{"version":3,"mappings":"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","names":["EventBus","app","document","appState","seen","themeManager","currentFilename","sourceBin","ElementFinder","pageElement","binsContainer","contextMenuHandler","page","bin","trimmed","type","defaultTags","allTags","pageId","tagManager","formatSelect","eventBus","formatRendererManager","error","remoteTimestamp","target","pathStartIndex","navigationEnd","pages","dataManager","afterCounts","elementToFind","index","titleElement","elementsList","elementIndex","itemIndex","timerElement","timeLogElement","fileInput","childIndex","pageFormat","isDroppingOnParent","binId","depth","elementId","e","container","rect","dragData"],"ignoreList":[],"sources":["../../js/utils/events.js","../../js/core/EventBus.js","../../js/core/AppEvents.js","../../js/core/ServiceLocator.js","../../js/core/AppServices.js","../../js/utils/ItemHierarchy.js","../../js/modules/DataManager.js","../../js/modules/ThemePresets.js","../../js/utils/string.js","../../js/modules/SettingsManager.js","../../js/modules/ThemeManager.js","../../js/modules/VisualSettingsManager.js","../../js/modules/PageManager.js","../../js/modules/BinManager.js","../../js/modules/ElementManager.js","../../js/modules/DragDropHandler.js","../../js/utils/ElementFinder.js","../../js/modules/AudioHandler.js","../../js/utils/EventHelper.js","../../js/modules/EventHandler.js","../../js/modules/ContextMenuHandler.js","../../js/modules/TouchGestureHandler.js","../../js/utils/dom.js","../../js/utils/DOMBuilder.js?v=103","../../js/utils/ModalBuilder.js?v=103","../../js/modules/modal/ModalService.js","../../js/modules/modal/ModalRenderer.js","../../js/modules/ModalHandler.js","../../js/modules/FileManager.js","../../js/utils/data.js","../../js/core/PluginManager.js","../../js/modules/PagePluginManager.js","../../js/modules/BinPluginManager.js","../../js/modules/ElementTypeManager.js","../../js/modules/FormatRendererManager.js","../../js/core/PluginLoaderService.js","../../js/modules/RelationshipManager.js","../../js/utils/storage.js","../../js/modules/TemplateManager.js","../../js/core/AutomationManager.js","../../js/modules/TagManager.js","../../js/modules/SearchIndex.js","../../js/modules/ExportService.js","../../js/modules/ImportService.js","../../js/core/OAuthManager.js","../../js/modules/SyncManager.js","../../js/modules/UndoRedoManager.js","../../js/modules/TimeTracker.js","../../js/core/BinRenderer.js","../../js/core/elements/TaskRenderer.js","../../js/core/elements/HeaderRenderer.js","../../js/core/elements/HeaderCheckboxRenderer.js","../../js/core/elements/MultiCheckboxRenderer.js","../../js/core/elements/AudioRenderer.js","../../js/core/elements/TimerRenderer.js","../../js/core/elements/CounterRenderer.js","../../js/core/elements/TrackerRenderer.js","../../js/core/elements/RatingRenderer.js","../../js/core/elements/TimeLogRenderer.js","../../js/core/elements/ImageRenderer.js","../../js/core/elements/ElementTypeRegistry.js","../../js/utils/SharedDragDrop.js","../../js/core/ElementRenderer.js","../../js/core/AnimationRenderer.js","../../js/core/PaneManager.js","../../js/core/AppRenderer.js","../../js/core/RenderService.js","../../js/core/AppState.js","../../js/core/PluginDiscoveryManager.js","../../js/core/AppInitializationManager.js","../../js/modules/DailyResetManager.js","../../js/modules/InlineEditor.js","../../js/utils/NavigationHelper.js","../../js/utils/LinkHandler.js","../../js/core/ModalEventBridge.js","../../app.js?v=104","../../js/core/BasePlugin.js"],"sourcesContent":["// Event System Utilities - Event emitter and event bus\r\nexport class EventEmitter {\r\n    constructor() {\r\n        this.events = {};\r\n    }\r\n    \r\n    /**\r\n     * Subscribe to event\r\n     * @param {string} event - Event name\r\n     * @param {Function} handler - Event handler\r\n     * @returns {Function} - Unsubscribe function\r\n     */\r\n    on(event, handler) {\r\n        if (!this.events[event]) {\r\n            this.events[event] = [];\r\n        }\r\n        this.events[event].push(handler);\r\n        \r\n        // Return unsubscribe function\r\n        return () => this.off(event, handler);\r\n    }\r\n    \r\n    /**\r\n     * Subscribe to event once\r\n     * @param {string} event - Event name\r\n     * @param {Function} handler - Event handler\r\n     * @returns {Function} - Unsubscribe function\r\n     */\r\n    once(event, handler) {\r\n        const onceHandler = (...args) => {\r\n            handler(...args);\r\n            this.off(event, onceHandler);\r\n        };\r\n        return this.on(event, onceHandler);\r\n    }\r\n    \r\n    /**\r\n     * Unsubscribe from event\r\n     * @param {string} event - Event name\r\n     * @param {Function} handler - Event handler\r\n     */\r\n    off(event, handler) {\r\n        if (!this.events[event]) return;\r\n        this.events[event] = this.events[event].filter(h => h !== handler);\r\n    }\r\n    \r\n    /**\r\n     * Emit event\r\n     * @param {string} event - Event name\r\n     * @param {...*} args - Event arguments\r\n     */\r\n    emit(event, ...args) {\r\n        if (!this.events[event]) return;\r\n        this.events[event].forEach(handler => {\r\n            try {\r\n                handler(...args);\r\n            } catch (error) {\r\n                console.error(`Error in event handler for \"${event}\":`, error);\r\n            }\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Remove all listeners for event\r\n     * @param {string} event - Event name\r\n     */\r\n    removeAllListeners(event) {\r\n        if (event) {\r\n            delete this.events[event];\r\n        } else {\r\n            this.events = {};\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get listener count for event\r\n     * @param {string} event - Event name\r\n     * @returns {number}\r\n     */\r\n    listenerCount(event) {\r\n        return this.events[event] ? this.events[event].length : 0;\r\n    }\r\n}\r\n\r\n// Global Event Bus\r\nclass EventBus extends EventEmitter {\r\n    constructor() {\r\n        super();\r\n        this.eventHistory = [];\r\n        this.maxHistorySize = 100;\r\n    }\r\n    \r\n    /**\r\n     * Emit event with history tracking\r\n     * @param {string} event - Event name\r\n     * @param {...*} args - Event arguments\r\n     */\r\n    emit(event, ...args) {\r\n        // Add to history\r\n        this.eventHistory.push({\r\n            event,\r\n            args,\r\n            timestamp: Date.now()\r\n        });\r\n        \r\n        // Limit history size\r\n        if (this.eventHistory.length > this.maxHistorySize) {\r\n            this.eventHistory.shift();\r\n        }\r\n        \r\n        // Emit to listeners\r\n        super.emit(event, ...args);\r\n    }\r\n    \r\n    /**\r\n     * Get event history\r\n     * @param {string} eventName - Optional event name to filter\r\n     * @param {number} limit - Limit number of results\r\n     * @returns {Array}\r\n     */\r\n    getHistory(eventName = null, limit = null) {\r\n        let history = this.eventHistory;\r\n        \r\n        if (eventName) {\r\n            history = history.filter(item => item.event === eventName);\r\n        }\r\n        \r\n        if (limit) {\r\n            history = history.slice(-limit);\r\n        }\r\n        \r\n        return history;\r\n    }\r\n    \r\n    /**\r\n     * Clear event history\r\n     */\r\n    clearHistory() {\r\n        this.eventHistory = [];\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const eventBus = new EventBus();\r\n\r\n// Event delegation helper\r\nexport const EventDelegation = {\r\n    /**\r\n     * Delegate event to matching elements\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {string} event - Event type\r\n     * @param {string} selector - CSS selector\r\n     * @param {Function} handler - Event handler\r\n     * @returns {Function} - Cleanup function\r\n     */\r\n    delegate(container, event, selector, handler) {\r\n        const wrappedHandler = (e) => {\r\n            const target = e.target.closest(selector);\r\n            if (target && container.contains(target)) {\r\n                handler.call(target, e);\r\n            }\r\n        };\r\n        \r\n        container.addEventListener(event, wrappedHandler);\r\n        \r\n        return () => {\r\n            container.removeEventListener(event, wrappedHandler);\r\n        };\r\n    }\r\n};\r\n\r\n","// EventBus - Global event bus for app-wide event communication\r\nimport { EventEmitter } from '../utils/events.js';\r\n\r\nexport class EventBus extends EventEmitter {\r\n    constructor() {\r\n        super();\r\n        this.eventHistory = [];\r\n        this.maxHistorySize = 100;\r\n    }\r\n    \r\n    /**\r\n     * Emit event with history tracking\r\n     * @param {string} event - Event name\r\n     * @param {...*} args - Event arguments\r\n     */\r\n    emit(event, ...args) {\r\n        // Add to history\r\n        this.eventHistory.push({\r\n            event,\r\n            args,\r\n            timestamp: Date.now()\r\n        });\r\n        \r\n        // Limit history size\r\n        if (this.eventHistory.length > this.maxHistorySize) {\r\n            this.eventHistory.shift();\r\n        }\r\n        \r\n        // Emit to listeners\r\n        super.emit(event, ...args);\r\n    }\r\n    \r\n    /**\r\n     * Get event history\r\n     * @param {string} eventName - Optional event name to filter\r\n     * @param {number} limit - Limit number of results\r\n     * @returns {Array}\r\n     */\r\n    getHistory(eventName = null, limit = null) {\r\n        let history = this.eventHistory;\r\n        \r\n        if (eventName) {\r\n            history = history.filter(item => item.event === eventName);\r\n        }\r\n        \r\n        if (limit) {\r\n            history = history.slice(-limit);\r\n        }\r\n        \r\n        return history;\r\n    }\r\n    \r\n    /**\r\n     * Clear event history\r\n     */\r\n    clearHistory() {\r\n        this.eventHistory = [];\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const eventBus = new EventBus();\r\n\r\n","// AppEvents.js - Event name constants and payload documentation\r\n// Standardizes event names across the application to prevent typos and improve maintainability\r\n\r\n/**\r\n * Application Event Constants\r\n * \r\n * All events emitted through the EventBus should use these constants.\r\n * This ensures consistency and makes it easier to track event usage.\r\n */\r\nexport const EVENTS = {\r\n    /**\r\n     * Application-level events\r\n     */\r\n    APP: {\r\n        /** Request application render\r\n         * @event app:render-requested\r\n         * @type {void}\r\n         * Emitted when any module needs the UI to be re-rendered\r\n         */\r\n        RENDER_REQUESTED: 'app:render-requested',\r\n        \r\n        /** Application render completed\r\n         * @event app:rendered\r\n         * @type {void}\r\n         * Emitted after render is complete\r\n         */\r\n        RENDERED: 'app:rendered',\r\n        \r\n        /** Application initialized\r\n         * @event app:initialized\r\n         * @type {void}\r\n         * Emitted when app initialization is complete\r\n         */\r\n        INITIALIZED: 'app:initialized',\r\n    },\r\n    \r\n    /**\r\n     * Data management events\r\n     */\r\n    DATA: {\r\n        /** Request data save\r\n         * @event data:save-requested\r\n         * @type {void}\r\n         * Emitted when data should be saved\r\n         */\r\n        SAVE_REQUESTED: 'data:save-requested',\r\n        \r\n        /** Data saved\r\n         * @event data:saved\r\n         * @type {void}\r\n         * Emitted after data is successfully saved\r\n         */\r\n        SAVED: 'data:saved',\r\n        \r\n        /** Data loaded\r\n         * @event data:loaded\r\n         * @type {{data: Object}}\r\n         * Emitted when data is loaded from storage\r\n         */\r\n        LOADED: 'data:loaded',\r\n        \r\n        /** Data changed\r\n         * @event data:changed\r\n         * @type {{change: Object}}\r\n         * Emitted when data structure changes\r\n         */\r\n        CHANGED: 'data:changed',\r\n    },\r\n    \r\n    /**\r\n     * Element events\r\n     */\r\n    ELEMENT: {\r\n        /** Element created\r\n         * @event element:created\r\n         * @type {{pageId: string, binId: string, elementIndex: number, element: Object}}\r\n         */\r\n        CREATED: 'element:created',\r\n        \r\n        /** Element updated\r\n         * @event element:updated\r\n         * @type {{pageId: string, binId: string, elementIndex: number, element: Object}}\r\n         */\r\n        UPDATED: 'element:updated',\r\n        \r\n        /** Element completed\r\n         * @event element:completed\r\n         * @type {{pageId: string, binId: string, elementIndex: number, element: Object}}\r\n         */\r\n        COMPLETED: 'element:completed',\r\n        \r\n        /** Element deleted\r\n         * @event element:deleted\r\n         * @type {{pageId: string, binId: string, elementIndex: number}}\r\n         */\r\n        DELETED: 'element:deleted',\r\n        \r\n        /** Element moved\r\n         * @event element:moved\r\n         * @type {{sourcePageId: string, sourceBinId: string, sourceElementIndex: number, targetPageId: string, targetBinId: string, targetElementIndex: number}}\r\n         */\r\n        MOVED: 'element:moved',\r\n    },\r\n    \r\n    /**\r\n     * Page events\r\n     */\r\n    PAGE: {\r\n        /** Page created\r\n         * @event page:created\r\n         * @type {{pageId: string, page: Object}}\r\n         */\r\n        CREATED: 'page:created',\r\n        \r\n        /** Page deleted\r\n         * @event page:deleted\r\n         * @type {{pageId: string}}\r\n         */\r\n        DELETED: 'page:deleted',\r\n        \r\n        /** Page switched\r\n         * @event page:switched\r\n         * @type {{pageId: string}}\r\n         */\r\n        SWITCHED: 'page:switched',\r\n    },\r\n    \r\n    /**\r\n     * Bin events\r\n     */\r\n    BIN: {\r\n        /** Bin created\r\n         * @event bin:created\r\n         * @type {{pageId: string, binId: string, bin: Object}}\r\n         */\r\n        CREATED: 'bin:created',\r\n        \r\n        /** Bin deleted\r\n         * @event bin:deleted\r\n         * @type {{pageId: string, binId: string}}\r\n         */\r\n        DELETED: 'bin:deleted',\r\n    },\r\n    \r\n    /**\r\n     * Undo/Redo events\r\n     */\r\n    UNDO_REDO: {\r\n        /** Change recorded\r\n         * @event undo-redo:change-recorded\r\n         * @type {{change: Object}}\r\n         */\r\n        CHANGE_RECORDED: 'undo-redo:change-recorded',\r\n        \r\n        /** Undo performed\r\n         * @event undo-redo:undo\r\n         * @type {{change: Object}}\r\n         */\r\n        UNDO: 'undo-redo:undo',\r\n        \r\n        /** Redo performed\r\n         * @event undo-redo:redo\r\n         * @type {{change: Object}}\r\n         */\r\n        REDO: 'undo-redo:redo',\r\n    },\r\n    \r\n    /**\r\n     * Sync events\r\n     */\r\n    SYNC: {\r\n        /** Change received from remote\r\n         * @event sync:change-received\r\n         * @type {{change: Object, clientId: string}}\r\n         */\r\n        CHANGE_RECEIVED: 'sync:change-received',\r\n        \r\n        /** Connected to sync server\r\n         * @event sync:connected\r\n         * @type {{clientId: string}}\r\n         */\r\n        CONNECTED: 'sync:connected',\r\n        \r\n        /** Disconnected from sync server\r\n         * @event sync:disconnected\r\n         * @type {void}\r\n         */\r\n        DISCONNECTED: 'sync:disconnected',\r\n    },\r\n    \r\n    /**\r\n     * Format renderer events\r\n     */\r\n    FORMAT: {\r\n        /** Format registered\r\n         * @event format:registered\r\n         * @type {{pluginId: string, formatName: string}}\r\n         */\r\n        REGISTERED: 'format:registered',\r\n        \r\n        /** Format changed for page/bin\r\n         * @event format:changed\r\n         * @type {{pageId: string, binId?: string, formatName: string}}\r\n         */\r\n        CHANGED: 'format:changed',\r\n    },\r\n    \r\n    /**\r\n     * Plugin events\r\n     */\r\n    PLUGIN: {\r\n        /** Plugin loaded\r\n         * @event plugin:loaded\r\n         * @type {{pluginId: string, plugin: Object}}\r\n         */\r\n        LOADED: 'plugin:loaded',\r\n        \r\n        /** Plugin enabled\r\n         * @event plugin:enabled\r\n         * @type {{pluginId: string}}\r\n         */\r\n        ENABLED: 'plugin:enabled',\r\n        \r\n        /** Plugin disabled\r\n         * @event plugin:disabled\r\n         * @type {{pluginId: string}}\r\n         */\r\n        DISABLED: 'plugin:disabled',\r\n    },\r\n    \r\n    /**\r\n     * UI events\r\n     */\r\n    UI: {\r\n        /** UI state changed\r\n         * @event ui:changed\r\n         * @type {{type: string, value: any}}\r\n         * Emitted when UI state changes (e.g., multiPaneEnabled)\r\n         */\r\n        CHANGED: 'ui:changed',\r\n        \r\n        /** Show edit modal\r\n         * @event ui:show-edit-modal\r\n         * @type {{pageId: string, binId: string, elementIndex: number, element: Object}}\r\n         */\r\n        SHOW_EDIT_MODAL: 'ui:show-edit-modal',\r\n        \r\n        /** Show add element modal\r\n         * @event ui:show-add-element-modal\r\n         * @type {{pageId: string, binId?: string, elementIndex?: number}}\r\n         */\r\n        SHOW_ADD_ELEMENT_MODAL: 'ui:show-add-element-modal',\r\n        \r\n        /** Show add child element modal\r\n         * @event ui:show-add-child-element-modal\r\n         * @type {{pageId: string, binId: string, elementIndex: number}}\r\n         */\r\n        SHOW_ADD_CHILD_ELEMENT_MODAL: 'ui:show-add-child-element-modal',\r\n        \r\n        /** Show add subtasks modal\r\n         * @event ui:show-add-subtasks-modal\r\n         * @type {{pageId: string, binId: string, elementIndex: number, element: Object}}\r\n         */\r\n        SHOW_ADD_SUBTASKS_MODAL: 'ui:show-add-subtasks-modal',\r\n        \r\n        /** Show view data modal\r\n         * @event ui:show-view-data-modal\r\n         * @type {{element: Object, isSubtask?: boolean}}\r\n         */\r\n        SHOW_VIEW_DATA_MODAL: 'ui:show-view-data-modal',\r\n        \r\n        /** Show edit page modal\r\n         * @event ui:show-edit-page-modal\r\n         * @type {{pageId: string}}\r\n         */\r\n        SHOW_EDIT_PAGE_MODAL: 'ui:show-edit-page-modal',\r\n        \r\n        /** Show edit bin modal\r\n         * @event ui:show-edit-bin-modal\r\n         * @type {{pageId: string, binId: string}}\r\n         */\r\n        SHOW_EDIT_BIN_MODAL: 'ui:show-edit-bin-modal',\r\n        \r\n        /** Show visual customization modal\r\n         * @event ui:show-visual-customization-modal\r\n         * @type {{targetType: string, targetId: string, context: Object}}\r\n         */\r\n        SHOW_VISUAL_CUSTOMIZATION_MODAL: 'ui:show-visual-customization-modal',\r\n        \r\n        /** Close modal\r\n         * @event ui:close-modal\r\n         * @type {void}\r\n         */\r\n        CLOSE_MODAL: 'ui:close-modal',\r\n        \r\n        /** Focus input element\r\n         * @event ui:focus-input\r\n         * @type {{inputId: string, select?: boolean}}\r\n         */\r\n        FOCUS_INPUT: 'ui:focus-input',\r\n    },\r\n};\r\n\r\n/**\r\n * Helper function to emit events with type safety\r\n * @param {string} eventName - Event name from EVENTS constants\r\n * @param {*} payload - Event payload\r\n */\r\nexport function emitEvent(eventName, payload = null) {\r\n    // This will be used with EventBus once we have a reference\r\n    // For now, it's a placeholder for documentation\r\n    console.warn('emitEvent called without EventBus reference. Use eventBus.emit() directly.');\r\n}\r\n\r\n","// ServiceLocator.js - Singleton service locator for dependency injection\r\n// Provides a centralized registry for app services, reducing coupling between modules\r\n\r\n/**\r\n * Service Locator - Singleton pattern for service registration and retrieval\r\n * \r\n * This allows modules to access only the services they need without requiring\r\n * the full app instance, improving modularity and testability.\r\n */\r\nexport class ServiceLocator {\r\n    constructor() {\r\n        if (ServiceLocator.instance) {\r\n            return ServiceLocator.instance;\r\n        }\r\n        \r\n        this.services = new Map();\r\n        this.lazyFactories = new Map(); // For services that need lazy initialization\r\n        ServiceLocator.instance = this;\r\n    }\r\n    \r\n    /**\r\n     * Register a service\r\n     * @param {string} name - Service name\r\n     * @param {*} service - Service instance\r\n     * @throws {Error} If service name is already registered\r\n     */\r\n    register(name, service) {\r\n        if (this.services.has(name)) {\r\n            throw new Error(`Service \"${name}\" is already registered`);\r\n        }\r\n        this.services.set(name, service);\r\n    }\r\n    \r\n    /**\r\n     * Register a lazy service factory\r\n     * @param {string} name - Service name\r\n     * @param {Function} factory - Factory function that returns the service\r\n     */\r\n    registerLazy(name, factory) {\r\n        if (this.lazyFactories.has(name)) {\r\n            throw new Error(`Lazy service \"${name}\" is already registered`);\r\n        }\r\n        this.lazyFactories.set(name, factory);\r\n    }\r\n    \r\n    /**\r\n     * Get a service by name\r\n     * @param {string} name - Service name\r\n     * @returns {*} Service instance\r\n     * @throws {Error} If service is not registered\r\n     */\r\n    get(name) {\r\n        // Check if service is already instantiated\r\n        if (this.services.has(name)) {\r\n            return this.services.get(name);\r\n        }\r\n        \r\n        // Check if there's a lazy factory\r\n        if (this.lazyFactories.has(name)) {\r\n            const factory = this.lazyFactories.get(name);\r\n            const service = factory();\r\n            this.services.set(name, service);\r\n            this.lazyFactories.delete(name);\r\n            return service;\r\n        }\r\n        \r\n        throw new Error(`Service \"${name}\" is not registered`);\r\n    }\r\n    \r\n    /**\r\n     * Check if a service is registered\r\n     * @param {string} name - Service name\r\n     * @returns {boolean}\r\n     */\r\n    has(name) {\r\n        return this.services.has(name) || this.lazyFactories.has(name);\r\n    }\r\n    \r\n    /**\r\n     * Unregister a service (useful for testing)\r\n     * @param {string} name - Service name\r\n     */\r\n    unregister(name) {\r\n        this.services.delete(name);\r\n        this.lazyFactories.delete(name);\r\n    }\r\n    \r\n    /**\r\n     * Clear all services (useful for testing)\r\n     */\r\n    clear() {\r\n        this.services.clear();\r\n        this.lazyFactories.clear();\r\n    }\r\n    \r\n    /**\r\n     * Get all registered service names\r\n     * @returns {string[]}\r\n     */\r\n    getRegisteredServices() {\r\n        const services = Array.from(this.services.keys());\r\n        const lazy = Array.from(this.lazyFactories.keys());\r\n        return [...services, ...lazy];\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const serviceLocator = new ServiceLocator();\r\n\r\n","// AppServices.js - Service name constants and registration helpers\nimport { serviceLocator } from './ServiceLocator.js';\nimport { eventBus } from './EventBus.js';\n\n/**\n * Service name constants\n * Use these constants instead of magic strings to prevent typos\n */\nexport const SERVICES = {\n    // Core services\n    DATA_MANAGER: 'dataManager',\n    UNDO_REDO_MANAGER: 'undoRedoManager',\n    SYNC_MANAGER: 'syncManager',\n    EVENT_BUS: 'eventBus',\n    RENDERER: 'renderer',\n    \n    // Manager services\n    SETTINGS_MANAGER: 'settingsManager',\n    THEME_MANAGER: 'themeManager',\n    VISUAL_SETTINGS_MANAGER: 'visualSettingsManager',\n    PAGE_MANAGER: 'pageManager',\n    BIN_MANAGER: 'binManager',\n    ELEMENT_MANAGER: 'elementManager',\n    FILE_MANAGER: 'fileManager',\n    MODAL_HANDLER: 'modalHandler',\n    DRAG_DROP_HANDLER: 'dragDropHandler',\n    CONTEXT_MENU_HANDLER: 'contextMenuHandler',\n    TOUCH_GESTURE_HANDLER: 'touchGestureHandler',\n    EVENT_HANDLER: 'eventHandler',\n    AUDIO_HANDLER: 'audioHandler',\n    \n    // Feature services\n    RELATIONSHIP_MANAGER: 'relationshipManager',\n    TEMPLATE_MANAGER: 'templateManager',\n    AUTOMATION_MANAGER: 'automationManager',\n    TAG_MANAGER: 'tagManager',\n    SEARCH_INDEX: 'searchIndex',\n    EXPORT_SERVICE: 'exportService',\n    IMPORT_SERVICE: 'importService',\n    OAUTH_MANAGER: 'oauthManager',\n    TIME_TRACKER: 'timeTracker',\n    DAILY_RESET_MANAGER: 'dailyResetManager',\n    INLINE_EDITOR: 'inlineEditor',\n    \n    // Plugin system\n    PAGE_PLUGIN_MANAGER: 'pagePluginManager',\n    BIN_PLUGIN_MANAGER: 'binPluginManager',\n    ELEMENT_TYPE_MANAGER: 'elementTypeManager',\n    FORMAT_RENDERER_MANAGER: 'formatRendererManager',\n    \n    // App state (for accessing pages array, etc.)\n    APP_STATE: 'appState'\n};\n\n/**\n * Register a service with the service locator\n * @param {string} name - Service name (use SERVICES constants)\n * @param {*} service - Service instance\n */\nexport function registerService(name, service) {\n    serviceLocator.register(name, service);\n}\n\n/**\n * Get a service from the service locator\n * @param {string} name - Service name (use SERVICES constants)\n * @returns {*} Service instance\n */\nexport function getService(name) {\n    return serviceLocator.get(name);\n}\n\n/**\n * Check if a service is registered\n * @param {string} name - Service name\n * @returns {boolean}\n */\nexport function hasService(name) {\n    return serviceLocator.has(name);\n}\n\n/**\n * Register all core services from app instance\n * This is called during app initialization\n * @param {Object} app - TodoApp instance\n */\nexport function registerAllServices(app) {\n    // Core services\n    // EVENT_BUS is already registered in app.js using the imported singleton\n    // Only register if not already registered (for backward compatibility)\n    if (!hasService(SERVICES.EVENT_BUS)) {\n        registerService(SERVICES.EVENT_BUS, app.eventBus || eventBus);\n    }\n    // These may already be registered, but registerAllServices will overwrite with latest instance\n    if (!hasService(SERVICES.DATA_MANAGER)) {\n        registerService(SERVICES.DATA_MANAGER, app.dataManager);\n    }\n    if (!hasService(SERVICES.UNDO_REDO_MANAGER)) {\n        registerService(SERVICES.UNDO_REDO_MANAGER, app.undoRedoManager);\n    }\n    registerService(SERVICES.SYNC_MANAGER, app.syncManager);\n    \n    // Manager services\n    // These services may already be registered in app.js, check before registering\n    if (!hasService(SERVICES.SETTINGS_MANAGER)) {\n        registerService(SERVICES.SETTINGS_MANAGER, app.settingsManager);\n    }\n    if (!hasService(SERVICES.THEME_MANAGER)) {\n        registerService(SERVICES.THEME_MANAGER, app.themeManager);\n    }\n    if (!hasService(SERVICES.VISUAL_SETTINGS_MANAGER)) {\n        registerService(SERVICES.VISUAL_SETTINGS_MANAGER, app.visualSettingsManager);\n    }\n    if (!hasService(SERVICES.PAGE_MANAGER)) {\n        registerService(SERVICES.PAGE_MANAGER, app.pageManager);\n    }\n    if (!hasService(SERVICES.BIN_MANAGER)) {\n        registerService(SERVICES.BIN_MANAGER, app.binManager);\n    }\n    if (!hasService(SERVICES.ELEMENT_MANAGER)) {\n        registerService(SERVICES.ELEMENT_MANAGER, app.elementManager);\n    }\n    registerService(SERVICES.FILE_MANAGER, app.fileManager);\n    registerService(SERVICES.MODAL_HANDLER, app.modalHandler);\n    registerService(SERVICES.DRAG_DROP_HANDLER, app.dragDropHandler);\n    registerService(SERVICES.CONTEXT_MENU_HANDLER, app.contextMenuHandler);\n    registerService(SERVICES.TOUCH_GESTURE_HANDLER, app.touchGestureHandler);\n    registerService(SERVICES.EVENT_HANDLER, app.eventHandler);\n    registerService(SERVICES.AUDIO_HANDLER, app.audioHandler);\n    \n    // Feature services\n    registerService(SERVICES.RELATIONSHIP_MANAGER, app.relationshipManager);\n    registerService(SERVICES.TEMPLATE_MANAGER, app.templateManager);\n    registerService(SERVICES.AUTOMATION_MANAGER, app.automationEngine);\n    registerService(SERVICES.TAG_MANAGER, app.tagManager);\n    registerService(SERVICES.SEARCH_INDEX, app.searchIndex);\n    registerService(SERVICES.EXPORT_SERVICE, app.exportService);\n    registerService(SERVICES.IMPORT_SERVICE, app.importService);\n    registerService(SERVICES.OAUTH_MANAGER, app.oauthManager);\n    registerService(SERVICES.TIME_TRACKER, app.timeTracker);\n    registerService(SERVICES.DAILY_RESET_MANAGER, app.dailyResetManager);\n    registerService(SERVICES.INLINE_EDITOR, app.inlineEditor);\n    \n    // Plugin system\n    registerService(SERVICES.PAGE_PLUGIN_MANAGER, app.pagePluginManager);\n    registerService(SERVICES.BIN_PLUGIN_MANAGER, app.binPluginManager);\n    registerService(SERVICES.ELEMENT_TYPE_MANAGER, app.elementTypeManager);\n    registerService(SERVICES.FORMAT_RENDERER_MANAGER, app.formatRendererManager);\n    \n    // App state - provide access to pages array and other app state\n    // Now uses AppState instance\n    // APP_STATE may already be registered in app.js, check before registering\n    if (!hasService(SERVICES.APP_STATE)) {\n        registerService(SERVICES.APP_STATE, app.appState);\n    }\n}\n\n","// ItemHierarchy.js - Helpers for ID-link item nesting\r\n\r\nexport const ItemHierarchy = {\r\n    buildItemIndex(items) {\r\n        const index = {};\r\n        if (!items || !Array.isArray(items)) {\r\n            return index;\r\n        }\r\n        items.forEach(item => {\r\n            if (!item || typeof item !== 'object' || !item.id) {\r\n                return;\r\n            }\r\n            index[item.id] = item;\r\n        });\r\n        return index;\r\n    },\r\n\r\n    getRootItems(items) {\r\n        if (!items || !Array.isArray(items)) {\r\n            return [];\r\n        }\r\n        return items.filter(item => item && !item.parentId);\r\n    },\r\n\r\n    getRootItemAtIndex(items, index) {\r\n        if (typeof index !== 'number' || index < 0) {\r\n            return null;\r\n        }\r\n        const rootItems = ItemHierarchy.getRootItems(items);\r\n        return rootItems[index] || null;\r\n    },\r\n\r\n    getChildItems(item, itemIndex) {\r\n        if (!itemIndex || typeof itemIndex !== 'object') {\r\n            return [];\r\n        }\r\n        const childIds = Array.isArray(item?.childIds) ? item.childIds : [];\r\n        return childIds.map(id => itemIndex[id]).filter(Boolean);\r\n    }\r\n};\r\n","// DataManager.js - Handles all data loading, saving, and migration\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class DataManager {\n    constructor() {\n        this.storageKey = 'twodo-data';\n        this.lastResetKey = 'twodo-last-reset';\n        this._lastSyncTimestamp = 0; // Track last sync timestamp to prevent conflicts\n        this.setupEventListeners();\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Get SettingsManager service\n     */\n    _getSettingsManager() {\n        return getService(SERVICES.SETTINGS_MANAGER);\n    }\n    \n    /**\n     * Get SyncManager service\n     */\n    _getSyncManager() {\n        return getService(SERVICES.SYNC_MANAGER);\n    }\n    \n    /**\n     * Get FileManager service\n     */\n    _getFileManager() {\n        return getService(SERVICES.FILE_MANAGER);\n    }\n    \n    /**\n     * Setup EventBus listeners for save requests\n     */\n    setupEventListeners() {\n        eventBus.on(EVENTS.DATA.SAVE_REQUESTED, (skipSync = false) => {\n            this.saveData(skipSync);\n        });\n    }\n    \n    checkDailyReset() {\n        const today = new Date().toDateString();\n        const lastReset = localStorage.getItem(this.lastResetKey);\n        \n        if (lastReset !== today) {\n            // Reset all repeating tasks\n            const storedData = this._normalizeDataModel(this.loadFromStorage());\n            if (storedData && storedData.documents) {\n                // Delete completed one-time tasks first\n                storedData.documents.forEach(document => {\n                    if (document.groups) {\n                        document.groups.forEach(group => {\n                            if (group.items) {\n                                const removeIds = new Set(\n                                    group.items\n                                        .filter(item => item?.repeats === false && item?.completed)\n                                        .map(item => item.id)\n                                );\n                                group.items = group.items.filter(item => !removeIds.has(item.id));\n                                group.items.forEach(item => {\n                                    if (Array.isArray(item.childIds)) {\n                                        item.childIds = item.childIds.filter(id => !removeIds.has(id));\n                                    }\n                                    if (item.parentId && removeIds.has(item.parentId)) {\n                                        item.parentId = null;\n                                    }\n                                });\n                            }\n                        });\n                    } else if (document.items) {\n                        // Legacy support: migrate old structure\n                        document.items = document.items.filter(item => {\n                            // Delete one-time tasks that are completed\n                            if (item.repeats === false && item.completed) {\n                                return false;\n                            }\n                            return true;\n                        });\n                    }\n                });\n                \n                // Reset all repeating tasks\n                const resetItem = (item, documentId, itemIndex, itemIndexMap) => {\n                    if (item.repeats !== false) {\n                        item.completed = false;\n                        \n                        // Reset children (one level for current implementation)\n                        if (itemIndexMap) {\n                            const childItems = ItemHierarchy.getChildItems(item, itemIndexMap);\n                            childItems.forEach(child => {\n                                if (child.repeats !== false) {\n                                    child.completed = false;\n                                }\n                            });\n                        }\n                        \n                        // Handle audio elements - archive and clear\n                        if (item.type === 'audio' && item.repeats !== false) {\n                            if (item.audioFile && item.date) {\n                                this.archiveAudioRecording(documentId, itemIndex, item.audioFile, item.date);\n                            }\n                            item.audioFile = null;\n                            item.date = null;\n                        }\n                        \n                        if (item.items) {\n                            item.items.forEach(subItem => {\n                                if (subItem.repeats !== false) {\n                                    subItem.completed = false;\n                                }\n                            });\n                        }\n                    }\n                };\n                \n                storedData.documents.forEach(document => {\n                    if (document.groups) {\n                        document.groups.forEach(group => {\n                            if (group.items) {\n                                const itemIndexMap = ItemHierarchy.buildItemIndex(group.items);\n                                group.items.forEach((item, itemIndex) => {\n                                    resetItem(item, document.id, itemIndex, itemIndexMap);\n                                });\n                            }\n                        });\n                    } else if (document.items) {\n                        // Legacy support\n                        document.items.forEach((item, itemIndex) => {\n                            resetItem(item, document.id, itemIndex);\n                        });\n                    }\n                });\n                const appState = this._getAppState();\n                appState.documents = storedData.documents;\n                this.saveData();\n            }\n            localStorage.setItem(this.lastResetKey, today);\n        }\n    }\n    \n    loadFromStorage() {\n        const stored = localStorage.getItem(this.storageKey);\n        if (stored) {\n            try {\n                return JSON.parse(stored);\n            } catch (e) {\n                console.error('Failed to parse stored data:', e);\n            }\n        }\n        return null;\n    }\n\n    _normalizeDataModel(rawData) {\n        if (!rawData || typeof rawData !== 'object') {\n            return { documents: [] };\n        }\n\n        const normalized = { ...rawData };\n        normalized.documents = normalized.documents || [];\n        normalized.documentStates = normalized.documentStates || {};\n        normalized.groupStates = normalized.groupStates || {};\n        normalized.documents = this._migrateDocumentsToIdLinks(normalized.documents);\n        return normalized;\n    }\n\n    normalizeDataModel(rawData) {\n        return this._normalizeDataModel(rawData);\n    }\n\n    _generateItemId() {\n        return `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n    }\n\n    _ensureDocumentDefaults(document) {\n        const config = document.config && typeof document.config === 'object' ? document.config : {};\n        const groupMode = document.groupMode || config.groupMode || 'manual';\n        return {\n            ...document,\n            groups: Array.isArray(document.groups) ? document.groups : [],\n            config: { ...config, groupMode },\n            groupMode\n        };\n    }\n\n    _ensureGroupDefaults(group) {\n        return {\n            ...group,\n            items: Array.isArray(group.items) ? group.items : [],\n            level: typeof group.level === 'number' ? group.level : 0,\n            parentGroupId: group.parentGroupId ?? null\n        };\n    }\n\n    _migrateItemsToIdLinks(items) {\n        const flatItems = [];\n        const seen = new Set();\n\n        const addItem = (item, parentId = null) => {\n            if (!item || typeof item !== 'object') {\n                return null;\n            }\n\n            const itemId = item.id || this._generateItemId();\n            item.id = itemId;\n            if (parentId !== null) {\n                item.parentId = parentId;\n            } else if (!item.parentId) {\n                item.parentId = null;\n            }\n\n            const existingChildIds = Array.isArray(item.childIds) ? [...item.childIds] : [];\n            const children = Array.isArray(item.children) ? item.children : [];\n\n            if (Array.isArray(item.subtasks) && item.subtasks.length > 0) {\n                item.subtasks.forEach(subtask => {\n                    const childItem = {\n                        id: this._generateItemId(),\n                        type: 'task',\n                        text: subtask.text || 'Subtask',\n                        completed: subtask.completed || false,\n                        timeAllocated: subtask.timeAllocated || '',\n                        repeats: subtask.repeats !== undefined ? subtask.repeats : true,\n                        funModifier: subtask.funModifier || '',\n                        parentId: itemId,\n                        childIds: [],\n                        config: {}\n                    };\n                    children.push(childItem);\n                });\n                delete item.subtasks;\n            }\n\n            if (!seen.has(itemId)) {\n                flatItems.push(item);\n                seen.add(itemId);\n            }\n\n            item.childIds = [];\n            children.forEach(child => {\n                const childId = addItem(child, itemId);\n                if (childId) {\n                    item.childIds.push(childId);\n                }\n            });\n\n            if (item.childIds.length === 0 && existingChildIds.length > 0) {\n                item.childIds = existingChildIds;\n            }\n\n            delete item.children;\n            return itemId;\n        };\n\n        (items || []).forEach(item => addItem(item, null));\n\n        const itemIndex = ItemHierarchy.buildItemIndex(flatItems);\n        flatItems.forEach(item => {\n            if (item.parentId && itemIndex[item.parentId]) {\n                const parent = itemIndex[item.parentId];\n                if (!Array.isArray(parent.childIds)) {\n                    parent.childIds = [];\n                }\n                if (!parent.childIds.includes(item.id)) {\n                    parent.childIds.push(item.id);\n                }\n            }\n        });\n\n        flatItems.forEach(item => {\n            const childIds = Array.isArray(item.childIds) ? item.childIds : [];\n            item.childIds = childIds.filter(childId => itemIndex[childId]);\n            if (item.parentId && !itemIndex[item.parentId]) {\n                item.parentId = null;\n            }\n        });\n\n        return flatItems;\n    }\n\n    _migrateDocumentsToIdLinks(documents) {\n        return documents.map(rawDocument => {\n            const document = this._ensureDocumentDefaults(rawDocument);\n            let groups = document.groups;\n\n            if ((!groups || groups.length === 0) && Array.isArray(document.items)) {\n                groups = [{\n                    id: 'group-0',\n                    title: 'Group 1',\n                    items: document.items,\n                    level: 0,\n                    parentGroupId: null\n                }];\n                delete document.items;\n            }\n\n            const normalizedGroups = (groups || []).map(group => {\n                const normalizedGroup = this._ensureGroupDefaults(group);\n                normalizedGroup.items = this._migrateItemsToIdLinks(normalizedGroup.items);\n                return normalizedGroup;\n            });\n\n            return {\n                ...document,\n                groups: normalizedGroups\n            };\n        });\n    }\n    \n    migrateSubtasksToChildren(data) {\n        if (!data) {\n            return data;\n        }\n        data.documents = this._migrateDocumentsToIdLinks(data.documents || []);\n        return data;\n    }\n    \n    loadData() {\n        const normalized = this._normalizeDataModel(this.loadFromStorage());\n        const appState = this._getAppState();\n        \n        const documents = (normalized.documents || []).map((document) => {\n            const groups = document.groups || [];\n            if (groups.length === 0) {\n                return {\n                    ...document,\n                    groups: [{\n                        id: 'group-0',\n                        title: 'Group 1',\n                        items: [],\n                        level: 0,\n                        parentGroupId: null\n                    }]\n                };\n            }\n            return {\n                ...document,\n                groups\n            };\n        });\n        \n        if (documents.length > 0) {\n            appState.documents = documents;\n        } else {\n            appState.documents = [{\n                id: 'document-1',\n                groups: [{\n                    id: 'group-0',\n                    title: 'Group 1',\n                    items: [],\n                    level: 0,\n                    parentGroupId: null\n                }]\n            }];\n        }\n        \n        const storedCurrentId = normalized.currentDocumentId;\n        if (storedCurrentId) {\n            appState.currentDocumentId = storedCurrentId;\n        } else if (appState.documents.length > 0) {\n            appState.currentDocumentId = appState.documents[0].id;\n        }\n        \n        if (normalized.documentStates) {\n            appState.documentStates = normalized.documentStates;\n        }\n        \n        if (normalized.groupStates) {\n            appState.groupStates = normalized.groupStates;\n        }\n        \n        if (normalized.subtaskStates) {\n            if (appState.setSubtaskState) {\n                Object.keys(normalized.subtaskStates).forEach(key => {\n                    appState.setSubtaskState(key, normalized.subtaskStates[key]);\n                });\n            } else {\n                appState.subtaskStates = normalized.subtaskStates;\n            }\n        }\n        if (normalized.allSubtasksExpanded !== undefined) {\n            appState.allSubtasksExpanded = normalized.allSubtasksExpanded;\n        }\n        \n        if (normalized.settings) {\n            const settingsManager = this._getSettingsManager();\n            if (settingsManager) {\n                settingsManager.saveSettings(normalized.settings);\n            }\n        }\n        \n        this.saveData();\n    }\n    \n    saveData(skipSync = false) {\n        // Debounce autosave to server\n        if (this._autosaveTimer) {\n            clearTimeout(this._autosaveTimer);\n        }\n        \n        this._autosaveTimer = setTimeout(() => {\n            this._autosaveToServer();\n        }, 500); // Wait 500ms after last change before saving\n        \n        // Track that there's a pending save\n        this._hasPendingSave = true;\n        \n        // Debounce WebSocket sync (shorter delay for real-time feel)\n            // Skip sync if this is from a remote update to prevent loops\n        if (!skipSync) {\n            if (this._syncTimer) {\n                clearTimeout(this._syncTimer);\n            }\n            \n            this._syncTimer = setTimeout(() => {\n                // Send full data sync via WebSocket for real-time updates\n                const syncManager = this._getSyncManager();\n                const fileManager = this._getFileManager();\n                if (syncManager && syncManager.isConnected && fileManager && fileManager.currentFilename) {\n                    this._syncDataToWebSocket();\n                }\n            }, 200); // Wait 200ms after last change before syncing\n        }\n        \n        const appState = this._getAppState();\n        const settingsManager = this._getSettingsManager();\n        const documents = appState.documents;\n        const localData = {\n            documents,\n            currentDocumentId: appState.currentDocumentId,\n            lastModified: new Date().toISOString(),\n            groupStates: appState.groupStates || {},\n            subtaskStates: appState.subtaskStates || {},\n            allSubtasksExpanded: appState.allSubtasksExpanded,\n            settings: settingsManager ? settingsManager.loadSettings() : {}\n        };\n        localStorage.setItem(this.storageKey, JSON.stringify(localData));\n    }\n    \n    /**\n     * Sync data to WebSocket for real-time updates\n     */\n    _syncDataToWebSocket() {\n        const syncManager = this._getSyncManager();\n        const fileManager = this._getFileManager();\n        \n        if (!syncManager || !syncManager.isConnected) {\n            return;\n        }\n        \n        if (!fileManager || !fileManager.currentFilename) {\n            return;\n        }\n        \n        // Update last sync timestamp\n        this._lastSyncTimestamp = Date.now();\n        \n        // Send full data state for sync\n        const appState = this._getAppState();\n        const settingsManager = this._getSettingsManager();\n        const documents = appState.documents;\n        const syncPayload = {\n            documents,\n            currentDocumentId: appState.currentDocumentId,\n            groupStates: appState.groupStates || {},\n            subtaskStates: appState.subtaskStates || {},\n            allSubtasksExpanded: appState.allSubtasksExpanded,\n            settings: settingsManager ? settingsManager.loadSettings() : {},\n            timestamp: this._lastSyncTimestamp\n        };\n        \n        // Send as a \"full sync\" change\n        syncManager.send({\n            type: 'full_sync',\n            filename: fileManager.currentFilename,\n            data: syncPayload,\n            timestamp: this._lastSyncTimestamp\n        });\n    }\n    \n    /**\n     * Autosave to server if a file is currently open\n     * This is called automatically after saveData() with debouncing\n     */\n    async _autosaveToServer() {\n        // Only autosave if a file is currently open\n        const fileManager = this._getFileManager();\n        if (!fileManager || !fileManager.currentFilename) {\n            console.log('[DataManager] Autosave skipped - no currentFilename:', {\n                hasFileManager: !!fileManager,\n                currentFilename: fileManager?.currentFilename\n            });\n            return;\n        }\n        \n        const currentFilename = fileManager.currentFilename;\n        console.log('[DataManager] Autosaving to:', currentFilename);\n        \n        try {\n            const appState = this._getAppState();\n            const autosaveData = {\n                documents: appState.documents\n            };\n            \n            // Use FileManager's saveFile method to save to server (silent mode for autosave)\n            await fileManager.saveFile(currentFilename, autosaveData, true);\n            console.log('[DataManager] Autosave successful:', currentFilename);\n            // Mark save as complete\n            this._hasPendingSave = false;\n            // Silently save - don't show alerts for autosave\n        } catch (error) {\n            // Silently fail for autosave - don't interrupt user workflow\n            console.warn('[DataManager] Autosave failed:', error);\n            this._hasPendingSave = false;\n        }\n    }\n    \n    /**\n     * Flush any pending autosave before page unload\n     * This ensures changes are saved even if user refreshes quickly\n     */\n    async flushPendingSave() {\n        if (this._autosaveTimer) {\n            // Clear the timer and save immediately\n            clearTimeout(this._autosaveTimer);\n            this._autosaveTimer = null;\n            await this._autosaveToServer();\n        } else if (this._hasPendingSave) {\n            // Save is in progress, wait for it to complete\n            // Note: This is best-effort - we can't guarantee completion on unload\n            await this._autosaveToServer();\n        }\n    }\n    \n    async loadDefaultFile() {\n        try {\n            // Use cache: 'no-store' to bypass browser cache and always fetch fresh file\n            const response = await fetch('default.json?' + Date.now(), {\n                cache: 'no-store'\n            });\n            const defaultData = await response.json();\n            const normalizedDefault = this._normalizeDataModel(defaultData);\n            \n            if (!normalizedDefault.documents || !Array.isArray(normalizedDefault.documents)) {\n                alert('Invalid default.json format. Expected a JSON file with a \"documents\" array.');\n                return;\n            }\n            \n            if (confirm(`Load ${normalizedDefault.documents.length} document(s) from default.json? This will replace your current data.`)) {\n                const appState = this._getAppState();\n                appState.documents = normalizedDefault.documents;\n                \n                // Restore collapse states if they exist, otherwise reset to closed state\n                if (normalizedDefault.documentStates) {\n                    appState.documentStates = normalizedDefault.documentStates;\n                }\n                if (normalizedDefault.groupStates) {\n                    appState.groupStates = normalizedDefault.groupStates;\n                }\n                \n                if (normalizedDefault.subtaskStates) {\n                    Object.keys(normalizedDefault.subtaskStates).forEach(key => {\n                        if (appState.setSubtaskState) {\n                            appState.setSubtaskState(key, normalizedDefault.subtaskStates[key]);\n                        }\n                    });\n                }\n                \n                if (normalizedDefault.allSubtasksExpanded !== undefined) {\n                    appState.allSubtasksExpanded = normalizedDefault.allSubtasksExpanded;\n                } else {\n                    appState.allSubtasksExpanded = false;\n                }\n                \n                // Restore settings if they exist\n                if (normalizedDefault.settings) {\n                    const settingsManager = this._getSettingsManager();\n                    if (settingsManager) {\n                        settingsManager.saveSettings(normalizedDefault.settings);\n                    }\n                }\n                \n                this.saveData();\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                alert('default.json loaded successfully!');\n            }\n        } catch (error) {\n            console.error('Failed to load default.json:', error);\n            alert('Failed to load default.json. Make sure it exists in the twodo directory.');\n        }\n    }\n    \n    saveToFile() {\n        const appState = this._getAppState();\n        const settingsManager = this._getSettingsManager();\n        const exportData = {\n            documents: appState.documents,\n            lastModified: new Date().toISOString(),\n            version: '1.0',\n            documentStates: {}, // Legacy - documentStates now in AppState\n            subtaskStates: appState.subtaskStates || {},\n            allSubtasksExpanded: appState.allSubtasksExpanded,\n            settings: settingsManager ? settingsManager.loadSettings() : {}\n        };\n        \n        const json = JSON.stringify(exportData, null, 2);\n        const blob = new Blob([json], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        \n        const a = document.createElement('a');\n        a.href = url;\n        const dateStr = new Date().toISOString().split('T')[0];\n        a.download = `twodo-backup-${dateStr}.json`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n    \n    async saveAsDefault() {\n        if (!confirm('This will overwrite the default.json file on the server with your current data. Continue?')) {\n            return;\n        }\n        \n        const appState = this._getAppState();\n        const settingsManager = this._getSettingsManager();\n        const defaultPayload = {\n            documents: appState.documents,\n            lastModified: new Date().toISOString(),\n            version: '1.0',\n            documentStates: {}, // Legacy - documentStates now in AppState\n            subtaskStates: appState.subtaskStates || {},\n            allSubtasksExpanded: appState.allSubtasksExpanded,\n            settings: settingsManager ? settingsManager.loadSettings() : {}\n        };\n        \n        try {\n            // Use absolute URL to work from any device\n            const url = window.location.origin + '/save-default.json';\n            console.log('Saving to:', url);\n            \n            const response = await fetch(url, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify(defaultPayload)\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            \n            if (result.success) {\n                alert('default.json saved successfully!');\n            } else {\n                alert('Failed to save default.json: ' + (result.error || 'Unknown error'));\n            }\n        } catch (error) {\n            console.error('Failed to save default.json:', error);\n            alert('Failed to save default.json: ' + error.message + '. Make sure the server is running and supports POST requests.');\n        }\n    }\n    \n    loadFromFile(event) {\n        const file = event.target.files[0];\n        if (!file) return;\n        \n        const reader = new FileReader();\n        reader.onload = (e) => {\n            try {\n                const importedData = JSON.parse(e.target.result);\n                const normalizedImport = this._normalizeDataModel(importedData);\n                \n                if (!normalizedImport.documents || !Array.isArray(normalizedImport.documents)) {\n                    alert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                    return;\n                }\n                \n                // Ask for confirmation\n                if (confirm(`Load ${normalizedImport.documents.length} document(s) from file? This will replace your current data.`)) {\n                    const appState = this._getAppState();\n                    appState.documents = normalizedImport.documents;\n                    \n                    // Restore collapse states if they exist, otherwise reset to closed state\n                    if (normalizedImport.documentStates) {\n                        appState.documentStates = normalizedImport.documentStates;\n                    }\n                    if (normalizedImport.groupStates) {\n                        appState.groupStates = normalizedImport.groupStates;\n                    }\n                    \n                    if (normalizedImport.subtaskStates) {\n                        Object.keys(normalizedImport.subtaskStates).forEach(key => {\n                            if (appState.setSubtaskState) {\n                                appState.setSubtaskState(key, normalizedImport.subtaskStates[key]);\n                            }\n                        });\n                    }\n                    \n                    if (normalizedImport.allSubtasksExpanded !== undefined) {\n                        appState.allSubtasksExpanded = normalizedImport.allSubtasksExpanded;\n                    } else {\n                        appState.allSubtasksExpanded = false;\n                    }\n                    \n                    // Restore settings if they exist\n                    if (normalizedImport.settings) {\n                        const settingsManager = this._getSettingsManager();\n                        if (settingsManager) {\n                            settingsManager.saveSettings(normalizedImport.settings);\n                        }\n                    }\n                    \n                    this.saveData();\n                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                    alert('File loaded successfully!');\n                }\n            } catch (error) {\n                console.error('Failed to load file:', error);\n                alert('Failed to load file. Make sure it is a valid JSON file.');\n            }\n        };\n        reader.readAsText(file);\n        \n        // Reset file input so the same file can be loaded again\n        event.target.value = '';\n    }\n    \n    archiveAudioRecording(pageId, elementIndex, audioFile, date) {\n        const archiveKey = 'twodo-audio-archive';\n        let archive = [];\n        const stored = localStorage.getItem(archiveKey);\n        if (stored) {\n            try {\n                archive = JSON.parse(stored);\n            } catch (e) {\n                console.error('Failed to parse archive:', e);\n            }\n        }\n        \n        archive.push({\n            pageId: pageId,\n            elementIndex: elementIndex,\n            filename: audioFile,\n            date: date,\n            archivedDate: new Date().toISOString().split('T')[0]\n        });\n        \n        localStorage.setItem(archiveKey, JSON.stringify(archive));\n    }\n    \n    getArchivedRecordings(pageId, elementIndex) {\n        const archiveKey = 'twodo-audio-archive';\n        const stored = localStorage.getItem(archiveKey);\n        if (!stored) return [];\n        \n        try {\n            const archive = JSON.parse(stored);\n            return archive.filter(entry => entry.pageId === pageId && entry.elementIndex === elementIndex);\n        } catch (e) {\n            console.error('Failed to parse archive:', e);\n            return [];\n        }\n    }\n    \n    playArchivedAudio(filename) {\n        const audio = document.createElement('audio');\n        audio.src = `/saved_files/recordings/${filename}`;\n        audio.controls = true;\n        audio.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; background: #2d2d2d; padding: 20px; border-radius: 8px;';\n        document.body.appendChild(audio);\n        audio.play();\n        \n        audio.onended = () => {\n            audio.remove();\n        };\n    }\n}\n","// ThemePresets.js - Predefined theme presets\r\nexport class ThemePresets {\r\n    constructor() {\r\n        this.presets = this.initializePresets();\r\n    }\r\n    \r\n    initializePresets() {\r\n        return {\r\n            'default': {\r\n                name: 'Default',\r\n                description: 'The original dark theme with comfortable spacing and rounded corners',\r\n                theme: {\r\n                    background: '#1a1a1a',\r\n                    page: {\r\n                        background: '#2d2d2d',\r\n                        margin: '0px',\r\n                        padding: '20px',\r\n                        borderRadius: '8px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '14px',\r\n                        opacity: '1',\r\n                        color: '#e0e0e0',\r\n                        title: {\r\n                            fontSize: '18px',\r\n                            color: '#ffffff',\r\n                            marginBottom: '15px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'transparent',\r\n                        margin: '0px',\r\n                        padding: '10px',\r\n                        paddingVertical: '10px',\r\n                        paddingHorizontal: '10px',\r\n                        gap: '8px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '14px',\r\n                        opacity: '1',\r\n                        color: '#e0e0e0',\r\n                        hoverBackground: '#363636'\r\n                    },\r\n                    header: {\r\n                        fontSize: '16px',\r\n                        color: '#b8b8b8',\r\n                        margin: '10px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '18px'\r\n                    }\r\n                }\r\n            },\r\n            'minimal': {\r\n                name: 'Minimal',\r\n                description: 'Ultra-clean design with sharp edges, tight spacing, and monochrome palette',\r\n                theme: {\r\n                    background: '#0a0a0a',\r\n                    page: {\r\n                        background: '#121212',\r\n                        margin: '0px',\r\n                        padding: '8px',\r\n                        borderRadius: '0px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '12px',\r\n                        opacity: '1',\r\n                        color: '#c8c8c8',\r\n                        title: {\r\n                            fontSize: '14px',\r\n                            color: '#ffffff',\r\n                            marginBottom: '6px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'transparent',\r\n                        margin: '0px',\r\n                        padding: '4px',\r\n                        paddingVertical: '4px',\r\n                        paddingHorizontal: '6px',\r\n                        gap: '2px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '12px',\r\n                        opacity: '1',\r\n                        color: '#c8c8c8',\r\n                        hoverBackground: '#1e1e1e'\r\n                    },\r\n                    header: {\r\n                        fontSize: '13px',\r\n                        color: '#909090',\r\n                        margin: '4px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '14px'\r\n                    }\r\n                }\r\n            },\r\n            'spacious': {\r\n                name: 'Spacious',\r\n                description: 'Generous spacing, large fonts, and soft rounded corners for comfortable reading',\r\n                theme: {\r\n                    background: '#1e1e1e',\r\n                    page: {\r\n                        background: '#2a2a2a',\r\n                        margin: '0px',\r\n                        padding: '40px',\r\n                        borderRadius: '16px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '17px',\r\n                        opacity: '1',\r\n                        color: '#e8e8e8',\r\n                        title: {\r\n                            fontSize: '26px',\r\n                            color: '#ffffff',\r\n                            marginBottom: '24px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'transparent',\r\n                        margin: '0px',\r\n                        padding: '18px',\r\n                        paddingVertical: '18px',\r\n                        paddingHorizontal: '24px',\r\n                        gap: '14px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '17px',\r\n                        opacity: '1',\r\n                        color: '#e8e8e8',\r\n                        hoverBackground: '#3a3a3a'\r\n                    },\r\n                    header: {\r\n                        fontSize: '22px',\r\n                        color: '#c0c0c0',\r\n                        margin: '20px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '22px'\r\n                    }\r\n                }\r\n            },\r\n            'compact': {\r\n                name: 'Compact',\r\n                description: 'Ultra-dense layout with sharp edges for maximum information density',\r\n                theme: {\r\n                    background: '#0d0d0d',\r\n                    page: {\r\n                        background: '#181818',\r\n                        margin: '0px',\r\n                        padding: '4px',\r\n                        borderRadius: '0px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '11px',\r\n                        opacity: '1',\r\n                        color: '#d0d0d0',\r\n                        title: {\r\n                            fontSize: '13px',\r\n                            color: '#ffffff',\r\n                            marginBottom: '4px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'transparent',\r\n                        margin: '0px',\r\n                        padding: '2px',\r\n                        paddingVertical: '2px',\r\n                        paddingHorizontal: '4px',\r\n                        gap: '1px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '11px',\r\n                        opacity: '1',\r\n                        color: '#d0d0d0',\r\n                        hoverBackground: '#252525'\r\n                    },\r\n                    header: {\r\n                        fontSize: '12px',\r\n                        color: '#a0a0a0',\r\n                        margin: '2px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '12px'\r\n                    }\r\n                }\r\n            },\r\n            'warm': {\r\n                name: 'Warm',\r\n                description: 'Cozy amber and brown tones with generous rounded corners',\r\n                theme: {\r\n                    background: '#2a1f18',\r\n                    page: {\r\n                        background: '#3d2e24',\r\n                        margin: '0px',\r\n                        padding: '24px',\r\n                        borderRadius: '14px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '15px',\r\n                        opacity: '1',\r\n                        color: '#f0e6d8',\r\n                        title: {\r\n                            fontSize: '20px',\r\n                            color: '#ffedd5',\r\n                            marginBottom: '18px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'rgba(255, 235, 205, 0.05)',\r\n                        margin: '0px',\r\n                        padding: '12px',\r\n                        paddingVertical: '12px',\r\n                        paddingHorizontal: '14px',\r\n                        gap: '10px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '15px',\r\n                        opacity: '1',\r\n                        color: '#f0e6d8',\r\n                        hoverBackground: '#4a3a2e'\r\n                    },\r\n                    header: {\r\n                        fontSize: '17px',\r\n                        color: '#d4b896',\r\n                        margin: '12px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '19px'\r\n                    }\r\n                }\r\n            },\r\n            'cool': {\r\n                name: 'Cool',\r\n                description: 'Crisp blue-gray palette with sharp, modern edges',\r\n                theme: {\r\n                    background: '#0f1419',\r\n                    page: {\r\n                        background: '#1a2332',\r\n                        margin: '0px',\r\n                        padding: '18px',\r\n                        borderRadius: '6px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '14px',\r\n                        opacity: '1',\r\n                        color: '#c8d4e0',\r\n                        title: {\r\n                            fontSize: '19px',\r\n                            color: '#e0ecf8',\r\n                            marginBottom: '14px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'rgba(100, 150, 200, 0.08)',\r\n                        margin: '0px',\r\n                        padding: '9px',\r\n                        paddingVertical: '9px',\r\n                        paddingHorizontal: '12px',\r\n                        gap: '7px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '14px',\r\n                        opacity: '1',\r\n                        color: '#c8d4e0',\r\n                        hoverBackground: '#2a3440'\r\n                    },\r\n                    header: {\r\n                        fontSize: '16px',\r\n                        color: '#8fa0b0',\r\n                        margin: '9px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '17px'\r\n                    }\r\n                }\r\n            },\r\n            'high-contrast': {\r\n                name: 'High Contrast',\r\n                description: 'Maximum contrast with bold borders and sharp edges for accessibility',\r\n                theme: {\r\n                    background: '#000000',\r\n                    page: {\r\n                        background: '#0a0a0a',\r\n                        margin: '0px',\r\n                        padding: '24px',\r\n                        borderRadius: '2px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#ffffff',\r\n                        title: {\r\n                            fontSize: '22px',\r\n                            color: '#ffffff',\r\n                            marginBottom: '18px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: '#000000',\r\n                        margin: '0px',\r\n                        padding: '14px',\r\n                        paddingVertical: '14px',\r\n                        paddingHorizontal: '16px',\r\n                        gap: '10px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#ffffff',\r\n                        hoverBackground: '#1a1a1a'\r\n                    },\r\n                    header: {\r\n                        fontSize: '20px',\r\n                        color: '#ffffff',\r\n                        margin: '14px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '22px'\r\n                    }\r\n                }\r\n            },\r\n            'paper': {\r\n                name: 'Paper',\r\n                description: 'Light paper aesthetic with serif fonts, textures, and soft shadows',\r\n                theme: {\r\n                    background: '#f5f3f0',\r\n                    backgroundTexture: 'repeating-linear-gradient(0deg, rgba(0,0,0,0.02) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.02) 3px), repeating-linear-gradient(90deg, rgba(0,0,0,0.02) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.02) 3px)',\r\n                    page: {\r\n                        background: '#ffffff',\r\n                        margin: '0px',\r\n                        padding: '32px',\r\n                        borderRadius: '2px',\r\n                        fontFamily: 'Georgia, \"Times New Roman\", \"Palatino\", serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#1a1a1a',\r\n                        texture: 'repeating-linear-gradient(45deg, rgba(0,0,0,0.03) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.03) 3px)',\r\n                        shadow: '0 2px 8px rgba(0,0,0,0.1), 0 4px 16px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.9)',\r\n                        title: {\r\n                            fontSize: '24px',\r\n                            color: '#000000',\r\n                            marginBottom: '20px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: '#fafafa',\r\n                        margin: '0px',\r\n                        padding: '14px',\r\n                        paddingVertical: '14px',\r\n                        paddingHorizontal: '18px',\r\n                        gap: '10px',\r\n                        fontFamily: 'Georgia, \"Times New Roman\", \"Palatino\", serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#1a1a1a',\r\n                        hoverBackground: '#f0f0f0',\r\n                        texture: 'repeating-linear-gradient(0deg, rgba(0,0,0,0.015) 0px, transparent 1px, transparent 2px, rgba(0,0,0,0.015) 3px)',\r\n                        shadow: '0 1px 3px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5)'\r\n                    },\r\n                    header: {\r\n                        fontSize: '19px',\r\n                        color: '#3a3a3a',\r\n                        margin: '14px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '19px'\r\n                    }\r\n                }\r\n            },\r\n            'terminal': {\r\n                name: 'Terminal',\r\n                description: 'Console aesthetic with monospace font, sharp edges, and code colors',\r\n                theme: {\r\n                    background: '#0a0e14',\r\n                    page: {\r\n                        background: '#0d1117',\r\n                        margin: '0px',\r\n                        padding: '12px',\r\n                        borderRadius: '0px',\r\n                        fontFamily: '\"Courier New\", \"Consolas\", \"Monaco\", \"Fira Code\", monospace',\r\n                        fontSize: '13px',\r\n                        opacity: '1',\r\n                        color: '#a8b5c0',\r\n                        title: {\r\n                            fontSize: '15px',\r\n                            color: '#58a6ff',\r\n                            marginBottom: '10px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'transparent',\r\n                        margin: '0px',\r\n                        padding: '4px',\r\n                        paddingVertical: '4px',\r\n                        paddingHorizontal: '6px',\r\n                        gap: '2px',\r\n                        fontFamily: '\"Courier New\", \"Consolas\", \"Monaco\", \"Fira Code\", monospace',\r\n                        fontSize: '13px',\r\n                        opacity: '1',\r\n                        color: '#a8b5c0',\r\n                        hoverBackground: '#161b22'\r\n                    },\r\n                    header: {\r\n                        fontSize: '14px',\r\n                        color: '#7c3aed',\r\n                        margin: '6px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '14px'\r\n                    }\r\n                }\r\n            },\r\n            'zen': {\r\n                name: 'Zen',\r\n                description: 'Calming light theme with soft colors, generous spacing, and rounded corners',\r\n                theme: {\r\n                    background: '#f8f6f4',\r\n                    page: {\r\n                        background: '#ffffff',\r\n                        margin: '0px',\r\n                        padding: '36px',\r\n                        borderRadius: '20px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#2d2d2d',\r\n                        title: {\r\n                            fontSize: '22px',\r\n                            color: '#1a1a1a',\r\n                            marginBottom: '24px'\r\n                        }\r\n                    },\r\n                    element: {\r\n                        background: 'rgba(0, 0, 0, 0.02)',\r\n                        margin: '0px',\r\n                        padding: '16px',\r\n                        paddingVertical: '16px',\r\n                        paddingHorizontal: '20px',\r\n                        gap: '12px',\r\n                        fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, sans-serif',\r\n                        fontSize: '16px',\r\n                        opacity: '1',\r\n                        color: '#2d2d2d',\r\n                        hoverBackground: 'rgba(0, 0, 0, 0.04)'\r\n                    },\r\n                    header: {\r\n                        fontSize: '18px',\r\n                        color: '#4a4a4a',\r\n                        margin: '16px 0'\r\n                    },\r\n                    checkbox: {\r\n                        size: '20px'\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get all preset themes\r\n     */\r\n    getAllPresets() {\r\n        return Object.keys(this.presets).map(key => ({\r\n            id: key,\r\n            name: this.presets[key].name,\r\n            description: this.presets[key].description\r\n        }));\r\n    }\r\n    \r\n    /**\r\n     * Get a preset theme by ID\r\n     */\r\n    getPreset(presetId) {\r\n        return this.presets[presetId] ? { ...this.presets[presetId] } : null;\r\n    }\r\n    \r\n    /**\r\n     * Apply a preset theme globally\r\n     */\r\n    applyPreset(themeManager, presetId) {\r\n        const preset = this.getPreset(presetId);\r\n        if (preset) {\r\n            themeManager.setGlobalTheme(preset.theme);\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\n","// String Utilities - String manipulation and parsing\nexport const StringUtils = {\n    /**\n     * Escape HTML special characters\n     * @param {string} text - Text to escape\n     * @returns {string}\n     */\n    escapeHtml(text) {\n        if (typeof text !== 'string') return text;\n        const div = document.createElement('div');\n        div.textContent = text;\n        return div.innerHTML;\n    },\n    \n    /**\n     * Unescape HTML entities\n     * @param {string} html - HTML to unescape\n     * @returns {string}\n     */\n    unescapeHtml(html) {\n        if (typeof html !== 'string') return html;\n        const div = document.createElement('div');\n        div.innerHTML = html;\n        return div.textContent || div.innerText || '';\n    },\n    \n    /**\n     * Capitalize first letter\n     * @param {string} str - String to capitalize\n     * @returns {string}\n     */\n    capitalize(str) {\n        if (!str) return str;\n        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();\n    },\n    \n    /**\n     * Convert to camelCase\n     * @param {string} str - String to convert\n     * @returns {string}\n     */\n    camelCase(str) {\n        return str.replace(/-([a-z])/g, (g) => g[1].toUpperCase())\n                  .replace(/^[A-Z]/, (g) => g.toLowerCase());\n    },\n    \n    /**\n     * Convert to kebab-case\n     * @param {string} str - String to convert\n     * @returns {string}\n     */\n    kebabCase(str) {\n        return str.replace(/([a-z])([A-Z])/g, '$1-$2')\n                  .replace(/[\\s_]+/g, '-')\n                  .toLowerCase();\n    },\n    \n    /**\n     * Convert to snake_case\n     * @param {string} str - String to convert\n     * @returns {string}\n     */\n    snakeCase(str) {\n        return str.replace(/([a-z])([A-Z])/g, '$1_$2')\n                  .replace(/[\\s-]+/g, '_')\n                  .toLowerCase();\n    },\n    \n    /**\n     * Truncate string with ellipsis\n     * @param {string} str - String to truncate\n     * @param {number} length - Maximum length\n     * @param {string} suffix - Suffix (default: '...')\n     * @returns {string}\n     */\n    truncate(str, length, suffix = '...') {\n        if (!str || str.length <= length) return str;\n        return str.slice(0, length) + suffix;\n    },\n    \n    /**\n     * Strip HTML tags\n     * @param {string} html - HTML string\n     * @returns {string}\n     */\n    stripHtml(html) {\n        if (typeof html !== 'string') return html;\n        const div = document.createElement('div');\n        div.innerHTML = html;\n        return div.textContent || div.innerText || '';\n    },\n    \n    /**\n     * Detect and extract URLs from text\n     * @param {string} text - Text to search\n     * @returns {Array<Object>} - Array of { url, index, length }\n     */\n    detectUrls(text) {\n        if (typeof text !== 'string') return [];\n        const urlRegex = /(https?:\\/\\/[^\\s]+)/g;\n        const urls = [];\n        let match;\n        \n        while ((match = urlRegex.exec(text)) !== null) {\n            urls.push({\n                url: match[0],\n                index: match.index,\n                length: match[0].length\n            });\n        }\n        \n        return urls;\n    },\n    \n    /**\n     * Convert URLs in text to links\n     * @param {string} text - Text to convert\n     * @returns {string} - HTML with links\n     */\n    linkify(text) {\n        if (typeof text !== 'string') return text;\n        const urls = this.detectUrls(text);\n        if (urls.length === 0) return this.escapeHtml(text);\n        \n        let result = '';\n        let lastIndex = 0;\n        \n        urls.forEach(({ url, index, length }) => {\n            result += this.escapeHtml(text.slice(lastIndex, index));\n            result += `<a href=\"${this.escapeHtml(url)}\" target=\"_blank\" rel=\"noopener noreferrer\">${this.escapeHtml(url)}</a>`;\n            lastIndex = index + length;\n        });\n        \n        result += this.escapeHtml(text.slice(lastIndex));\n        return result;\n    },\n    \n    /**\n     * Parse text and make URLs clickable (returns DocumentFragment)\n     * @param {string} text - Text to parse\n     * @returns {DocumentFragment} Fragment containing text nodes and link elements\n     */\n    parseLinks(text) {\n        if (!text || typeof text !== 'string') return document.createDocumentFragment();\n        \n        try {\n            // First, convert markdown formatting to HTML if present\n            let processedText = text;\n            const hasMarkdown = /\\*\\*|\\*[^*]|\\`|\\[.*\\]\\(.*\\)/.test(text);\n            \n            if (hasMarkdown && !/<[a-z][a-z0-9]*[^>]*>/i.test(text)) {\n                // Has markdown but no HTML - convert markdown to HTML\n                // Code (before bold/italic to avoid conflicts)\n                processedText = processedText.replace(/`([^`]+)`/g, '<code>$1</code>');\n                // Bold\n                processedText = processedText.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\n                // Italic (but not if it's part of bold)\n                processedText = processedText.replace(/(?<!\\*)\\*([^*]+?)\\*(?!\\*)/g, '<em>$1</em>');\n                // Strikethrough\n                processedText = processedText.replace(/~~([^~]+)~~/g, '<del>$1</del>');\n                // Links\n                processedText = processedText.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\">$1</a>');\n            }\n            \n            // Check if text contains HTML tags (simple check for opening tags)\n            const hasHtml = /<[a-z][a-z0-9]*[^>]*>/i.test(processedText);\n            \n            if (hasHtml) {\n                // Text contains HTML - render it directly\n                // Use a safer approach: create a container, set innerHTML, then extract children\n                const tempDiv = document.createElement('div');\n                // Sanitize: only allow safe HTML tags\n                const allowedTags = /<\\/?(strong|em|code|a|b|i|u|span|div|p|br|del|s)[^>]*>/gi;\n                if (allowedTags.test(processedText) || processedText.match(/<[a-z][a-z0-9]*[^>]*>/i)) {\n                    tempDiv.innerHTML = processedText;\n                } else {\n                    // If it looks like HTML but doesn't match allowed tags, escape it\n                    tempDiv.textContent = processedText;\n                }\n                \n                const fragment = document.createDocumentFragment();\n                \n                // Move all children to fragment\n                while (tempDiv.firstChild) {\n                    fragment.appendChild(tempDiv.firstChild);\n                }\n                \n                // Style any existing links\n                fragment.querySelectorAll('a').forEach(link => {\n                    link.target = '_blank';\n                    link.rel = 'noopener noreferrer';\n                    if (!link.style.color) {\n                        link.style.color = '#4a9eff';\n                    }\n                    if (!link.style.textDecoration) {\n                        link.style.textDecoration = 'underline';\n                    }\n                    link.onclick = (e) => e.stopPropagation();\n                });\n                \n                return fragment;\n            } else {\n            // No HTML - use original link parsing logic\n            const urlPattern = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}[^\\s]*)/g;\n            const parts = processedText.split(urlPattern);\n            const fragment = document.createDocumentFragment();\n            \n            parts.forEach((part) => {\n                if (urlPattern.test(part)) {\n                    // This is a URL\n                    let href = part;\n                    if (!href.startsWith('http://') && !href.startsWith('https://')) {\n                        href = 'https://' + href;\n                    }\n                    const link = document.createElement('a');\n                    link.href = href;\n                    link.textContent = part;\n                    link.target = '_blank';\n                    link.rel = 'noopener noreferrer';\n                    link.style.color = '#4a9eff';\n                    link.style.textDecoration = 'underline';\n                    link.onclick = (e) => e.stopPropagation(); // Prevent element click when clicking link\n                    fragment.appendChild(link);\n                } else if (part) {\n                    // Regular text\n                    const textNode = document.createTextNode(part);\n                    fragment.appendChild(textNode);\n                }\n            });\n            \n            return fragment;\n            }\n        } catch (error) {\n            console.error('Error parsing links:', error);\n            // Fallback: return text as plain text node\n            const fragment = document.createDocumentFragment();\n            fragment.appendChild(document.createTextNode(text));\n            return fragment;\n        }\n    },\n    \n    /**\n     * Parse markdown-like syntax (basic)\n     * @param {string} text - Text to parse\n     * @returns {string} - HTML\n     */\n    parseMarkdown(text) {\n        if (typeof text !== 'string') return text;\n        \n        // Bold: **text** or __text__\n        text = text.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n        text = text.replace(/__(.+?)__/g, '<strong>$1</strong>');\n        \n        // Italic: *text* or _text_\n        text = text.replace(/\\*(.+?)\\*/g, '<em>$1</em>');\n        text = text.replace(/_(.+?)_/g, '<em>$1</em>');\n        \n        // Code: `code`\n        text = text.replace(/`(.+?)`/g, '<code>$1</code>');\n        \n        // Links: [text](url)\n        text = text.replace(/\\[([^\\]]+)\\]\\(([^)]+)\\)/g, '<a href=\"$2\" target=\"_blank\">$1</a>');\n        \n        return text;\n    },\n    \n    /**\n     * Generate unique ID\n     * @param {string} prefix - ID prefix\n     * @returns {string}\n     */\n    generateId(prefix = 'id') {\n        return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    },\n    \n    /**\n     * Slugify string (for URLs, IDs, etc.)\n     * @param {string} str - String to slugify\n     * @returns {string}\n     */\n    slugify(str) {\n        if (typeof str !== 'string') return '';\n        return str.toLowerCase()\n                  .trim()\n                  .replace(/[^\\w\\s-]/g, '')\n                  .replace(/[\\s_-]+/g, '-')\n                  .replace(/^-+|-+$/g, '');\n    },\n    \n    /**\n     * Pad string to specified length\n     * @param {string} str - String to pad\n     * @param {number} length - Target length\n     * @param {string} padString - Padding string\n     * @param {string} side - 'left' or 'right'\n     * @returns {string}\n     */\n    pad(str, length, padString = ' ', side = 'right') {\n        if (typeof str !== 'string') str = String(str);\n        const pad = padString.repeat(Math.max(0, length - str.length));\n        return side === 'left' ? pad + str : str + pad;\n    },\n    \n    /**\n     * Remove whitespace from string\n     * @param {string} str - String to trim\n     * @returns {string}\n     */\n    trim(str) {\n        return typeof str === 'string' ? str.trim() : str;\n    },\n    \n    /**\n     * Replace all occurrences\n     * @param {string} str - String to replace in\n     * @param {string|RegExp} search - Search string or regex\n     * @param {string} replace - Replacement string\n     * @returns {string}\n     */\n    replaceAll(str, search, replace) {\n        if (typeof str !== 'string') return str;\n        if (search instanceof RegExp) {\n            return str.replace(search, replace);\n        }\n        return str.split(search).join(replace);\n    }\n};\n\n","// SettingsManager.js - Handles all settings loading, saving, and UI\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { ThemePresets } from './ThemePresets.js';\r\nimport { StringUtils } from '../utils/string.js';\r\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\r\n\r\nexport class SettingsManager {\r\n    constructor() {\r\n        this.storageKey = 'twodo-settings';\r\n        this.themePresets = new ThemePresets();\r\n    }\r\n    \r\n    /**\r\n     * Get services\r\n     */\r\n    _getFileManager() {\r\n        return getService(SERVICES.FILE_MANAGER);\r\n    }\r\n    \r\n    _getUndoRedoManager() {\r\n        return getService(SERVICES.UNDO_REDO_MANAGER);\r\n    }\r\n    \r\n    /**\r\n     * Get ThemeManager service\r\n     */\r\n    _getThemeManager() {\r\n        return getService(SERVICES.THEME_MANAGER);\r\n    }\r\n    \r\n    /**\r\n     * Get AppState service\r\n     */\r\n    _getAppState() {\r\n        return getService(SERVICES.APP_STATE);\r\n    }\r\n    \r\n    // Check if themes are available at runtime\r\n    get useThemes() {\r\n        return !!this._getThemeManager();\r\n    }\r\n    \r\n    loadSettings() {\r\n        // If ThemeManager is available, use it for global theme\r\n        const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n            return themeManager.themes.global;\r\n        }\r\n        \r\n        // Legacy: load from localStorage\r\n        const stored = localStorage.getItem(this.storageKey);\r\n        if (stored) {\r\n            try {\r\n                const settings = JSON.parse(stored);\r\n                // Merge with defaults to ensure all properties exist\r\n                const defaults = this.getDefaultSettings();\r\n                return this.mergeSettings(settings, defaults);\r\n            } catch (e) {\r\n                console.error('Failed to parse settings:', e);\r\n            }\r\n        }\r\n        return this.getDefaultSettings();\r\n    }\r\n    \r\n    mergeSettings(settings, defaults) {\r\n        const merged = { ...defaults };\r\n        // Recursively merge settings with defaults\r\n        for (const key in settings) {\r\n            if (settings[key] && typeof settings[key] === 'object' && !Array.isArray(settings[key])) {\r\n                merged[key] = this.mergeSettings(settings[key], defaults[key] || {});\r\n            } else {\r\n                merged[key] = settings[key];\r\n            }\r\n        }\r\n        return merged;\r\n    }\r\n    \r\n    getDefaultSettings() {\r\n        // These are the current defaults (what's saved in localStorage)\r\n        return {\r\n            background: '#1a1a1a',\r\n            page: {\r\n                background: '#2d2d2d',\r\n                margin: '0px',\r\n                padding: '20px',\r\n                borderRadius: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                title: {\r\n                    fontSize: '18px',\r\n                    color: '#ffffff',\r\n                    marginBottom: '15px'\r\n                }\r\n            },\r\n            element: {\r\n                background: 'transparent',\r\n                margin: '0px',\r\n                padding: '10px',\r\n                paddingVertical: '10px',\r\n                paddingHorizontal: '10px',\r\n                gap: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                hoverBackground: '#363636'\r\n            },\r\n            header: {\r\n                fontSize: '16px',\r\n                color: '#b8b8b8',\r\n                margin: '10px 0'\r\n            },\r\n            checkbox: {\r\n                size: '18px'\r\n            }\r\n        };\r\n    }\r\n    \r\n    getOriginalDefaultSettings() {\r\n        // These are the original values from the initial CSS (before settings were added)\r\n        return {\r\n            background: '#1a1a1a',\r\n            page: {\r\n                background: '#2d2d2d',\r\n                margin: '0px',\r\n                padding: '20px',\r\n                borderRadius: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                title: {\r\n                    fontSize: '18px',\r\n                    color: '#ffffff',\r\n                    marginBottom: '15px'\r\n                }\r\n            },\r\n            element: {\r\n                background: 'transparent',\r\n                margin: '0px',\r\n                padding: '10px',\r\n                paddingVertical: '10px',\r\n                paddingHorizontal: '10px',\r\n                gap: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                hoverBackground: '#363636'\r\n            },\r\n            header: {\r\n                fontSize: '16px',\r\n                color: '#b8b8b8',\r\n                margin: '10px 0'\r\n            },\r\n            checkbox: {\r\n                size: '18px'\r\n            }\r\n        };\r\n    }\r\n    \r\n    saveSettings(settings, themeType = 'global', viewFormat = null, pageId = null) {\r\n        // If ThemeManager is available, use it\r\n        const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n            if (themeType === 'global') {\r\n                themeManager.setGlobalTheme(settings);\r\n            } else if (themeType === 'view' && viewFormat) {\r\n                themeManager.setViewTheme(viewFormat, settings);\r\n            } else if (themeType === 'page' && pageId) {\r\n                themeManager.setPageTheme(pageId, settings);\r\n            }\r\n            // ThemeManager.set*Theme already applies and triggers updates, so we don't need applySettings here\r\n        } else {\r\n            // Legacy: save to localStorage\r\n            localStorage.setItem(this.storageKey, JSON.stringify(settings));\r\n            this.applySettings(settings);\r\n            // Emit theme update event for legacy mode too\r\n            eventBus.emit('theme:updated', { type: themeType, settings });\r\n        }\r\n        \r\n        // Also update the main data structure to include settings\r\n        const appState = this._getAppState();\r\n        if (appState?.documents && appState.documents.length > 0) {\r\n            eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\r\n        }\r\n    }\r\n    \r\n    applySettings(settings) {\r\n        const root = document.documentElement;\r\n        root.style.setProperty('--bg-color', settings.background);\r\n        root.style.setProperty('--page-bg', settings.page.background);\r\n        root.style.setProperty('--page-margin', settings.page.margin);\r\n        root.style.setProperty('--page-padding', settings.page.padding);\r\n        root.style.setProperty('--page-border-radius', settings.page.borderRadius);\r\n        root.style.setProperty('--page-font-family', settings.page.fontFamily);\r\n        root.style.setProperty('--page-font-size', settings.page.fontSize);\r\n        root.style.setProperty('--page-opacity', settings.page.opacity);\r\n        root.style.setProperty('--page-color', settings.page.color);\r\n        root.style.setProperty('--page-title-font-size', settings.page.title.fontSize);\r\n        root.style.setProperty('--page-title-color', settings.page.title.color);\r\n        root.style.setProperty('--page-title-margin-bottom', settings.page.title.marginBottom);\r\n        root.style.setProperty('--element-bg', settings.element.background);\r\n        root.style.setProperty('--element-margin', settings.element.margin);\r\n        root.style.setProperty('--element-padding', settings.element.padding);\r\n        root.style.setProperty('--element-padding-vertical', settings.element.paddingVertical || settings.element.padding);\r\n        root.style.setProperty('--element-padding-horizontal', settings.element.paddingHorizontal || settings.element.padding);\r\n        root.style.setProperty('--element-gap', settings.element.gap || '8px');\r\n        root.style.setProperty('--element-font-family', settings.element.fontFamily);\r\n        root.style.setProperty('--element-font-size', settings.element.fontSize);\r\n        root.style.setProperty('--element-opacity', settings.element.opacity);\r\n        root.style.setProperty('--element-color', settings.element.color);\r\n        root.style.setProperty('--element-hover-bg', settings.element.hoverBackground);\r\n        root.style.setProperty('--header-font-size', settings.header.fontSize);\r\n        root.style.setProperty('--header-color', settings.header.color);\r\n        root.style.setProperty('--header-margin', settings.header.margin);\r\n        root.style.setProperty('--checkbox-size', (settings.checkbox && settings.checkbox.size) || '18px');\r\n    }\r\n    \r\n    showSettingsModal() {\r\n        const modal = document.getElementById('settings-modal');\r\n        const settingsBody = document.getElementById('settings-body');\r\n        const settings = this.loadSettings();\r\n        \r\n        // Generate QR code for current file at the top\r\n        let qrCodeHtml = '';\r\n        const fileManager = this._getFileManager();\r\n        const currentFilename = fileManager?.currentFilename;\r\n        if (currentFilename) {\r\n            // Get current URL origin and construct file URL\r\n            const currentUrl = window.location.origin + window.location.pathname;\r\n            const fileUrl = `${currentUrl}?file=${encodeURIComponent(currentFilename)}`;\r\n            \r\n            // Generate QR code HTML\r\n            qrCodeHtml = `\r\n                <div style=\"margin-bottom: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px; text-align: center;\">\r\n                    <div style=\"margin-bottom: 10px; color: #ffffff; font-weight: 600;\">Open on Mobile Device</div>\r\n                    <div id=\"qrcode-container\" style=\"display: inline-block; padding: 10px; background: white; border-radius: 4px; min-height: 200px; min-width: 200px;\"></div>\r\n                    <div style=\"margin-top: 10px; color: #888; font-size: 12px;\">Scan to open: ${currentFilename}</div>\r\n                    <div style=\"margin-top: 5px; color: #666; font-size: 11px; word-break: break-all;\">${fileUrl}</div>\r\n                </div>\r\n            `;\r\n        } else {\r\n            // Show message if no file is open\r\n            qrCodeHtml = `\r\n                <div style=\"margin-bottom: 20px; padding: 15px; background: #2d2d2d; border-radius: 8px; text-align: center;\">\r\n                    <div style=\"color: #888; font-size: 14px;\">No file currently open. Open a file to generate a QR code.</div>\r\n                </div>\r\n            `;\r\n        }\r\n        \r\n        let html = '<h3 style=\"margin-bottom: 20px; color: #ffffff;\">Settings</h3>';\r\n        html += qrCodeHtml;\r\n        \r\n        // Theme Management Section (if ThemeManager is available)\r\n        const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n            html += '<div class=\"settings-section\">';\r\n            html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-theme\">';\r\n            html += '<span class=\"settings-toggle-arrow\"></span>';\r\n            html += '<span>Theme Management</span>';\r\n            html += '</div>';\r\n            html += '<div class=\"settings-section-content\" id=\"settings-content-theme\" style=\"display: none;\">';\r\n            html += '<div class=\"settings-subsection\">';\r\n            \r\n            // Theme type selector\r\n            html += '<div class=\"settings-control\">';\r\n            html += '<label>Theme Scope:</label>';\r\n            html += '<select id=\"theme-scope-select\" style=\"width: 100%; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px;\">';\r\n            html += '<option value=\"global\">Global (All Views)</option>';\r\n            html += '<option value=\"view\">View-Specific</option>';\r\n            html += '<option value=\"page\">Page-Specific</option>';\r\n            html += '</select>';\r\n            html += '</div>';\r\n            \r\n            // View format selector (shown when view-specific is selected)\r\n            html += '<div class=\"settings-control\" id=\"theme-view-selector\" style=\"display: none;\">';\r\n            html += '<label>View Format:</label>';\r\n            html += '<select id=\"theme-view-format\" style=\"width: 100%; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px;\">';\r\n            const viewFormats = themeManager.getViewFormats();\r\n            viewFormats.forEach(format => {\r\n                const formatName = format === 'default' ? 'Default' : format.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\r\n                html += `<option value=\"${format}\">${formatName}</option>`;\r\n            });\r\n            html += '</select>';\r\n            html += '</div>';\r\n            \r\n            // Document selector (shown when document-specific is selected)\r\n            html += '<div class=\"settings-control\" id=\"theme-page-selector\" style=\"display: none;\">';\r\n            html += '<label>Document:</label>';\r\n            html += '<select id=\"theme-page-id\" style=\"width: 100%; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px;\">';\r\n            const appState = this._getAppState();\r\n            const documents = appState?.documents || [];\r\n            documents.forEach(page => {\r\n                html += `<option value=\"${page.id}\">${page.title || page.id}</option>`;\r\n            });\r\n            html += '</select>';\r\n            html += '</div>';\r\n            \r\n            // Theme Presets Section\r\n            html += '<div style=\"margin-top: 15px; padding-top: 15px; border-top: 1px solid #404040; margin-bottom: 20px;\">';\r\n            html += '<div style=\"font-weight: 600; color: #ffffff; margin-bottom: 10px; font-size: 14px;\">Theme Presets</div>';\r\n            html += '<div style=\"color: #888; font-size: 12px; margin-bottom: 15px;\">Quick-apply pre-designed themes across all views and elements</div>';\r\n            html += '<div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin-bottom: 15px;\">';\r\n            \r\n            const presets = this.themePresets.getAllPresets();\r\n            presets.forEach(preset => {\r\n                html += `<div style=\"padding: 12px; background: #1a1a1a; border-radius: 6px; border: 1px solid #404040; cursor: pointer; transition: all 0.2s;\" class=\"theme-preset-item\" data-preset-id=\"${preset.id}\">`;\r\n                html += `<div style=\"font-weight: 600; color: #ffffff; margin-bottom: 4px; font-size: 13px;\">${StringUtils.escapeHtml(preset.name)}</div>`;\r\n                html += `<div style=\"color: #888; font-size: 11px;\">${StringUtils.escapeHtml(preset.description)}</div>`;\r\n                html += `</div>`;\r\n            });\r\n            \r\n            html += '</div>';\r\n            html += '<button id=\"theme-preset-apply-btn\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 15px; display: none;\">Apply Selected Preset</button>';\r\n            html += '</div>';\r\n            \r\n            html += '<div style=\"margin-top: 15px; padding-top: 15px; border-top: 1px solid #404040;\">';\r\n            html += '<div style=\"color: #888; font-size: 12px; margin-bottom: 10px;\">';\r\n            html += 'Theme inheritance: Page-specific > View-specific > Global';\r\n            html += '</div>';\r\n            html += '<div style=\"display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px;\">';\r\n            html += '<button id=\"theme-load-btn\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">Load Theme</button>';\r\n            html += '<button id=\"theme-export-btn\" style=\"padding: 8px 16px; background: #58a858; color: white; border: none; border-radius: 4px; cursor: pointer;\">Export Theme</button>';\r\n            html += '<button id=\"theme-import-btn\" style=\"padding: 8px 16px; background: #58a858; color: white; border: none; border-radius: 4px; cursor: pointer;\">Import Theme</button>';\r\n            html += '<input type=\"file\" id=\"theme-import-file\" accept=\".json\" style=\"display: none;\">';\r\n            html += '<button id=\"theme-export-all-btn\" style=\"padding: 8px 16px; background: #9e58a8; color: white; border: none; border-radius: 4px; cursor: pointer;\">Export All Themes</button>';\r\n            html += '<button id=\"theme-import-all-btn\" style=\"padding: 8px 16px; background: #9e58a8; color: white; border: none; border-radius: 4px; cursor: pointer;\">Import All Themes</button>';\r\n            html += '<input type=\"file\" id=\"theme-import-all-file\" accept=\".json\" style=\"display: none;\">';\r\n            html += '<button id=\"theme-save-custom-btn\" style=\"padding: 8px 16px; background: #d4a574; color: white; border: none; border-radius: 4px; cursor: pointer;\">Save Custom Theme</button>';\r\n            html += '<button id=\"theme-load-custom-btn\" style=\"padding: 8px 16px; background: #d4a574; color: white; border: none; border-radius: 4px; cursor: pointer;\">Load Custom Theme</button>';\r\n            html += '<input type=\"file\" id=\"theme-load-custom-file\" accept=\".json\" style=\"display: none;\">';\r\n            html += '</div>';\r\n            html += '<div style=\"display: flex; gap: 10px;\">';\r\n            html += '<button id=\"theme-reset-view-btn\" style=\"padding: 8px 16px; background: #888; color: white; border: none; border-radius: 4px; cursor: pointer; display: none;\">Reset View Theme</button>';\r\n            html += '<button id=\"theme-reset-page-btn\" style=\"padding: 8px 16px; background: #888; color: white; border: none; border-radius: 4px; cursor: pointer; display: none;\">Reset Page Theme</button>';\r\n            html += '</div>';\r\n            html += '</div>';\r\n            html += '</div>';\r\n            html += '</div>';\r\n            html += '</div>';\r\n        }\r\n        \r\n        // Background Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-0\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Background</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-0\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += this.createColorControl('background', 'Background Color', settings.background);\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        // Page Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-1\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Page Styles</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-1\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += this.createColorControl('page.background', 'Background Color', settings.page.background);\r\n        html += this.createSliderControl('page.margin', 'Margin', settings.page.margin, 0, 50, 1, 'px');\r\n        html += this.createSliderControl('page.padding', 'Padding', settings.page.padding, 0, 50, 1, 'px');\r\n        html += this.createSliderControl('page.borderRadius', 'Border Radius', settings.page.borderRadius, 0, 30, 1, 'px');\r\n        html += this.createTextControl('page.fontFamily', 'Font Family', settings.page.fontFamily);\r\n        html += this.createSliderControl('page.fontSize', 'Font Size', settings.page.fontSize, 8, 32, 1, 'px');\r\n        html += this.createOpacityControl('page.opacity', 'Opacity', settings.page.opacity);\r\n        html += this.createColorControl('page.color', 'Text Color', settings.page.color);\r\n        html += '</div>';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += '<div class=\"settings-subsection-title\" data-collapse-target=\"settings-subcontent-1\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Page Title</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-subsection-content\" id=\"settings-subcontent-1\" style=\"display: none;\">';\r\n        html += this.createSliderControl('page.title.fontSize', 'Font Size', settings.page.title.fontSize, 8, 48, 1, 'px');\r\n        html += this.createColorControl('page.title.color', 'Color', settings.page.title.color);\r\n        html += this.createSliderControl('page.title.marginBottom', 'Margin Bottom', settings.page.title.marginBottom, 0, 50, 1, 'px');\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        // Element Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-2\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Element Styles</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-2\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += this.createColorControl('element.background', 'Background Color', settings.element.background);\r\n        html += this.createSliderControl('element.margin', 'Margin', settings.element.margin, 0, 30, 1, 'px');\r\n        html += this.createSliderControl('element.padding', 'Padding (All)', settings.element.padding, 0, 30, 1, 'px');\r\n        html += this.createSliderControl('element.paddingVertical', 'Padding (Vertical)', settings.element.paddingVertical || settings.element.padding, 0, 30, 1, 'px');\r\n        html += this.createSliderControl('element.paddingHorizontal', 'Padding (Horizontal)', settings.element.paddingHorizontal || settings.element.padding, 0, 30, 1, 'px');\r\n        html += this.createSliderControl('element.gap', 'Element Gap', settings.element.gap || '8px', 0, 30, 1, 'px');\r\n        html += this.createTextControl('element.fontFamily', 'Font Family', settings.element.fontFamily);\r\n        html += this.createSliderControl('element.fontSize', 'Font Size', settings.element.fontSize, 8, 32, 1, 'px');\r\n        html += this.createOpacityControl('element.opacity', 'Opacity', settings.element.opacity);\r\n        html += this.createColorControl('element.color', 'Text Color', settings.element.color);\r\n        html += this.createColorControl('element.hoverBackground', 'Hover Background', settings.element.hoverBackground);\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        // Header Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-3\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Header Element Styles</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-3\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += this.createSliderControl('header.fontSize', 'Font Size', settings.header.fontSize, 8, 48, 1, 'px');\r\n        html += this.createColorControl('header.color', 'Color', settings.header.color);\r\n        html += this.createTextControl('header.margin', 'Margin', settings.header.margin);\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        // Checkbox Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-4\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Checkbox Styles</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-4\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        html += this.createSliderControl('checkbox.size', 'Size', settings.checkbox.size, 10, 30, 1, 'px');\r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        // Diagnostic Section\r\n        html += '<div class=\"settings-section\">';\r\n        html += '<div class=\"settings-section-title\" data-collapse-target=\"settings-content-5\">';\r\n        html += '<span class=\"settings-toggle-arrow\"></span>';\r\n        html += '<span>Diagnostics</span>';\r\n        html += '</div>';\r\n        html += '<div class=\"settings-section-content\" id=\"settings-content-5\" style=\"display: none;\">';\r\n        html += '<div class=\"settings-subsection\">';\r\n        \r\n        // Buffer status\r\n        const undoRedoManager = this._getUndoRedoManager();\r\n        const bufferFilename = undoRedoManager?.currentBufferFilename || 'None';\r\n        const undoStackSize = undoRedoManager?.undoStack?.length || 0;\r\n        const redoStackSize = undoRedoManager?.redoStack?.length || 0;\r\n        const snapshotCount = undoRedoManager?.snapshots?.length || 0;\r\n        const lastSnapshot = undoRedoManager?.snapshots?.length > 0 \r\n            ? undoRedoManager.snapshots[undoRedoManager.snapshots.length - 1]\r\n            : null;\r\n        \r\n        html += `<div style=\"margin-bottom: 15px; padding: 10px; background: #2a2a2a; border-radius: 4px;\">`;\r\n        html += `<div style=\"color: #ffffff; font-weight: 600; margin-bottom: 10px;\">Buffer Status</div>`;\r\n        html += `<div style=\"color: #e0e0e0; margin-bottom: 5px;\">Current File: <span style=\"color: #4a9eff;\">${bufferFilename}</span></div>`;\r\n        html += `<div style=\"color: #e0e0e0; margin-bottom: 5px;\">Undo Stack: <span style=\"color: #4a9eff;\">${undoStackSize}</span> changes</div>`;\r\n        html += `<div style=\"color: #e0e0e0; margin-bottom: 5px;\">Redo Stack: <span style=\"color: #4a9eff;\">${redoStackSize}</span> changes</div>`;\r\n        html += `<div style=\"color: #e0e0e0; margin-bottom: 5px;\">Snapshots: <span style=\"color: #4a9eff;\">${snapshotCount}</span></div>`;\r\n        if (lastSnapshot) {\r\n            html += `<div style=\"color: #e0e0e0; margin-bottom: 5px;\">Last Snapshot: Change index <span style=\"color: #4a9eff;\">${lastSnapshot.changeIndex}</span></div>`;\r\n            html += `<div style=\"color: #888; font-size: 12px;\">${new Date(lastSnapshot.timestamp).toLocaleString()}</div>`;\r\n        }\r\n        html += `</div>`;\r\n        \r\n        // Validation results\r\n        const validation = undoRedoManager?.validateState();\r\n        html += `<div style=\"margin-bottom: 15px; padding: 10px; background: #2a2a2a; border-radius: 4px;\">`;\r\n        html += `<div style=\"color: #ffffff; font-weight: 600; margin-bottom: 10px;\">State Validation</div>`;\r\n        if (validation) {\r\n            html += `<div style=\"color: ${validation.valid ? '#4a9eff' : '#ff5555'}; margin-bottom: 5px;\">Status: <span>${validation.valid ? 'Valid' : 'Invalid'}</span></div>`;\r\n            if (validation.errors && validation.errors.length > 0) {\r\n                html += `<div style=\"color: #ff5555; margin-top: 10px; font-weight: 600;\">Errors (${validation.errors.length}):</div>`;\r\n                validation.errors.forEach(error => {\r\n                    html += `<div style=\"color: #ff8888; font-size: 12px; margin-left: 10px; margin-top: 3px;\"> ${error}</div>`;\r\n                });\r\n            }\r\n            if (validation.warnings && validation.warnings.length > 0) {\r\n                html += `<div style=\"color: #ffaa00; margin-top: 10px; font-weight: 600;\">Warnings (${validation.warnings.length}):</div>`;\r\n                validation.warnings.forEach(warning => {\r\n                    html += `<div style=\"color: #ffcc88; font-size: 12px; margin-left: 10px; margin-top: 3px;\"> ${warning}</div>`;\r\n                });\r\n            }\r\n        } else {\r\n            html += `<div style=\"color: #888;\">Validation not available</div>`;\r\n        }\r\n        html += `</div>`;\r\n        \r\n        // Undo issue diagnostics\r\n        const undoDiagnostics = undoRedoManager?.diagnoseUndoIssue();\r\n        html += `<div style=\"margin-bottom: 15px; padding: 10px; background: #2a2a2a; border-radius: 4px;\">`;\r\n        html += `<div style=\"color: #ffffff; font-weight: 600; margin-bottom: 10px;\">Undo/Redo Diagnostics</div>`;\r\n        if (undoDiagnostics) {\r\n            html += `<div style=\"color: ${undoDiagnostics.valid ? '#4a9eff' : '#ff5555'}; margin-bottom: 5px;\">Status: <span>${undoDiagnostics.valid ? 'Valid' : 'Issues Found'}</span></div>`;\r\n            if (undoDiagnostics.issues && undoDiagnostics.issues.length > 0) {\r\n                html += `<div style=\"color: #ff5555; margin-top: 10px; font-weight: 600;\">Issues (${undoDiagnostics.issues.length}):</div>`;\r\n                undoDiagnostics.issues.forEach(issue => {\r\n                    html += `<div style=\"color: #ff8888; font-size: 12px; margin-left: 10px; margin-top: 3px;\"> ${issue.type}: ${issue.description}</div>`;\r\n                });\r\n            }\r\n        } else {\r\n            html += `<div style=\"color: #888;\">Diagnostics not available</div>`;\r\n        }\r\n        html += `</div>`;\r\n        \r\n        // File integrity check button\r\n        html += `<button id=\"diagnostic-file-integrity\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;\">Run File Integrity Check</button>`;\r\n        html += `<div id=\"diagnostic-file-integrity-result\" style=\"margin-top: 10px; padding: 10px; background: #2a2a2a; border-radius: 4px; display: none;\"></div>`;\r\n        \r\n        html += '</div>';\r\n        html += '</div>';\r\n        html += '</div>';\r\n        \r\n        html += '<button class=\"settings-reset-btn\" id=\"settings-reset\">Reset to Defaults</button>';\r\n        html += '<button class=\"settings-reset-btn\" id=\"settings-set-default\" style=\"margin-left: 10px;\">Set to Default</button>';\r\n        \r\n        settingsBody.innerHTML = html;\r\n        \r\n        // Generate QR code if we have a current file\r\n        if (currentFilename) {\r\n            const qrContainer = document.getElementById('qrcode-container');\r\n            if (qrContainer) {\r\n                const currentUrl = window.location.origin + window.location.pathname;\r\n                const fileUrl = `${currentUrl}?file=${encodeURIComponent(currentFilename)}`;\r\n                \r\n                // Clear any existing QR code\r\n                qrContainer.innerHTML = '';\r\n                \r\n                // Check if QRCode library is available\r\n                if (typeof QRCode !== 'undefined') {\r\n                    // Generate QR code using QRCode library\r\n                    QRCode.toCanvas(qrContainer, fileUrl, {\r\n                        width: 200,\r\n                        margin: 2,\r\n                        color: {\r\n                            dark: '#000000',\r\n                            light: '#FFFFFF'\r\n                        }\r\n                    }, (error) => {\r\n                        if (error) {\r\n                            console.error('Error generating QR code:', error);\r\n                            qrContainer.innerHTML = '<div style=\"color: #888; padding: 20px;\">QR code unavailable</div>';\r\n                        }\r\n                    });\r\n                } else {\r\n                    // Fallback: use an online QR code API if library not loaded\r\n                    const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(fileUrl)}`;\r\n                    qrContainer.innerHTML = `<img src=\"${qrApiUrl}\" alt=\"QR Code\" style=\"display: block;\">`;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Add event listeners to all controls\r\n        settingsBody.querySelectorAll('input, select').forEach(input => {\r\n            input.addEventListener('input', (e) => {\r\n                const path = e.target.dataset.settingPath;\r\n                let value;\r\n                if (e.target.type === 'color') {\r\n                    value = e.target.value;\r\n                } else if (e.target.type === 'range') {\r\n                    // For opacity, convert 0-100 to 0-1\r\n                    if (path.includes('opacity')) {\r\n                        value = (parseFloat(e.target.value) / 100).toFixed(2);\r\n                    } else {\r\n                        // For slider controls, add 'px' unit if it's a numeric value\r\n                        const numValue = parseFloat(e.target.value);\r\n                        if (!isNaN(numValue) && (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size'))) {\r\n                            value = numValue + 'px';\r\n                        } else {\r\n                            value = e.target.value;\r\n                        }\r\n                    }\r\n                } else if (e.target.type === 'number') {\r\n                    if (path.includes('opacity')) {\r\n                        // For opacity number input, convert 0-100 to 0-1\r\n                        value = (parseFloat(e.target.value) / 100).toFixed(2);\r\n                    } else {\r\n                        // For number inputs from sliders, add 'px' unit\r\n                        const numValue = parseFloat(e.target.value);\r\n                        if (!isNaN(numValue) && (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size'))) {\r\n                            value = numValue + 'px';\r\n                        } else {\r\n                            value = e.target.value;\r\n                        }\r\n                    }\r\n                } else {\r\n                    value = e.target.value;\r\n                }\r\n                // Determine theme scope for saving\r\n                let themeType = 'global';\r\n                let viewFormat = null;\r\n                let pageId = null;\r\n                \r\n                const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n                    const themeScopeSelect = document.getElementById('theme-scope-select');\r\n                    const themeViewFormat = document.getElementById('theme-view-format');\r\n                    const themePageId = document.getElementById('theme-page-id');\r\n                    const scope = themeScopeSelect?.value || 'global';\r\n                    \r\n                    if (scope === 'view' && themeViewFormat) {\r\n                        themeType = 'view';\r\n                        viewFormat = themeViewFormat.value;\r\n                    } else if (scope === 'page' && themePageId) {\r\n                        themeType = 'page';\r\n                        pageId = themePageId.value;\r\n                    }\r\n                }\r\n                \r\n                this.updateSetting(path, value, themeType, viewFormat, pageId);\r\n            });\r\n        });\r\n        \r\n        // Reset button\r\n        const resetBtn = document.getElementById('settings-reset');\r\n        if (resetBtn) {\r\n            resetBtn.addEventListener('click', () => {\r\n                const defaultSettings = this.getDefaultSettings();\r\n                const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n                    // Get current theme scope\r\n                    const themeScopeSelect = document.getElementById('theme-scope-select');\r\n                    const themeViewFormat = document.getElementById('theme-view-format');\r\n                    const themePageId = document.getElementById('theme-page-id');\r\n                    const scope = themeScopeSelect?.value || 'global';\r\n                    \r\n                    if (scope === 'global') {\r\n                        this.saveSettings(defaultSettings, 'global');\r\n                    } else if (scope === 'view' && themeViewFormat) {\r\n                        this.saveSettings(defaultSettings, 'view', themeViewFormat.value);\r\n                    } else if (scope === 'page' && themePageId) {\r\n                        this.saveSettings(defaultSettings, 'page', null, themePageId.value);\r\n                    }\r\n                } else {\r\n                    this.saveSettings(defaultSettings);\r\n                }\r\n                this.showSettingsModal(); // Refresh the modal\r\n            });\r\n        }\r\n        \r\n        // Set to Default button (original values)\r\n        document.getElementById('settings-set-default').addEventListener('click', () => {\r\n            const originalSettings = this.getOriginalDefaultSettings();\r\n            this.saveSettings(originalSettings);\r\n            this.showSettingsModal(); // Refresh the modal\r\n        });\r\n        \r\n        // File integrity check button\r\n        const fileIntegrityBtn = document.getElementById('diagnostic-file-integrity');\r\n        const fileIntegrityResult = document.getElementById('diagnostic-file-integrity-result');\r\n        if (fileIntegrityBtn && fileIntegrityResult) {\r\n            fileIntegrityBtn.addEventListener('click', async () => {\r\n                const currentFilename = this.app.fileManager?.currentFilename;\r\n                if (!currentFilename) {\r\n                    fileIntegrityResult.style.display = 'block';\r\n                    fileIntegrityResult.innerHTML = '<div style=\"color: #ff5555;\">No file currently open</div>';\r\n                    return;\r\n                }\r\n                \r\n                fileIntegrityBtn.disabled = true;\r\n                fileIntegrityBtn.textContent = 'Running...';\r\n                fileIntegrityResult.style.display = 'block';\r\n                fileIntegrityResult.innerHTML = '<div style=\"color: #888;\">Checking file integrity...</div>';\r\n                \r\n                try {\r\n                    const report = await this.app.fileManager.diagnoseFileIntegrity(currentFilename);\r\n                    \r\n                    let resultHtml = `<div style=\"color: #ffffff; font-weight: 600; margin-bottom: 10px;\">File Integrity Report: ${currentFilename}</div>`;\r\n                    resultHtml += `<div style=\"color: ${report.isValid ? '#4a9eff' : '#ff5555'}; margin-bottom: 10px;\">Status: ${report.isValid ? 'Valid' : 'Issues Found'}</div>`;\r\n                    \r\n                    resultHtml += `<div style=\"color: #e0e0e0; margin-bottom: 10px;\">`;\r\n                    resultHtml += `Documents: ${report.elementCounts.documents}, Groups: ${report.elementCounts.groups}, Items: ${report.elementCounts.items}`;\r\n                    resultHtml += `</div>`;\r\n                    \r\n                    if (report.issues && report.issues.length > 0) {\r\n                        resultHtml += `<div style=\"color: #ff5555; margin-top: 10px; font-weight: 600;\">Issues (${report.issues.length}):</div>`;\r\n                        report.issues.forEach(issue => {\r\n                            resultHtml += `<div style=\"color: #ff8888; font-size: 12px; margin-left: 10px; margin-top: 3px;\">`;\r\n                            resultHtml += ` [${issue.type}] ${issue.location}: ${issue.description}`;\r\n                            resultHtml += `</div>`;\r\n                        });\r\n                    } else {\r\n                        resultHtml += `<div style=\"color: #4a9eff; margin-top: 10px;\">No issues found</div>`;\r\n                    }\r\n                    \r\n                    fileIntegrityResult.innerHTML = resultHtml;\r\n                } catch (error) {\r\n                    fileIntegrityResult.innerHTML = `<div style=\"color: #ff5555;\">Error: ${error.message}</div>`;\r\n                } finally {\r\n                    fileIntegrityBtn.disabled = false;\r\n                    fileIntegrityBtn.textContent = 'Run File Integrity Check';\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Theme management event listeners\r\n        const themeManagerForListeners = this._getThemeManager();\r\n        if (this.useThemes && themeManagerForListeners) {\r\n            const themeScopeSelect = document.getElementById('theme-scope-select');\r\n            const themeViewSelector = document.getElementById('theme-view-selector');\r\n            const themePageSelector = document.getElementById('theme-page-selector');\r\n            const themeViewFormat = document.getElementById('theme-view-format');\r\n            const themePageId = document.getElementById('theme-page-id');\r\n            const themeLoadBtn = document.getElementById('theme-load-btn');\r\n            const themeResetViewBtn = document.getElementById('theme-reset-view-btn');\r\n            const themeResetPageBtn = document.getElementById('theme-reset-page-btn');\r\n            \r\n            // Theme preset selection\r\n            let selectedPresetId = null;\r\n            const presetItems = settingsBody.querySelectorAll('.theme-preset-item');\r\n            const presetApplyBtn = document.getElementById('theme-preset-apply-btn');\r\n            \r\n            presetItems.forEach(item => {\r\n                item.addEventListener('click', () => {\r\n                    // Remove previous selection\r\n                    presetItems.forEach(i => {\r\n                        i.style.border = '1px solid #404040';\r\n                        i.style.background = '#1a1a1a';\r\n                    });\r\n                    // Select this one\r\n                    item.style.border = '2px solid #4a9eff';\r\n                    item.style.background = '#2a3a4a';\r\n                    selectedPresetId = item.dataset.presetId;\r\n                    if (presetApplyBtn) {\r\n                        presetApplyBtn.style.display = 'inline-block';\r\n                    }\r\n                });\r\n            });\r\n            \r\n            // Apply preset button\r\n            if (presetApplyBtn) {\r\n                presetApplyBtn.addEventListener('click', () => {\r\n                    if (selectedPresetId) {\r\n                        const preset = this.themePresets.getPreset(selectedPresetId);\r\n                        if (preset) {\r\n                            // Apply to global theme\r\n                            const themeManager = this._getThemeManager();\r\n                            if (themeManager) {\r\n                                themeManager.setGlobalTheme(preset.theme);\r\n                            }\r\n                            // Apply settings\r\n                            this.applySettings(preset.theme);\r\n                            alert(`Applied \"${preset.name}\" theme globally!`);\r\n                            this.showSettingsModal();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            \r\n            // Save custom theme button\r\n            const themeSaveCustomBtn = document.getElementById('theme-save-custom-btn');\r\n            if (themeSaveCustomBtn) {\r\n                themeSaveCustomBtn.addEventListener('click', () => {\r\n                    const themeName = prompt('Enter a name for this custom theme:');\r\n                    if (themeName && themeName.trim()) {\r\n                        const themeManager = this._getThemeManager();\r\n                        const currentTheme = themeManager?.themes?.global;\r\n                        const customTheme = {\r\n                            name: themeName.trim(),\r\n                            description: 'Custom theme',\r\n                            theme: currentTheme\r\n                        };\r\n                        const json = JSON.stringify(customTheme, null, 2);\r\n                        const blob = new Blob([json], { type: 'application/json' });\r\n                        const url = URL.createObjectURL(blob);\r\n                        const a = document.createElement('a');\r\n                        a.href = url;\r\n                        a.download = `theme-${themeName.trim().toLowerCase().replace(/\\s+/g, '-')}.json`;\r\n                        a.click();\r\n                        URL.revokeObjectURL(url);\r\n                    }\r\n                });\r\n            }\r\n            \r\n            // Load custom theme button\r\n            const themeLoadCustomBtn = document.getElementById('theme-load-custom-btn');\r\n            const themeLoadCustomFile = document.getElementById('theme-load-custom-file');\r\n            if (themeLoadCustomBtn && themeLoadCustomFile) {\r\n                themeLoadCustomBtn.addEventListener('click', () => themeLoadCustomFile.click());\r\n                themeLoadCustomFile.addEventListener('change', (e) => {\r\n                    const file = e.target.files[0];\r\n                    if (file) {\r\n                        const reader = new FileReader();\r\n                        reader.onload = (event) => {\r\n                            try {\r\n                                const imported = JSON.parse(event.target.result);\r\n                                if (imported.theme) {\r\n                                    // It's a preset format\r\n                                    const themeManager = this._getThemeManager();\r\n                                    if (themeManager) {\r\n                                        themeManager.setGlobalTheme(imported.theme);\r\n                                    }\r\n                                    this.applySettings(imported.theme);\r\n                                    alert(`Loaded custom theme: ${imported.name || 'Unnamed'}`);\r\n                                    this.showSettingsModal();\r\n                                } else {\r\n                                    // It's a raw theme\r\n                                    const themeManager = this._getThemeManager();\r\n                                    if (themeManager) {\r\n                                        themeManager.setGlobalTheme(imported);\r\n                                    }\r\n                                    this.applySettings(imported);\r\n                                    alert('Loaded custom theme!');\r\n                                    this.showSettingsModal();\r\n                                }\r\n                            } catch (error) {\r\n                                alert('Failed to load theme. Please check the file format.');\r\n                                console.error('Theme load error:', error);\r\n                            }\r\n                        };\r\n                        reader.readAsText(file);\r\n                    }\r\n                });\r\n            }\r\n            \r\n            if (themeScopeSelect) {\r\n                themeScopeSelect.addEventListener('change', () => {\r\n                    const scope = themeScopeSelect.value;\r\n                    themeViewSelector.style.display = scope === 'view' ? 'block' : 'none';\r\n                    themePageSelector.style.display = scope === 'page' ? 'block' : 'none';\r\n                    themeResetViewBtn.style.display = scope === 'view' ? 'inline-block' : 'none';\r\n                    themeResetPageBtn.style.display = scope === 'page' ? 'inline-block' : 'none';\r\n                });\r\n            }\r\n            \r\n            if (themeLoadBtn) {\r\n                themeLoadBtn.addEventListener('click', () => {\r\n                    const scope = themeScopeSelect?.value || 'global';\r\n                    let theme = null;\r\n                    \r\n                    const themeManager = this._getThemeManager();\r\n                    if (scope === 'global') {\r\n                        theme = themeManager?.themes?.global;\r\n                    } else if (scope === 'view' && themeViewFormat) {\r\n                        const viewFormat = themeViewFormat.value;\r\n                        theme = themeManager?.getViewTheme(viewFormat) || themeManager?.themes?.global;\r\n                    } else if (scope === 'page' && themePageId) {\r\n                        const pageId = themePageId.value;\r\n                        theme = themeManager?.getPageTheme(pageId) || themeManager?.getEffectiveTheme(pageId);\r\n                    }\r\n                    \r\n                    if (theme) {\r\n                        // Reload settings modal with the selected theme\r\n                        this.showSettingsModal();\r\n                        // Expand all sections\r\n                        settingsBody.querySelectorAll('.settings-section-content').forEach(content => {\r\n                            content.style.display = 'block';\r\n                        });\r\n                        settingsBody.querySelectorAll('.settings-toggle-arrow').forEach(arrow => {\r\n                            arrow.textContent = '';\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            \r\n            if (themeResetViewBtn && themeViewFormat) {\r\n                themeResetViewBtn.addEventListener('click', () => {\r\n                    const viewFormat = themeViewFormat.value;\r\n                    const themeManager = this._getThemeManager();\r\n                    if (themeManager) {\r\n                        themeManager.setViewTheme(viewFormat, null);\r\n                    }\r\n                    alert(`View theme for \"${viewFormat}\" reset to inherit from global.`);\r\n                    this.showSettingsModal();\r\n                });\r\n            }\r\n            \r\n            if (themeResetPageBtn && themePageId) {\r\n                themeResetPageBtn.addEventListener('click', () => {\r\n                    const pageId = themePageId.value;\r\n                    if (themeManager) {\r\n                        themeManager.setPageTheme(pageId, null);\r\n                    }\r\n                    alert(`Page theme for \"${pageId}\" reset to inherit from view/global.`);\r\n                    this.showSettingsModal();\r\n                });\r\n            }\r\n            \r\n            // Export theme button\r\n            const themeExportBtn = document.getElementById('theme-export-btn');\r\n            if (themeExportBtn) {\r\n                themeExportBtn.addEventListener('click', () => {\r\n                    const scope = themeScopeSelect?.value || 'global';\r\n                    let theme = null;\r\n                    let filename = 'theme';\r\n                    \r\n                    const themeManager = this._getThemeManager();\r\n                    if (scope === 'global') {\r\n                        theme = themeManager?.themes?.global;\r\n                        filename = 'theme-global';\r\n                    } else if (scope === 'view' && themeViewFormat) {\r\n                        theme = themeManager?.getViewTheme(themeViewFormat.value) || themeManager?.themes?.global;\r\n                        filename = `theme-view-${themeViewFormat.value}`;\r\n                    } else if (scope === 'page' && themePageId) {\r\n                        theme = themeManager?.getPageTheme(themePageId.value) || themeManager?.getEffectiveTheme(themePageId.value);\r\n                        filename = `theme-page-${themePageId.value}`;\r\n                    }\r\n                    \r\n                    if (theme) {\r\n                        const json = themeManager?.exportTheme(theme);\r\n                        const blob = new Blob([json], { type: 'application/json' });\r\n                        const url = URL.createObjectURL(blob);\r\n                        const a = document.createElement('a');\r\n                        a.href = url;\r\n                        a.download = `${filename}.json`;\r\n                        a.click();\r\n                        URL.revokeObjectURL(url);\r\n                    }\r\n                });\r\n            }\r\n            \r\n            // Import theme button\r\n            const themeImportBtn = document.getElementById('theme-import-btn');\r\n            const themeImportFile = document.getElementById('theme-import-file');\r\n            if (themeImportBtn && themeImportFile) {\r\n                themeImportBtn.addEventListener('click', () => themeImportFile.click());\r\n                themeImportFile.addEventListener('change', (e) => {\r\n                    const file = e.target.files[0];\r\n                    if (file) {\r\n                        const reader = new FileReader();\r\n                        reader.onload = (event) => {\r\n                            const scope = themeScopeSelect?.value || 'global';\r\n                            const viewFormat = themeViewFormat?.value || null;\r\n                            const pageId = themePageId?.value || null;\r\n                            const success = themeManager?.importTheme(event.target.result, scope, viewFormat, pageId);\r\n                            if (success) {\r\n                                alert('Theme imported successfully!');\r\n                                this.showSettingsModal();\r\n                            } else {\r\n                                alert('Failed to import theme. Please check the file format.');\r\n                            }\r\n                        };\r\n                        reader.readAsText(file);\r\n                    }\r\n                });\r\n            }\r\n            \r\n            // Export all themes button\r\n            const themeExportAllBtn = document.getElementById('theme-export-all-btn');\r\n            if (themeExportAllBtn) {\r\n                themeExportAllBtn.addEventListener('click', () => {\r\n                    const themeManager = this._getThemeManager();\r\n                    const json = themeManager?.exportAllThemes();\r\n                    const blob = new Blob([json], { type: 'application/json' });\r\n                    const url = URL.createObjectURL(blob);\r\n                    const a = document.createElement('a');\r\n                    a.href = url;\r\n                    a.download = 'themes-all.json';\r\n                    a.click();\r\n                    URL.revokeObjectURL(url);\r\n                });\r\n            }\r\n            \r\n            // Import all themes button\r\n            const themeImportAllBtn = document.getElementById('theme-import-all-btn');\r\n            const themeImportAllFile = document.getElementById('theme-import-all-file');\r\n            if (themeImportAllBtn && themeImportAllFile) {\r\n                themeImportAllBtn.addEventListener('click', () => themeImportAllFile.click());\r\n                themeImportAllFile.addEventListener('change', (e) => {\r\n                    const file = e.target.files[0];\r\n                    if (file) {\r\n                        const reader = new FileReader();\r\n                        reader.onload = (event) => {\r\n                            const success = themeManager?.importAllThemes(event.target.result);\r\n                            if (success) {\r\n                                alert('All themes imported successfully!');\r\n                                this.showSettingsModal();\r\n                            } else {\r\n                                alert('Failed to import themes. Please check the file format.');\r\n                            }\r\n                        };\r\n                        reader.readAsText(file);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        \r\n        // Add collapse/expand functionality to section titles\r\n        settingsBody.querySelectorAll('.settings-section-title').forEach(title => {\r\n            title.style.cursor = 'pointer';\r\n            title.addEventListener('click', () => {\r\n                const targetId = title.dataset.collapseTarget;\r\n                const content = document.getElementById(targetId);\r\n                const arrow = title.querySelector('.settings-toggle-arrow');\r\n                if (content) {\r\n                    const isCollapsed = content.style.display === 'none';\r\n                    content.style.display = isCollapsed ? 'block' : 'none';\r\n                    arrow.textContent = isCollapsed ? '' : '';\r\n                }\r\n            });\r\n        });\r\n        \r\n        // Add collapse/expand functionality to subsection titles\r\n        settingsBody.querySelectorAll('.settings-subsection-title[data-collapse-target]').forEach(title => {\r\n            title.style.cursor = 'pointer';\r\n            title.addEventListener('click', () => {\r\n                const targetId = title.dataset.collapseTarget;\r\n                const content = document.getElementById(targetId);\r\n                const arrow = title.querySelector('.settings-toggle-arrow');\r\n                if (content) {\r\n                    const isCollapsed = content.style.display === 'none';\r\n                    content.style.display = isCollapsed ? 'block' : 'none';\r\n                    arrow.textContent = isCollapsed ? '' : '';\r\n                }\r\n            });\r\n        });\r\n        \r\n        modal.classList.add('active');\r\n    }\r\n    \r\n    createColorControl(path, label, value) {\r\n        return `\r\n            <div class=\"settings-control\">\r\n                <label>${label}:</label>\r\n                <div class=\"settings-control-row\">\r\n                    <input type=\"color\" data-setting-path=\"${path}\" value=\"${value && value !== 'transparent' && value.startsWith('#') ? value : '#000000'}\">\r\n                    <input type=\"text\" data-setting-path=\"${path}\" value=\"${value || ''}\" style=\"flex: 1;\">\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    createTextControl(path, label, value) {\r\n        return `\r\n            <div class=\"settings-control\">\r\n                <label>${label}:</label>\r\n                <input type=\"text\" data-setting-path=\"${path}\" value=\"${value}\">\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    createSliderControl(path, label, value, min = 0, max = 100, step = 1, unit = 'px') {\r\n        // Extract numeric value from string like \"14px\" or \"20px\"\r\n        const numValue = parseFloat(value) || 0;\r\n        return `\r\n            <div class=\"settings-control\">\r\n                <label>${label}:</label>\r\n                <div class=\"settings-control-row\">\r\n                    <input type=\"range\" min=\"${min}\" max=\"${max}\" step=\"${step}\" data-setting-path=\"${path}\" value=\"${numValue}\">\r\n                    <input type=\"number\" min=\"${min}\" max=\"${max}\" step=\"${step}\" data-setting-path=\"${path}\" value=\"${numValue}\" style=\"width: 80px;\">\r\n                    <span style=\"color: #888; min-width: 30px;\">${unit}</span>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    createOpacityControl(path, label, value) {\r\n        const numValue = parseFloat(value) * 100;\r\n        return `\r\n            <div class=\"settings-control\">\r\n                <label>${label}:</label>\r\n                <div class=\"settings-control-row\">\r\n                    <input type=\"range\" min=\"0\" max=\"100\" step=\"1\" data-setting-path=\"${path}\" value=\"${numValue}\">\r\n                    <input type=\"number\" min=\"0\" max=\"100\" step=\"1\" data-setting-path=\"${path}\" value=\"${numValue}\" style=\"width: 80px;\">\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n    \r\n    updateSetting(path, value, themeType = 'global', viewFormat = null, pageId = null) {\r\n        let settings;\r\n        \r\n        // Load settings from appropriate theme scope\r\n        const themeManager = this._getThemeManager();\r\n        if (this.useThemes && themeManager) {\r\n            if (themeType === 'global') {\r\n                settings = themeManager?.themes?.global;\r\n            } else if (themeType === 'view' && viewFormat) {\r\n                let viewTheme = themeManager?.getViewTheme(viewFormat);\r\n                if (!viewTheme && themeManager) {\r\n                    // Create new view theme based on global\r\n                    viewTheme = { ...themeManager.themes.global };\r\n                    themeManager.setViewTheme(viewFormat, viewTheme);\r\n                }\r\n                settings = viewTheme;\r\n            } else if (themeType === 'page' && pageId) {\r\n                let pageTheme = themeManager?.getPageTheme(pageId);\r\n                if (!pageTheme && themeManager) {\r\n                    // Create new page theme based on effective theme\r\n                    pageTheme = { ...themeManager.getEffectiveTheme(pageId) };\r\n                    themeManager.setPageTheme(pageId, pageTheme);\r\n                }\r\n                settings = pageTheme;\r\n            } else {\r\n                settings = this.loadSettings();\r\n            }\r\n        } else {\r\n            settings = this.loadSettings();\r\n        }\r\n        \r\n        const keys = path.split('.');\r\n        let obj = settings;\r\n        for (let i = 0; i < keys.length - 1; i++) {\r\n            obj = obj[keys[i]];\r\n        }\r\n        obj[keys[keys.length - 1]] = value;\r\n        \r\n        // Sync color inputs\r\n        if (path.includes('color') || path.includes('background')) {\r\n            const allInputs = document.querySelectorAll(`[data-setting-path=\"${path}\"]`);\r\n            allInputs.forEach(input => {\r\n                if (input.type === 'color') {\r\n                    // Color inputs don't accept \"transparent\", convert to a valid hex or skip\r\n                    if (value && value !== 'transparent' && value.startsWith('#')) {\r\n                        input.value = value;\r\n                    } else if (value && value !== 'transparent') {\r\n                        // Try to convert named colors or rgba to hex, or use a default\r\n                        input.value = '#000000'; // Default fallback\r\n                    }\r\n                } else if (input.type === 'text') {\r\n                    input.value = value;\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Sync opacity inputs (convert 0-1 to 0-100 for display)\r\n        if (path.includes('opacity')) {\r\n            const numValue = parseFloat(value) * 100;\r\n            const allInputs = document.querySelectorAll(`[data-setting-path=\"${path}\"]`);\r\n            allInputs.forEach(input => {\r\n                if (input.type === 'range' || input.type === 'number') {\r\n                    input.value = numValue;\r\n                }\r\n            });\r\n        }\r\n        \r\n        // Sync slider inputs (extract numeric value and sync range/number inputs)\r\n        if (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size') || path.includes('gap')) {\r\n            const numValue = parseFloat(value) || 0;\r\n            const allInputs = document.querySelectorAll(`[data-setting-path=\"${path}\"]`);\r\n            allInputs.forEach(input => {\r\n                if (input.type === 'range' || input.type === 'number') {\r\n                    input.value = numValue;\r\n                }\r\n            });\r\n        }\r\n        \r\n        this.saveSettings(settings, themeType, viewFormat, pageId);\r\n    }\r\n    \r\n    closeSettingsModal() {\r\n        const modal = document.getElementById('settings-modal');\r\n        modal.classList.remove('active');\r\n    }\r\n}\r\n","// ThemeManager.js - Manages themes with view-specific and page-specific overrides\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { getService, SERVICES } from '../core/AppServices.js';\r\n\r\nexport class ThemeManager {\r\n    constructor() {\r\n        this.storageKey = 'twodo-themes';\r\n        this.themes = this.loadThemes();\r\n        \r\n        // Initialize with default theme structure\r\n        if (!this.themes.global) {\r\n            this.themes.global = this.getDefaultTheme();\r\n        }\r\n        \r\n        // View-specific themes (one per format)\r\n        const viewFormats = ['default', 'grid-layout-format', 'horizontal-layout-format', 'document-view-format', 'page-kanban-format', 'trello-board'];\r\n        viewFormats.forEach(format => {\r\n            if (!this.themes.views[format]) {\r\n                this.themes.views[format] = null; // null means inherit from global\r\n            }\r\n        });\r\n        \r\n        this.saveThemes();\r\n    }\r\n    \r\n    loadThemes() {\r\n        const stored = localStorage.getItem(this.storageKey);\r\n        if (stored) {\r\n            try {\r\n                const themes = JSON.parse(stored);\r\n                // Ensure structure exists\r\n                return {\r\n                    global: themes.global || this.getDefaultTheme(),\r\n                    views: themes.views || {},\r\n                    documents: themes.documents || {}\r\n                };\r\n            } catch (e) {\r\n                console.error('Failed to parse themes:', e);\r\n            }\r\n        }\r\n        return {\r\n            global: this.getDefaultTheme(),\r\n            views: {},\r\n            documents: {}\r\n        };\r\n    }\r\n    \r\n    saveThemes() {\r\n        localStorage.setItem(this.storageKey, JSON.stringify(this.themes));\r\n    }\r\n    \r\n    getDefaultTheme() {\r\n        // Return a copy of default settings structure\r\n        return {\r\n            background: '#1a1a1a',\r\n            page: {\r\n                background: '#2d2d2d',\r\n                margin: '0px',\r\n                padding: '20px',\r\n                borderRadius: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                title: {\r\n                    fontSize: '18px',\r\n                    color: '#ffffff',\r\n                    marginBottom: '15px'\r\n                }\r\n            },\r\n            element: {\r\n                background: 'transparent',\r\n                margin: '0px',\r\n                padding: '10px',\r\n                paddingVertical: '10px',\r\n                paddingHorizontal: '10px',\r\n                gap: '8px',\r\n                fontFamily: '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif',\r\n                fontSize: '14px',\r\n                opacity: '1',\r\n                color: '#e0e0e0',\r\n                hoverBackground: '#363636'\r\n            },\r\n            header: {\r\n                fontSize: '16px',\r\n                color: '#b8b8b8',\r\n                margin: '10px 0'\r\n            },\r\n            checkbox: {\r\n                size: '18px'\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Deep merge two theme objects\r\n     */\r\n    mergeThemes(base, override) {\r\n        const merged = { ...base };\r\n        for (const key in override) {\r\n            if (override[key] && typeof override[key] === 'object' && !Array.isArray(override[key])) {\r\n                merged[key] = this.mergeThemes(merged[key] || {}, override[key]);\r\n            } else {\r\n                merged[key] = override[key];\r\n            }\r\n        }\r\n        return merged;\r\n    }\r\n    \r\n    /**\r\n     * Get effective theme for a page\r\n     * Priority: page-specific > view-specific > global\r\n     */\r\n    getEffectiveTheme(pageId, viewFormat = 'default') {\r\n        let theme = { ...this.themes.global };\r\n        \r\n        // Apply view-specific theme if exists\r\n        if (this.themes.views[viewFormat] && this.themes.views[viewFormat] !== null) {\r\n            theme = this.mergeThemes(theme, this.themes.views[viewFormat]);\r\n        }\r\n        \r\n        // Apply page-specific theme if exists\r\n        if (this.themes.documents[pageId]) {\r\n            theme = this.mergeThemes(theme, this.themes.documents[pageId]);\r\n        }\r\n        \r\n        return theme;\r\n    }\r\n    \r\n    /**\r\n     * Set global theme\r\n     */\r\n    setGlobalTheme(theme) {\r\n        this.themes.global = this.mergeThemes(this.getDefaultTheme(), theme);\r\n        this.saveThemes();\r\n        this.applyTheme(this.themes.global);\r\n        eventBus.emit('theme:updated', { type: 'global', theme: this.themes.global });\r\n        // Trigger immediate UI update\r\n        this._updateAllUIThemes();\r\n    }\r\n    \r\n    /**\r\n     * Set view-specific theme\r\n     */\r\n    setViewTheme(viewFormat, theme) {\r\n        if (theme === null) {\r\n            // Remove view theme (inherit from global)\r\n            delete this.themes.views[viewFormat];\r\n        } else {\r\n            this.themes.views[viewFormat] = this.mergeThemes(this.getDefaultTheme(), theme);\r\n        }\r\n        this.saveThemes();\r\n        eventBus.emit('theme:updated', { type: 'view', viewFormat, theme });\r\n        // Trigger immediate UI update\r\n        this._updateAllUIThemes();\r\n    }\r\n    \r\n    /**\r\n     * Set page-specific theme\r\n     */\r\n    setPageTheme(pageId, theme) {\r\n        if (theme === null) {\r\n            // Remove page theme (inherit from view/global)\r\n            delete this.themes.documents[pageId];\r\n        } else {\r\n            this.themes.documents[pageId] = this.mergeThemes(this.getDefaultTheme(), theme);\r\n        }\r\n        this.saveThemes();\r\n        eventBus.emit('theme:updated', { type: 'page', pageId, theme });\r\n        // Trigger immediate UI update\r\n        this._updateAllUIThemes();\r\n    }\r\n    \r\n    /**\r\n     * Update all UI components with current themes immediately\r\n     */\r\n    _updateAllUIThemes() {\r\n        // Apply global theme to root first (this sets CSS variables globally)\r\n        // CSS variables cascade to all child elements, so this updates everything\r\n        this.applyTheme(this.themes.global, 'root');\r\n        \r\n        // Get app state for page-specific themes\r\n        const appState = this._getAppState();\r\n        if (!appState || !appState.documents) return;\r\n        \r\n        // Update bins-container for current page (main content area)\r\n        const binsContainer = document.getElementById('bins-container');\r\n        if (binsContainer && appState.currentDocumentId) {\r\n            const currentPage = appState.documents.find(p => p.id === appState.currentDocumentId);\r\n            if (currentPage) {\r\n                const viewFormat = currentPage.format || 'default';\r\n                const effectiveTheme = this.getEffectiveTheme(currentPage.id, viewFormat);\r\n                this.applyTheme(effectiveTheme, binsContainer);\r\n            }\r\n        }\r\n        \r\n        // Update all format view containers (format-specific views)\r\n        const formatContainers = document.querySelectorAll('.format-container, .pane-content');\r\n        formatContainers.forEach(container => {\r\n            const pageId = container.dataset.pageId;\r\n            if (pageId) {\r\n                const page = appState.documents.find(p => p.id === pageId);\r\n                if (page) {\r\n                    const viewFormat = page.format || container.dataset.format || 'default';\r\n                    const effectiveTheme = this.getEffectiveTheme(pageId, viewFormat);\r\n                    this.applyTheme(effectiveTheme, container);\r\n                }\r\n            }\r\n        });\r\n        \r\n        // Update modal if open (so theme changes are visible in settings modal)\r\n        const modal = document.getElementById('modal');\r\n        if (modal && modal.classList.contains('active')) {\r\n            this.applyTheme(this.themes.global, modal);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get AppState service (for accessing documents)\r\n     */\r\n    _getAppState() {\r\n        try {\r\n            return getService(SERVICES.APP_STATE);\r\n        } catch (e) {\r\n            // Fallback if services not available\r\n            return null;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get view-specific theme (or null if inheriting)\r\n     */\r\n    getViewTheme(viewFormat) {\r\n        return this.themes.views[viewFormat] || null;\r\n    }\r\n    \r\n    /**\r\n     * Get page-specific theme (or null if inheriting)\r\n     */\r\n    getPageTheme(pageId) {\r\n        return this.themes.documents[pageId] || null;\r\n    }\r\n    \r\n    /**\r\n     * Apply theme to CSS variables\r\n     */\r\n    applyTheme(theme, scope = 'root') {\r\n        let target;\r\n        if (scope === 'root') {\r\n            target = document.documentElement;\r\n        } else if (scope instanceof HTMLElement) {\r\n            target = scope;\r\n        } else {\r\n            target = document.querySelector(scope);\r\n        }\r\n        if (!target) return;\r\n        \r\n        target.style.setProperty('--bg-color', theme.background);\r\n        target.style.setProperty('--page-bg', theme.page.background);\r\n        target.style.setProperty('--page-margin', theme.page.margin);\r\n        target.style.setProperty('--page-padding', theme.page.padding);\r\n        target.style.setProperty('--page-border-radius', theme.page.borderRadius);\r\n        target.style.setProperty('--page-font-family', theme.page.fontFamily);\r\n        target.style.setProperty('--page-font-size', theme.page.fontSize);\r\n        target.style.setProperty('--page-opacity', theme.page.opacity);\r\n        target.style.setProperty('--page-color', theme.page.color);\r\n        target.style.setProperty('--page-title-font-size', theme.page.title.fontSize);\r\n        target.style.setProperty('--page-title-color', theme.page.title.color);\r\n        target.style.setProperty('--page-title-margin-bottom', theme.page.title.marginBottom);\r\n        target.style.setProperty('--element-bg', theme.element.background);\r\n        target.style.setProperty('--element-margin', theme.element.margin);\r\n        target.style.setProperty('--element-padding', theme.element.padding);\r\n        target.style.setProperty('--element-padding-vertical', theme.element.paddingVertical || theme.element.padding);\r\n        target.style.setProperty('--element-padding-horizontal', theme.element.paddingHorizontal || theme.element.padding);\r\n        target.style.setProperty('--element-gap', theme.element.gap || '8px');\r\n        target.style.setProperty('--element-font-family', theme.element.fontFamily);\r\n        target.style.setProperty('--element-font-size', theme.element.fontSize);\r\n        target.style.setProperty('--element-opacity', theme.element.opacity);\r\n        target.style.setProperty('--element-color', theme.element.color);\r\n        target.style.setProperty('--element-hover-bg', theme.element.hoverBackground);\r\n        target.style.setProperty('--header-font-size', theme.header.fontSize);\r\n        target.style.setProperty('--header-color', theme.header.color);\r\n        target.style.setProperty('--header-margin', theme.header.margin);\r\n        target.style.setProperty('--checkbox-size', (theme.checkbox && theme.checkbox.size) || '18px');\r\n        \r\n        // Apply textures and shadows if present\r\n        if (theme.page.texture) {\r\n            target.style.setProperty('--page-texture', theme.page.texture);\r\n        }\r\n        if (theme.page.shadow) {\r\n            target.style.setProperty('--page-shadow', theme.page.shadow);\r\n        }\r\n        if (theme.element.texture) {\r\n            target.style.setProperty('--element-texture', theme.element.texture);\r\n        }\r\n        if (theme.element.shadow) {\r\n            target.style.setProperty('--element-shadow', theme.element.shadow);\r\n        }\r\n        if (theme.backgroundTexture) {\r\n            target.style.setProperty('--background-texture', theme.backgroundTexture);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply effective theme for a specific page/view combination\r\n     */\r\n    applyPageTheme(pageId, viewFormat = 'default', containerElement = null) {\r\n        const theme = this.getEffectiveTheme(pageId, viewFormat);\r\n        \r\n        // Always apply to root first so CSS variables are globally available\r\n        this.applyTheme(theme, 'root');\r\n        \r\n        // Also apply to container if provided (for page-specific overrides)\r\n        if (containerElement && containerElement instanceof HTMLElement) {\r\n            this.applyTheme(theme, containerElement);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Export theme as JSON\r\n     */\r\n    exportTheme(theme) {\r\n        return JSON.stringify(theme, null, 2);\r\n    }\r\n    \r\n    /**\r\n     * Export all themes (global, views, pages)\r\n     */\r\n    exportAllThemes() {\r\n        return JSON.stringify(this.themes, null, 2);\r\n    }\r\n    \r\n    /**\r\n     * Import theme from JSON\r\n     */\r\n    importTheme(jsonString, themeType = 'global', viewFormat = null, pageId = null) {\r\n        try {\r\n            const imported = JSON.parse(jsonString);\r\n            if (themeType === 'global') {\r\n                this.setGlobalTheme(imported);\r\n            } else if (themeType === 'view' && viewFormat) {\r\n                this.setViewTheme(viewFormat, imported);\r\n            } else if (themeType === 'page' && pageId) {\r\n                this.setPageTheme(pageId, imported);\r\n            }\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to parse theme JSON:', e);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Import all themes from JSON\r\n     */\r\n    importAllThemes(jsonString) {\r\n        try {\r\n            const imported = JSON.parse(jsonString);\r\n            if (imported.global) {\r\n                this.themes.global = this.mergeThemes(this.getDefaultTheme(), imported.global);\r\n            }\r\n            if (imported.views) {\r\n                this.themes.views = { ...this.themes.views, ...imported.views };\r\n            }\r\n            if (imported.documents) {\r\n                this.themes.documents = { ...this.themes.documents, ...imported.documents };\r\n            }\r\n            this.saveThemes();\r\n            eventBus.emit('theme:imported', { themes: this.themes });\r\n            // Trigger immediate UI update\r\n            this._updateAllUIThemes();\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Failed to import themes:', e);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get all available view formats\r\n     */\r\n    getViewFormats() {\r\n        return ['default', 'grid-layout-format', 'horizontal-layout-format', 'document-view-format', 'page-kanban-format', 'trello-board'];\r\n    }\r\n}\r\n\r\n","// VisualSettingsManager.js - Manages granular visual settings for individual objects\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class VisualSettingsManager {\n    constructor() {\n        this.storageKey = 'twodo-visual-settings';\n        this.settings = this.loadSettings();\n    }\n    \n    /**\n     * Get services\n     */\n    _getThemeManager() {\n        return getService(SERVICES.THEME_MANAGER);\n    }\n    \n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    loadSettings() {\n        const stored = localStorage.getItem(this.storageKey);\n        if (stored) {\n            try {\n                return JSON.parse(stored);\n            } catch (e) {\n                console.error('Failed to parse visual settings:', e);\n            }\n        }\n        return {\n            panes: {},      // paneId -> { custom: {...}, preserveAll: boolean }\n            pages: {},      // pageId -> { custom: {...}, preserveAll: boolean }\n            bins: {},       // binId -> { custom: {...}, preserveAll: boolean }\n            elements: {},   // elementId -> { custom: {...}, preserveAll: boolean }\n            tags: {}        // tag -> { custom: {...}, preserveAll: boolean, viewFormat: string|null }\n        };\n    }\n    \n    saveSettings() {\n        localStorage.setItem(this.storageKey, JSON.stringify(this.settings));\n    }\n    \n    /**\n     * Get visual settings for an object\n     * @param {string} type - 'pane', 'page', 'bin', or 'element'\n     * @param {string} id - Object ID\n     * @returns {Object} - { custom: {...}, preserveAll: boolean }\n     */\n    getObjectSettings(type, id) {\n        const typeKey = `${type}s`; // panes, pages, bins, elements\n        if (!this.settings[typeKey]) {\n            this.settings[typeKey] = {};\n        }\n        if (!this.settings[typeKey][id]) {\n            this.settings[typeKey][id] = { custom: {}, preserveAll: false };\n        }\n        return this.settings[typeKey][id];\n    }\n    \n    /**\n     * Get tag-based visual settings\n     * @param {string} tag - Tag name\n     * @param {string} viewFormat - View format (null for all views)\n     * @returns {Object} - { custom: {...}, preserveAll: boolean, viewFormat: string|null }\n     */\n    getTagSettings(tag, viewFormat = null) {\n        if (!this.settings.tags) {\n            this.settings.tags = {};\n        }\n        const tagKey = viewFormat ? `${tag}::${viewFormat}` : tag;\n        if (!this.settings.tags[tagKey]) {\n            this.settings.tags[tagKey] = { custom: {}, preserveAll: false, viewFormat: viewFormat };\n        }\n        return this.settings.tags[tagKey];\n    }\n    \n    /**\n     * Set tag-based visual settings\n     * @param {string} tag - Tag name\n     * @param {Object} customSettings - Custom settings\n     * @param {boolean} preserveAll - Whether to preserve all values\n     * @param {string} viewFormat - View format (null for all views)\n     */\n    setTagSettings(tag, customSettings, preserveAll = false, viewFormat = null) {\n        if (!this.settings.tags) {\n            this.settings.tags = {};\n        }\n        const tagKey = viewFormat ? `${tag}::${viewFormat}` : tag;\n        \n        if (preserveAll) {\n            this.settings.tags[tagKey] = {\n                custom: customSettings,\n                preserveAll: true,\n                viewFormat: viewFormat\n            };\n        } else {\n            const existing = this.settings.tags[tagKey] || { custom: {}, preserveAll: false, viewFormat: viewFormat };\n            const merged = { ...existing.custom, ...customSettings };\n            this.settings.tags[tagKey] = {\n                custom: merged,\n                preserveAll: false,\n                viewFormat: viewFormat\n            };\n        }\n        \n        this.saveSettings();\n        eventBus.emit('visual-settings:updated', { type: 'tag', tag, viewFormat, settings: this.settings.tags[tagKey] });\n    }\n    \n    /**\n     * Remove tag-based visual settings\n     * @param {string} tag - Tag name\n     * @param {string} viewFormat - View format (null for all views)\n     */\n    removeTagSettings(tag, viewFormat = null) {\n        if (!this.settings.tags) return;\n        const tagKey = viewFormat ? `${tag}::${viewFormat}` : tag;\n        if (this.settings.tags[tagKey]) {\n            delete this.settings.tags[tagKey];\n            this.saveSettings();\n            eventBus.emit('visual-settings:removed', { type: 'tag', tag, viewFormat });\n        }\n    }\n    \n    /**\n     * Get all tags that have visual settings\n     * @returns {Array} - Array of { tag: string, viewFormat: string|null }\n     */\n    getTagsWithSettings() {\n        if (!this.settings.tags) return [];\n        return Object.keys(this.settings.tags).map(key => {\n            const parts = key.split('::');\n            return {\n                tag: parts[0],\n                viewFormat: parts.length > 1 ? parts[1] : null\n            };\n        });\n    }\n    \n    /**\n     * Set visual settings for an object\n     * @param {string} type - 'pane', 'page', 'bin', or 'element'\n     * @param {string} id - Object ID\n     * @param {Object} customSettings - Custom settings (only changed values)\n     * @param {boolean} preserveAll - Whether to preserve all values\n     */\n    setObjectSettings(type, id, customSettings, preserveAll = false) {\n        const typeKey = `${type}s`;\n        if (!this.settings[typeKey]) {\n            this.settings[typeKey] = {};\n        }\n        \n        if (preserveAll) {\n            // Store all current values\n            this.settings[typeKey][id] = {\n                custom: customSettings,\n                preserveAll: true\n            };\n        } else {\n            // Only store customized values\n            const existing = this.settings[typeKey][id] || { custom: {}, preserveAll: false };\n            const merged = { ...existing.custom, ...customSettings };\n            this.settings[typeKey][id] = {\n                custom: merged,\n                preserveAll: false\n            };\n        }\n        \n        this.saveSettings();\n        eventBus.emit('visual-settings:updated', { type, id, settings: this.settings[typeKey][id] });\n    }\n    \n    /**\n     * Remove visual settings for an object\n     */\n    removeObjectSettings(type, id) {\n        const typeKey = `${type}s`;\n        if (this.settings[typeKey] && this.settings[typeKey][id]) {\n            delete this.settings[typeKey][id];\n            this.saveSettings();\n            eventBus.emit('visual-settings:removed', { type, id });\n        }\n    }\n    \n    /**\n     * Get effective visual settings for an object (merges with theme hierarchy)\n     * @param {string} type - 'pane', 'page', 'bin', or 'element'\n     * @param {string} id - Object ID\n     * @param {string} pageId - Page ID (for bins/elements)\n     * @param {string} viewFormat - View format (for pages)\n     * @param {Array} tags - Array of tags for the object\n     * @returns {Object} - Effective settings\n     */\n    getEffectiveSettings(type, id, pageId = null, viewFormat = 'default', tags = []) {\n        let baseTheme = {};\n        \n        // Start with global theme\n        const themeManager = this._getThemeManager();\n        if (themeManager) {\n            baseTheme = themeManager.getEffectiveTheme(pageId || id, viewFormat);\n        }\n        \n        // Apply tag-based settings (view-specific first, then global)\n        if (tags && Array.isArray(tags) && tags.length > 0) {\n            // First apply view-specific tag settings\n            tags.forEach(tag => {\n                const viewSpecificTagSettings = this.getTagSettings(tag, viewFormat);\n                if (viewSpecificTagSettings.custom && Object.keys(viewSpecificTagSettings.custom).length > 0) {\n                    baseTheme = this.mergeSettings(baseTheme, viewSpecificTagSettings.custom);\n                }\n            });\n            \n            // Then apply global tag settings (for tags without view-specific settings)\n            tags.forEach(tag => {\n                const globalTagSettings = this.getTagSettings(tag, null);\n                // Only apply if no view-specific settings exist\n                const viewSpecificKey = `${tag}::${viewFormat}`;\n                if (!this.settings.tags || !this.settings.tags[viewSpecificKey] || \n                    Object.keys(this.settings.tags[viewSpecificKey].custom || {}).length === 0) {\n                    if (globalTagSettings.custom && Object.keys(globalTagSettings.custom).length > 0) {\n                        baseTheme = this.mergeSettings(baseTheme, globalTagSettings.custom);\n                    }\n                }\n            });\n        }\n        \n        // Apply object-specific settings (highest priority)\n        const objectSettings = this.getObjectSettings(type, id);\n        if (objectSettings.preserveAll) {\n            // If preserveAll, use all custom settings as base\n            return this.mergeSettings(baseTheme, objectSettings.custom);\n        } else {\n            // Only merge customized values\n            return this.mergeSettings(baseTheme, objectSettings.custom);\n        }\n    }\n    \n    /**\n     * Merge two settings objects (deep merge)\n     */\n    mergeSettings(base, override) {\n        const merged = { ...base };\n        for (const key in override) {\n            if (override[key] && typeof override[key] === 'object' && !Array.isArray(override[key])) {\n                merged[key] = this.mergeSettings(merged[key] || {}, override[key]);\n            } else {\n                merged[key] = override[key];\n            }\n        }\n        return merged;\n    }\n    \n    /**\n     * Get tags for an object\n     * @param {string} type - Object type\n     * @param {string} id - Object ID\n     * @param {string} pageId - Page ID (for bins/elements)\n     * @returns {Array} - Array of tags\n     */\n    getObjectTags(type, id, pageId = null) {\n        if (type === 'element' && pageId) {\n            // Extract pageId, binId, elementIndex from element ID\n            const parts = id.split('-');\n            if (parts.length >= 3) {\n                const elementPageId = parts[0];\n                const binId = parts[1];\n                const elementIndex = parseInt(parts[2]);\n                const appState = this._getAppState();\n                const page = appState.documents?.find(p => p.id === elementPageId);\n                const bin = page?.groups?.find(b => b.id === binId);\n                const items = bin?.items || [];\n                if (bin) {\n                    bin.items = items;\n                }\n                const element = items?.[elementIndex];\n                return element?.tags || [];\n            }\n        } else if (type === 'bin' && pageId) {\n            const appState = this._getAppState();\n            const page = appState.documents?.find(p => p.id === pageId);\n            const bin = page?.groups?.find(b => b.id === id);\n            // Bins may have tags property, if not, return empty array\n            return bin?.tags || [];\n        } else if (type === 'page') {\n            const page = appState.documents?.find(p => p.id === id);\n            // Pages may have tags property, if not, return empty array\n            return page?.tags || [];\n        } else if (type === 'pane') {\n            // Panes don't have tags, but could inherit from their active page\n            // For now, return empty array\n            return [];\n        }\n        return [];\n    }\n    \n    /**\n     * Apply visual settings to a DOM element\n     * @param {HTMLElement} element - DOM element to style\n     * @param {string} type - Object type\n     * @param {string} id - Object ID\n     * @param {string} pageId - Page ID (for bins/elements)\n     * @param {string} viewFormat - View format (for pages)\n     */\n    applyVisualSettings(element, type, id, pageId = null, viewFormat = 'default') {\n        if (!element || !(element instanceof HTMLElement)) return;\n        \n        // Get object tags\n        const tags = this.getObjectTags(type, id, pageId);\n        \n        // Get effective settings (includes tag-based settings)\n        const effectiveSettings = this.getEffectiveSettings(type, id, pageId, viewFormat, tags);\n        \n        // Apply CSS variables based on object type\n        if (type === 'pane' || type === 'page') {\n            this.applyPageSettings(element, effectiveSettings);\n        } else if (type === 'bin') {\n            this.applyBinSettings(element, effectiveSettings);\n        } else if (type === 'element') {\n            this.applyElementSettings(element, effectiveSettings);\n        }\n    }\n    \n    applyPageSettings(element, settings) {\n        if (settings.background) element.style.setProperty('--page-bg', settings.background);\n        if (settings.margin) element.style.setProperty('--page-margin', settings.margin);\n        if (settings.padding) element.style.setProperty('--page-padding', settings.padding);\n        if (settings.borderRadius) element.style.setProperty('--page-border-radius', settings.borderRadius);\n        if (settings.fontFamily) element.style.setProperty('--page-font-family', settings.fontFamily);\n        if (settings.fontSize) element.style.setProperty('--page-font-size', settings.fontSize);\n        if (settings.opacity) element.style.setProperty('--page-opacity', settings.opacity);\n        if (settings.color) element.style.setProperty('--page-color', settings.color);\n        \n        if (settings.page) {\n            if (settings.page.background) element.style.setProperty('--page-bg', settings.page.background);\n            if (settings.page.margin) element.style.setProperty('--page-margin', settings.page.margin);\n            if (settings.page.padding) element.style.setProperty('--page-padding', settings.page.padding);\n            if (settings.page.borderRadius) element.style.setProperty('--page-border-radius', settings.page.borderRadius);\n            if (settings.page.fontFamily) element.style.setProperty('--page-font-family', settings.page.fontFamily);\n            if (settings.page.fontSize) element.style.setProperty('--page-font-size', settings.page.fontSize);\n            if (settings.page.opacity) element.style.setProperty('--page-opacity', settings.page.opacity);\n            if (settings.page.color) element.style.setProperty('--page-color', settings.page.color);\n        }\n    }\n    \n    applyBinSettings(element, settings) {\n        // Bins can have page-level settings plus bin-specific overrides\n        this.applyPageSettings(element, settings);\n        // Add bin-specific CSS variables if needed\n    }\n    \n    applyElementSettings(element, settings) {\n        if (settings.element) {\n            if (settings.element.background) element.style.setProperty('--element-bg', settings.element.background);\n            if (settings.element.margin) element.style.setProperty('--element-margin', settings.element.margin);\n            if (settings.element.padding) element.style.setProperty('--element-padding', settings.element.padding);\n            if (settings.element.paddingVertical) element.style.setProperty('--element-padding-vertical', settings.element.paddingVertical);\n            if (settings.element.paddingHorizontal) element.style.setProperty('--element-padding-horizontal', settings.element.paddingHorizontal);\n            if (settings.element.gap) element.style.setProperty('--element-gap', settings.element.gap);\n            if (settings.element.fontFamily) element.style.setProperty('--element-font-family', settings.element.fontFamily);\n            if (settings.element.fontSize) element.style.setProperty('--element-font-size', settings.element.fontSize);\n            if (settings.element.opacity) element.style.setProperty('--element-opacity', settings.element.opacity);\n            if (settings.element.color) element.style.setProperty('--element-color', settings.element.color);\n            if (settings.element.hoverBackground) element.style.setProperty('--element-hover-bg', settings.element.hoverBackground);\n        }\n    }\n    \n    /**\n     * Export settings for an object, tag, or all settings\n     */\n    exportSettings(type = null, id = null, tag = null, viewFormat = null) {\n        if (tag !== null) {\n            return JSON.stringify(this.getTagSettings(tag, viewFormat), null, 2);\n        } else if (type && id) {\n            return JSON.stringify(this.getObjectSettings(type, id), null, 2);\n        }\n        return JSON.stringify(this.settings, null, 2);\n    }\n    \n    /**\n     * Import settings\n     */\n    importSettings(jsonString) {\n        try {\n            const imported = JSON.parse(jsonString);\n            this.settings = this.mergeSettings(this.settings, imported);\n            this.saveSettings();\n            eventBus.emit('visual-settings:imported', { settings: this.settings });\n            return true;\n        } catch (e) {\n            console.error('Failed to import visual settings:', e);\n            return false;\n        }\n    }\n}\n\n","// PageManager.js - Handles page-related operations (pages contain bins)\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\r\n\r\nexport class PageManager {\r\n    constructor() {\r\n    }\r\n    \r\n    /**\r\n     * Get AppState service\r\n     */\r\n    _getAppState() {\r\n        return getService(SERVICES.APP_STATE);\r\n    }\r\n    \r\n    /**\r\n     * Get other services\r\n     */\r\n    _getUndoRedoManager() {\r\n        return getService(SERVICES.UNDO_REDO_MANAGER);\r\n    }\r\n    \r\n    _getDataManager() {\r\n        return getService(SERVICES.DATA_MANAGER);\r\n    }\r\n    \r\n    _getPagePluginManager() {\r\n        return getService(SERVICES.PAGE_PLUGIN_MANAGER);\r\n    }\r\n    \r\n    async addPage() {\r\n        const appState = this._getAppState();\r\n        const documentNum = appState.documents.length + 1;\r\n        const documentId = `page-${documentNum}`;\r\n        const seededGroups = [{\r\n            id: 'group-0',\r\n            title: 'Group 1',\r\n            items: [],\r\n            level: 0,\r\n            parentGroupId: null\r\n        }];\r\n        const newDocument = {\r\n            id: documentId,\r\n            groups: seededGroups,\r\n            groupMode: 'manual',\r\n            plugins: [],\r\n            format: null,\r\n            config: {\r\n                groupMode: 'manual'\r\n            }\r\n        };\r\n        const pageIndex = appState.documents.length;\r\n        appState.documents.push(newDocument);\r\n        appState.currentDocumentId = documentId;\r\n        \r\n        // Record undo/redo change\r\n        const undoRedoManager = this._getUndoRedoManager();\r\n        if (undoRedoManager) {\r\n            undoRedoManager.recordPageAdd(pageIndex, newDocument);\r\n        }\r\n        \r\n        // Initialize plugins for new page\r\n        const pagePluginManager = this._getPagePluginManager();\r\n        if (pagePluginManager) {\r\n            await pagePluginManager.initializePagePlugins(newDocument.id);\r\n        }\r\n        \r\n        // Emit event\r\n        eventBus.emit(EVENTS.PAGE.CREATED, { pageId: newDocument.id, documentId: newDocument.id, page: newDocument });\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n    }\r\n    \r\n    /**\r\n     * Ensure at least one page exists (business logic extracted from AppRenderer)\r\n     * @returns {Object} The current page\r\n     */\r\n    ensureDefaultPage() {\r\n        const appState = this._getAppState();\r\n        const currentPage = appState.documents.find(p => p.id === appState.currentDocumentId);\r\n        if (!currentPage) {\r\n            // If current page doesn't exist, use first page or create default\r\n            if (appState.documents.length > 0) {\r\n                appState.currentDocumentId = appState.documents[0].id;\r\n                return appState.documents[0];\r\n            } else {\r\n                // Create default page with one bin\r\n                const seededGroups = [{\r\n                    id: 'group-0',\r\n                    title: 'Group 1',\r\n                    items: [],\r\n                    level: 0,\r\n                    parentGroupId: null\r\n                }];\r\n                const defaultDocument = {\r\n                    id: 'page-1',\r\n                    groups: seededGroups,\r\n                    groupMode: 'manual',\r\n                    config: {\r\n                        groupMode: 'manual'\r\n                    }\r\n                };\r\n                appState.documents = [defaultDocument];\r\n                appState.currentDocumentId = 'page-1';\r\n                return defaultDocument;\r\n            }\r\n        }\r\n        return currentPage;\r\n    }\r\n    \r\n    async deletePage(pageId) {\r\n        const appState = this._getAppState();\r\n        // Don't allow deleting the last page\r\n        if (appState.documents.length <= 1) {\r\n            return;\r\n        }\r\n        \r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return;\r\n        \r\n        // Record undo/redo change before deletion\r\n        const undoRedoManager = this._getUndoRedoManager();\r\n        if (undoRedoManager) {\r\n            undoRedoManager.recordPageDelete(pageId, JSON.parse(JSON.stringify(page)));\r\n        }\r\n        \r\n        // Cleanup plugins for page\r\n        const pagePluginManager = this._getPagePluginManager();\r\n        if (pagePluginManager) {\r\n            await pagePluginManager.cleanupPagePlugins(pageId);\r\n        }\r\n        \r\n        // Emit event before deletion\r\n        eventBus.emit(EVENTS.PAGE.DELETED, { pageId });\r\n        \r\n        appState.documents = appState.documents.filter(p => p.id !== pageId);\r\n        \r\n        // If current page was deleted, switch to first page\r\n        if (appState.currentDocumentId === pageId) {\r\n            appState.currentDocumentId = appState.documents[0]?.id || null;\r\n        }\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n    }\r\n    \r\n    movePage(sourcePageId, targetPageId) {\r\n        if (sourcePageId === targetPageId) return;\r\n        \r\n        const appState = this._getAppState();\r\n        const sourcePage = appState.documents.find(p => p.id === sourcePageId);\r\n        const targetPage = appState.documents.find(p => p.id === targetPageId);\r\n        \r\n        if (!sourcePage || !targetPage) return;\r\n        \r\n        const sourceIndex = appState.documents.indexOf(sourcePage);\r\n        const targetIndex = appState.documents.indexOf(targetPage);\r\n        \r\n        // Remove from source position\r\n        appState.documents.splice(sourceIndex, 1);\r\n        \r\n        // Insert at target position (adjust if source was before target)\r\n        const insertIndex = sourceIndex < targetIndex ? targetIndex - 1 : targetIndex;\r\n        appState.documents.splice(insertIndex, 0, sourcePage);\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        requestAnimationFrame(() => {\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n    }\r\n    \r\n    renamePage(pageId, newTitle) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (page) {\r\n            // Pages don't have titles in the new structure, but we can store it for future use\r\n            // For now, pages are just numbered\r\n            const dataManager = this._getDataManager();\r\n            if (dataManager) {\r\n                dataManager.saveData();\r\n            }\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        }\r\n    }\r\n}\r\n","// BinManager.js - Handles bin-related operations (renamed from PageManager)\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\r\n\r\nexport class BinManager {\r\n    constructor() {\r\n    }\r\n    \r\n    /**\r\n     * Get services\r\n     */\r\n    _getAppState() {\r\n        return getService(SERVICES.APP_STATE);\r\n    }\r\n    \r\n    _getUndoRedoManager() {\r\n        return getService(SERVICES.UNDO_REDO_MANAGER);\r\n    }\r\n    \r\n    _getDataManager() {\r\n        return getService(SERVICES.DATA_MANAGER);\r\n    }\r\n    \r\n    _getBinPluginManager() {\r\n        return getService(SERVICES.BIN_PLUGIN_MANAGER);\r\n    }\r\n\r\n    _isManualGroupMode(document) {\r\n        const groupMode = document?.groupMode || document?.config?.groupMode || 'manual';\r\n        if (groupMode !== 'manual') {\r\n            console.warn('[BinManager] Group modifications are disabled in header-derived mode.');\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n    \r\n    async addBin(pageId, afterBinId = null) {\r\n        const appState = this._getAppState();\r\n        const document = appState.documents.find(p => p.id === pageId);\r\n        if (!document) return;\r\n        if (!this._isManualGroupMode(document)) return;\r\n\r\n        if (!document.groups) {\r\n            document.groups = [];\r\n        }\r\n\r\n        // Generate unique group ID that doesn't conflict with existing groups\r\n        let binId;\r\n        let counter = 0;\r\n        do {\r\n            binId = `group-${counter}`;\r\n            counter++;\r\n        } while (document.groups.some(b => b.id === binId));\r\n\r\n        const binNum = document.groups.length + 1;\r\n        const newGroup = {\r\n            id: binId,\r\n            title: `Group ${binNum}`,\r\n            items: [],\r\n            level: 0,\r\n            parentGroupId: null,\r\n            plugins: [],\r\n            format: null,\r\n            config: {}\r\n        };\r\n        \r\n        // Insert bin at specific position if afterBinId is provided\r\n        let binIndex;\r\n        if (afterBinId) {\r\n            const afterBinIndex = document.groups.findIndex(b => b.id === afterBinId);\r\n            if (afterBinIndex !== -1) {\r\n                // Insert after the specified bin\r\n                binIndex = afterBinIndex + 1;\r\n                document.groups.splice(binIndex, 0, newGroup);\r\n            } else {\r\n                // Bin not found, just append\r\n                binIndex = document.groups.length;\r\n                document.groups.push(newGroup);\r\n            }\r\n        } else {\r\n            // No position specified, append to end\r\n            binIndex = document.groups.length;\r\n            document.groups.push(newGroup);\r\n        }\r\n        \r\n        // Record undo/redo change\r\n        const undoRedoManager = this._getUndoRedoManager();\r\n        if (undoRedoManager) {\r\n            undoRedoManager.recordBinAdd(pageId, binIndex, newGroup);\r\n        }\r\n        \r\n        // Initialize plugins for new bin\r\n        const binPluginManager = this._getBinPluginManager();\r\n        if (binPluginManager) {\r\n            await binPluginManager.initializeBinPlugins(pageId, binId);\r\n        }\r\n        \r\n        // Emit event\r\n        eventBus.emit(EVENTS.BIN.CREATED, { pageId, documentId: pageId, binId, groupId: binId, bin: newGroup, group: newGroup });\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n    }\r\n    \r\n    async deleteBin(pageId, binId) {\r\n        const appState = this._getAppState();\r\n        const document = appState.documents.find(p => p.id === pageId);\r\n        if (!document || !document.groups) return;\r\n        if (!this._isManualGroupMode(document)) return;\r\n        \r\n        const group = document.groups.find(b => b.id === binId);\r\n        if (!group) return;\r\n        \r\n        // Record undo/redo change before deletion\r\n        const undoRedoManager = this._getUndoRedoManager();\r\n        if (undoRedoManager) {\r\n            undoRedoManager.recordBinDelete(pageId, binId, JSON.parse(JSON.stringify(group)));\r\n        }\r\n        \r\n        // Cleanup plugins for bin\r\n        const binPluginManager = this._getBinPluginManager();\r\n        if (binPluginManager) {\r\n            await binPluginManager.cleanupBinPlugins(pageId, binId);\r\n        }\r\n        \r\n        // Emit event before deletion\r\n        eventBus.emit(EVENTS.BIN.DELETED, { pageId, documentId: pageId, binId, groupId: binId });\r\n        \r\n        document.groups = document.groups.filter(b => b.id !== binId);\r\n        \r\n        // If no groups left, create a default one\r\n        if (document.groups.length === 0) {\r\n            const defaultGroup = {\r\n                id: 'group-0',\r\n                title: 'Group 1',\r\n                items: [],\r\n                level: 0,\r\n                parentGroupId: null,\r\n                plugins: [],\r\n                format: null,\r\n                config: {}\r\n            };\r\n            document.groups = [defaultGroup];\r\n            \r\n            // Record addition of default bin\r\n            if (undoRedoManager) {\r\n                undoRedoManager.recordBinAdd(pageId, 0, defaultGroup);\r\n            }\r\n        }\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n    }\r\n    \r\n    moveBin(sourcePageId, sourceBinId, targetPageId, targetBinId) {\r\n        if (sourcePageId === targetPageId && sourceBinId === targetBinId) return;\r\n        \r\n        const appState = this._getAppState();\r\n        const sourcePage = appState.documents.find(p => p.id === sourcePageId);\r\n        const targetPage = appState.documents.find(p => p.id === targetPageId);\r\n        \r\n        if (!sourcePage || !targetPage || !sourcePage.groups || !targetPage.groups) return;\r\n        if (!this._isManualGroupMode(sourcePage) || !this._isManualGroupMode(targetPage)) return;\r\n        \r\n        const sourceBin = sourcePage.groups.find(b => b.id === sourceBinId);\r\n        const targetBin = targetPage.groups.find(b => b.id === targetBinId);\r\n        \r\n        if (!sourceBin || !targetBin) return;\r\n        \r\n        const sourceIndex = sourcePage.groups.indexOf(sourceBin);\r\n        const targetIndex = targetPage.groups.indexOf(targetBin);\r\n        \r\n        // Remove from source\r\n        sourcePage.groups.splice(sourceIndex, 1);\r\n        \r\n        // Insert at target (adjust if same page and source was before target)\r\n        if (sourcePageId === targetPageId) {\r\n            const insertIndex = sourceIndex < targetIndex ? targetIndex - 1 : targetIndex;\r\n            targetPage.groups.splice(insertIndex, 0, sourceBin);\r\n        } else {\r\n            targetPage.groups.splice(targetIndex, 0, sourceBin);\r\n        }\r\n        \r\n        const dataManager = this._getDataManager();\r\n        if (dataManager) {\r\n            dataManager.saveData();\r\n        }\r\n        requestAnimationFrame(() => {\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n    }\r\n}\r\n\r\n","// ElementManager.js - Handles element-related operations\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES } from '../core/AppServices.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class ElementManager {\n    constructor() {\n        // Get services via ServiceLocator\n        // Use lazy access for services that might not be registered yet\n        this.appState = getService(SERVICES.APP_STATE);\n        this.undoRedoManager = getService(SERVICES.UNDO_REDO_MANAGER);\n        this.dataManager = getService(SERVICES.DATA_MANAGER);\n        // ElementTypeManager is created later, so access lazily\n        this._elementTypeManager = null;\n    }\n    \n    /**\n     * Get ElementTypeManager (lazy access since it's created after ElementManager)\n     */\n    get elementTypeManager() {\n        if (!this._elementTypeManager) {\n            try {\n                this._elementTypeManager = getService(SERVICES.ELEMENT_TYPE_MANAGER);\n            } catch (e) {\n                // Service not available yet, return null\n                return null;\n            }\n        }\n        return this._elementTypeManager;\n    }\n    \n    addElement(pageId, binId, elementType) {\n        const document = this.appState.documents.find(p => p.id === pageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === binId);\n        if (!group) return;\n        \n        const newElement = this.createElementTemplate(elementType);\n        newElement.parentId = null;\n        newElement.childIds = Array.isArray(newElement.childIds) ? newElement.childIds : [];\n        // Generate unique ID for the element\n        if (!newElement.id) {\n            newElement.id = `element-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        }\n        if (!group.items) group.items = [];\n        const newElementIndex = group.items.length;\n        group.items.push(newElement);\n        \n        // Record undo/redo change\n        if (this.undoRedoManager) {\n            this.undoRedoManager.recordElementAdd(pageId, binId, newElementIndex, newElement);\n        }\n        \n        // Request data save via EventBus\n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        \n        // Emit element created event for automation\n        eventBus.emit(EVENTS.ELEMENT.CREATED, {\n            pageId,\n            binId,\n            documentId: pageId,\n            groupId: binId,\n            elementIndex: newElementIndex,\n            element: newElement\n        });\n        \n        // Request render via EventBus\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        // Automatically open edit modal for the newly created element via event\n        setTimeout(() => {\n            eventBus.emit(EVENTS.UI.SHOW_EDIT_MODAL, {\n                pageId,\n                binId,\n                documentId: pageId,\n                groupId: binId,\n                elementIndex: newElementIndex,\n                element: newElement\n            });\n            // Focus on the text input\n            setTimeout(() => {\n                eventBus.emit(EVENTS.UI.FOCUS_INPUT, {\n                    inputId: 'edit-text',\n                    select: true\n                });\n            }, 50);\n        }, 50);\n    }\n    \n    createElementTemplate(type) {\n        // Try to use ElementTypeManager if available\n        if (this.elementTypeManager) {\n            const template = this.elementTypeManager.createTemplate(type);\n            if (template) {\n                return template;\n            }\n        }\n        \n        // Fallback to default templates\n        const templates = {\n            'task': {\n                type: 'task',\n                text: 'New task',\n                completed: false,\n                repeats: true,\n                timeAllocated: '',\n                funModifier: '',\n                parentId: null,\n                childIds: []\n            },\n            'header-checkbox': {\n                type: 'header-checkbox',\n                text: 'New Header',\n                completed: false,\n                repeats: true,\n                timeAllocated: '',\n                funModifier: '',\n                parentId: null,\n                childIds: []\n            },\n            'multi-checkbox': {\n                type: 'multi-checkbox',\n                items: [\n                    { text: 'Item 1', completed: false, funModifier: '' },\n                    { text: 'Item 2', completed: false, funModifier: '' }\n                ],\n                completed: false,\n                repeats: true,\n                timeAllocated: '',\n                funModifier: '',\n                parentId: null,\n                childIds: []\n            },\n            'one-time': {\n                type: 'task',\n                text: 'One-time task',\n                completed: false,\n                repeats: false,\n                timeAllocated: '',\n                funModifier: '',\n                parentId: null,\n                childIds: []\n            },\n            'audio': {\n                type: 'audio',\n                text: 'Audio Recording',\n                audioFile: null,\n                date: null,\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'timer': {\n                type: 'timer',\n                text: 'Timer',\n                duration: 3600, // Total duration in seconds (default 1 hour)\n                elapsed: 0, // Elapsed time in seconds\n                running: false, // Whether timer is currently running\n                alarmSound: '/sounds/alarm.mp3', // Default alarm sound file path\n                startTime: null, // Timestamp when timer was started\n                pausedAt: 0, // Elapsed time when paused\n                completed: false,\n                alarmPlaying: false, // Whether alarm is currently playing\n                alarmAudio: null, // Reference to alarm audio element\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'counter': {\n                type: 'counter',\n                text: 'Counter',\n                value: 0,\n                increment1: 1,\n                increment5: 5,\n                customIncrement: 10,\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'tracker': {\n                type: 'tracker',\n                text: 'Tracker',\n                mode: 'daily', // 'daily' or 'page'\n                dailyCompletions: {}, // { date: count } for daily mode\n                pageCompletions: {}, // { elementId: count } for page mode\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'rating': {\n                type: 'rating',\n                text: 'Rating',\n                rating: 0, // 0-5 stars\n                review: '',\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'image': {\n                type: 'image',\n                text: 'Image',\n                imageUrl: null,\n                imageAlignment: 'left',\n                imageWidth: 300,\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'time-log': {\n                type: 'time-log',\n                text: 'Time Log',\n                totalTime: 0, // Total time in seconds\n                isRunning: false,\n                startTime: null,\n                sessions: [], // Array of { start, end, duration }\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            },\n            'calendar': {\n                type: 'calendar',\n                text: 'Calendar',\n                displayMode: 'current-date', // 'current-date', 'one-day', 'week', 'month'\n                currentDate: new Date().toISOString().split('T')[0], // For one-day scrollable mode\n                targetingMode: 'default', // 'default', 'specific', 'tags'\n                targetPages: [], // Array of page IDs for specific mode\n                targetBins: [], // Array of {pageId, binId} for specific mode\n                targetElements: [], // Array of {pageId, binId, elementIndex} for specific mode\n                targetTags: [], // Array of tag strings for tags mode\n                completed: false,\n                persistent: true, // Calendars are persistent\n                parentId: null,\n                childIds: []\n            },\n            'note': {\n                type: 'note',\n                text: 'New Note',\n                content: '',\n                format: 'markdown',\n                completed: false,\n                persistent: true,\n                parentId: null,\n                childIds: []\n            },\n            'text': {\n                type: 'text',\n                text: 'New Text',\n                completed: false,\n                repeats: true,\n                parentId: null,\n                childIds: []\n            }\n        };\n        \n        return templates[type] || templates['task'];\n    }\n    \n    toggleElement(pageId, binId, elementIndex, subtaskIndex = null, itemIndex = null) {\n        // Handle nested children - elementIndex might be a string like \"0-1\" for nested children\n        let actualPageId = pageId;\n        let actualBinId = binId;\n        let actualElementIndex = elementIndex;\n        let childIndex = null;\n        \n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n            // This is a nested child - parse the index\n            const parts = elementIndex.split('-');\n            actualElementIndex = parseInt(parts[0]);\n            childIndex = parseInt(parts[1]);\n        }\n        \n        const document = this.appState.documents.find(p => p.id === actualPageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === actualBinId);\n        if (!group) return;\n        const items = group.items || [];\n        group.items = items;\n        \n        const element = items[actualElementIndex];\n        if (!element) return;\n        const itemIndexMap = ItemHierarchy.buildItemIndex(items);\n        \n        // If we have a childIndex, we're toggling a nested child\n        if (childIndex !== null) {\n            const childItems = ItemHierarchy.getChildItems(element, itemIndexMap);\n            const child = childItems[childIndex];\n            if (!child) {\n                return;\n            }\n            const oldValue = child.completed;\n            child.completed = !child.completed;\n            element.completed = childItems.every(ch => ch.completed);\n            \n            // Record undo/redo change\n            if (this.undoRedoManager) {\n                this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', child.completed, oldValue, childIndex);\n                this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.completed, !element.completed);\n            }\n        } else if (itemIndex !== null && element.items) {\n            // Toggle multi-checkbox item\n            const oldItemValue = element.items[itemIndex].completed;\n            element.items[itemIndex].completed = !element.items[itemIndex].completed;\n            const oldElementValue = element.completed;\n            element.completed = element.items.every(item => item.completed);\n            \n            // Record undo/redo change\n            if (this.undoRedoManager) {\n                this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.items[itemIndex].completed, oldItemValue, null, itemIndex);\n                this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.completed, oldElementValue);\n            }\n        } else if (subtaskIndex !== null) {\n            // Legacy subtask support (for backward compatibility)\n            if (element.subtasks && element.subtasks[subtaskIndex]) {\n                const oldValue = element.subtasks[subtaskIndex].completed;\n                element.subtasks[subtaskIndex].completed = !element.subtasks[subtaskIndex].completed;\n                element.completed = element.subtasks.every(st => st.completed);\n                \n                // Record undo/redo change\n                if (this.undoRedoManager) {\n                    this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.subtasks[subtaskIndex].completed, oldValue, subtaskIndex);\n                    this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.completed, !element.completed);\n                }\n            } else {\n                const childItems = ItemHierarchy.getChildItems(element, itemIndexMap);\n                if (!childItems[subtaskIndex]) {\n                    return;\n                }\n                // Use childIds if subtasks don't exist\n                const oldValue = childItems[subtaskIndex].completed;\n                childItems[subtaskIndex].completed = !childItems[subtaskIndex].completed;\n                element.completed = childItems.every(ch => ch.completed);\n                \n                // Record undo/redo change\n                if (this.undoRedoManager) {\n                    this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', childItems[subtaskIndex].completed, oldValue, subtaskIndex);\n                    this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.completed, !element.completed);\n                }\n            }\n        } else {\n            // Toggle main element\n            const wasChecked = element.completed;\n            const oldValue = element.completed;\n            element.completed = !element.completed;\n            // Record undo/redo change for main element\n            if (this.undoRedoManager) {\n                this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', element.completed, oldValue);\n            }\n            \n            const childItems = ItemHierarchy.getChildItems(element, itemIndexMap);\n            childItems.forEach((child, idx) => {\n                if (child.repeats !== false) {\n                    const oldChildValue = child.completed;\n                    child.completed = element.completed;\n                    // Record child changes\n                    if (this.undoRedoManager && oldChildValue !== child.completed) {\n                        this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', child.completed, oldChildValue, idx);\n                    }\n                }\n            });\n            // Legacy subtask support\n            if (element.subtasks) {\n                element.subtasks.forEach((st, idx) => {\n                    if (st.repeats !== false) {\n                        const oldSubtaskValue = st.completed;\n                        st.completed = element.completed;\n                        // Record subtask changes\n                        if (this.undoRedoManager && oldSubtaskValue !== st.completed) {\n                            this.undoRedoManager.recordElementPropertyChange(pageId, binId, actualElementIndex, 'completed', st.completed, oldSubtaskValue, idx);\n                        }\n                    }\n                });\n            }\n            \n            // Emit events for automation\n            if (element.completed && !wasChecked) {\n                // Element was just completed\n                eventBus.emit(EVENTS.ELEMENT.COMPLETED, {\n                    pageId: actualPageId,\n                    binId: actualBinId,\n                    documentId: actualPageId,\n                    groupId: actualBinId,\n                    elementIndex: actualElementIndex,\n                    element: element\n                });\n            }\n            \n            // Always emit updated event\n            eventBus.emit(EVENTS.ELEMENT.UPDATED, {\n                pageId: actualPageId,\n                binId: actualBinId,\n                documentId: actualPageId,\n                groupId: actualBinId,\n                elementIndex: actualElementIndex,\n                element: element\n            });\n            \n            // Update tracker elements if any exist (only if element was just checked)\n            if (element.completed && !wasChecked) {\n                this.updateTrackers(actualPageId, actualBinId, actualElementIndex, true);\n            } else {\n                // Still update to refresh page mode counts\n                this.updateTrackers(actualPageId, actualBinId);\n            }\n        }\n        \n        // Don't delete one-time tasks immediately - they'll be deleted on day reset if completed\n        \n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n    }\n    \n    updateTrackers(pageId, binId, toggledElementIndex = null, wasChecked = false) {\n        const document = this.appState.documents.find(p => p.id === pageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === binId);\n        if (!group) return;\n        const items = group.items || [];\n        group.items = items;\n        \n        const today = new Date().toISOString().split('T')[0];\n        \n        items.forEach((trackerElement, trackerIdx) => {\n            if (trackerElement.type === 'tracker') {\n                if (trackerElement.mode === 'daily') {\n                    // Track daily completions - one check per day per element\n                    if (!trackerElement.dailyCompletions) trackerElement.dailyCompletions = {};\n                    if (!trackerElement.dailyCompletions[today]) {\n                        trackerElement.dailyCompletions[today] = {};\n                    }\n                    \n                    // If an element was just checked, mark it as completed today\n                    if (toggledElementIndex !== null && wasChecked) {\n                        const elementKey = `${pageId}-${binId}-${toggledElementIndex}`;\n                        if (!trackerElement.dailyCompletions[today][elementKey]) {\n                            trackerElement.dailyCompletions[today][elementKey] = true;\n                        }\n                    }\n                    \n                    // Count unique elements completed today\n                    const todayCount = Object.keys(trackerElement.dailyCompletions[today] || {}).length;\n                    trackerElement.dailyCompletions[today]._count = todayCount;\n                } else if (trackerElement.mode === 'page') {\n                    // Count unique checked elements in the page (each element counts once)\n                    let uniqueCount = 0;\n                    items.forEach((el, elIdx) => {\n                        if (el.completed && el.type !== 'tracker') {\n                            uniqueCount++;\n                        }\n                    });\n                    // Store the count\n                    if (!trackerElement.pageCompletions) trackerElement.pageCompletions = {};\n                    trackerElement.pageCompletions.count = uniqueCount;\n                }\n            }\n        });\n    }\n    \n    addMultiCheckboxItem(pageId, binId, elementIndex) {\n        const document = this.appState.documents.find(p => p.id === pageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === binId);\n        if (!group) return;\n        const items = group.items || [];\n        group.items = items;\n        \n        const element = items[elementIndex];\n        if (element && element.items) {\n            const newItem = {\n                text: 'New item',\n                completed: false,\n                funModifier: ''\n            };\n            const itemIndex = element.items.length;\n            element.items.push(newItem);\n            \n            // Record undo/redo change\n            if (this.undoRedoManager) {\n                const path = this.undoRedoManager.getElementPath(pageId, binId, elementIndex);\n                if (path) {\n                    path.push('items');\n                    const change = this.undoRedoManager.createChange('add', path, newItem, null);\n                    change.changeId = `${Date.now()}-${Math.random()}`;\n                    this.undoRedoManager.recordChange(change);\n                }\n            }\n            \n            this.dataManager.saveData();\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        }\n    }\n    \n    removeMultiCheckboxItem(pageId, binId, elementIndex, itemIndex) {\n        const document = this.appState.documents.find(p => p.id === pageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === binId);\n        if (!group) return;\n        const items = group.items || [];\n        group.items = items;\n        \n        const element = items[elementIndex];\n        if (element && element.items && element.items.length > 1) {\n            const removedItem = element.items[itemIndex];\n            const oldCompleted = element.completed;\n            element.items.splice(itemIndex, 1);\n            element.completed = element.items.length > 0 && element.items.every(item => item.completed);\n            \n            // Record undo/redo change\n            if (this.undoRedoManager) {\n                const path = this.undoRedoManager.getElementPath(pageId, binId, elementIndex);\n                if (path) {\n                    path.push('items');\n                    path.push(itemIndex);\n                    const change = this.undoRedoManager.createChange('delete', path, null, removedItem);\n                    change.changeId = `${Date.now()}-${Math.random()}`;\n                    this.undoRedoManager.recordChange(change);\n                    \n                    // Also record completed state change if it changed\n                    if (oldCompleted !== element.completed) {\n                        this.undoRedoManager.recordElementPropertyChange(pageId, binId, elementIndex, 'completed', element.completed, oldCompleted);\n                    }\n                }\n            }\n            \n            this.dataManager.saveData();\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        }\n    }\n    \n    addElementAfter(pageId, binId, elementIndex, elementType) {\n        const document = this.appState.documents.find(p => p.id === pageId);\n        if (!document) return;\n        \n        const group = document.groups?.find(b => b.id === binId);\n        if (!group) return;\n        const items = group.items || [];\n        group.items = items;\n        \n        const newElement = this.createElementTemplate(elementType);\n        newElement.parentId = null;\n        newElement.childIds = Array.isArray(newElement.childIds) ? newElement.childIds : [];\n        // Generate unique ID for the element\n        if (!newElement.id) {\n            newElement.id = `element-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        }\n        if (!group.items) group.items = items;\n        const insertIndex = elementIndex + 1;\n        group.items.splice(insertIndex, 0, newElement);\n        \n        // Record undo/redo change\n        if (this.undoRedoManager) {\n            this.undoRedoManager.recordElementAdd(pageId, binId, insertIndex, newElement);\n        }\n        \n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n    }\n}\n","// DragDropHandler.js - Handles drag and drop operations\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class DragDropHandler {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n\n    _getDocument(pageId) {\n        const appState = this._getAppState();\n        return appState.documents?.find(page => page.id === pageId) || null;\n    }\n\n    _getGroup(pageId, binId) {\n        const document = this._getDocument(pageId);\n        const group = document?.groups?.find(bin => bin.id === binId) || null;\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return group;\n    }\n    \n    _getUndoRedoManager() {\n        return getService(SERVICES.UNDO_REDO_MANAGER);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    _getFormatRendererManager() {\n        return getService(SERVICES.FORMAT_RENDERER_MANAGER);\n    }\n    \n    _getRenderer() {\n        return getService(SERVICES.RENDERER);\n    }\n\n    _getRootItems(items) {\n        return ItemHierarchy.getRootItems(items);\n    }\n\n    _getRootItemAtIndex(items, elementIndex) {\n        return ItemHierarchy.getRootItemAtIndex(items, elementIndex);\n    }\n\n    _getFlatInsertIndex(items, rootIndex) {\n        if (rootIndex <= 0) return 0;\n        let seenRoots = 0;\n        for (let i = 0; i < items.length; i++) {\n            if (!items[i]?.parentId) {\n                if (seenRoots === rootIndex) {\n                    return i;\n                }\n                seenRoots += 1;\n            }\n        }\n        return items.length;\n    }\n\n    _getChildItemsForGroup(group, parentElement) {\n        const itemIndex = ItemHierarchy.buildItemIndex(group?.items || []);\n        return ItemHierarchy.getChildItems(parentElement, itemIndex);\n    }\n\n    _getChildItemForGroup(group, parentElement, childIndex) {\n        const children = this._getChildItemsForGroup(group, parentElement);\n        return children[childIndex] || null;\n    }\n\n    _getDescendantIds(item, itemIndex) {\n        const descendants = [];\n        const walk = (node) => {\n            const children = ItemHierarchy.getChildItems(node, itemIndex);\n            children.forEach(child => {\n                descendants.push(child.id);\n                walk(child);\n            });\n        };\n        walk(item);\n        return descendants;\n    }\n\n    _removeItemsByIds(items, ids) {\n        const idSet = ids instanceof Set ? ids : new Set(ids);\n        return (items || []).filter(item => !idSet.has(item.id));\n    }\n\n    _getItemsByIds(items, ids) {\n        const idSet = ids instanceof Set ? ids : new Set(ids);\n        return (items || []).filter(item => idSet.has(item.id));\n    }\n    \n    moveElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild = false, parentElementIndex = null, childIndex = null) {\n        const appState = this._getAppState();\n        const sourcePage = appState.documents.find(p => p.id === sourcePageId);\n        if (!sourcePage) {\n            console.error('Source page not found:', sourcePageId);\n            return;\n        }\n        \n        const sourceBin = sourcePage.groups?.find(b => b.id === sourceBinId);\n        if (!sourceBin) {\n            console.error('Source bin not found:', sourceBinId);\n            return;\n        }\n        let sourceItems = sourceBin.items || [];\n        sourceBin.items = sourceItems;\n        const sourceRootItems = this._getRootItems(sourceItems);\n        const sourceItemIndex = ItemHierarchy.buildItemIndex(sourceItems);\n        \n        let element;\n        \n        // Handle children being moved\n        if (isChild && parentElementIndex !== null && childIndex !== null) {\n            const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n            const childItems = parentElement ? ItemHierarchy.getChildItems(parentElement, sourceItemIndex) : [];\n            if (!parentElement || !childItems[childIndex]) {\n                console.error('Source child element not found:', childIndex, 'in parent', parentElementIndex);\n                return;\n            }\n            element = childItems[childIndex];\n            if (!Array.isArray(parentElement.childIds)) {\n                parentElement.childIds = [];\n            }\n            parentElement.childIds.splice(childIndex, 1);\n            element.parentId = null;\n        } else {\n            // Regular element move\n            if (!sourceRootItems[sourceElementIndex]) {\n                console.error('Source element not found:', sourceElementIndex, 'in bin', sourceBinId);\n                return;\n            }\n            element = sourceRootItems[sourceElementIndex];\n        }\n\n        const descendantIds = this._getDescendantIds(element, sourceItemIndex);\n        const movingIds = new Set([element.id, ...descendantIds]);\n        const movingItems = this._getItemsByIds(sourceItems, movingIds);\n        sourceItems = this._removeItemsByIds(sourceItems, movingIds);\n        sourceBin.items = sourceItems;\n        \n        // Add to target\n        const targetPage = appState.documents.find(p => p.id === targetPageId);\n        if (!targetPage) {\n            console.error('Target page not found:', targetPageId);\n            // Re-add element to source if target is invalid\n            if (isChild && parentElementIndex !== null) {\n                const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n                if (parentElement) {\n                    if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                    parentElement.childIds.splice(childIndex, 0, element.id);\n                    element.parentId = parentElement.id;\n                }\n                const insertIndex = this._getFlatInsertIndex(sourceItems, sourceElementIndex);\n                sourceItems.splice(insertIndex, 0, ...movingItems);\n            } else {\n                const insertIndex = this._getFlatInsertIndex(sourceItems, sourceElementIndex);\n                sourceItems.splice(insertIndex, 0, ...movingItems);\n            }\n            sourceBin.items = sourceItems;\n            return;\n        }\n        \n        const targetBin = targetPage.groups?.find(b => b.id === targetBinId);\n        if (!targetBin) {\n            console.error('Target bin not found:', targetBinId);\n            // Re-add element to source if target is invalid\n            if (isChild && parentElementIndex !== null) {\n                const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n                if (parentElement) {\n                    if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                    parentElement.childIds.splice(childIndex, 0, element.id);\n                    element.parentId = parentElement.id;\n                }\n                const insertIndex = this._getFlatInsertIndex(sourceItems, sourceElementIndex);\n                sourceItems.splice(insertIndex, 0, ...movingItems);\n            } else {\n                const insertIndex = this._getFlatInsertIndex(sourceItems, sourceElementIndex);\n                sourceItems.splice(insertIndex, 0, ...movingItems);\n            }\n            sourceBin.items = sourceItems;\n            return;\n        }\n        const targetItems = targetBin.items || [];\n        targetBin.items = targetItems;\n        \n        // Adjust target index if moving within same bin\n        // User wants items to be placed ABOVE the target item\n        let adjustedTargetIndex = targetElementIndex;\n        if (isChild && parentElementIndex !== null) {\n            // When un-nesting a child element:\n            // - The item is removed from parent's children array (doesn't affect items array)\n            // - We need to adjust if the parent's position in items array is before the target\n            // - If parent is at index X and target is at index Y where X < Y, we don't need to adjust\n            //   because removing from children doesn't change the items array indices\n            // - However, if we're moving to a position after the parent, we need to account for it\n            // Actually, since we're removing from children (not items), we only need to adjust\n            // if the parent item itself was removed, which doesn't happen here.\n            // So no adjustment needed for un-nesting children.\n            // IMPORTANT: When un-nesting, we're inserting into the items array, so we can insert\n            // at any valid index (0 to items.length). No adjustment needed.\n        } else if (!isChild && sourcePageId === targetPageId && sourceBinId === targetBinId) {\n            // Normal move within same bin: place ABOVE target element\n            // splice inserts BEFORE the specified index, so to place above target:\n            // - If source is before target: after removal, target shifts down by 1, so we insert at targetElementIndex\n            //   (which becomes targetElementIndex-1 after removal, placing it above the shifted target)\n            // - If source is after target: insert at targetElementIndex (places above target)\n            // However, we need to account for the fact that we remove first, then insert\n            if (sourceElementIndex < targetElementIndex) {\n                // Source before target: after removal, target is at (targetElementIndex - 1)\n                // To place above the shifted target, we insert at (targetElementIndex - 1)\n                // But we're inserting AFTER removal, so we use targetElementIndex (which is correct)\n                adjustedTargetIndex = targetElementIndex;\n            } else {\n                // Source after target: target position unchanged, insert at targetElementIndex (places above)\n                adjustedTargetIndex = targetElementIndex;\n            }\n        }\n        \n        // Ensure index is valid\n        // For splice, we can insert at any index from 0 to array.length (inclusive)\n        // array.length is valid and will append to the end\n        const maxValidIndex = targetItems.length; // Can insert at this index (appends to end)\n        const beforeClamp = adjustedTargetIndex;\n        adjustedTargetIndex = Math.max(0, Math.min(adjustedTargetIndex, maxValidIndex));\n        \n        // Special case: when un-nesting a child, if we calculated targetIndex as parentIndex + 1\n        // but it got clamped, we need to allow insertion at items.length (which is valid for splice)\n        // This happens when the parent is the last element in the array\n        if (isChild && parentElementIndex !== null && targetElementIndex === parentElementIndex + 1) {\n            // We want to place after the parent (parentIndex + 1)\n            // If it was clamped, use items.length to append after the parent\n            if (adjustedTargetIndex !== targetElementIndex && adjustedTargetIndex === parentElementIndex) {\n                adjustedTargetIndex = targetItems.length;\n            }\n        }\n        \n        // Capture the old position BEFORE modifying the DOM\n        let oldPosition = null;\n        if (isChild && parentElementIndex !== null) {\n            // For nested children, find the parent element first\n            const parentElement = document.querySelector(`[data-page-id=\"${sourcePageId}\"][data-bin-id=\"${sourceBinId}\"][data-element-index=\"${parentElementIndex}\"]`);\n            if (parentElement) {\n                const childElement = parentElement.querySelector(`[data-child-index=\"${childIndex}\"]`);\n                if (childElement) {\n                    const rect = childElement.getBoundingClientRect();\n                    oldPosition = { top: rect.top, left: rect.left };\n                }\n            }\n        } else {\n            // For regular items, find by source index\n            const sourceElement = document.querySelector(`[data-page-id=\"${sourcePageId}\"][data-bin-id=\"${sourceBinId}\"][data-element-index=\"${sourceElementIndex}\"]:not([data-is-child=\"true\"])`);\n            if (sourceElement) {\n                const rect = sourceElement.getBoundingClientRect();\n                oldPosition = { top: rect.top, left: rect.left };\n            }\n        }\n        \n        const insertFlatIndex = this._getFlatInsertIndex(targetItems, adjustedTargetIndex);\n        targetItems.splice(insertFlatIndex, 0, ...movingItems);\n        targetBin.items = targetItems;\n        \n        // Record undo/redo change\n        const undoRedoManager = this._getUndoRedoManager();\n        if (undoRedoManager) {\n            if (isChild && parentElementIndex !== null) {\n                // Child element being un-nested - record as move from child to element\n                // For now, treat it as a regular element move from the parent's position\n                // (the actual implementation is complex, so we'll record it as a move)\n                undoRedoManager.recordElementMove(\n                    sourcePageId, sourceBinId, parentElementIndex, // Source (parent position)\n                    targetPageId, targetBinId, adjustedTargetIndex, // Target\n                    JSON.parse(JSON.stringify(element))\n                );\n            } else {\n                // Regular element move\n                undoRedoManager.recordElementMove(\n                    sourcePageId, sourceBinId, sourceElementIndex,\n                    targetPageId, targetBinId, adjustedTargetIndex,\n                    JSON.parse(JSON.stringify(element))\n                );\n            }\n        }\n        \n        // Track which element is being moved for animation\n        // Create a unique identifier using element content + old position\n        const elementText = element.text ? element.text.substring(0, 50) : '';\n        const elementType = element.type || 'unknown';\n        const elementId = `${targetPageId}-${targetBinId}-${adjustedTargetIndex}-${elementType}-${elementText}`;\n        \n        appState.lastMovedElement = {\n            pageId: targetPageId,\n            binId: targetBinId,\n            elementIndex: adjustedTargetIndex,\n            element: element,\n            uniqueId: elementId,\n            oldPageId: sourcePageId,\n            oldBinId: sourceBinId,\n            oldElementIndex: sourceElementIndex,\n            oldPosition: oldPosition // Store the captured old position\n        };\n        // Log resulting structure\n        const resultBin = this._getGroup(targetPageId, targetBinId);\n        const resultElement = resultBin ? this._getRootItemAtIndex(resultBin.items, adjustedTargetIndex) : null;\n        const resultText = resultElement?.text || 'N/A';\n        \n        // If we un-nested a child, check if parent still has children\n        let parentChildrenInfo = 'N/A';\n        if (isChild && parentElementIndex !== null) {\n            const sourceBin = this._getGroup(sourcePageId, sourceBinId);\n            const parentElement = sourceBin ? this._getRootItemAtIndex(sourceBin.items, parentElementIndex) : null;\n            if (parentElement) {\n                const childrenCount = parentElement.childIds?.length || 0;\n                parentChildrenInfo = `${childrenCount} child${childrenCount !== 1 ? 'ren' : ''} (${parentElement.childIds ? 'ids exist' : 'no ids'})`;\n            }\n        }\n        \n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        // Preserve format view during re-render to prevent flicker\n        const formatRendererManager = this._getFormatRendererManager();\n        const pageFormat = formatRendererManager?.getPageFormat(targetPageId);\n        if (pageFormat) {\n            const renderer = this._getRenderer();\n            if (renderer && renderer.getRenderer) {\n                renderer.getRenderer()._preservingFormat = true;\n            }\n        }\n        \n        // Use requestAnimationFrame to ensure smooth animation\n        requestAnimationFrame(() => {\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        });\n    }\n\n    reorderChildElement(pageId, binId, parentElementIndex, sourceChildIndex, targetChildIndex) {\n        const document = this._getDocument(pageId);\n        if (!document) {\n            console.error('Page not found:', pageId);\n            return;\n        }\n\n        const bin = this._getGroup(pageId, binId);\n        if (!bin) {\n            console.error('Bin not found:', binId);\n            return;\n        }\n\n        const parentElement = this._getRootItemAtIndex(bin.items, parentElementIndex);\n        if (!parentElement || !Array.isArray(parentElement.childIds) || !parentElement.childIds[sourceChildIndex]) {\n            console.error('Parent element or child not found:', parentElementIndex, sourceChildIndex);\n            return;\n        }\n\n        // Remove the child from its current position\n        const childId = parentElement.childIds.splice(sourceChildIndex, 1)[0];\n\n        // Insert it at the new position\n        // Adjust target index if moving to a higher position (since we already removed the source)\n        let adjustedTargetIndex = targetChildIndex;\n        if (sourceChildIndex < targetChildIndex) {\n            adjustedTargetIndex -= 1;\n        }\n\n        // Ensure index is valid\n        adjustedTargetIndex = Math.max(0, Math.min(adjustedTargetIndex, parentElement.childIds.length));\n        parentElement.childIds.splice(adjustedTargetIndex, 0, childId);\n\n        // Record undo/redo change\n        const undoRedoManager = this._getUndoRedoManager();\n        if (undoRedoManager) {\n            const itemIndex = ItemHierarchy.buildItemIndex(bin.items);\n            const childElement = itemIndex[childId];\n            undoRedoManager.recordChildReorder(\n                pageId, binId, parentElementIndex, sourceChildIndex, adjustedTargetIndex,\n                JSON.parse(JSON.stringify(childElement))\n            );\n        }\n\n        // Log resulting structure\n        const parentText = parentElement?.text || 'N/A';\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        \n        // Preserve format view during re-render to prevent flicker\n        const formatRendererManager = this._getFormatRendererManager();\n        const pageFormat = formatRendererManager?.getPageFormat(pageId);\n        if (pageFormat) {\n            const renderer = this._getRenderer();\n            if (renderer && renderer.getRenderer) {\n                renderer.getRenderer()._preservingFormat = true;\n            }\n        }\n        \n        requestAnimationFrame(() => {\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        });\n    }\n\n    nestElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild = false, parentElementIndex = null, childIndex = null, elementToNest = null) {\n        \n        const sourcePage = this._getDocument(sourcePageId);\n        if (!sourcePage) {\n            console.error('Source page not found:', sourcePageId);\n            return;\n        }\n        \n        const sourceBin = this._getGroup(sourcePageId, sourceBinId);\n        if (!sourceBin) {\n            console.error('Source bin not found:', sourceBinId);\n            return;\n        }\n        const sourceItems = sourceBin.items || [];\n        sourceBin.items = sourceItems;\n        \n        // Reuse appState from line 316\n        const targetPage = this._getDocument(targetPageId);\n        if (!targetPage) {\n            console.error('Target page not found:', targetPageId);\n            return;\n        }\n        \n        const targetBin = this._getGroup(targetPageId, targetBinId);\n        if (!targetBin) {\n            console.error('Target bin not found:', targetBinId);\n            return;\n        }\n        const targetItems = targetBin.items || [];\n        targetBin.items = targetItems;\n        const sourceRootItems = this._getRootItems(sourceItems);\n        const targetRootItems = this._getRootItems(targetItems);\n        const sourceItemIndex = ItemHierarchy.buildItemIndex(sourceItems);\n        const targetItemIndex = ItemHierarchy.buildItemIndex(targetItems);\n        const isSameGroup = sourcePageId === targetPageId && sourceBinId === targetBinId;\n        \n        if (!targetRootItems[targetElementIndex]) {\n            console.error('Target item not found:', targetElementIndex, 'in bin', targetBinId);\n            return;\n        }\n        \n        let element;\n        let sourceParentText = 'N/A';\n        let sourceChildText = 'N/A';\n        \n        // If elementToNest is provided, use it directly (for un-nesting then nesting in one operation)\n        if (elementToNest) {\n            element = elementToNest;\n            sourceChildText = element.text || 'N/A';\n        } else if (isChild && parentElementIndex !== null && childIndex !== null) {\n            // Handle children being nested\n            const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n            if (!parentElement) {\n                console.error('Source parent element not found at index:', parentElementIndex, 'in bin', sourceBinId);\n                console.error('Available items:', sourceItems.map((e, i) => `${i}: \"${e.text || 'N/A'}\"`).join(', '));\n                return;\n            }\n            sourceParentText = parentElement.text || 'N/A';\n            const childElement = this._getChildItemForGroup(sourceBin, parentElement, childIndex);\n            if (!childElement) {\n                console.error('Source child element not found:', {\n                    childIndex: childIndex,\n                    parentIndex: parentElementIndex,\n                    parentText: sourceParentText,\n                    childrenCount: parentElement.childIds?.length || 0,\n                    availableChildren: parentElement.childIds?.map((id, i) => `${i}: \"${sourceItemIndex[id]?.text || 'N/A'}\"`).join(', ') || 'none'\n                });\n                return;\n            }\n            element = childElement;\n            sourceChildText = element.text || 'N/A';\n            if (!Array.isArray(parentElement.childIds)) {\n                parentElement.childIds = [];\n            }\n            parentElement.childIds.splice(childIndex, 1);\n            element.parentId = null;\n        } else {\n            // Regular element nesting\n            if (!sourceRootItems[sourceElementIndex]) {\n                console.error('Source element not found:', sourceElementIndex, 'in bin', sourceBinId);\n                console.error('Available items:', sourceItems.map((e, i) => `${i}: \"${e.text || 'N/A'}\"`).join(', '));\n                return;\n            }\n            element = sourceRootItems[sourceElementIndex];\n            sourceChildText = element.text || 'N/A';\n            // Root item nesting does not remove from flat list\n        }\n\n        const descendantIds = this._getDescendantIds(element, sourceItemIndex);\n        const movingIds = new Set([element.id, ...descendantIds]);\n        let movingItems = this._getItemsByIds(sourceItems, movingIds);\n        if (movingItems.length === 0) {\n            movingItems = [element];\n        }\n        if (!isSameGroup) {\n            sourceItems = this._removeItemsByIds(sourceItems, movingIds);\n            sourceBin.items = sourceItems;\n        }\n\n        const restoreToSource = () => {\n            if (!isSameGroup) {\n                const insertIndex = this._getFlatInsertIndex(sourceItems, sourceElementIndex);\n                sourceItems.splice(insertIndex, 0, ...movingItems);\n                sourceBin.items = sourceItems;\n            }\n        };\n        \n        // Adjust target index if source item was removed from items array and was before target\n        // (This only applies to regular items, not children, since children are removed from children array)\n        let adjustedTargetElementIndex = targetElementIndex;\n        if (!isChild && sourcePageId === targetPageId && sourceBinId === targetBinId && sourceElementIndex < targetElementIndex) {\n            // Source was removed from items array, so target index shifts down by 1\n            adjustedTargetElementIndex = targetElementIndex - 1;\n        }\n        \n        const targetElement = targetRootItems[adjustedTargetElementIndex];\n        if (!targetElement) {\n            console.error('Target element not found at index:', targetElementIndex, 'in bin', targetBinId);\n            console.error('Available items:', targetItems.map((e, i) => `${i}: \"${e.text || 'N/A'}\"`).join(', '));\n            // Re-add element to source if target is invalid\n            if (isChild && parentElementIndex !== null) {\n                const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n                if (parentElement) {\n                    if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                    parentElement.childIds.splice(childIndex, 0, element.id);\n                    element.parentId = parentElement.id;\n                }\n            }\n            restoreToSource();\n            return;\n        }\n        \n        // Prevent self-nesting: check if source is the same as target\n        // Skip this check if elementToNest is provided (element already removed from array)\n        // Compare actual element objects, not just indices (indices can be stale after moves)\n        if (!elementToNest && !isChild && sourcePageId === targetPageId && sourceBinId === targetBinId) {\n            const targetElementForCheck = targetRootItems[adjustedTargetElementIndex];\n            \n            // Only prevent if the actual element objects are the same\n            // Compare the element we're nesting with the target element\n            if (element && targetElementForCheck && element === targetElementForCheck) {\n                console.error('Cannot nest: cannot nest element into itself');\n                // Re-add element to source (though it's already there, this is defensive)\n                if (!sourceItems[sourceElementIndex]) { // Check if it's actually missing\n                    sourceItems.splice(sourceElementIndex, 0, element);\n                }\n                return;\n            }\n        }\n        \n        // Prevent nesting a child into its own parent\n        // Check both parentElementIndex (from drag data) and sourceElementIndex (which is the parent when isChild is true)\n        if (isChild && sourcePageId === targetPageId && sourceBinId === targetBinId) {\n            const actualParentIndex = parentElementIndex !== null ? parentElementIndex : sourceElementIndex;\n            if (actualParentIndex === adjustedTargetElementIndex) {\n                console.error('Cannot nest: cannot nest a child into its own parent');\n                // Re-add element to source\n                const parentElement = this._getRootItemAtIndex(sourceItems, actualParentIndex);\n                if (parentElement) {\n                    if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                    parentElement.childIds.splice(childIndex, 0, element.id);\n                    element.parentId = parentElement.id;\n                }\n                restoreToSource();\n                return;\n            }\n        }\n        \n        // Prevent circular nesting - check if target is a descendant of source\n        const isDescendant = (parent, child, itemIndex) => {\n            const children = ItemHierarchy.getChildItems(parent, itemIndex);\n            for (const c of children) {\n                if (c === child) {\n                    return true;\n                }\n                if (isDescendant(c, child, itemIndex)) {\n                    return true;\n                }\n            }\n            return false;\n        };\n        \n        if (isDescendant(element, targetElement, targetItemIndex)) {\n            console.error('Cannot nest: target is a descendant of source (circular nesting prevented)');\n            // Re-add element to source\n            if (isChild && parentElementIndex !== null) {\n                const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n                if (parentElement) {\n                    if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                    parentElement.childIds.splice(childIndex, 0, element.id);\n                    element.parentId = parentElement.id;\n                }\n            }\n            restoreToSource();\n            return;\n        }\n        \n        // Enforce one-level limit: check if any existing children have their own children\n        if (Array.isArray(targetElement.childIds) && targetElement.childIds.length > 0) {\n            const targetChildren = ItemHierarchy.getChildItems(targetElement, targetItemIndex);\n            const hasNestedChildren = targetChildren.some(child => (child.childIds || []).length > 0);\n            if (hasNestedChildren) {\n                console.error('Cannot nest: target has children with their own children (one-level limit enforced)');\n                // Re-add element to source\n                if (isChild && parentElementIndex !== null) {\n                    const parentElement = this._getRootItemAtIndex(sourceItems, parentElementIndex);\n                    if (parentElement) {\n                        if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n                        parentElement.childIds.splice(childIndex, 0, element.id);\n                        element.parentId = parentElement.id;\n                    }\n                }\n                restoreToSource();\n                return;\n            }\n        }\n        \n        // Initialize childIds if it doesn't exist\n        if (!Array.isArray(targetElement.childIds)) {\n            targetElement.childIds = [];\n        }\n        \n        // Add to target's children\n        targetElement.childIds.push(element.id);\n        element.parentId = targetElement.id;\n\n        if (!isSameGroup) {\n            const targetFlatIndex = targetItems.findIndex(item => item.id === targetElement.id);\n            const insertAt = targetFlatIndex === -1 ? targetItems.length : targetFlatIndex + 1;\n            targetItems.splice(insertAt, 0, ...movingItems);\n            targetBin.items = targetItems;\n        }\n        \n        // Log resulting structure\n        const resultElement = targetRootItems[adjustedTargetElementIndex];\n        const resultText = resultElement?.text || 'N/A';\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        \n        // Preserve format view during re-render to prevent flicker\n        const formatRendererManager = this._getFormatRendererManager();\n        const pageFormat = formatRendererManager?.getPageFormat(targetPageId);\n        if (pageFormat) {\n            const renderer = this._getRenderer();\n            if (renderer && renderer.getRenderer) {\n                renderer.getRenderer()._preservingFormat = true;\n            }\n        }\n        \n        // Use requestAnimationFrame to ensure smooth animation\n        requestAnimationFrame(() => {\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        });\n    }\n    \n    /**\n     * Set up trash icon drag and drop handlers\n     */\n    setupTrashIcon() {\n        const trashIcon = document.getElementById('trash-icon');\n        if (!trashIcon) return;\n        \n        // Ensure trash icon is hidden on initialization\n        trashIcon.style.display = 'none';\n        \n        // Only set up handlers once\n        if (trashIcon._handlersSetup) return;\n        trashIcon._handlersSetup = true;\n        \n        trashIcon.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = 'move';\n            trashIcon.classList.add('drag-over-trash');\n            trashIcon.style.background = 'rgba(220, 53, 69, 1)';\n            trashIcon.style.transform = 'scale(1.2)';\n        });\n        \n        trashIcon.addEventListener('dragleave', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            trashIcon.classList.remove('drag-over-trash');\n            trashIcon.style.background = 'rgba(220, 53, 69, 0.9)';\n            trashIcon.style.transform = 'scale(1)';\n        });\n        \n        trashIcon.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            trashIcon.classList.remove('drag-over-trash');\n            trashIcon.style.background = 'rgba(220, 53, 69, 0.9)';\n            trashIcon.style.transform = 'scale(1)';\n            trashIcon.style.display = 'none';\n            \n            const appState = this._getAppState();\n            const dragData = appState.dragData;\n            if (!dragData) return;\n            \n            if (dragData.type === 'element') {\n                // Delete element\n                const bin = this._getGroup(dragData.pageId, dragData.binId);\n                if (bin) {\n                    const items = bin.items || [];\n                    bin.items = items;\n                    const rootItems = this._getRootItems(items);\n                    if (dragData.isChild && dragData.parentElementIndex !== null && dragData.childIndex !== null) {\n                        // Delete child element\n                        const parentElement = this._getRootItemAtIndex(items, dragData.parentElementIndex);\n                        if (parentElement && Array.isArray(parentElement.childIds)) {\n                            const childId = parentElement.childIds[dragData.childIndex];\n                            const itemIndex = ItemHierarchy.buildItemIndex(items);\n                            const deletedChild = childId ? itemIndex[childId] : null;\n                            // Record undo/redo change\n                            const undoRedoManager = this._getUndoRedoManager();\n                            if (undoRedoManager && deletedChild) {\n                                const path = undoRedoManager.getElementPath(dragData.pageId, dragData.binId, dragData.parentElementIndex, dragData.childIndex);\n                                if (path) {\n                                    const change = undoRedoManager.createChange('delete', path, null, deletedChild);\n                                    change.changeId = `${Date.now()}-${Math.random()}`;\n                                    undoRedoManager.recordChange(change);\n                                }\n                            }\n                            parentElement.childIds.splice(dragData.childIndex, 1);\n                            if (deletedChild) {\n                                const descendantIds = this._getDescendantIds(deletedChild, itemIndex);\n                                const removeIds = new Set([deletedChild.id, ...descendantIds]);\n                                items = this._removeItemsByIds(items, removeIds);\n                                bin.items = items;\n                            }\n                        }\n                    } else {\n                        // Delete regular element\n                        const deletedElement = rootItems[dragData.elementIndex];\n                        // Record undo/redo change\n                        const undoRedoManager = this._getUndoRedoManager();\n                        if (undoRedoManager && deletedElement) {\n                            undoRedoManager.recordElementDelete(dragData.pageId, dragData.binId, dragData.elementIndex, deletedElement);\n                        }\n                        if (deletedElement) {\n                            const itemIndex = ItemHierarchy.buildItemIndex(items);\n                            const descendantIds = this._getDescendantIds(deletedElement, itemIndex);\n                            const removeIds = new Set([deletedElement.id, ...descendantIds]);\n                            items = this._removeItemsByIds(items, removeIds);\n                        }\n                        bin.items = items;\n                    }\n                    const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                }\n            } else if (dragData.type === 'bin') {\n                // Delete bin\n                const binManager = getService(SERVICES.BIN_MANAGER);\n                if (binManager) {\n                    binManager.deleteBin(dragData.pageId, dragData.binId);\n                }\n            } else if (dragData.type === 'page') {\n                // Delete page (only if more than one page exists)\n                if (appState.documents.length > 1) {\n                    const pageManager = getService(SERVICES.PAGE_MANAGER);\n                    if (pageManager) {\n                        pageManager.deletePage(dragData.pageId);\n                    }\n                }\n            }\n            \n            appState.dragData = null;\n        });\n    }\n}\n\n","// ElementFinder.js - Centralized element lookup by data attributes\r\n// Provides consistent element finding patterns across the application\r\n\r\nexport class ElementFinder {\r\n    /**\r\n     * Find element by data attributes\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {number} elementIndex - Element index\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @param {number} childIndex - Optional child index for nested elements\r\n     * @returns {HTMLElement|null} Found element or null\r\n     */\r\n    static findElement(pageId, binId, elementIndex, context = document, childIndex = null) {\r\n        let selector = `[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"][data-element-index=\"${elementIndex}\"]`;\r\n        \r\n        if (childIndex !== null && childIndex !== undefined) {\r\n            selector += `[data-child-index=\"${childIndex}\"]`;\r\n        }\r\n        \r\n        return context.querySelector(selector);\r\n    }\r\n    \r\n    /**\r\n     * Find bin element by data attributes\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @returns {HTMLElement|null} Found bin element or null\r\n     */\r\n    static findBin(pageId, binId, context = document) {\r\n        return context.querySelector(`[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"].bin`);\r\n    }\r\n    \r\n    /**\r\n     * Find page element by data attributes\r\n     * @param {string} pageId - Page ID\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @returns {HTMLElement|null} Found page element or null\r\n     */\r\n    static findPage(pageId, context = document) {\r\n        return context.querySelector(`[data-page-id=\"${pageId}\"].page`);\r\n    }\r\n    \r\n    /**\r\n     * Find all elements in a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @returns {NodeList} List of element nodes\r\n     */\r\n    static findAllElements(pageId, binId, context = document) {\r\n        return context.querySelectorAll(`[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"][data-element-index]`);\r\n    }\r\n    \r\n    /**\r\n     * Find element by ID (searches data-element-id attribute)\r\n     * @param {string} elementId - Element ID\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @returns {HTMLElement|null} Found element or null\r\n     */\r\n    static findElementById(elementId, context = document) {\r\n        return context.querySelector(`[data-element-id=\"${elementId}\"]`);\r\n    }\r\n    \r\n    /**\r\n     * Find all elements of a specific type\r\n     * @param {string} elementType - Element type\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @returns {NodeList} List of element nodes\r\n     */\r\n    static findAllByType(elementType, context = document) {\r\n        return context.querySelectorAll(`.element.${elementType}`);\r\n    }\r\n    \r\n    /**\r\n     * Find element by text content (fuzzy search)\r\n     * @param {string} text - Text to search for\r\n     * @param {HTMLElement} context - Optional context element (default: document)\r\n     * @param {boolean} exact - Whether to match exactly (default: false)\r\n     * @returns {HTMLElement|null} Found element or null\r\n     */\r\n    static findElementByText(text, context = document, exact = false) {\r\n        const elements = context.querySelectorAll('.element');\r\n        for (const element of elements) {\r\n            const elementText = element.textContent || element.innerText || '';\r\n            if (exact) {\r\n                if (elementText.trim() === text.trim()) {\r\n                    return element;\r\n                }\r\n            } else {\r\n                if (elementText.toLowerCase().includes(text.toLowerCase())) {\r\n                    return element;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Find closest element with data attributes\r\n     * @param {HTMLElement} element - Starting element\r\n     * @param {Object} dataAttrs - Data attributes to match\r\n     * @returns {HTMLElement|null} Found element or null\r\n     */\r\n    static findClosestWithData(element, dataAttrs) {\r\n        if (!element) return null;\r\n        \r\n        let current = element;\r\n        while (current && current !== document.body) {\r\n            let matches = true;\r\n            for (const [key, value] of Object.entries(dataAttrs)) {\r\n                const dataKey = key.startsWith('data-') ? key.slice(5) : key;\r\n                if (current.dataset[dataKey] !== String(value)) {\r\n                    matches = false;\r\n                    break;\r\n                }\r\n            }\r\n            if (matches) {\r\n                return current;\r\n            }\r\n            current = current.parentElement;\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Get element data attributes as object\r\n     * @param {HTMLElement} element - Element to get data from\r\n     * @returns {Object} Object with data attributes\r\n     */\r\n    static getElementData(element) {\r\n        if (!element) return {};\r\n        \r\n        return {\r\n            pageId: element.dataset.pageId,\r\n            binId: element.dataset.binId,\r\n            elementIndex: element.dataset.elementIndex ? parseInt(element.dataset.elementIndex) : null,\r\n            childIndex: element.dataset.childIndex ? parseInt(element.dataset.childIndex) : null,\r\n            elementId: element.dataset.elementId,\r\n            dragType: element.dataset.dragType\r\n        };\r\n    }\r\n}\r\n\r\n","// AudioHandler.js - Handles audio recording and playback\nimport { ElementFinder } from '../utils/ElementFinder.js';\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class AudioHandler {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    _getFileManager() {\n        return getService(SERVICES.FILE_MANAGER);\n    }\n    \n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n\n    _getGroup(pageId, binId) {\n        const appState = this._getAppState();\n        const page = appState.documents?.find(p => p.id === pageId);\n        const bin = page?.groups?.find(b => b.id === binId);\n        if (!bin) return null;\n        const items = bin.items || [];\n        bin.items = items;\n        return bin;\n    }\n    \n    showAudioRecordingModal() {\n        const modal = document.getElementById('audio-recording-modal');\n        const startBtn = document.getElementById('audio-start-btn');\n        const stopBtn = document.getElementById('audio-stop-btn');\n        const statusDiv = document.getElementById('audio-recording-status');\n        const timeDiv = document.getElementById('audio-recording-time');\n        const previewAudio = document.getElementById('audio-preview');\n        const saveControls = document.getElementById('audio-save-controls');\n        const filenameInput = document.getElementById('audio-filename');\n        \n        // Reset UI\n        statusDiv.textContent = 'Ready to record';\n        statusDiv.style.color = '#e0e0e0';\n        startBtn.style.display = 'block';\n        stopBtn.style.display = 'none';\n        timeDiv.style.display = 'none';\n        previewAudio.style.display = 'none';\n        saveControls.style.display = 'none';\n        filenameInput.value = '';\n        const appState = this._getAppState();\n        appState.audioChunks = [];\n        \n        // Close button\n        const closeBtn = document.getElementById('audio-recording-close');\n        closeBtn.onclick = () => {\n            this.stopAudioRecording();\n            this.closeAudioRecordingModal();\n        };\n        \n        // Close on outside click\n        const existingHandler = modal._clickHandler;\n        if (existingHandler) {\n            modal.removeEventListener('click', existingHandler);\n        }\n        modal._clickHandler = (e) => {\n            if (e.target.id === 'audio-recording-modal') {\n                this.stopAudioRecording();\n                this.closeAudioRecordingModal();\n            }\n        };\n        modal.addEventListener('click', modal._clickHandler);\n        \n        // Start recording button\n        startBtn.onclick = () => {\n            this.startAudioRecording();\n        };\n        \n        // Stop recording button\n        stopBtn.onclick = () => {\n            this.stopAudioRecording();\n        };\n        \n        // Save button\n        document.getElementById('audio-save-btn').onclick = () => {\n            this.saveAudioRecording();\n        };\n        \n        modal.classList.add('active');\n    }\n    \n    async startAudioRecording() {\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n            \n            const appState = this._getAppState();\n            appState.mediaRecorder = new MediaRecorder(stream);\n            appState.audioChunks = [];\n            \n            appState.mediaRecorder.ondataavailable = (event) => {\n                if (event.data.size > 0) {\n                    appState.audioChunks.push(event.data);\n                }\n            };\n            \n            appState.mediaRecorder.onstop = () => {\n                const audioBlob = new Blob(appState.audioChunks, { type: 'audio/webm' });\n                const audioUrl = URL.createObjectURL(audioBlob);\n                const previewAudio = document.getElementById('audio-preview');\n                previewAudio.src = audioUrl;\n                previewAudio.style.display = 'block';\n                \n                // Stop all tracks\n                stream.getTracks().forEach(track => track.stop());\n            };\n            \n            appState.mediaRecorder.start();\n            appState.recordingStartTime = Date.now();\n            \n            // Update UI\n            const startBtn = document.getElementById('audio-start-btn');\n            const stopBtn = document.getElementById('audio-stop-btn');\n            const statusDiv = document.getElementById('audio-recording-status');\n            const timeDiv = document.getElementById('audio-recording-time');\n            \n            startBtn.style.display = 'none';\n            stopBtn.style.display = 'block';\n            statusDiv.textContent = 'Recording...';\n            statusDiv.style.color = '#ff5555';\n            timeDiv.style.display = 'block';\n            \n            // Start timer (reuse appState from line 90)\n            appState.recordingTimer = setInterval(() => {\n                const elapsed = Math.floor((Date.now() - appState.recordingStartTime) / 1000);\n                const minutes = Math.floor(elapsed / 60);\n                const seconds = elapsed % 60;\n                timeDiv.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\n            }, 100);\n            \n        } catch (error) {\n            console.error('Error accessing microphone:', error);\n            alert('Failed to access microphone. Please ensure microphone permissions are granted.');\n        }\n    }\n    \n    stopAudioRecording() {\n        const appState = this._getAppState();\n        if (appState.mediaRecorder && appState.mediaRecorder.state !== 'inactive') {\n            appState.mediaRecorder.stop();\n        }\n        \n        if (appState.recordingTimer) {\n            clearInterval(appState.recordingTimer);\n            appState.recordingTimer = null;\n        }\n        \n        const startBtn = document.getElementById('audio-start-btn');\n        const stopBtn = document.getElementById('audio-stop-btn');\n        const statusDiv = document.getElementById('audio-recording-status');\n        const saveControls = document.getElementById('audio-save-controls');\n        \n        startBtn.style.display = 'block';\n        stopBtn.style.display = 'none';\n        statusDiv.textContent = 'Recording stopped. Preview and save below.';\n        statusDiv.style.color = '#4a9eff';\n        saveControls.style.display = 'block';\n    }\n    \n    async saveAudioRecording() {\n        const appState = this._getAppState();\n        if (appState.audioChunks.length === 0) {\n            alert('No recording to save.');\n            return;\n        }\n        \n        // Reuse appState from line 165\n        const audioBlob = new Blob(appState.audioChunks, { type: 'audio/webm' });\n        const filenameInput = document.getElementById('audio-filename');\n        let filename = filenameInput.value.trim();\n        \n        // Generate filename if not provided\n        if (!filename) {\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n            filename = `recording-${timestamp}.webm`;\n        } else {\n            // Ensure .webm extension\n            if (!filename.endsWith('.webm')) {\n                filename += '.webm';\n            }\n        }\n        \n        const statusDiv = document.getElementById('audio-recording-status');\n        statusDiv.textContent = 'Saving...';\n        \n        try {\n            const formData = new FormData();\n            formData.append('audio', audioBlob, filename);\n            \n            const url = window.location.origin + '/save-audio';\n            const response = await fetch(url, {\n                method: 'POST',\n                body: formData\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            \n            if (result.success) {\n                statusDiv.textContent = `Saved as: ${filename}`;\n                statusDiv.style.color = '#4a9eff';\n                alert(`Audio saved successfully as: ${filename}`);\n                \n                // Reset after a delay\n                setTimeout(() => {\n                    this.closeAudioRecordingModal();\n                }, 2000);\n            } else {\n                throw new Error(result.error || 'Unknown error');\n            }\n        } catch (error) {\n            statusDiv.textContent = 'Failed to save audio: ' + error.message;\n            statusDiv.style.color = '#ff5555';\n            alert('Failed to save audio: ' + error.message);\n        }\n    }\n    \n    closeAudioRecordingModal() {\n        this.stopAudioRecording();\n        const modal = document.getElementById('audio-recording-modal');\n        modal.classList.remove('active');\n    }\n    \n    // Inline audio recording methods with binId support\n    async startInlineRecording(pageId, binId, elementIndex, originalElementIndex = null, shouldOverwrite = false) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const domElementIndex = originalElementIndex !== null ? originalElementIndex : elementIndex;\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n            const recorder = new MediaRecorder(stream);\n            const chunks = [];\n            \n            recorder.ondataavailable = (event) => {\n                if (event.data.size > 0) {\n                    chunks.push(event.data);\n                }\n            };\n            \n            recorder.onstop = () => {\n                stream.getTracks().forEach(track => track.stop());\n            };\n\n            recorder.onerror = (event) => {\n                // Error handling without logging\n            };\n            \n            recorder.start();\n            const startTime = Date.now();\n            \n            const appState = this._getAppState();\n            if (!appState.inlineAudioRecorders) {\n                appState.inlineAudioRecorders = {};\n            }\n            appState.inlineAudioRecorders[audioKey] = {\n                recorder: recorder,\n                chunks: chunks,\n                startTime: startTime,\n                timer: null,\n                stream: stream,\n                domElementIndex: domElementIndex,  // Store original for DOM updates\n                shouldOverwrite: shouldOverwrite   // Flag for overwrite mode\n            };\n            \n            // Update status using original elementIndex for correct DOM targeting\n            this.updateAudioStatus(pageId, binId, domElementIndex, 'Recording...', '#ff5555');\n        } catch (error) {\n            alert('Failed to access microphone. Please ensure microphone permissions are granted.');\n        }\n    }\n    \n    async stopInlineRecording(pageId, binId, elementIndex, originalElementIndex = null) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const domElementIndex = originalElementIndex !== null ? originalElementIndex : elementIndex;\n        const appState = this._getAppState();\n        const recorderData = appState.inlineAudioRecorders?.[audioKey];\n        \n        if (recorderData && recorderData.recorder && recorderData.recorder.state !== 'inactive') {\n            recorderData.recorder.stop();\n            \n            if (recorderData.timer) {\n                clearInterval(recorderData.timer);\n            }\n            \n            // Wait for recorder to stop and process chunks\n            await new Promise(resolve => {\n                recorderData.recorder.onstop = () => {\n                    resolve();\n                };\n            });\n            \n            // Save the recording - use domElementIndex from recorderData if available\n            const saveDomIndex = recorderData.domElementIndex || domElementIndex;\n            await this.saveInlineRecording(pageId, binId, elementIndex, recorderData.chunks, saveDomIndex);\n            \n            // Clean up\n            delete appState.inlineAudioRecorders[audioKey];\n        }\n    }\n    \n    async saveInlineRecording(pageId, binId, elementIndex, chunks, domElementIndex = null) {\n        if (!chunks || chunks.length === 0) {\n            alert('No recording to save.');\n            return;\n        }\n        \n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) {\n            return;\n        }\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) {\n            return;\n        }\n        const items = bin.items || [];\n        bin.items = items;\n        \n        // Find the element by checking if it exists at the given index\n        let element = items[elementIndex];\n        if (!element) {\n            // Try to find an audio element in the bin that might be the moved element\n            element = items.find(el => el.type === 'audio');\n            if (!element) {\n                return;\n            }\n            // Update elementIndex to the correct index\n            elementIndex = items.indexOf(element);\n        }\n\n        // element is already declared above in error handling\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        // Reuse appState from line 312\n        const recorderData = appState.inlineAudioRecorders?.[audioKey];\n        \n        let audioBlob = new Blob(chunks, { type: 'audio/webm' });\n        let filename = element.audioFile;\n        const today = new Date().toISOString().split('T')[0];\n        \n        // Check if this is an overwrite (from edit modal)\n        if (recorderData && recorderData.shouldOverwrite && filename) {\n            // Overwrite existing file - keep same filename\n        } else if (recorderData && recorderData.isAppend && recorderData.existingBlob) {\n            // Appending - combine existing blob with new recording\n            const combinedChunks = [recorderData.existingBlob, audioBlob];\n            audioBlob = new Blob(combinedChunks, { type: 'audio/webm' });\n            // Keep existing filename\n        } else {\n            // New recording - generate new filename\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n            filename = `recording-${timestamp}.webm`;\n        }\n        \n        try {\n            const formData = new FormData();\n            formData.append('audio', audioBlob, filename);\n            \n            const url = window.location.origin + '/save-audio';\n            const response = await fetch(url, {\n                method: 'POST',\n                body: formData\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            \n            if (result.success) {\n                // Update element with file reference\n                element.audioFile = filename;\n                element.date = today;\n                const dataManager = this._getDataManager();\n                if (dataManager) {\n                    dataManager.saveData();\n                }\n                // Use domElementIndex for status update if provided, otherwise use elementIndex\n                const statusIndex = domElementIndex !== null ? domElementIndex : elementIndex;\n                this.updateAudioStatus(pageId, binId, statusIndex, `File: ${filename} (${today})`, '#4a9eff');\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED); // Re-render to show new controls\n            } else {\n                throw new Error(result.error || 'Unknown error');\n            }\n        } catch (error) {\n            alert('Failed to save audio: ' + error.message);\n            const statusIndex = domElementIndex !== null ? domElementIndex : elementIndex;\n            this.updateAudioStatus(pageId, binId, statusIndex, 'Failed to save', '#ff5555');\n        }\n    }\n    \n    async appendInlineRecording(pageId, binId, elementIndex, originalElementIndex = null) {\n        const domElementIndex = originalElementIndex !== null ? originalElementIndex : elementIndex;\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) {\n            return;\n        }\n\n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) {\n            return;\n        }\n        const items = bin.items || [];\n        bin.items = items;\n        \n        // Use parsed elementIndex to access element (it's already parsed when passed from render)\n        const element = items[elementIndex];\n        if (!element || !element.audioFile) {\n            alert('No existing recording to append to.');\n            return;\n        }\n        \n        const existingFile = element.audioFile;\n        \n        // Fetch existing audio file\n        try {\n            const response = await fetch(`/saved_files/recordings/${existingFile}`);\n            if (!response.ok) {\n                throw new Error('Failed to load existing recording');\n            }\n            const existingBlob = await response.blob();\n            \n            // Start new recording (will automatically append)\n            await this.startInlineRecording(pageId, binId, elementIndex, domElementIndex, false);\n            \n            // Mark as append mode and store existing blob\n            const appState = this._getAppState();\n            if (appState.inlineAudioRecorders?.[audioKey]) {\n                appState.inlineAudioRecorders[audioKey].isAppend = true;\n                appState.inlineAudioRecorders[audioKey].existingBlob = existingBlob;\n            }\n        } catch (error) {\n            alert('Failed to load existing recording for appending.');\n        }\n    }\n    \n    async playInlineAudio(pageId, binId, elementIndex) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        \n        if (!page) {\n            return;\n        }\n\n        const bin = page.groups?.find(b => b.id === binId);\n        const items = bin?.items || [];\n        if (bin) {\n            bin.items = items;\n        }\n        if (!bin || !items[elementIndex] || !items[elementIndex].audioFile) {\n            alert('No recording to play.');\n            return;\n        }\n        \n        const element = items[elementIndex];\n        const filename = element.audioFile;\n\n        try {\n            // Create player if it doesn't exist\n            const appState = this._getAppState();\n            if (!appState.inlineAudioPlayers) {\n                appState.inlineAudioPlayers = {};\n            }\n            if (!appState.inlineAudioPlayers[audioKey]) {\n                const response = await fetch(`/saved_files/recordings/${filename}`);\n                if (!response.ok) {\n                    throw new Error(`Failed to load audio file: ${response.status}`);\n                }\n\n                const blob = await response.blob();\n                const audioUrl = URL.createObjectURL(blob);\n                const audio = new Audio(audioUrl);\n\n                appState.inlineAudioPlayers[audioKey] = {\n                    audio: audio,\n                    isPlaying: false,\n                    url: audioUrl\n                };\n            }\n\n            // Reuse appState from line 461\n            const player = appState.inlineAudioPlayers?.[audioKey];\n\n            if (player.isPlaying) {\n                // Pause\n                player.audio.pause();\n                player.isPlaying = false;\n                this.updateAudioStatus(pageId, binId, elementIndex, `File: ${filename}`, '#888');\n                this.hideAudioProgressBar(pageId, binId, elementIndex);\n            } else {\n                // Play\n                await player.audio.play();\n                player.isPlaying = true;\n                this.updateAudioStatus(pageId, binId, elementIndex, 'Playing...', '#4a9eff');\n                this.showAudioProgressBar(pageId, binId, elementIndex);\n\n                // Set up progress bar updates\n                const audioKeyForProgress = `${pageId}-${binId}-${elementIndex}`;\n                const audioProgressBar = document.querySelector(`#audio-progress-${audioKeyForProgress} input[type=\"range\"]`);\n                if (audioProgressBar) {\n                    const updateProgress = () => {\n                        if (player.audio && !player.audio.paused) {\n                            const percent = (player.audio.currentTime / player.audio.duration) * 100;\n                            audioProgressBar.value = percent || 0;\n                        }\n                    };\n                    \n                    // Remove old listener if exists\n                    if (player.progressUpdateHandler) {\n                        player.audio.removeEventListener('timeupdate', player.progressUpdateHandler);\n                    }\n                    player.progressUpdateHandler = updateProgress;\n                    player.audio.addEventListener('timeupdate', updateProgress);\n                    \n                    // Allow seeking\n                    audioProgressBar.oninput = (e) => {\n                        if (player.audio) {\n                            const seekTime = (e.target.value / 100) * player.audio.duration;\n                            player.audio.currentTime = seekTime;\n                        }\n                    };\n                }\n            \n                player.audio.onended = () => {\n                    player.isPlaying = false;\n                    this.updateAudioStatus(pageId, binId, elementIndex, `File: ${filename}`, '#888');\n                    this.hideAudioProgressBar(pageId, binId, elementIndex);\n                };\n\n                player.audio.onerror = (error) => {\n                    alert('Error playing audio file.');\n                    this.hideAudioProgressBar(pageId, binId, elementIndex);\n                };\n            }\n        } catch (error) {\n            alert('Failed to play audio: ' + error.message);\n        }\n    }\n    \n    stopInlineAudio(pageId, binId, elementIndex) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const appState = this._getAppState();\n        const player = appState.inlineAudioPlayers?.[audioKey];\n        const page = appState.documents.find(p => p.id === pageId);\n\n        if (!page) {\n            console.error('Page not found:', pageId);\n            return;\n        }\n\n        const bin = page.groups?.find(b => b.id === binId);\n        const items = bin?.items || [];\n        if (bin) {\n            bin.items = items;\n        }\n        if (!bin || !items[elementIndex]) {\n            console.error('Element not found:', elementIndex);\n            return;\n        }\n\n        const element = items[elementIndex];\n        \n        if (player && player.audio) {\n            player.audio.pause();\n            player.audio.currentTime = 0;\n            player.isPlaying = false;\n            this.updateAudioStatus(pageId, binId, elementIndex, `File: ${element.audioFile}`, '#888');\n            this.hideAudioProgressBar(pageId, binId, elementIndex);\n        }\n    }\n    \n    showAudioProgressBar(pageId, binId, elementIndex) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const progressContainer = document.getElementById(`audio-progress-${audioKey}`);\n        if (progressContainer) {\n            progressContainer.style.display = 'block';\n        }\n    }\n    \n    hideAudioProgressBar(pageId, binId, elementIndex) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const progressContainer = document.getElementById(`audio-progress-${audioKey}`);\n        if (progressContainer) {\n            progressContainer.style.display = 'none';\n            const audioProgressBarInput = progressContainer.querySelector('input[type=\"range\"]');\n            if (audioProgressBarInput) {\n                audioProgressBarInput.value = '0';\n            }\n        }\n    }\n    \n    updateAudioStatus(pageId, binId, elementIndex, text, color) {\n        // Find audio element using ElementFinder - handle both regular and nested children\n        let element = null;\n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n            const parts = elementIndex.split('-');\n            element = ElementFinder.findElement(pageId, binId, parseInt(parts[0]), document, parseInt(parts[1]));\n        } else {\n            element = ElementFinder.findElement(pageId, binId, elementIndex);\n        }\n        if (element) {\n            const statusDiv = element.querySelector('.audio-status');\n            if (statusDiv) {\n                statusDiv.textContent = text;\n                statusDiv.style.color = color;\n            }\n        }\n    }\n    \n    toggleArchiveView(pageId, binId, elementIndex) {\n        const audioKey = `${pageId}-${binId}-${elementIndex}`;\n        const archiveView = document.getElementById(`archive-view-${audioKey}`);\n        if (!archiveView) return;\n        \n        if (archiveView.style.display === 'none') {\n            // Show archive\n            const dataManager = this._getDataManager();\n            const archived = dataManager ? dataManager.getArchivedRecordings(pageId, elementIndex) : [];\n            if (archived.length === 0) {\n                archiveView.innerHTML = '<div style=\"padding: 10px; color: #888;\">No archived recordings</div>';\n            } else {\n                let html = '<div style=\"padding: 10px; border-top: 1px solid #404040; margin-top: 10px;\"><strong>Archived Recordings:</strong><ul style=\"margin-top: 10px; padding-left: 20px;\">';\n                archived.forEach(entry => {\n                    html += `<li style=\"margin: 5px 0;\"><button onclick=\"app.dataManager.playArchivedAudio('${entry.filename}')\" style=\"background: #4a9eff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 8px;\">Play</button>${entry.date} - ${entry.filename}</li>`;\n                });\n                html += '</ul></div>';\n                archiveView.innerHTML = html;\n            }\n            archiveView.style.display = 'block';\n        } else {\n            archiveView.style.display = 'none';\n        }\n    }\n}\n\n","// EventHelper.js - Centralized event handling utilities\r\n// Provides common event patterns to reduce code duplication\r\n\r\nexport class EventHelper {\r\n    /**\r\n     * Setup double-click detection on an element\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {Function} handler - Handler function to call on double-click\r\n     * @param {number} delay - Maximum time between clicks in ms (default: 300)\r\n     * @param {Object} options - Additional options\r\n     * @param {Function} options.filter - Optional filter function to determine if click should be processed\r\n     * @param {Function} options.singleClickHandler - Optional handler for single clicks\r\n     * @returns {Function} Cleanup function to remove event listener\r\n     */\r\n    static setupDoubleClick(element, handler, delay = 300, options = {}) {\r\n        let lastClickTime = 0;\r\n        const { filter, singleClickHandler } = options;\r\n        \r\n        const clickHandler = (e) => {\r\n            // Apply filter if provided\r\n            if (filter && !filter(e)) {\r\n                return;\r\n            }\r\n            \r\n            // Don't trigger on interactive elements (checkboxes, buttons, inputs)\r\n            if (e.target.closest('input') || e.target.closest('button') || e.target.closest('textarea')) {\r\n                return;\r\n            }\r\n            \r\n            const now = Date.now();\r\n            const timeSinceLastClick = now - lastClickTime;\r\n            \r\n            if (timeSinceLastClick < delay && timeSinceLastClick > 0) {\r\n                // Double click detected\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                lastClickTime = 0; // Reset to prevent triple-click\r\n                handler(e);\r\n            } else {\r\n                // Single click - wait to see if another click comes\r\n                lastClickTime = now;\r\n                if (singleClickHandler) {\r\n                    // Delay single click handler to allow for potential double-click\r\n                    setTimeout(() => {\r\n                        if (lastClickTime === now) {\r\n                            singleClickHandler(e);\r\n                        }\r\n                    }, delay);\r\n                }\r\n            }\r\n        };\r\n        \r\n        element.addEventListener('click', clickHandler);\r\n        \r\n        // Return cleanup function\r\n        return () => {\r\n            element.removeEventListener('click', clickHandler);\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Setup click-outside detection\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {Function} handler - Handler function to call when clicking outside\r\n     * @param {HTMLElement} container - Optional container to limit scope (default: document)\r\n     * @returns {Function} Cleanup function to remove event listener\r\n     */\r\n    static setupClickOutside(element, handler, container = document) {\r\n        const clickHandler = (e) => {\r\n            if (!element.contains(e.target)) {\r\n                handler(e);\r\n            }\r\n        };\r\n        \r\n        container.addEventListener('click', clickHandler, true);\r\n        \r\n        // Return cleanup function\r\n        return () => {\r\n            container.removeEventListener('click', clickHandler, true);\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Setup keyboard shortcuts\r\n     * @param {HTMLElement} element - Target element (usually document or a container)\r\n     * @param {Object} shortcuts - Object mapping key combinations to handlers\r\n     *   Format: { 'ctrl+s': handler, 'escape': handler, etc. }\r\n     * @param {Object} options - Additional options\r\n     * @param {boolean} options.preventDefault - Whether to prevent default behavior (default: true)\r\n     * @returns {Function} Cleanup function to remove event listener\r\n     */\r\n    static setupKeyboardShortcuts(element, shortcuts, options = {}) {\r\n        const { preventDefault = true } = options;\r\n        \r\n        const keyHandler = (e) => {\r\n            const key = e.key.toLowerCase();\r\n            const ctrl = e.ctrlKey || e.metaKey;\r\n            const shift = e.shiftKey;\r\n            const alt = e.altKey;\r\n            \r\n            // Build key string\r\n            let keyString = '';\r\n            if (ctrl) keyString += 'ctrl+';\r\n            if (shift) keyString += 'shift+';\r\n            if (alt) keyString += 'alt+';\r\n            keyString += key;\r\n            \r\n            // Check for exact match\r\n            if (shortcuts[keyString]) {\r\n                if (preventDefault) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                }\r\n                shortcuts[keyString](e);\r\n                return;\r\n            }\r\n            \r\n            // Check for key-only match (if no modifiers)\r\n            if (!ctrl && !shift && !alt && shortcuts[key]) {\r\n                if (preventDefault) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                }\r\n                shortcuts[key](e);\r\n            }\r\n        };\r\n        \r\n        element.addEventListener('keydown', keyHandler);\r\n        \r\n        // Return cleanup function\r\n        return () => {\r\n            element.removeEventListener('keydown', keyHandler);\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Debounce a function\r\n     * @param {Function} func - Function to debounce\r\n     * @param {number} delay - Delay in milliseconds\r\n     * @param {boolean} immediate - Whether to call immediately on first invocation\r\n     * @returns {Function} Debounced function\r\n     */\r\n    static debounce(func, delay, immediate = false) {\r\n        let timeout;\r\n        return function(...args) {\r\n            const context = this;\r\n            const callNow = immediate && !timeout;\r\n            \r\n            clearTimeout(timeout);\r\n            timeout = setTimeout(() => {\r\n                timeout = null;\r\n                if (!immediate) {\r\n                    func.apply(context, args);\r\n                }\r\n            }, delay);\r\n            \r\n            if (callNow) {\r\n                func.apply(context, args);\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Throttle a function\r\n     * @param {Function} func - Function to throttle\r\n     * @param {number} limit - Time limit in milliseconds\r\n     * @returns {Function} Throttled function\r\n     */\r\n    static throttle(func, limit) {\r\n        let inThrottle;\r\n        return function(...args) {\r\n            const context = this;\r\n            if (!inThrottle) {\r\n                func.apply(context, args);\r\n                inThrottle = true;\r\n                setTimeout(() => {\r\n                    inThrottle = false;\r\n                }, limit);\r\n            }\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Setup drag and drop handlers\r\n     * @param {HTMLElement} element - Draggable element\r\n     * @param {Object} config - Configuration object\r\n     * @param {Function} config.onDragStart - Handler for dragstart event\r\n     * @param {Function} config.onDragEnd - Handler for dragend event\r\n     * @param {Function} config.onDragOver - Handler for dragover event\r\n     * @param {Function} config.onDrop - Handler for drop event\r\n     * @param {Function} config.onDragLeave - Handler for dragleave event\r\n     * @param {boolean} config.draggable - Whether element is draggable (default: true)\r\n     * @returns {Function} Cleanup function to remove all event listeners\r\n     */\r\n    static setupDragAndDrop(element, config) {\r\n        const {\r\n            onDragStart,\r\n            onDragEnd,\r\n            onDragOver,\r\n            onDrop,\r\n            onDragLeave,\r\n            draggable = true\r\n        } = config;\r\n        \r\n        element.draggable = draggable;\r\n        \r\n        const handlers = [];\r\n        \r\n        if (onDragStart) {\r\n            const handler = (e) => onDragStart(e);\r\n            element.addEventListener('dragstart', handler);\r\n            handlers.push({ event: 'dragstart', handler });\r\n        }\r\n        \r\n        if (onDragEnd) {\r\n            const handler = (e) => onDragEnd(e);\r\n            element.addEventListener('dragend', handler);\r\n            handlers.push({ event: 'dragend', handler });\r\n        }\r\n        \r\n        if (onDragOver) {\r\n            const handler = (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                onDragOver(e);\r\n            };\r\n            element.addEventListener('dragover', handler);\r\n            handlers.push({ event: 'dragover', handler });\r\n        }\r\n        \r\n        if (onDrop) {\r\n            const handler = (e) => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                onDrop(e);\r\n            };\r\n            element.addEventListener('drop', handler);\r\n            handlers.push({ event: 'drop', handler });\r\n        }\r\n        \r\n        if (onDragLeave) {\r\n            const handler = (e) => onDragLeave(e);\r\n            element.addEventListener('dragleave', handler);\r\n            handlers.push({ event: 'dragleave', handler });\r\n        }\r\n        \r\n        // Return cleanup function\r\n        return () => {\r\n            handlers.forEach(({ event, handler }) => {\r\n                element.removeEventListener(event, handler);\r\n            });\r\n            element.draggable = false;\r\n        };\r\n    }\r\n}\r\n\r\n","// EventHandler.js - Sets up all event listeners\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { EventHelper } from '../utils/EventHelper.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class EventHandler {\n    constructor(app = null) {\n        this.app = app;\n    }\n    \n    /**\n     * Get services\n     */\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    _getFileManager() {\n        return getService(SERVICES.FILE_MANAGER);\n    }\n    \n    _getElementManager() {\n        return getService(SERVICES.ELEMENT_MANAGER);\n    }\n    \n    _getModalHandler() {\n        return getService(SERVICES.MODAL_HANDLER);\n    }\n    \n    _getBinManager() {\n        return getService(SERVICES.BIN_MANAGER);\n    }\n    \n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    _getContextMenuHandler() {\n        return getService(SERVICES.CONTEXT_MENU_HANDLER);\n    }\n    \n    setupEventListeners() {\n        // Flush pending autosave before page unload\n        window.addEventListener('beforeunload', async (e) => {\n            const dataManager = this._getDataManager();\n            if (dataManager && typeof dataManager.flushPendingSave === 'function') {\n                // Use sendBeacon or synchronous XHR for reliable save on unload\n                // For now, try to flush but don't block unload\n                dataManager.flushPendingSave().catch(err => {\n                    console.warn('[EventHandler] Failed to flush pending save on unload:', err);\n                });\n            }\n        });\n        \n        // Also flush on visibility change (tab switch, minimize, etc.)\n        document.addEventListener('visibilitychange', async () => {\n            if (document.hidden) {\n                const dataManager = this._getDataManager();\n                if (dataManager && typeof dataManager.flushPendingSave === 'function') {\n                    dataManager.flushPendingSave().catch(err => {\n                        console.warn('[EventHandler] Failed to flush pending save on visibility change:', err);\n                    });\n                }\n            }\n        });\n        const loadDefaultBtn = document.getElementById('load-default');\n        if (loadDefaultBtn) {\n            loadDefaultBtn.addEventListener('click', () => {\n                const dataManager = this._getDataManager();\n                if (dataManager) {\n                    dataManager.loadDefaultFile();\n                }\n            });\n        }\n        \n        const fileManagerBtn = document.getElementById('file-manager');\n        if (fileManagerBtn) {\n            fileManagerBtn.addEventListener('click', (e) => {\n                e.stopPropagation(); // Prevent event from bubbling to document click handler\n                const fileManager = this._getFileManager();\n                if (fileManager) {\n                    fileManager.showFileManager();\n                }\n            }, true); // Use capture phase to ensure this runs first\n        }\n        \n        const saveDefaultBtn = document.getElementById('save-default');\n        if (saveDefaultBtn) {\n            saveDefaultBtn.addEventListener('click', () => {\n                const dataManager = this._getDataManager();\n                if (dataManager) {\n                    dataManager.saveAsDefault();\n                }\n            });\n        }\n        \n        // Keep file input for backward compatibility (load from local file)\n        const fileInput = document.getElementById('file-input');\n        if (fileInput) {\n            fileInput.addEventListener('change', (e) => {\n                const dataManager = this._getDataManager();\n                if (dataManager) {\n                    dataManager.loadFromFile(e);\n                }\n            });\n        }\n        \n        // File input for images/JSON\n        const fileInputImagesJson = document.getElementById('file-input-images-json');\n        const openFilesBtn = document.getElementById('open-files');\n        if (openFilesBtn && fileInputImagesJson) {\n            openFilesBtn.addEventListener('click', () => {\n                fileInputImagesJson.click();\n            });\n        }\n        \n        if (fileInputImagesJson) {\n            fileInputImagesJson.addEventListener('change', (e) => {\n                this.handleFileInput(e);\n            });\n        }\n        \n        // Audio recording button\n        const recordAudioBtn = document.getElementById('record-audio');\n        if (recordAudioBtn) {\n            recordAudioBtn.addEventListener('click', () => {\n                const audioHandler = this._getAudioHandler();\n                if (audioHandler) {\n                    audioHandler.showAudioRecordingModal();\n                }\n            });\n        }\n        \n        // Undo button\n        const undoBtn = document.getElementById('undo-btn');\n        if (undoBtn) {\n            undoBtn.addEventListener('click', () => {\n                const undoRedoManager = this._getUndoRedoManager();\n                if (undoRedoManager) {\n                    const success = undoRedoManager.undo();\n                    if (!success) {\n                        console.log('Nothing to undo');\n                    }\n                }\n            });\n        }\n        \n        // Redo button\n        const redoBtn = document.getElementById('redo-btn');\n        if (redoBtn) {\n            redoBtn.addEventListener('click', () => {\n                const undoRedoManager = this._getUndoRedoManager();\n                if (undoRedoManager) {\n                    const success = undoRedoManager.redo();\n                    if (!success) {\n                        console.log('Nothing to redo');\n                    }\n                }\n            });\n        }\n        \n        // Header pin button (toggle fixed header)\n        const headerPinBtn = document.getElementById('header-pin-btn');\n        if (headerPinBtn) {\n            // Load saved preference\n            const isFixed = localStorage.getItem('headerFixed') === 'true';\n            if (isFixed) {\n                document.querySelector('header').classList.add('header-fixed');\n                document.body.classList.add('header-fixed-active');\n                headerPinBtn.textContent = ''; // Pinned icon\n                headerPinBtn.title = 'Unpin header (scrolls with page)';\n            }\n            \n            headerPinBtn.addEventListener('click', () => {\n                const header = document.querySelector('header');\n                const isCurrentlyFixed = header.classList.contains('header-fixed');\n                \n                if (isCurrentlyFixed) {\n                    // Unpin: remove fixed positioning\n                    header.classList.remove('header-fixed');\n                    document.body.classList.remove('header-fixed-active');\n                    headerPinBtn.textContent = ''; // Unpinned icon\n                    headerPinBtn.title = 'Pin header to top of window';\n                    localStorage.setItem('headerFixed', 'false');\n                } else {\n                    // Pin: add fixed positioning\n                    header.classList.add('header-fixed');\n                    document.body.classList.add('header-fixed-active');\n                    headerPinBtn.textContent = ''; // Pinned icon\n                    headerPinBtn.title = 'Unpin header (scrolls with page)';\n                    localStorage.setItem('headerFixed', 'true');\n                }\n            });\n        }\n        \n        // Settings button\n        const settingsBtn = document.getElementById('settings-btn');\n        if (settingsBtn) {\n            settingsBtn.addEventListener('click', () => {\n                const settingsManager = getService(SERVICES.SETTINGS_MANAGER);\n                if (settingsManager) {\n                    settingsManager.showSettingsModal();\n                }\n            });\n        }\n        \n        // Settings modal close button\n        const settingsCloseBtn = document.getElementById('settings-close');\n        if (settingsCloseBtn) {\n            settingsCloseBtn.addEventListener('click', () => {\n                const settingsManager = getService(SERVICES.SETTINGS_MANAGER);\n                if (settingsManager) {\n                    settingsManager.closeSettingsModal();\n                }\n            });\n        }\n        \n        // Close settings modal when clicking outside\n        const settingsModal = document.getElementById('settings-modal');\n        if (settingsModal) {\n            settingsModal.addEventListener('click', (e) => {\n                if (e.target.id === 'settings-modal') {\n                    const settingsManager = getService(SERVICES.SETTINGS_MANAGER);\n                if (settingsManager) {\n                    settingsManager.closeSettingsModal();\n                }\n                }\n            });\n        }\n        \n        // Dropdown menu toggle\n        const dropdownToggle = document.querySelector('.dropdown-toggle');\n        const dropdownMenu = document.querySelector('.dropdown-menu');\n        \n        if (dropdownToggle && dropdownMenu) {\n            const toggleMenu = () => {\n                const isActive = dropdownMenu.classList.toggle('active');\n                dropdownToggle.classList.toggle('active', isActive);\n            };\n            \n            dropdownToggle.addEventListener('click', (e) => {\n                e.stopPropagation();\n                toggleMenu();\n            });\n            \n            // Close dropdown when clicking outside\n            document.addEventListener('click', (e) => {\n                if (!e.target.closest('.dropdown')) {\n                    dropdownMenu.classList.remove('active');\n                    dropdownToggle.classList.remove('active');\n                }\n            });\n            \n            // Close dropdown when clicking on menu items\n            // Use capture phase to ensure this runs after specific button handlers\n            dropdownMenu.querySelectorAll('button').forEach(button => {\n                button.addEventListener('click', (e) => {\n                    // Only close if this isn't the file-manager button (it has its own handler)\n                    if (button.id !== 'file-manager') {\n                        dropdownMenu.classList.remove('active');\n                        dropdownToggle.classList.remove('active');\n                    } else {\n                        // For file-manager, close dropdown after a short delay to allow handler to fire\n                        setTimeout(() => {\n                            dropdownMenu.classList.remove('active');\n                            dropdownToggle.classList.remove('active');\n                        }, 100);\n                    }\n                }, true); // Use capture phase\n            });\n        }\n        \n        // Context menu event listeners\n        document.getElementById('context-edit').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            console.log('[EventHandler] context-edit clicked');\n            const app = this.app || window.app;\n            if (app && app.handleContextEdit) {\n                app.handleContextEdit();\n            } else {\n                console.error('[EventHandler] app.handleContextEdit not available', { hasThisApp: !!this.app, hasWindowApp: !!window.app });\n            }\n        });\n        \n        const customizeVisualsBtn = document.getElementById('context-customize-visuals');\n        if (customizeVisualsBtn) {\n            customizeVisualsBtn.addEventListener('click', (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                const app = this.app || window.app;\n                if (app && app.handleContextCustomizeVisuals) {\n                    app.handleContextCustomizeVisuals();\n                }\n            });\n        }\n        \n        document.getElementById('context-view-data').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextViewData) {\n                app.handleContextViewData();\n            }\n        });\n        \n        document.getElementById('context-add-element').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextAddElement) {\n                app.handleContextAddElement();\n            }\n        });\n        \n        document.getElementById('context-add-child-element').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextAddChildElement) {\n                app.handleContextAddChildElement();\n            }\n        });\n        \n        document.getElementById('context-add-element-page').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextAddElementPage) {\n                app.handleContextAddElementPage();\n            }\n        });\n        \n        document.getElementById('context-delete-element').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextDeleteElement) {\n                app.handleContextDeleteElement();\n            }\n        });\n        \n        document.getElementById('context-collapse-page').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextCollapsePage) {\n                app.handleContextCollapsePage();\n            }\n        });\n        \n        document.getElementById('context-add-page').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextAddPage) {\n                app.handleContextAddPage();\n            }\n        });\n        \n        document.getElementById('context-add-bin').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextAddBin) {\n                app.handleContextAddBin();\n            }\n        });\n        \n        document.getElementById('context-delete-bin').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextDeleteBin) {\n                app.handleContextDeleteBin();\n            }\n        });\n        \n        document.getElementById('context-delete-page').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextDeletePage) {\n                app.handleContextDeletePage();\n            }\n        });\n        \n        document.getElementById('context-toggle-subtasks').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextToggleSubtasks) {\n                app.handleContextToggleSubtasks();\n            }\n        });\n        \n        document.getElementById('context-reset-day').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextResetDay) {\n                app.handleContextResetDay();\n            }\n        });\n        \n        document.getElementById('context-collapse-all-pages').addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const app = this.app || window.app;\n            if (app && app.handleContextCollapseAllPages) {\n                app.handleContextCollapseAllPages();\n            }\n        });\n        \n        // Close context menu on outside click (use capture phase to run early)\n        document.addEventListener('click', (e) => {\n            const contextMenuHandler = this._getContextMenuHandler();\n            if (!contextMenuHandler) return;\n            \n            const appState = this._getAppState();\n            const menu = document.getElementById('context-menu');\n            \n            // Only process if context menu is visible\n            if (!menu || !menu.classList.contains('active')) {\n                // Track active page when clicking on pages\n                const pageElement = e.target.closest('.page');\n                if (pageElement) {\n                    appState.currentDocumentId = pageElement.dataset.pageId;\n                }\n                return;\n            }\n            \n            // Don't close if clicking on the context menu or its items\n            if (e.target.closest('.context-menu')) {\n                return;\n            }\n            \n            // Click is outside the context menu - hide it\n            contextMenuHandler.hideContextMenu();\n            \n            // Track active page when clicking on pages\n            const pageElement = e.target.closest('.page');\n            if (pageElement) {\n                appState.currentDocumentId = pageElement.dataset.pageId;\n            }\n        }, true); // Use capture phase to ensure this runs before other handlers\n        \n        // Keyboard shortcuts for adding elements\n        document.addEventListener('keydown', (e) => {\n            // Only trigger if not typing in an input/textarea\n            if (e.target.tagName === 'INPUT' || \n                e.target.tagName === 'TEXTAREA' || \n                e.target.closest('.modal')) {\n                return;\n            }\n            \n            // Don't trigger if editing a page title\n            if (e.target.classList.contains('page-title') && e.target.contentEditable === 'true') {\n                return;\n            }\n            \n            // Ctrl+Shift+1-5 for adding element types\n            if (e.ctrlKey && e.shiftKey) {\n                const types = {\n                    '1': 'task',\n                    '2': 'header-checkbox',\n                    '3': 'header-checkbox',\n                    '4': 'multi-checkbox',\n                    '5': 'one-time'\n                };\n                \n                if (types[e.key]) {\n                    e.preventDefault();\n                    // Use active page or first page\n                    const appState = this._getAppState();\n                    const targetPageId = appState.currentDocumentId || (appState.documents.length > 0 ? appState.documents[0].id : null);\n                    const targetBinId = appState.activeGroupId || (appState.documents.find(p => p.id === targetPageId)?.groups?.[0]?.id || null);\n                    if (targetPageId && targetBinId) {\n                        const elementManager = this._getElementManager();\n                        if (elementManager) {\n                            elementManager.addElement(targetPageId, targetBinId, types[e.key]);\n                        }\n                    }\n                }\n            }\n            \n            // Ctrl+N for adding element (shows modal)\n            if (e.ctrlKey && e.key === 'n') {\n                e.preventDefault();\n                const appState = this._getAppState();\n                const targetPageId = this.app?.activePageId || (appState.documents.length > 0 ? appState.documents[0].id : null);\n                const targetBinId = this.app?.activeGroupId || (appState.documents.find(p => p.id === targetPageId)?.groups?.[0]?.id || null);\n                if (targetPageId && targetBinId) {\n                    const modalHandler = this._getModalHandler();\n                    if (modalHandler) {\n                        modalHandler.showAddElementModal(targetPageId, targetBinId);\n                    }\n                }\n            }\n            \n            // Ctrl+Z for undo\n            if (e.ctrlKey && e.key === 'z' && !e.shiftKey) {\n                e.preventDefault();\n                if (this.app.undoRedoManager) {\n                    this.app.undoRedoManager.undo();\n                }\n            }\n            \n            // Ctrl+Shift+Z or Ctrl+Y for redo\n            if ((e.ctrlKey && e.shiftKey && e.key === 'z') || (e.ctrlKey && e.key === 'y')) {\n                e.preventDefault();\n                if (this.app.undoRedoManager) {\n                    this.app.undoRedoManager.redo();\n                }\n            }\n        });\n        \n        // Handle right-click on bins container (empty area) for bin-level menu\n        const binsContainer = document.getElementById('bins-container');\n        if (!binsContainer) {\n            console.warn('bins-container not found, skipping container event listeners');\n            return;\n        }\n        const handleBinsContainerMenu = (e) => {\n            // Show page context menu for empty bins container area (not on a bin, element, or header)\n            if (!e.target.closest('.bin') && !e.target.closest('.element')) {\n                e.preventDefault();\n                e.stopPropagation();\n                const contextMenuHandler = this._getContextMenuHandler();\n                if (contextMenuHandler) {\n                    contextMenuHandler.showPageContextMenu(e);\n                }\n            }\n        };\n        binsContainer.addEventListener('contextmenu', handleBinsContainerMenu);\n        \n        // Use EventHelper for double-click detection on bins container\n        const appState = this._getAppState();\n        EventHelper.setupDoubleClick(\n            binsContainer,\n            (e) => {\n                // Only trigger on empty area, not on interactive elements\n                if (!e.target.closest('.page') && !e.target.closest('.element') && \n                    !e.target.closest('input') && !e.target.closest('button')) {\n                    // Double click detected\n                    handlePageContainerMenu(e);\n                }\n            },\n            appState.doubleClickDelay,\n            {\n                filter: (e) => {\n                    // Only process clicks on empty area\n                    return !e.target.closest('.page') && !e.target.closest('.element') && \n                           !e.target.closest('input') && !e.target.closest('button');\n                }\n            }\n        );\n        \n        // Drag and drop handlers for bins-container\n        binsContainer.addEventListener('dragover', (e) => {\n            // Check if dragging files\n            if (e.dataTransfer.types.includes('Files')) {\n                e.preventDefault();\n                e.stopPropagation();\n                e.dataTransfer.dropEffect = 'copy';\n                binsContainer.classList.add('drag-over');\n                return;\n            }\n            \n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'move';\n            \n            const appState = this._getAppState();\n            const dragData = appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            if (dragData.type === 'bin') {\n                // Find the bin we're hovering over\n                const binElement = e.target.closest('.bin');\n                if (binElement) {\n                    binElement.classList.add('drag-over');\n                } else if (!e.target.closest('.bin')) {\n                    // Hovering over empty space, add class to container\n                    binsContainer.classList.add('drag-over');\n                }\n            }\n        });\n        \n        binsContainer.addEventListener('dragleave', (e) => {\n            // Only remove if we're leaving the container itself\n            if (!binsContainer.contains(e.relatedTarget)) {\n                binsContainer.classList.remove('drag-over');\n                document.querySelectorAll('.bin.drag-over').forEach(el => {\n                    el.classList.remove('drag-over');\n                });\n            }\n        });\n        \n        // File drag and drop on bins container (handled in drop event above)\n        \n        binsContainer.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            // Check if dropping files\n            if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n                Array.from(e.dataTransfer.files).forEach(file => {\n                    this.processDroppedFile(file);\n                });\n                return;\n            }\n            \n            const appState = this._getAppState();\n            let dragData = appState.dragData;\n            if (!dragData) {\n                try {\n                    const dataStr = e.dataTransfer.getData('text/plain');\n                    if (dataStr) {\n                        dragData = JSON.parse(dataStr);\n                    } else {\n                        console.error('No drag data available');\n                        return;\n                    }\n                } catch (err) {\n                    console.error('Failed to parse drag data:', err);\n                    return;\n                }\n            }\n            \n            if (dragData && dragData.type === 'bin') {\n                const binElement = e.target.closest('.bin');\n                if (binElement) {\n                    const targetPageId = binElement.dataset.pageId;\n                    const targetBinId = binElement.dataset.binId;\n                    const binManager = this._getBinManager();\n                    if (binManager) {\n                        binManager.moveBin(dragData.pageId, dragData.binId, targetPageId, targetBinId);\n                    }\n                } else {\n                    // Dropped on empty space, move to end of current page\n                    const page = appState.documents.find(p => p.id === dragData.pageId);\n                    if (page) {\n                        const bin = page.groups?.find(b => b.id === dragData.binId);\n                        if (bin) {\n                            const sourceIndex = page.groups.indexOf(bin);\n                            page.groups.splice(sourceIndex, 1);\n                            page.groups.push(bin);\n                            const dataManager = this._getDataManager();\n                            if (dataManager) {\n                                dataManager.saveData();\n                            }\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                        }\n                    }\n                }\n                \n                // Clean up drag-over classes\n                binsContainer.classList.remove('drag-over');\n                document.querySelectorAll('.drag-over').forEach(el => {\n                    el.classList.remove('drag-over');\n                });\n            }\n            \n            // Clear dragData after processing\n            appState.dragData = null;\n        });\n        \n        // Close context menu on left-click anywhere\n        document.addEventListener('click', (e) => {\n            const contextMenuHandler = this._getContextMenuHandler();\n            if (contextMenuHandler) {\n                contextMenuHandler.hideContextMenu();\n            }\n        });\n\n        // Unified contextmenu handler - routes to appropriate ContextMenuHandler methods\n        document.addEventListener('contextmenu', (e) => {\n            const target = e.target;\n            const binsContainer = document.getElementById('bins-container');\n            \n            // Find the closest element, bin, or page tab\n            const targetElement = target.closest('.element');\n            const binElement = target.closest('.bin');\n            const pageTabElement = target.closest('.page-tab');\n            \n            // Route to appropriate handler\n            if (targetElement) {\n                // Element context menu\n                const appState = this._getAppState();\n                const pageId = targetElement.dataset.pageId || appState.currentDocumentId;\n                const binId = targetElement.dataset.binId;\n                const elementIndexStr = targetElement.dataset.elementIndex;\n                const elementIndex = elementIndexStr !== undefined && elementIndexStr !== '' ? parseInt(elementIndexStr, 10) : null;\n                const contextMenuHandler = this._getContextMenuHandler();\n                if (contextMenuHandler) {\n                    contextMenuHandler.showContextMenu(e, pageId, binId, elementIndex);\n                }\n                return;\n            }\n            \n            if (binElement && !targetElement) {\n                // Bin context menu\n                const pageId = binElement.dataset.pageId || appState.currentDocumentId;\n                const binId = binElement.dataset.binId;\n                const contextMenuHandler = this._getContextMenuHandler();\n                if (contextMenuHandler) {\n                    contextMenuHandler.showBinContextMenu(e, pageId, binId);\n                }\n                return;\n            }\n            \n            if (pageTabElement) {\n                // Page tab context menu\n                const pageId = pageTabElement.dataset.pageId;\n                const contextMenuHandler = this._getContextMenuHandler();\n                if (contextMenuHandler) {\n                    contextMenuHandler.showPageContextMenu(e, pageId);\n                }\n                return;\n            }\n            \n            // Empty area context menu (bins container or app area)\n            if (binsContainer) {\n                const contextMenuHandler = this._getContextMenuHandler();\n                if (contextMenuHandler) {\n                    contextMenuHandler.showPageContextMenu(e);\n                }\n                return;\n            }\n            \n            // If no specific handler, hide any active context menu\n            const contextMenuHandler = getService(SERVICES.CONTEXT_MENU_HANDLER);\n            if (contextMenuHandler) {\n                contextMenuHandler.hideContextMenu();\n            }\n        }, true); // Use capture phase\n        \n        // Touch gesture handlers for mobile two-finger context menu\n        const touchGestureHandler = getService(SERVICES.TOUCH_GESTURE_HANDLER);\n        if (touchGestureHandler) {\n            touchGestureHandler.setupTouchGestures();\n            \n            // Swipe gesture handlers for mobile\n            touchGestureHandler.setupSwipeGestures();\n        }\n        \n        // Modal close handlers\n        // Store the current edit info for the close button\n        let currentEditInfo = null;\n        \n        document.querySelector('.modal-close').addEventListener('click', () => {\n            // Use currentEdit if available, otherwise try to find it from the modal\n            const appState = this._getAppState();\n            const currentEdit = appState.currentEditModal;\n            if (currentEdit && currentEdit.pageId && currentEdit.elementIndex !== undefined) {\n                const modalHandler = this._getModalHandler();\n                if (modalHandler && currentEdit) {\n                    modalHandler.saveEdit(currentEdit.pageId, currentEdit.elementIndex);\n                }\n            } else if (currentEditInfo) {\n                const modalHandler = this._getModalHandler();\n                if (modalHandler) {\n                    modalHandler.saveEdit(currentEditInfo.pageId, currentEditInfo.elementIndex);\n                }\n            } else {\n                // Fallback: close modal\n                const modalHandler = this._getModalHandler();\n                if (modalHandler) {\n                    modalHandler.closeModal();\n                }\n            }\n        });\n        \n        // Track mouse down location to prevent closing when clicking inside and releasing outside\n        let modalMouseDownTarget = null;\n        const modalElement = document.getElementById('modal');\n        \n        modalElement.addEventListener('mousedown', (e) => {\n            // Track what element was clicked on mousedown\n            modalMouseDownTarget = e.target;\n        });\n        \n        modalElement.addEventListener('click', (e) => {\n            // Only close if both mousedown and click were on the modal background (not modal-content)\n            // This prevents closing when clicking inside and releasing outside\n            if (e.target.id === 'modal' && modalMouseDownTarget && modalMouseDownTarget.id === 'modal') {\n                const modalHandler = this._getModalHandler();\n                if (modalHandler) {\n                    modalHandler.closeModal();\n                }\n            }\n            modalMouseDownTarget = null; // Reset\n        });\n        \n        // Auto-scroll during drag when near screen edges\n        document.addEventListener('dragover', (e) => {\n            const appState = this._getAppState();\n            if (!appState.isDragging) return;\n            \n            const edgeThreshold = 50; // Distance from edge to trigger scrolling\n            const viewportWidth = window.innerWidth;\n            const viewportHeight = window.innerHeight;\n            const mouseX = e.clientX;\n            const mouseY = e.clientY;\n            \n            let scrollX = 0;\n            let scrollY = 0;\n            \n            // Check horizontal edges\n            if (mouseX < edgeThreshold) {\n                scrollX = -appState.edgeScrollSpeed;\n            } else if (mouseX > viewportWidth - edgeThreshold) {\n                scrollX = appState.edgeScrollSpeed;\n            }\n            \n            // Check vertical edges\n            if (mouseY < edgeThreshold) {\n                scrollY = -appState.edgeScrollSpeed;\n            } else if (mouseY > viewportHeight - edgeThreshold) {\n                scrollY = appState.edgeScrollSpeed;\n            }\n            \n            // Apply scrolling\n            if (scrollX !== 0 || scrollY !== 0) {\n                // Clear existing interval\n                if (appState.autoScrollInterval) {\n                    clearInterval(appState.autoScrollInterval);\n                }\n                \n                // Start continuous scrolling\n                appState.autoScrollInterval = setInterval(() => {\n                    if (!appState.isDragging) {\n                        clearInterval(appState.autoScrollInterval);\n                        appState.autoScrollInterval = null;\n                        return;\n                    }\n                    \n                    const container = document.getElementById('bins-container');\n                    if (container) {\n                        if (scrollX !== 0) {\n                            container.scrollLeft += scrollX;\n                        }\n                        if (scrollY !== 0) {\n                            container.scrollTop += scrollY;\n                        }\n                    } else {\n                        // Fallback to window scroll\n                        if (scrollX !== 0) {\n                            window.scrollBy(scrollX, 0);\n                        }\n                        if (scrollY !== 0) {\n                            window.scrollBy(0, scrollY);\n                        }\n                    }\n                }, 16); // ~60fps\n            } else {\n                // Stop scrolling if not near edge\n                if (appState.autoScrollInterval) {\n                    clearInterval(appState.autoScrollInterval);\n                    appState.autoScrollInterval = null;\n                }\n            }\n        });\n        \n        // Middle mouse wheel scrolling during drag\n        document.addEventListener('wheel', (e) => {\n            const appState = this._getAppState();\n            if (!appState.isDragging) return;\n            \n            // Check if middle mouse button is pressed (button 1)\n            // Note: We can't directly check button state during wheel event,\n            // so we'll track it via mousedown/mouseup\n            if (appState.middleMouseDown) {\n                e.preventDefault();\n                \n                const container = document.getElementById('pages-container');\n                if (container) {\n                    // Scroll horizontally if shift is held, otherwise vertically\n                    if (e.shiftKey) {\n                        container.scrollLeft += e.deltaY;\n                    } else {\n                        container.scrollTop += e.deltaY;\n                    }\n                } else {\n                    // Fallback to window scroll\n                    if (e.shiftKey) {\n                        window.scrollBy(e.deltaY, 0);\n                    } else {\n                        window.scrollBy(0, e.deltaY);\n                    }\n                }\n            }\n        }, { passive: false });\n        \n        // Track middle mouse button state (reuse appState from wheel handler scope)\n        // Get appState for middle mouse tracking\n        const appStateForMouse = this._getAppState();\n        appStateForMouse.middleMouseDown = false;\n        document.addEventListener('mousedown', (e) => {\n            if (e.button === 1) { // Middle mouse button\n                appStateForMouse.middleMouseDown = true;\n            }\n        });\n        \n        document.addEventListener('mouseup', (e) => {\n            if (e.button === 1) { // Middle mouse button\n                appStateForMouse.middleMouseDown = false;\n            }\n        });\n        \n        // Also handle contextmenu event for middle mouse (some browsers)\n        document.addEventListener('contextmenu', (e) => {\n            if (e.button === 1) {\n                e.preventDefault();\n            }\n        });\n    }\n}\n\n","// ContextMenuHandler.js - Handles context menu display and interaction\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class ContextMenuHandler {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n\n    // Position menu within viewport bounds\n    positionMenu(menu, x, y) {\n        // Show menu temporarily to get its dimensions\n        menu.style.visibility = 'hidden';\n        menu.style.display = 'block';\n\n        const menuRect = menu.getBoundingClientRect();\n        const menuWidth = menuRect.width;\n        const menuHeight = menuRect.height;\n        const viewportWidth = window.innerWidth;\n        const viewportHeight = window.innerHeight;\n\n        // Hide menu again while we calculate position\n        menu.style.display = 'none';\n        menu.style.visibility = 'visible';\n\n        // Adjust X position\n        let finalX = x;\n        if (x + menuWidth > viewportWidth) {\n            finalX = x - menuWidth;\n            // If it would go off the left side too, position at right edge\n            if (finalX < 0) {\n                finalX = viewportWidth - menuWidth;\n            }\n        }\n\n        // Adjust Y position\n        let finalY = y;\n        if (y + menuHeight > viewportHeight) {\n            finalY = y - menuHeight;\n            // If it would go off the top too, position at bottom edge\n            if (finalY < 0) {\n                finalY = viewportHeight - menuHeight;\n            }\n        }\n\n        menu.style.left = finalX + 'px';\n        menu.style.top = finalY + 'px';\n    }\n    \n    showContextMenu(e, pageId, binId, elementIndex, subtaskIndex = null) {\n        const now = Date.now();\n        const appState = this._getAppState();\n        const timeSinceLastClick = now - (appState.lastRightClickTime || 0);\n        \n        // Check if this is a double right-click\n        if (timeSinceLastClick < (appState.doubleClickThreshold || 500) && appState.contextMenuState && appState.contextMenuState.visible) {\n            // Double right-click - hide custom menu and allow browser menu\n            this.hideContextMenu();\n            // Don't prevent default - let browser show its context menu\n            appState.lastRightClickTime = 0; // Reset to prevent triple-click issues\n            return;\n        }\n        \n        // Single right-click - show custom menu\n        e.preventDefault();\n        e.stopPropagation();\n        \n        // If binId not provided, try to find it\n        if (!binId) {\n            binId = appState.activeGroupId;\n            if (!binId) {\n                const page = appState.documents.find(p => p.id === pageId);\n                if (page && page.groups && page.groups.length > 0) {\n                    binId = page.groups[0].id;\n                }\n            }\n        }\n        \n        appState.lastRightClickTime = now;\n        \n        if (appState.setContextMenuState) {\n            appState.setContextMenuState({\n                visible: true,\n                documentId: pageId,\n                groupId: binId,\n                elementIndex: elementIndex,\n                subtaskIndex: subtaskIndex,\n                x: e.clientX,\n                y: e.clientY\n            });\n        }\n        \n        const menu = document.getElementById('context-menu');\n\n        if (!menu) {\n            console.error('Context menu element not found!');\n            return;\n        }\n\n        // Show element-specific menu items, hide page-level items\n        const pageLevelItems = ['context-add-page', 'context-add-element-page', 'context-delete-page', 'context-toggle-subtasks', 'context-collapse-all-pages', 'context-reset-day'];\n        menu.querySelectorAll('.context-menu-item').forEach(item => {\n            if (pageLevelItems.includes(item.id)) {\n                item.style.display = 'none';\n            } else {\n                item.style.display = 'block';\n            }\n        });\n        \n        // Show customize visuals for elements\n        const customizeVisualsItem = document.getElementById('context-customize-visuals');\n        if (customizeVisualsItem) {\n            customizeVisualsItem.style.display = 'block';\n            customizeVisualsItem.textContent = 'Customize Visuals';\n        }\n        \n        // Show/hide menu items based on whether it's a child/subtask\n        const editMenuItem = document.getElementById('context-edit');\n        const addElementMenuItem = document.getElementById('context-add-element');\n        const addChildElementMenuItem = document.getElementById('context-add-child-element');\n        const collapsePageMenuItem = document.getElementById('context-collapse-page');\n        \n        // Ensure edit menu item shows \"Edit\" for elements\n        if (editMenuItem) {\n            editMenuItem.textContent = 'Edit';\n        }\n        \n        // Check if element already has children (one-level limit)\n        // Reuse appState from line 57\n        const page = appState.documents.find(p => p.id === pageId);\n        const bin = page?.groups?.find(b => b.id === binId);\n        const items = bin?.items || [];\n        if (bin) {\n            bin.items = items;\n        }\n        const element = bin && items && items[elementIndex] ? items[elementIndex] : null;\n        const hasChildren = Array.isArray(element?.childIds) && element.childIds.length > 0;\n        \n        if (subtaskIndex !== null || (typeof elementIndex === 'string' && elementIndex.includes('-'))) {\n            // For children/subtasks, hide some options\n            if (editMenuItem) editMenuItem.style.display = 'none';\n            if (addElementMenuItem) addElementMenuItem.style.display = 'none';\n            if (addChildElementMenuItem) addChildElementMenuItem.style.display = 'none';\n            if (collapsePageMenuItem) collapsePageMenuItem.style.display = 'none';\n        } else {\n            // For main elements, show all element options\n            if (editMenuItem) editMenuItem.style.display = 'block';\n            if (addElementMenuItem) addElementMenuItem.style.display = 'block';\n            // Show \"Add Child Element\" only if element doesn't already have children\n            if (addChildElementMenuItem) {\n                addChildElementMenuItem.style.display = hasChildren ? 'none' : 'block';\n            }\n        }\n        \n        // Update \"Collapse Page\" / \"Expand Page\" text based on current state\n        if (collapsePageMenuItem && pageId && subtaskIndex === null) {\n            // Check bin states for page collapse state (pages are collapsed if all bins are collapsed)\n            const page = appState.documents.find(p => p.id === pageId);\n            const isExpanded = page && page.groups && page.groups.some(bin => {\n                const binState = appState.getGroupState ? appState.getGroupState(bin.id) : appState.groupStates?.[bin.id];\n                return binState !== 'collapsed';\n            });\n            collapsePageMenuItem.textContent = isExpanded ? 'Collapse Page' : 'Expand Page';\n        }\n\n        this.positionMenu(menu, e.clientX, e.clientY);\n        menu.classList.add('active');\n        // Remove the inline display style so CSS can take effect\n        menu.style.display = '';\n    }\n    \n    hideContextMenu() {\n        const menu = document.getElementById('context-menu');\n        if (!menu) {\n            return;\n        }\n        menu.classList.remove('active');\n        const appState = this._getAppState();\n        if (appState.contextMenuState && appState.setContextMenuState) {\n            appState.setContextMenuState({ visible: false });\n        }\n        // Hide all menu items, they will be shown/hidden as needed\n        menu.querySelectorAll('.context-menu-item').forEach(item => {\n            item.style.display = '';\n        });\n    }\n    \n    showBinContextMenu(e, pageId, binId) {\n        const now = Date.now();\n        const appState = this._getAppState();\n        const timeSinceLastClick = now - (appState.lastRightClickTime || 0);\n        \n        // Check if this is a double right-click\n        if (timeSinceLastClick < (appState.doubleClickThreshold || 500) && appState.contextMenuState && appState.contextMenuState.visible) {\n            // Double right-click - hide custom menu and allow browser menu\n            this.hideContextMenu();\n            // Don't prevent default - let browser show its context menu\n            appState.lastRightClickTime = 0; // Reset to prevent triple-click issues\n            return;\n        }\n        \n        // Single right-click - show custom menu\n        e.preventDefault();\n        e.stopPropagation();\n        \n        appState.lastRightClickTime = now;\n        \n        const menu = document.getElementById('context-menu');\n        \n        // Show bin-level menu items (edit bin, add element, add bin, delete bin, etc.)\n        const binLevelItems = ['context-edit', 'context-customize-visuals', 'context-add-element', 'context-add-bin', 'context-delete-bin'];\n        const elementLevelItems = ['context-add-child-element', 'context-delete-element', 'context-view-data'];\n        const pageLevelItems = ['context-add-page', 'context-add-element-page', 'context-delete-page', 'context-toggle-subtasks', 'context-collapse-all-pages', 'context-reset-day', 'context-collapse-page'];\n        \n        menu.querySelectorAll('.context-menu-item').forEach(item => {\n            if (binLevelItems.includes(item.id)) {\n                item.style.display = 'block';\n            } else if (elementLevelItems.includes(item.id) || pageLevelItems.includes(item.id)) {\n                item.style.display = 'none';\n            }\n        });\n        \n        // Update edit menu item text for bins\n        const editMenuItem = document.getElementById('context-edit');\n        if (editMenuItem) {\n            editMenuItem.textContent = 'Edit Bin';\n        }\n        \n        // Update customize visuals menu item text for bins\n        const customizeVisualsItem = document.getElementById('context-customize-visuals');\n        if (customizeVisualsItem) {\n            customizeVisualsItem.textContent = 'Customize Visuals';\n        }\n\n        this.positionMenu(menu, e.clientX, e.clientY);\n        menu.classList.add('active');\n        // Remove the inline display style so CSS can take effect\n        menu.style.display = '';\n        \n        // Set context menu state with the correct pageId and binId\n        if (appState.setContextMenuState) {\n            appState.setContextMenuState({\n                visible: true,\n                pageId: pageId,\n                binId: binId,\n                elementIndex: null,\n                x: e.clientX,\n                y: e.clientY\n            });\n        }\n    }\n    \n    showPageContextMenu(e, pageId = null) {\n        const now = Date.now();\n        const appState = this._getAppState();\n        const timeSinceLastClick = now - (appState.lastRightClickTime || 0);\n        \n        // Check if this is a double right-click\n        if (timeSinceLastClick < (appState.doubleClickThreshold || 500) && appState.contextMenuState && appState.contextMenuState.visible) {\n            // Double right-click - hide custom menu and allow browser menu\n            this.hideContextMenu();\n            // Don't prevent default - let browser show its context menu\n            appState.lastRightClickTime = 0; // Reset to prevent triple-click issues\n            return;\n        }\n        \n        // Single right-click - show custom menu\n        e.preventDefault();\n        e.stopPropagation();\n        \n        appState.lastRightClickTime = now;\n        \n        const menu = document.getElementById('context-menu');\n        \n        // Show only page-level menu items (including edit for pages)\n        const pageLevelItems = ['context-add-page', 'context-add-element-page', 'context-delete-page', 'context-toggle-subtasks', 'context-collapse-all-pages', 'context-reset-day', 'context-edit', 'context-customize-visuals', 'context-paste-markdown'];\n        menu.querySelectorAll('.context-menu-item').forEach(item => {\n            if (pageLevelItems.includes(item.id)) {\n                item.style.display = 'block';\n            } else {\n                item.style.display = 'none';\n            }\n        });\n        \n        // Update edit menu item text for pages\n        const editMenuItem = document.getElementById('context-edit');\n        if (editMenuItem) {\n            editMenuItem.textContent = 'Edit Page';\n        }\n        \n        // Update customize visuals menu item text for pages\n        const customizeVisualsItem = document.getElementById('context-customize-visuals');\n        if (customizeVisualsItem) {\n            customizeVisualsItem.textContent = 'Customize Visuals';\n        }\n        \n        // Determine which page to use (parameter, the one being right-clicked on, or active page)\n        let pageIdToUse = pageId;\n        if (!pageIdToUse) {\n            const pageElement = e.target.closest('.page-tab');\n            if (pageElement) {\n                pageIdToUse = pageElement.dataset.pageId;\n            }\n        }\n        if (!pageIdToUse) {\n            const pageElement = e.target.closest('.page');\n            if (pageElement) {\n                pageIdToUse = pageElement.dataset.pageId;\n            }\n        }\n        if (!pageIdToUse) {\n            pageIdToUse = appState.currentDocumentId;\n        }\n        \n        // Update \"Toggle All Subtasks\" text based on current state\n        const toggleSubtasksItem = document.getElementById('context-toggle-subtasks');\n        if (toggleSubtasksItem) {\n            toggleSubtasksItem.textContent = appState.allSubtasksExpanded ? ' Collapse All Subtasks' : ' Expand All Subtasks';\n        }\n\n        this.positionMenu(menu, e.clientX, e.clientY);\n        menu.classList.add('active');\n        // Remove the inline display style so CSS can take effect\n        menu.style.display = '';\n        \n        // Set context menu state with the correct pageId (binId explicitly set to null for page context)\n        // Reuse appState from line 256\n        if (appState.setContextMenuState) {\n            appState.setContextMenuState({\n                visible: true,\n                pageId: pageIdToUse,\n                binId: null,\n                elementIndex: null,\n                x: e.clientX,\n                y: e.clientY\n            });\n        }\n    }\n}\n","// TouchGestureHandler.js - Handles touch gestures for mobile devices\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class TouchGestureHandler {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    setupTouchGestures() {\n        // Handle two-finger gesture: finger 1 held, finger 2 taps -> context menu at finger 1 position\n        document.addEventListener('touchstart', (e) => {\n            const touches = Array.from(e.touches);\n            \n            const appState = this._getAppState();\n            // Store all current touches\n            touches.forEach(touch => {\n                if (!appState.touchPoints[touch.identifier]) {\n                    // New touch - store it with timestamp\n                    appState.touchPoints[touch.identifier] = {\n                        x: touch.clientX,\n                        y: touch.clientY,\n                        target: document.elementFromPoint(touch.clientX, touch.clientY),\n                        time: Date.now()\n                    };\n                }\n            });\n            \n            // If we now have 2 touches (second finger just touched)\n            if (touches.length === 2) {\n                const touchIds = Object.keys(appState.touchPoints).map(id => parseInt(id));\n                // Get the first touch (oldest)\n                const firstTouchId = touchIds.sort((a, b) => \n                    appState.touchPoints[a].time - appState.touchPoints[b].time\n                )[0];\n                \n                const firstTouch = appState.touchPoints[firstTouchId];\n                const timeHeld = Date.now() - firstTouch.time;\n                \n                // If first touch has been held for at least 100ms\n                if (timeHeld >= 100 && firstTouch.target) {\n                    // Trigger context menu at first touch position\n                    e.preventDefault();\n                    e.stopPropagation();\n                    \n                    // Get fresh element at first touch position (in case DOM changed)\n                    const targetAtPosition = document.elementFromPoint(firstTouch.x, firstTouch.y);\n                    \n                    // Create synthetic event for showContextMenu\n                    const syntheticEvent = {\n                        clientX: firstTouch.x,\n                        clientY: firstTouch.y,\n                        target: targetAtPosition || firstTouch.target,\n                        preventDefault: () => {},\n                        stopPropagation: () => {}\n                    };\n                    \n                    // Find context menu data from the element at first touch position\n                    this.triggerContextMenuFromTouch(syntheticEvent, syntheticEvent.target);\n                }\n            }\n        }, { passive: false });\n        \n        document.addEventListener('touchmove', (e) => {\n            // Update touch positions\n            Array.from(e.touches).forEach(touch => {\n                const appState = this._getAppState();\n                if (appState.touchPoints[touch.identifier]) {\n                    appState.touchPoints[touch.identifier].x = touch.clientX;\n                    appState.touchPoints[touch.identifier].y = touch.clientY;\n                }\n            });\n        });\n        \n        document.addEventListener('touchend', (e) => {\n            // Remove ended touches\n            Array.from(e.changedTouches).forEach(touch => {\n                const appState = this._getAppState();\n                delete appState.touchPoints[touch.identifier];\n            });\n            \n            // Clear first touch data if no touches remain\n            if (e.touches.length === 0) {\n                this.app.firstTouchData = null;\n                const appState = this._getAppState();\n                appState.touchPoints = {};\n            }\n        });\n    }\n    \n    triggerContextMenuFromTouch(e, target) {\n        // Create a proper contextmenu event that will bubble and trigger all existing handlers\n        // This ensures the touch gesture works exactly like a mouse right-click\n        const contextMenuEvent = new MouseEvent('contextmenu', {\n            bubbles: true,\n            cancelable: true,\n            clientX: e.clientX,\n            clientY: e.clientY,\n            button: 2, // Right mouse button\n            buttons: 2,\n            view: window\n        });\n        \n        // Dispatch the event on the target element\n        // This will trigger all existing contextmenu event listeners\n        target.dispatchEvent(contextMenuEvent);\n        \n        // If the event wasn't prevented and no handler showed a menu,\n        // fall back to the original logic for edge cases\n        if (!contextMenuEvent.defaultPrevented && (!this.app.contextMenuState || !this.app.contextMenuState.visible)) {\n            // Fallback: try to find context menu data manually\n            this.fallbackContextMenuFromTouch(e, target);\n        }\n    }\n    \n    fallbackContextMenuFromTouch(e, target) {\n        // Fallback method for edge cases where event didn't trigger handlers\n        const element = target.closest('.element');\n        const bin = target.closest('.bin');\n        const binContent = target.closest('.bin-content');\n        const elementsList = target.closest('.elements-list');\n        const pageTab = target.closest('.page-tab');\n        const tabsContainer = target.closest('.page-tabs');\n        const binsContainer = target.closest('#bins-container');\n        const page = target.closest('.page');\n        const subtask = target.closest('.subtask');\n        \n        // Element context menu\n        if (element) {\n            const pageId = element.dataset.pageId;\n            const binId = element.dataset.binId;\n            let elementIndex = element.dataset.elementIndex;\n            const isChild = element.dataset.isChild === 'true';\n            const childIndex = element.dataset.childIndex;\n            \n            // Handle nested children\n            if (isChild && childIndex !== undefined) {\n                elementIndex = `${elementIndex}-${childIndex}`;\n            } else {\n                elementIndex = parseInt(elementIndex);\n            }\n            \n            if (subtask) {\n                // Find subtask index (legacy support)\n                const subtaskContainer = element.querySelector('.subtask-container, .children-container');\n                if (subtaskContainer) {\n                    const subtasks = subtaskContainer.querySelectorAll('.subtask, .child-element');\n                    const subtaskIndex = Array.from(subtasks).indexOf(subtask);\n                    if (subtaskIndex !== -1) {\n                        this.app.contextMenuHandler.showContextMenu(e, pageId, binId, elementIndex, subtaskIndex);\n                        return;\n                    }\n                }\n            }\n            \n            // Regular element\n            if (pageId && binId && (typeof elementIndex === 'string' || !isNaN(elementIndex))) {\n                this.app.contextMenuHandler.showContextMenu(e, pageId, binId, elementIndex);\n                return;\n            }\n        }\n        \n        // Bin context menu (empty bin content area)\n        if (bin && binContent && !target.closest('.element') && !target.closest('button')) {\n            const pageId = bin.dataset.pageId;\n            const binId = bin.dataset.binId;\n            if (pageId && binId) {\n                this.app.contextMenuHandler.showBinContextMenu(e, pageId, binId);\n                return;\n            }\n        }\n        \n        // Elements list context menu (empty area in elements list)\n        if (elementsList && !target.closest('.element')) {\n            const bin = elementsList.closest('.bin');\n            if (bin) {\n                const pageId = bin.dataset.pageId;\n                const binId = bin.dataset.binId;\n                if (pageId && binId) {\n                    this.app.contextMenuHandler.showBinContextMenu(e, pageId, binId);\n                    return;\n                }\n            }\n        }\n        \n        // Page tab context menu\n        if (pageTab) {\n            const pageId = pageTab.dataset.pageId;\n            if (pageId) {\n                this.app.contextMenuHandler.showPageContextMenu(e, pageId);\n                return;\n            }\n        }\n        \n        // Tabs container context menu (empty area in tabs)\n        if (tabsContainer && !target.closest('.page-tab')) {\n            this.app.contextMenuHandler.showPageContextMenu(e);\n            return;\n        }\n        \n        // Bins container context menu (empty area)\n        if (binsContainer && !target.closest('.bin') && !target.closest('.element')) {\n            this.app.contextMenuHandler.showPageContextMenu(e);\n            return;\n        }\n        \n        // Page context menu (fallback)\n        if (page) {\n            const pageId = page.dataset.pageId;\n            if (pageId) {\n                const isInPageContent = target.closest('[id^=\"page-content-\"]');\n                const isElement = target.closest('.element');\n                const isPageControl = target.closest('.page-controls');\n                const isToggleArrow = target.closest('.page-toggle-arrow');\n                const isAddElementBtn = target.closest('.add-element-btn');\n                \n                if (!isInPageContent && !isElement && !isPageControl && !isToggleArrow && !isAddElementBtn) {\n                    this.app.contextMenuHandler.showPageContextMenu(e, pageId);\n                    return;\n                }\n            }\n        }\n    }\n    \n    setupSwipeGestures() {\n        // Swipe Gestures (4) - Swipe left to delete, swipe right to toggle completion\n        let touchStartX = 0;\n        let touchStartY = 0;\n        let touchStartTime = 0;\n        const swipeThreshold = 50; // pixels\n        const maxSwipeTime = 500; // milliseconds\n        let swipeElement = null;\n        \n        document.addEventListener('touchstart', (e) => {\n            if (e.touches.length === 1) {\n                touchStartX = e.touches[0].clientX;\n                touchStartY = e.touches[0].clientY;\n                touchStartTime = Date.now();\n                swipeElement = e.target.closest('.element');\n                \n                // Add visual feedback\n                if (swipeElement) {\n                    swipeElement.style.transition = 'transform 0.2s ease-out';\n                }\n            }\n        }, { passive: true });\n        \n        document.addEventListener('touchmove', (e) => {\n            if (swipeElement && e.touches.length === 1) {\n                const currentX = e.touches[0].clientX;\n                const currentY = e.touches[0].clientY;\n                const diffX = currentX - touchStartX;\n                const diffY = currentY - touchStartY;\n                \n                // Only allow horizontal swipes\n                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 10) {\n                    e.preventDefault();\n                    // Visual feedback during swipe\n                    swipeElement.style.transform = `translateX(${diffX}px)`;\n                    swipeElement.style.opacity = Math.max(0.5, 1 - Math.abs(diffX) / 200);\n                }\n            }\n        }, { passive: false });\n        \n        document.addEventListener('touchend', (e) => {\n            if (!swipeElement || !touchStartX || !touchStartY) {\n                touchStartX = 0;\n                touchStartY = 0;\n                swipeElement = null;\n                return;\n            }\n            \n            const touchEndX = e.changedTouches[0].clientX;\n            const touchEndY = e.changedTouches[0].clientY;\n            const diffX = touchEndX - touchStartX;\n            const diffY = touchEndY - touchStartY;\n            const swipeTime = Date.now() - touchStartTime;\n            \n            // Reset transform\n            if (swipeElement) {\n                swipeElement.style.transform = '';\n                swipeElement.style.opacity = '';\n            }\n            \n            // Check if it's a valid horizontal swipe\n            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > swipeThreshold && swipeTime < maxSwipeTime) {\n                const pageId = swipeElement.dataset.pageId;\n                const binId = swipeElement.dataset.binId;\n                let elementIndex = swipeElement.dataset.elementIndex;\n                \n                // Handle nested children\n                if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n                    // Don't allow swipe actions on nested children\n                    touchStartX = 0;\n                    touchStartY = 0;\n                    swipeElement = null;\n                    return;\n                } else {\n                    elementIndex = parseInt(elementIndex);\n                }\n                \n                if (pageId && binId && !isNaN(elementIndex)) {\n                    if (diffX > 0) {\n                        // Swipe right - toggle completion\n                        this.app.toggleElement(pageId, binId, elementIndex);\n                    } else {\n                        // Swipe left - delete\n                        if (confirm('Delete this element?')) {\n                            const appState = this._getAppState();\n                            const page = appState.documents.find(p => p.id === pageId);\n                            if (page) {\n                                const bin = page.groups?.find(b => b.id === binId);\n                                const items = bin?.items || [];\n                                if (bin) {\n                                    bin.items = items;\n                                }\n                                if (items[elementIndex]) {\n                                    items.splice(elementIndex, 1);\n                                    bin.items = items;\n                                    const dataManager = this._getDataManager();\n                                    if (dataManager) {\n                                        dataManager.saveData();\n                                    }\n                                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n            \n            touchStartX = 0;\n            touchStartY = 0;\n            swipeElement = null;\n        }, { passive: true });\n    }\n}\n\n","// DOM Utilities - DOM manipulation helpers\r\nexport const DOMUtils = {\r\n    /**\r\n     * Create an element with attributes and optional children\r\n     * @param {string} tag - HTML tag name\r\n     * @param {Object} attrs - Attributes object (class, id, style, etc.)\r\n     * @param {Array|string} children - Child elements or text content\r\n     * @returns {HTMLElement}\r\n     */\r\n    createElement(tag, attrs = {}, children = []) {\r\n        const el = document.createElement(tag);\r\n        \r\n        // Set attributes\r\n        for (const [key, value] of Object.entries(attrs)) {\r\n            if (key === 'textContent' || key === 'innerHTML') {\r\n                el[key] = value;\r\n            } else if (key === 'style' && typeof value === 'object') {\r\n                Object.assign(el.style, value);\r\n            } else if (key === 'dataset') {\r\n                Object.assign(el.dataset, value);\r\n            } else {\r\n                el.setAttribute(key, value);\r\n            }\r\n        }\r\n        \r\n        // Add children\r\n        if (typeof children === 'string') {\r\n            el.textContent = children;\r\n        } else if (Array.isArray(children)) {\r\n            children.forEach(child => {\r\n                if (typeof child === 'string') {\r\n                    el.appendChild(document.createTextNode(child));\r\n                } else if (child instanceof Node) {\r\n                    el.appendChild(child);\r\n                }\r\n            });\r\n        }\r\n        \r\n        return el;\r\n    },\r\n    \r\n    /**\r\n     * Query selector with optional context\r\n     * @param {string} selector - CSS selector\r\n     * @param {HTMLElement} context - Context element (default: document)\r\n     * @returns {HTMLElement|null}\r\n     */\r\n    query(selector, context = document) {\r\n        return context.querySelector(selector);\r\n    },\r\n    \r\n    /**\r\n     * Query all elements matching selector\r\n     * @param {string} selector - CSS selector\r\n     * @param {HTMLElement} context - Context element (default: document)\r\n     * @returns {NodeList}\r\n     */\r\n    queryAll(selector, context = document) {\r\n        return context.querySelectorAll(selector);\r\n    },\r\n    \r\n    /**\r\n     * Add event listener with delegation support\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} event - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {Object} options - Event options (delegate selector, etc.)\r\n     */\r\n    on(element, event, handler, options = {}) {\r\n        if (options.delegate) {\r\n            element.addEventListener(event, (e) => {\r\n                const target = e.target.closest(options.delegate);\r\n                if (target && element.contains(target)) {\r\n                    handler.call(target, e);\r\n                }\r\n            });\r\n        } else {\r\n            element.addEventListener(event, handler);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Remove event listener\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} event - Event type\r\n     * @param {Function} handler - Event handler\r\n     */\r\n    off(element, event, handler) {\r\n        element.removeEventListener(event, handler);\r\n    },\r\n    \r\n    /**\r\n     * Toggle class on element\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} className - Class name\r\n     * @param {boolean} force - Force add/remove\r\n     */\r\n    toggleClass(element, className, force) {\r\n        element.classList.toggle(className, force);\r\n    },\r\n    \r\n    /**\r\n     * Add class to element\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} className - Class name\r\n     */\r\n    addClass(element, className) {\r\n        element.classList.add(className);\r\n    },\r\n    \r\n    /**\r\n     * Remove class from element\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} className - Class name\r\n     */\r\n    removeClass(element, className) {\r\n        element.classList.remove(className);\r\n    },\r\n    \r\n    /**\r\n     * Check if element has class\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {string} className - Class name\r\n     * @returns {boolean}\r\n     */\r\n    hasClass(element, className) {\r\n        return element.classList.contains(className);\r\n    },\r\n    \r\n    /**\r\n     * Smooth scroll to element\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {Object} options - Scroll options\r\n     */\r\n    scrollTo(element, options = {}) {\r\n        element.scrollIntoView({\r\n            behavior: 'smooth',\r\n            block: 'nearest',\r\n            ...options\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * Fade in animation\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {number} duration - Animation duration in ms\r\n     */\r\n    fadeIn(element, duration = 300) {\r\n        element.style.opacity = '0';\r\n        element.style.display = '';\r\n        element.style.transition = `opacity ${duration}ms`;\r\n        requestAnimationFrame(() => {\r\n            element.style.opacity = '1';\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * Fade out animation\r\n     * @param {HTMLElement} element - Target element\r\n     * @param {number} duration - Animation duration in ms\r\n     * @returns {Promise}\r\n     */\r\n    fadeOut(element, duration = 300) {\r\n        return new Promise((resolve) => {\r\n            element.style.transition = `opacity ${duration}ms`;\r\n            element.style.opacity = '0';\r\n            setTimeout(() => {\r\n                element.style.display = 'none';\r\n                resolve();\r\n            }, duration);\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * Remove element from DOM\r\n     * @param {HTMLElement} element - Element to remove\r\n     */\r\n    remove(element) {\r\n        if (element && element.parentNode) {\r\n            element.parentNode.removeChild(element);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clear element content\r\n     * @param {HTMLElement} element - Element to clear\r\n     */\r\n    clear(element) {\r\n        element.innerHTML = '';\r\n    }\r\n};\r\n\r\n","// Version: 1766175000 - ULTIMATE FIX: One-at-a-time classList.add()\r\n// DOMBuilder.js - Fluent API for DOM element creation\r\n// Reduces boilerplate in DOM manipulation code\r\n\r\nexport class DOMBuilder {\r\n    constructor(tag) {\r\n        this.element = document.createElement(tag);\r\n    }\r\n    \r\n    /**\r\n     * Set an attribute\r\n     * @param {string} key - Attribute name\r\n     * @param {string} value - Attribute value\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    attr(key, value) {\r\n        if (key === 'class' || key === 'className') {\r\n            this.element.className = value;\r\n        } else if (key === 'style' && typeof value === 'object') {\r\n            Object.assign(this.element.style, value);\r\n        } else if (key === 'dataset') {\r\n            Object.assign(this.element.dataset, value);\r\n        } else if (key === 'textContent') {\r\n            this.element.textContent = value;\r\n        } else if (key === 'innerHTML') {\r\n            this.element.innerHTML = value;\r\n        } else {\r\n            this.element.setAttribute(key, value);\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set multiple attributes at once\r\n     * @param {Object} attrs - Object of attribute key-value pairs\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    attrs(attrs) {\r\n        for (const [key, value] of Object.entries(attrs)) {\r\n            this.attr(key, value);\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set style (object or string)\r\n     * @param {Object|string} styles - Style object or CSS string\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    style(styles) {\r\n        if (typeof styles === 'string') {\r\n            this.element.style.cssText = styles;\r\n        } else if (typeof styles === 'object') {\r\n            Object.assign(this.element.style, styles);\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Add class(es)\r\n     * @param {string|Array<string>} className - Class name(s) to add\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    class(className) {\r\n        // DEFENSIVE: Skip if empty, undefined, null, or whitespace-only\r\n        // This is a safety check - should never receive empty strings, but handle it gracefully\r\n        \r\n        // LOGGING: Log the exact value received for debugging\r\n        // console.log('[DOMBuilder.class] Entry - className:', className, 'type:', typeof className, 'length:', className?.length, 'isFalsy:', !className, 'isNull:', className == null, 'isEmptyString:', className === '');\r\n        \r\n        // CRITICAL: Early return for all falsy values (null, undefined, false, 0, '', NaN)\r\n        // Empty string is falsy, so this should catch it\r\n        if (!className) {\r\n            // console.log('[DOMBuilder.class] Early return - falsy value (includes empty string)');\r\n            return this;\r\n        }\r\n        \r\n        // ADDITIONAL CHECK: Explicitly check for empty string (in case it's not caught above)\r\n        if (className === '' || (typeof className === 'string' && className.trim() === '')) {\r\n            // console.warn('[DOMBuilder.class] Early return - explicit empty string check');\r\n            return this;\r\n        }\r\n        \r\n        // Additional check: if it's a string, check if it's empty or whitespace-only\r\n        if (typeof className === 'string') {\r\n            // Check for empty string\r\n            if (className === '') {\r\n                // console.warn('[DOMBuilder.class] Empty string detected - returning early');\r\n                return this;\r\n            }\r\n            \r\n            const trimmed = className.trim();\r\n            // Only add if trimmed string has content\r\n            if (!trimmed || trimmed.length === 0) {\r\n                // console.warn('[DOMBuilder.class] Whitespace-only string detected - returning early');\r\n                return this;\r\n            }\r\n            \r\n            // console.log('[DOMBuilder.class] Processing string - trimmed:', trimmed, 'length:', trimmed.length);\r\n            \r\n            // Split by spaces in case multiple classes are passed\r\n            const classes = trimmed.split(/\\s+/).filter(c => {\r\n                // Filter out empty strings and whitespace-only strings\r\n                if (!c || typeof c !== 'string') return false;\r\n                const trimmedC = c.trim();\r\n                return trimmedC.length > 0;\r\n            }).map(c => c.trim());\r\n            \r\n            // Final safety check: ensure no empty strings in the array\r\n            const validClasses = classes.filter(c => {\r\n                // Triple-check: must be string, not empty, and have length > 0\r\n                return c && \r\n                       typeof c === 'string' && \r\n                       c !== '' && \r\n                       c.trim().length > 0;\r\n            }).map(c => c.trim()).filter(c => c.length > 0);\r\n            \r\n            if (validClasses.length > 0) {\r\n                // Final validation before calling classList.add\r\n                const safeClasses = validClasses.filter(c => {\r\n                    if (!c || typeof c !== 'string' || c === '' || c.trim() === '') {\r\n                        // console.warn('[DOMBuilder] Filtering out invalid class:', c);\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n                \r\n                if (safeClasses.length > 0) {\r\n                    // FINAL SAFETY: Filter out any empty strings one more time\r\n                    const finalSafeClasses = safeClasses.filter(c => {\r\n                        const isValid = c && \r\n                                       typeof c === 'string' && \r\n                                       c !== '' && \r\n                                       c.trim() !== '' &&\r\n                                       c.trim().length > 0;\r\n                        if (!isValid) {\r\n                            // console.warn('[DOMBuilder.class] Final filter removing invalid class:', c);\r\n                        }\r\n                        return isValid;\r\n                    }).map(c => c.trim());\r\n                    \r\n                    if (finalSafeClasses.length > 0) {\r\n                        // console.log('[DOMBuilder.class] Attempting to add classes:', finalSafeClasses);\r\n                        // CRITICAL: Add classes one at a time instead of using spread operator\r\n                        // This prevents empty strings from causing errors\r\n                        finalSafeClasses.forEach(c => {\r\n                            const trimmed = String(c).trim();\r\n                            // ULTIMATE SAFETY: Triple-check before calling classList.add\r\n                            if (trimmed && \r\n                                typeof trimmed === 'string' && \r\n                                trimmed !== '' && \r\n                                trimmed.length > 0 &&\r\n                                trimmed.trim().length > 0) {\r\n                                try {\r\n                                    // LAST RESORT: Check one more time right before calling\r\n                                    const finalCheck = trimmed.trim();\r\n                                    if (finalCheck && finalCheck.length > 0) {\r\n                                        this.element.classList.add(finalCheck);\r\n                                        // console.log('[DOMBuilder.class] Successfully added class:', finalCheck);\r\n                                    } else {\r\n                                        // console.error('[DOMBuilder.class] CRITICAL: finalCheck failed for:', trimmed);\r\n                                    }\r\n                                } catch (err) {\r\n                                    // console.error('[DOMBuilder.class] Failed to add class:', trimmed, 'error:', err, 'stack:', err.stack);\r\n                                    // Don't throw - just log and continue\r\n                                }\r\n                            } else {\r\n                                // console.warn('[DOMBuilder.class] Skipping empty/invalid class:', c, 'trimmed:', trimmed);\r\n                            }\r\n                        });\r\n                        // console.log('[DOMBuilder.class] Finished adding classes');\r\n                    } else {\r\n                        // console.warn('[DOMBuilder.class] No valid classes after final filtering');\r\n                    }\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n        \r\n        // Handle array case\r\n        if (Array.isArray(className)) {\r\n            // Filter out empty strings and whitespace-only strings\r\n            const validClasses = className\r\n                .filter(c => c != null && typeof c === 'string' && c.trim().length > 0)\r\n                .map(c => c.trim())\r\n                .filter(c => c.length > 0);\r\n            if (validClasses.length > 0) {\r\n                // Add classes one at a time to prevent empty string errors\r\n                validClasses.forEach(c => {\r\n                    const trimmed = String(c).trim();\r\n                    // ULTIMATE SAFETY: Triple-check before calling classList.add\r\n                    if (trimmed && \r\n                        typeof trimmed === 'string' && \r\n                        trimmed !== '' && \r\n                        trimmed.length > 0 &&\r\n                        trimmed.trim().length > 0) {\r\n                        try {\r\n                            // LAST RESORT: Check one more time right before calling\r\n                            const finalCheck = trimmed.trim();\r\n                            if (finalCheck && finalCheck.length > 0) {\r\n                                this.element.classList.add(finalCheck);\r\n                                // console.log('[DOMBuilder.class] Successfully added class from array:', finalCheck);\r\n                            } else {\r\n                                // console.error('[DOMBuilder.class] CRITICAL: finalCheck failed for array item:', trimmed);\r\n                            }\r\n                        } catch (err) {\r\n                            // console.error('[DOMBuilder.class] Failed to add class from array:', trimmed, 'error:', err, 'stack:', err.stack);\r\n                            // Don't throw - just log and continue\r\n                        }\r\n                    } else {\r\n                        // console.warn('[DOMBuilder.class] Skipping empty/invalid class from array:', c, 'trimmed:', trimmed);\r\n                    }\r\n                });\r\n            }\r\n            return this;\r\n        }\r\n        \r\n        // If we get here, className is an unexpected type - just return silently\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Remove class(es)\r\n     * @param {string|Array<string>} className - Class name(s) to remove\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    removeClass(className) {\r\n        if (Array.isArray(className)) {\r\n            this.element.classList.remove(...className);\r\n        } else {\r\n            this.element.classList.remove(className);\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set text content\r\n     * @param {string} text - Text content\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    text(text) {\r\n        this.element.textContent = text;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set HTML content\r\n     * @param {string} html - HTML content\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    html(html) {\r\n        this.element.innerHTML = html;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Append a child element\r\n     * @param {HTMLElement|DOMBuilder|string} child - Child element, builder, or text\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    child(child) {\r\n        if (child instanceof DOMBuilder) {\r\n            this.element.appendChild(child.build());\r\n        } else if (child instanceof HTMLElement || child instanceof Text) {\r\n            this.element.appendChild(child);\r\n        } else if (typeof child === 'string') {\r\n            this.element.appendChild(document.createTextNode(child));\r\n        }\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Append multiple children\r\n     * @param {Array<HTMLElement|DOMBuilder|string>} children - Array of children\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    children(children) {\r\n        children.forEach(child => this.child(child));\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Add event listener\r\n     * @param {string} event - Event type\r\n     * @param {Function} handler - Event handler\r\n     * @param {Object} options - Event options\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    on(event, handler, options = {}) {\r\n        this.element.addEventListener(event, handler, options);\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set data attribute\r\n     * @param {string} key - Data attribute key (without 'data-' prefix)\r\n     * @param {string} value - Data attribute value\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    data(key, value) {\r\n        this.element.dataset[key] = value;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set multiple data attributes\r\n     * @param {Object} data - Object of data attribute key-value pairs\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    dataset(data) {\r\n        Object.assign(this.element.dataset, data);\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set property\r\n     * @param {string} key - Property name\r\n     * @param {*} value - Property value\r\n     * @returns {DOMBuilder} This builder for chaining\r\n     */\r\n    prop(key, value) {\r\n        this.element[key] = value;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Build and return the element\r\n     * @returns {HTMLElement} The constructed element\r\n     */\r\n    build() {\r\n        return this.element;\r\n    }\r\n    \r\n    /**\r\n     * Static helper to create a builder\r\n     * @param {string} tag - HTML tag name\r\n     * @returns {DOMBuilder} New builder instance\r\n     */\r\n    static create(tag) {\r\n        return new DOMBuilder(tag);\r\n    }\r\n}\r\n\r\n// Force reload - 1766172537\r\n// CRITICAL FIX 1766174868\r\n","// ModalBuilder.js - Standardized modal creation utility\r\n// Reduces boilerplate in modal creation code\r\n// Version: 1766175000\r\n\r\nimport { DOMBuilder } from './DOMBuilder.js?v=103';\r\nimport { StringUtils } from './string.js';\r\n\r\nexport class ModalBuilder {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this.modal = null;\r\n        this.modalContent = null;\r\n        this.modalBody = null;\r\n        this.title = '';\r\n        this.content = '';\r\n        this.buttons = [];\r\n        this.inputs = [];\r\n        this.size = { width: 'auto', height: 'auto' };\r\n        this.onCloseHandler = null;\r\n        this.closable = true;\r\n        this.id = StringUtils.generateId('modal');\r\n    }\r\n    \r\n    /**\r\n     * Set modal title\r\n     * @param {string} title - Modal title\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    setTitle(title) {\r\n        this.title = title;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set modal body content\r\n     * @param {string|HTMLElement} content - Content (HTML string or element)\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    setContent(content) {\r\n        this.content = content;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Add a button to the modal\r\n     * @param {string} text - Button text\r\n     * @param {Function} handler - Click handler\r\n     * @param {Object} options - Button options\r\n     * @param {string} options.class - Button CSS class\r\n     * @param {boolean} options.primary - Whether button is primary (default: false)\r\n     * @param {boolean} options.closeOnClick - Whether to close modal on click (default: true)\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    addButton(text, handler, options = {}) {\r\n        const {\r\n            class: className = '',\r\n            primary = false,\r\n            closeOnClick = true\r\n        } = options;\r\n        \r\n        console.log('[ModalBuilder.addButton] Entry - text:', text, 'className:', className, 'type:', typeof className, 'primary:', primary, 'options:', options);\r\n        \r\n        // Clean up className - remove empty strings and whitespace-only strings\r\n        // CRITICAL: Never allow empty string to be stored - always use null\r\n        let finalClassName = null; // Use null instead of empty string\r\n        \r\n        if (primary) {\r\n            // If className is empty or whitespace, just use 'primary'\r\n            if (className && typeof className === 'string' && className.trim()) {\r\n                const combined = `primary ${className.trim()}`.trim();\r\n                finalClassName = combined || 'primary';\r\n            } else {\r\n                finalClassName = 'primary';\r\n            }\r\n        } else if (className && typeof className === 'string') {\r\n            const trimmed = className.trim();\r\n            // Only set if trimmed has actual content - NEVER set to empty string\r\n            if (trimmed && trimmed.length > 0) {\r\n                finalClassName = trimmed;\r\n            }\r\n            // If trimmed is empty, finalClassName stays null (not empty string)\r\n        }\r\n        // If className is empty string '', finalClassName stays null\r\n        // If className is null/undefined, finalClassName stays null\r\n        \r\n        console.log('[ModalBuilder.addButton] finalClassName:', finalClassName, 'type:', typeof finalClassName, 'isNull:', finalClassName === null, 'isEmptyString:', finalClassName === '', 'willStore:', finalClassName);\r\n        \r\n        // FINAL SAFETY CHECK: Never push empty string\r\n        if (finalClassName === '') {\r\n            console.error('[ModalBuilder.addButton] CRITICAL: finalClassName is empty string! Setting to null.');\r\n            finalClassName = null;\r\n        }\r\n        \r\n        this.buttons.push({\r\n            text,\r\n            handler,\r\n            className: finalClassName, // Store null if no valid class, NEVER empty string\r\n            closeOnClick\r\n        });\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Add an input field to the modal\r\n     * @param {string} id - Input ID\r\n     * @param {string} label - Input label\r\n     * @param {string} type - Input type (default: 'text')\r\n     * @param {*} value - Initial value\r\n     * @param {Object} options - Input options\r\n     * @param {string} options.placeholder - Placeholder text\r\n     * @param {boolean} options.required - Whether input is required\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    addInput(id, label, type = 'text', value = '', options = {}) {\r\n        const {\r\n            placeholder = '',\r\n            required = false\r\n        } = options;\r\n        \r\n        this.inputs.push({\r\n            id,\r\n            label,\r\n            type,\r\n            value,\r\n            placeholder,\r\n            required\r\n        });\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set modal size\r\n     * @param {string|number} width - Modal width\r\n     * @param {string|number} height - Modal height\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    setSize(width, height) {\r\n        this.size = { width, height };\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set close handler\r\n     * @param {Function} handler - Handler function called when modal closes\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    onClose(handler) {\r\n        this.onCloseHandler = handler;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set whether modal is closable\r\n     * @param {boolean} closable - Whether modal can be closed (default: true)\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    setClosable(closable) {\r\n        this.closable = closable;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Set modal ID\r\n     * @param {string} id - Modal ID\r\n     * @returns {ModalBuilder} This builder for chaining\r\n     */\r\n    setId(id) {\r\n        this.id = id;\r\n        return this;\r\n    }\r\n    \r\n    /**\r\n     * Build and show the modal\r\n     * @returns {HTMLElement} The modal element\r\n     */\r\n    show() {\r\n        // Get or create modal container\r\n        let modal = document.getElementById('modal');\r\n        if (!modal) {\r\n            modal = DOMBuilder.create('div')\r\n                .attr('id', 'modal')\r\n                .class('modal')\r\n                .build();\r\n            document.body.appendChild(modal);\r\n        }\r\n        \r\n        // Create modal content\r\n        const modalContent = DOMBuilder.create('div')\r\n            .class('modal-content')\r\n            .build();\r\n        \r\n        // Set size if specified\r\n        if (this.size.width !== 'auto') {\r\n            modalContent.style.width = typeof this.size.width === 'number' \r\n                ? `${this.size.width}px` \r\n                : this.size.width;\r\n        }\r\n        if (this.size.height !== 'auto') {\r\n            modalContent.style.height = typeof this.size.height === 'number' \r\n                ? `${this.size.height}px` \r\n                : this.size.height;\r\n        }\r\n        \r\n        // Add close button if closable\r\n        if (this.closable) {\r\n            const closeBtn = DOMBuilder.create('span')\r\n                .class('modal-close')\r\n                .text('')\r\n                .on('click', () => this.close())\r\n                .build();\r\n            modalContent.appendChild(closeBtn);\r\n        }\r\n        \r\n        // Add title if provided\r\n        if (this.title) {\r\n            const titleElement = DOMBuilder.create('h3')\r\n                .text(this.title)\r\n                .build();\r\n            modalContent.appendChild(titleElement);\r\n        }\r\n        \r\n        // Create modal body\r\n        const modalBody = DOMBuilder.create('div')\r\n            .attr('id', 'modal-body')\r\n            .build();\r\n        \r\n        // Add inputs\r\n        this.inputs.forEach(input => {\r\n            const inputContainer = DOMBuilder.create('div')\r\n                .class('modal-input-group')\r\n                .build();\r\n            \r\n            if (input.label) {\r\n                const label = DOMBuilder.create('label')\r\n                    .attr('for', input.id)\r\n                    .text(input.label)\r\n                    .build();\r\n                inputContainer.appendChild(label);\r\n            }\r\n            \r\n            const inputElement = DOMBuilder.create('input')\r\n                .attr('id', input.id)\r\n                .attr('type', input.type)\r\n                .attr('value', input.value)\r\n                .attr('placeholder', input.placeholder)\r\n                .attr('required', input.required)\r\n                .build();\r\n            \r\n            inputContainer.appendChild(inputElement);\r\n            modalBody.appendChild(inputContainer);\r\n        });\r\n        \r\n        // Add content\r\n        if (this.content) {\r\n            if (typeof this.content === 'string') {\r\n                const contentDiv = DOMBuilder.create('div')\r\n                    .html(this.content)\r\n                    .build();\r\n                modalBody.appendChild(contentDiv);\r\n            } else if (this.content instanceof HTMLElement) {\r\n                modalBody.appendChild(this.content);\r\n            }\r\n        }\r\n        \r\n        // Add buttons\r\n        if (this.buttons.length > 0) {\r\n            const buttonContainer = DOMBuilder.create('div')\r\n                .class('modal-buttons')\r\n                .build();\r\n            \r\n            this.buttons.forEach((button, index) => {\r\n                console.log('[ModalBuilder.show] Processing button', index, '- text:', button.text, 'className:', button.className, 'type:', typeof button.className, 'isNull:', button.className === null, 'isEmptyString:', button.className === '');\r\n                \r\n                const btn = DOMBuilder.create('button');\r\n                \r\n                // CRITICAL: Only add class if it exists, is not empty, and has non-whitespace content\r\n                // Multiple safety checks to prevent any empty strings from reaching DOMBuilder\r\n                const className = button.className;\r\n                \r\n                // SAFETY CHECK: If somehow we got an empty string, convert to null\r\n                if (className === '') {\r\n                    console.error('[ModalBuilder.show] CRITICAL: button.className is empty string! Skipping class addition.');\r\n                    // Don't call btn.class() at all\r\n                } else if (className && \r\n                    typeof className === 'string' && \r\n                    className !== '' &&\r\n                    className.trim().length > 0) {\r\n                    const trimmed = className.trim();\r\n                    // Final check before calling class()\r\n                    if (trimmed && trimmed.length > 0) {\r\n                        console.log('[ModalBuilder.show] Calling btn.class() with:', trimmed);\r\n                        btn.class(trimmed);\r\n                    } else {\r\n                        console.warn('[ModalBuilder.show] Skipping btn.class() - trimmed is empty');\r\n                    }\r\n                } else {\r\n                    console.log('[ModalBuilder.show] Skipping btn.class() - className is null/undefined/empty');\r\n                }\r\n                \r\n                const btnElement = btn.text(button.text)\r\n                    .on('click', (e) => {\r\n                        if (button.handler) {\r\n                            button.handler(e);\r\n                        }\r\n                        if (button.closeOnClick) {\r\n                            this.close();\r\n                        }\r\n                    })\r\n                    .build();\r\n                buttonContainer.appendChild(btnElement);\r\n            });\r\n            \r\n            modalBody.appendChild(buttonContainer);\r\n        }\r\n        \r\n        modalContent.appendChild(modalBody);\r\n        modal.innerHTML = '';\r\n        modal.appendChild(modalContent);\r\n        \r\n        // Store references\r\n        this.modal = modal;\r\n        this.modalContent = modalContent;\r\n        this.modalBody = modalBody;\r\n        \r\n        // Show modal\r\n        modal.classList.add('active');\r\n        \r\n        // Focus first input if available\r\n        if (this.inputs.length > 0) {\r\n            setTimeout(() => {\r\n                const firstInput = modalBody.querySelector('input');\r\n                if (firstInput) {\r\n                    firstInput.focus();\r\n                    firstInput.select();\r\n                }\r\n            }, 50);\r\n        }\r\n        \r\n        // Setup click outside to close\r\n        if (this.closable) {\r\n            const clickOutsideHandler = (e) => {\r\n                if (e.target === modal) {\r\n                    this.close();\r\n                }\r\n            };\r\n            modal.addEventListener('click', clickOutsideHandler);\r\n            this._clickOutsideHandler = clickOutsideHandler;\r\n        }\r\n        \r\n        return modal;\r\n    }\r\n    \r\n    /**\r\n     * Close the modal\r\n     */\r\n    close() {\r\n        if (this.modal) {\r\n            this.modal.classList.remove('active');\r\n            \r\n            // Remove click outside handler\r\n            if (this._clickOutsideHandler) {\r\n                this.modal.removeEventListener('click', this._clickOutsideHandler);\r\n                this._clickOutsideHandler = null;\r\n            }\r\n            \r\n            // Call close handler\r\n            if (this.onCloseHandler) {\r\n                this.onCloseHandler();\r\n            }\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get the modal element\r\n     * @returns {HTMLElement|null} Modal element\r\n     */\r\n    getModal() {\r\n        return this.modal;\r\n    }\r\n    \r\n    /**\r\n     * Get the modal body element\r\n     * @returns {HTMLElement|null} Modal body element\r\n     */\r\n    getBody() {\r\n        return this.modalBody;\r\n    }\r\n}\r\n\r\n","// ModalService.js - Handles modal business logic\r\n// Extracted from ModalHandler to separate business logic from UI\r\n\r\n/**\r\n * ModalService - Handles business logic for modals\r\n * \r\n * This class is responsible for:\r\n * - Processing form data\r\n * - Interacting with data managers\r\n * - Business rule enforcement\r\n * - Data transformations\r\n */\r\nexport class ModalService {\r\n    constructor() {\r\n    }\r\n    \r\n    /**\r\n     * Process element data from form\r\n     * @param {Object} formData - Raw form data\r\n     * @returns {Object} Processed element data\r\n     */\r\n    processElementData(formData) {\r\n        // Process and transform form data into element structure\r\n        // This is a placeholder - actual implementation will extract from ModalHandler\r\n        return formData;\r\n    }\r\n\r\n    applyTextUpdate({ element, newText, undoRedoManager, pageId, binId, elementIndex }) {\r\n        if (!element) {\r\n            return;\r\n        }\r\n        const oldText = element.text || '';\r\n        const nextText = (newText ?? '').trim();\r\n        if (oldText !== nextText && undoRedoManager) {\r\n            undoRedoManager.recordElementPropertyChange(pageId, binId, elementIndex, 'text', nextText, oldText);\r\n        }\r\n        element.text = nextText;\r\n    }\r\n\r\n    applyElementEditUpdates({ element, updates, undoRedoManager, pageId, binId, elementIndex }) {\r\n        if (!element || !updates) {\r\n            return;\r\n        }\r\n\r\n        if (updates.text !== undefined) {\r\n            this.applyTextUpdate({\r\n                element,\r\n                newText: updates.text,\r\n                undoRedoManager,\r\n                pageId,\r\n                binId,\r\n                elementIndex\r\n            });\r\n        }\r\n\r\n        if (updates.progressEnabled !== undefined) {\r\n            if (updates.progressEnabled) {\r\n                element.progress = parseInt(updates.progressValue, 10) || 0;\r\n            } else {\r\n                delete element.progress;\r\n            }\r\n        }\r\n\r\n        if (updates.recurringEnabled !== undefined) {\r\n            if (updates.recurringEnabled) {\r\n                element.recurringSchedule = updates.recurringSchedule;\r\n                if (updates.recurringSchedule === 'custom') {\r\n                    element.recurringCustomPattern = (updates.recurringCustomPattern || '').trim();\r\n                } else {\r\n                    delete element.recurringCustomPattern;\r\n                }\r\n            } else {\r\n                delete element.recurringSchedule;\r\n                delete element.recurringCustomPattern;\r\n            }\r\n        }\r\n\r\n        if (updates.deadlineEnabled !== undefined) {\r\n            if (updates.deadlineEnabled && updates.deadlineDate) {\r\n                const timeValue = updates.deadlineTime || '00:00';\r\n                element.deadline = `${updates.deadlineDate}T${timeValue}:00`;\r\n            } else {\r\n                delete element.deadline;\r\n            }\r\n        }\r\n\r\n        if (updates.persistentEnabled !== undefined) {\r\n            if (updates.persistentEnabled) {\r\n                element.persistent = true;\r\n            } else if (element.type !== 'image') {\r\n                delete element.persistent;\r\n            }\r\n        }\r\n\r\n        if (updates.timeEnabled !== undefined) {\r\n            if (updates.timeEnabled) {\r\n                element.timeAllocated = (updates.timeValue || '').trim();\r\n            } else {\r\n                element.timeAllocated = '';\r\n            }\r\n        } else if (updates.timeValue !== undefined) {\r\n            element.timeAllocated = (updates.timeValue || '').trim();\r\n        }\r\n\r\n        if (updates.funEnabled !== undefined) {\r\n            if (updates.funEnabled) {\r\n                element.funModifier = (updates.funValue || '').trim();\r\n            } else {\r\n                element.funModifier = '';\r\n            }\r\n        } else if (updates.funValue !== undefined) {\r\n            element.funModifier = (updates.funValue || '').trim();\r\n        }\r\n\r\n        if (updates.repeatsEnabled !== undefined) {\r\n            element.repeats = updates.repeatsEnabled;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Process page data from form\r\n     * @param {Object} formData - Raw form data\r\n     * @returns {Object} Processed page data\r\n     */\r\n    processPageData(formData) {\r\n        return formData;\r\n    }\r\n    \r\n    /**\r\n     * Process bin data from form\r\n     * @param {Object} formData - Raw form data\r\n     * @returns {Object} Processed bin data\r\n     */\r\n    processBinData(formData) {\r\n        return formData;\r\n    }\r\n}\r\n","// ModalRenderer.js - Handles modal UI rendering (DOM manipulation)\r\n// Extracted from ModalHandler to separate UI concerns from business logic\r\nimport { StringUtils } from '../../utils/string.js';\r\nimport { DOMUtils } from '../../utils/dom.js';\r\nimport { ModalBuilder } from '../../utils/ModalBuilder.js?v=103';\r\nimport { DOMBuilder } from '../../utils/DOMBuilder.js?v=103';\r\n\r\n/**\r\n * ModalRenderer - Handles all modal DOM rendering\r\n * \r\n * This class is responsible for:\r\n * - Creating modal DOM structures\r\n * - Rendering modal content\r\n * - Managing modal visibility\r\n * - DOM manipulation for modals\r\n */\r\nexport class ModalRenderer {\r\n    constructor() {\r\n        this.modal = document.getElementById('modal');\r\n        this.modalContent = this.modal?.querySelector('.modal-content');\r\n    }\r\n    \r\n    /**\r\n     * Show modal\r\n     */\r\n    show() {\r\n        if (this.modal) {\r\n            this.modal.classList.add('active');\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Hide modal\r\n     */\r\n    hide() {\r\n        if (this.modal) {\r\n            this.modal.classList.remove('active');\r\n            this.modal.style.display = 'none';\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Set modal content HTML\r\n     * @param {string} html - HTML content\r\n     */\r\n    setContent(html) {\r\n        if (this.modalContent) {\r\n            this.modalContent.innerHTML = html;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get modal body element\r\n     * @returns {HTMLElement|null}\r\n     */\r\n    getModalBody() {\r\n        return document.getElementById('modal-body');\r\n    }\r\n    \r\n    /**\r\n     * Escape HTML for safe rendering\r\n     * @param {string} text - Text to escape\r\n     * @returns {string}\r\n     */\r\n    escapeHtml(text) {\r\n        return StringUtils.escapeHtml(text);\r\n    }\r\n    \r\n    /**\r\n     * Render element type options HTML\r\n     * @param {Array} options - Array of {key, type, label}\r\n     * @returns {string} HTML string\r\n     */\r\n    renderElementTypeOptions(options) {\r\n        return options.map(opt => {\r\n            const keyDisplay = opt.key.toUpperCase();\r\n            return `<div class=\"element-type-option\" data-type=\"${opt.type}\" data-key=\"${opt.key}\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>${keyDisplay}</strong> - ${this.escapeHtml(opt.label)}</div>`;\r\n        }).join('');\r\n    }\r\n    \r\n    /**\r\n     * Setup close button handler\r\n     * @param {Function} onClose - Close handler function\r\n     */\r\n    setupCloseButton(onClose) {\r\n        const closeBtn = this.modalContent?.querySelector('.modal-close');\r\n        if (closeBtn) {\r\n            closeBtn.onclick = onClose;\r\n        }\r\n    }\r\n}\r\n","// ModalHandler - Handles all modal dialogs\nimport { StringUtils } from '../utils/string.js';\nimport { DOMUtils } from '../utils/dom.js';\nimport { ModalBuilder } from '../utils/ModalBuilder.js?v=103';\nimport { DOMBuilder } from '../utils/DOMBuilder.js?v=103';\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\nimport { ModalService } from './modal/ModalService.js';\nimport { ModalRenderer } from './modal/ModalRenderer.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class ModalHandler {\n    constructor() {\n        this.modalService = new ModalService();\n        this.modalRenderer = new ModalRenderer();\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n\n    _getDocument(pageId) {\n        const appState = this._getAppState();\n        return appState.documents?.find(page => page.id === pageId) || null;\n    }\n\n    _getGroup(pageId, binId) {\n        const document = this._getDocument(pageId);\n        const group = document?.groups?.find(bin => bin.id === binId) || null;\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return group;\n    }\n    \n    _getElementTypeManager() {\n        return getService(SERVICES.ELEMENT_TYPE_MANAGER);\n    }\n    \n    _getElementManager() {\n        return getService(SERVICES.ELEMENT_MANAGER);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    _getUndoRedoManager() {\n        return getService(SERVICES.UNDO_REDO_MANAGER);\n    }\n    \n    _getTagManager() {\n        return getService(SERVICES.TAG_MANAGER);\n    }\n    \n    _getFileManager() {\n        return getService(SERVICES.FILE_MANAGER);\n    }\n    \n    _getFormatRendererManager() {\n        return getService(SERVICES.FORMAT_RENDERER_MANAGER);\n    }\n    \n    _getPagePluginManager() {\n        return getService(SERVICES.PAGE_PLUGIN_MANAGER);\n    }\n    \n    _getBinPluginManager() {\n        return getService(SERVICES.BIN_PLUGIN_MANAGER);\n    }\n    \n    _getVisualSettingsManager() {\n        return getService(SERVICES.VISUAL_SETTINGS_MANAGER);\n    }\n    \n    _getThemeManager() {\n        return getService(SERVICES.THEME_MANAGER);\n    }\n    \n    _getSettingsManager() {\n        return getService(SERVICES.SETTINGS_MANAGER);\n    }\n    \n    _getApp() {\n        // Try to get app from window (set during initialization)\n        return window.app || null;\n    }\n    \n    escapeHtml(text) {\n        return StringUtils.escapeHtml(text);\n    }\n    \n    showAddElementModal(pageId, binId, elementIndex = null) {\n        // Show modal with keyboard listener for immediate selection\n        // Base types (always available)\n        const baseTypes = {\n            '1': 'task',\n            '2': 'header',\n            '3': 'header-checkbox',\n            '4': 'multi-checkbox',\n            '5': 'audio',\n            '6': 'one-time',\n            '7': 'timer',\n            '8': 'counter',\n            '9': 'tracker',\n            '0': 'rating',\n            'q': 'time-log',\n            'i': 'image',\n            'c': 'calendar'\n        };\n        \n        // Get all registered element types from ElementTypeManager\n        // Convert baseTypes object to Map entries\n        const allElementTypes = new Map(Object.entries(baseTypes));\n        const elementTypeManager = this._getElementTypeManager();\n        if (elementTypeManager) {\n            const registeredTypes = elementTypeManager.getAllElementTypes();\n            registeredTypes.forEach(plugin => {\n                if (plugin.keyboardShortcut && plugin.elementType) {\n                    allElementTypes.set(plugin.keyboardShortcut.toLowerCase(), plugin.elementType);\n                }\n            });\n        }\n        \n        // Build element type options HTML\n        const baseOptions = [\n            { key: '1', type: 'task', label: 'Task' },\n            { key: '2', type: 'header-checkbox', label: 'Header' },\n            { key: '3', type: 'header-checkbox', label: 'Header with Checkbox' },\n            { key: '4', type: 'multi-checkbox', label: 'Multi-checkbox' },\n            { key: '5', type: 'audio', label: 'Audio' },\n            { key: '6', type: 'one-time', label: 'One-time Task' },\n            { key: '7', type: 'timer', label: 'Timer' },\n            { key: '8', type: 'counter', label: 'Counter' },\n            { key: '9', type: 'tracker', label: 'Tracker' },\n            { key: '0', type: 'rating', label: 'Rating' },\n            { key: 'q', type: 'time-log', label: 'Time Log' },\n            { key: 'i', type: 'image', label: 'Image' },\n            { key: 'c', type: 'calendar', label: 'Calendar' }\n        ];\n        \n        // Add registered element types\n        const registeredOptions = [];\n        // Reuse elementTypeManager from line 63\n        if (elementTypeManager) {\n            const registeredTypes = elementTypeManager.getAllElementTypes();\n            registeredTypes.forEach(plugin => {\n                if (plugin.keyboardShortcut && plugin.elementType && plugin.name) {\n                    // Check if not already in base types\n                    if (!baseTypes[plugin.keyboardShortcut.toLowerCase()]) {\n                        registeredOptions.push({\n                            key: plugin.keyboardShortcut.toLowerCase(),\n                            type: plugin.elementType,\n                            label: plugin.name\n                        });\n                    }\n                }\n            });\n        }\n        \n        // Sort registered options by keyboard shortcut\n        registeredOptions.sort((a, b) => a.key.localeCompare(b.key));\n        \n        // Combine all options\n        const allOptions = [...baseOptions, ...registeredOptions];\n        \n        // Generate options HTML\n        const optionsHTML = allOptions.map(opt => {\n            const keyDisplay = opt.key.toUpperCase();\n            return `<div class=\"element-type-option\" data-type=\"${opt.type}\" data-key=\"${opt.key}\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>${keyDisplay}</strong> - ${this.escapeHtml(opt.label)}</div>`;\n        }).join('');\n        \n        const modal = document.getElementById('modal');\n        const modalContent = modal.querySelector('.modal-content');\n        \n        // Set up modal structure with count display and scrollable body\n        modalContent.innerHTML = `\n            <div id=\"element-count-display\" style=\"position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 36px; font-weight: bold; color: rgb(74, 158, 255); pointer-events: none; user-select: none; display: none; z-index: 2001; text-shadow: rgba(0, 0, 0, 0.8) 0px 2px 8px; background: rgba(45, 45, 45, 0.95); padding: 8px 16px; border-radius: 8px; border: 2px solid rgb(74, 158, 255); min-width: 60px; text-align: center;\">1</div>\n            <span class=\"modal-close\"></span>\n            <div id=\"modal-body\" style=\"max-height: 70vh; overflow-y: auto; padding-right: 10px;\">\n                <h3>Add Element</h3>\n                <p style=\"margin-bottom: 15px;\">Press a key, click, or drag to set count:</p>\n                <div style=\"margin: 10px 0;\" id=\"element-type-options\">\n                    ${optionsHTML}\n                </div>\n                <div style=\"margin-top: 20px;\">\n                    <button class=\"cancel\" onclick=\"app.modalHandler.closeModal()\">Cancel</button>\n                </div>\n            </div>\n        `;\n        \n        modal.classList.add('active');\n        \n        // Get modalBody AFTER setting innerHTML\n        const modalBody = document.getElementById('modal-body');\n        \n        // Store original closeModal\n        const originalCloseModal = this.closeModal.bind(this);\n        const app = this._getApp();\n        \n        // Track element count for drag functionality\n        let elementCount = 1;\n        \n        // Get count display element (now part of the HTML structure)\n        const countDisplay = document.getElementById('element-count-display');\n        \n        // Re-attach close button handler\n        const closeBtn = modalContent.querySelector('.modal-close');\n        if (closeBtn) {\n            closeBtn.onclick = () => {\n                document.removeEventListener('keydown', keyHandler);\n                app.modalHandler.closeModal = originalCloseModal;\n                app.modalHandler.closeModal();\n            };\n        }\n        \n        // Capture elementIndex in a local variable to preserve it in closure\n        const capturedElementIndex = elementIndex;\n        \n        // Click handler for numbered options\n        const handleOptionClick = (type, count = 1) => {\n            document.removeEventListener('keydown', keyHandler);\n            if (!app) {\n                console.error('[ModalHandler] app is undefined in handleOptionClick');\n                this.closeModal();\n                return;\n            }\n            app.modalHandler.closeModal = originalCloseModal;\n            app.modalHandler.closeModal();\n            \n            // Track the first element created for editing\n            let firstElementIndex = null;\n            let firstElement = null;\n            let currentInsertIndex = capturedElementIndex; // Use captured value\n            \n            // Add multiple elements\n            const page = (app.appState?.documents || app.documents || []).find(p => p.id === pageId);\n            if (!page) return;\n            const bin = page.groups?.find(b => b.id === binId);\n            if (!bin) return;\n            const items = bin.items || [];\n            bin.items = items;\n            \n            if (capturedElementIndex !== null) {\n                // Add after the specified element\n                for (let i = 0; i < count; i++) {\n                    const newElement = app.elementManager.createElementTemplate(type);\n                    const insertIndex = currentInsertIndex + 1;\n                    items.splice(insertIndex, 0, newElement);\n                    if (i === 0) {\n                        // First element - remember for editing\n                        firstElementIndex = insertIndex;\n                        firstElement = newElement;\n                    }\n                    // Update currentInsertIndex for subsequent elements (they're being inserted after each other)\n                    currentInsertIndex++;\n                }\n            } else {\n                // Add at the end\n                const startIndex = items.length;\n                for (let i = 0; i < count; i++) {\n                    const newElement = app.elementManager.createElementTemplate(type);\n                    items.push(newElement);\n                    if (i === 0) {\n                        // First element - remember for editing\n                        firstElementIndex = startIndex;\n                        firstElement = newElement;\n                    }\n                }\n            }\n            \n            // Save and render\n            app.dataManager.saveData();\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            \n            // Open edit modal for the first element (if any were created)\n            if (firstElementIndex !== null && firstElement) {\n                // Store multi-edit state if multiple elements were created\n                if (count > 1) {\n                    app.multiEditState = {\n                        pageId: pageId,\n                        binId: binId,\n                        startIndex: firstElementIndex,\n                        endIndex: firstElementIndex + count - 1,\n                        currentIndex: firstElementIndex\n                    };\n                } else {\n                    app.multiEditState = null;\n                }\n                \n                setTimeout(() => {\n                    app.modalHandler.showEditModal(pageId, binId, firstElementIndex, firstElement);\n                    // Focus on the text input\n                    setTimeout(() => {\n                        const textInput = document.getElementById('edit-text');\n                        if (textInput) {\n                            textInput.focus();\n                            textInput.select();\n                        }\n                    }, 50);\n                }, 50);\n            }\n        };\n        \n        // Drag state tracking\n        let dragState = {\n            active: false,\n            startX: 0,\n            startCount: 1,\n            currentType: null,\n            pixelsPerElement: 20\n        };\n        \n        // Track if mouseup already handled the action (to prevent click handler from firing)\n        let handledByMouseUp = false;\n        \n        // Helper to get X coordinate from mouse or touch event\n        const getClientX = (e) => {\n            if (e.touches && e.touches.length > 0) {\n                return e.touches[0].clientX;\n            }\n            if (e.changedTouches && e.changedTouches.length > 0) {\n                return e.changedTouches[0].clientX;\n            }\n            return e.clientX;\n        };\n        \n        // Global mouse/touch move handler for dragging\n        const globalMove = (e) => {\n            if (!dragState.active) return;\n            \n            const currentX = getClientX(e);\n            const deltaX = currentX - dragState.startX;\n            const countChange = Math.round(deltaX / dragState.pixelsPerElement);\n            const newCount = Math.max(1, Math.min(10, dragState.startCount + countChange)); // Cap at 10\n            \n            if (newCount !== elementCount) {\n                elementCount = newCount;\n                countDisplay.textContent = elementCount;\n            }\n        };\n        \n        // Global mouse/touch up handler for dragging\n        const globalUp = (e) => {\n            if (!dragState.active) return;\n            \n            handledByMouseUp = true; // Mark that we handled it (set before any async operations)\n            \n            const currentX = getClientX(e);\n            const wasDragging = Math.abs(currentX - dragState.startX) > 5;\n            const type = dragState.currentType;\n            \n            // Capture the count BEFORE resetting it\n            const finalCount = elementCount;\n            \n            // Reset drag state immediately\n            dragState.active = false;\n            dragState.startX = 0;\n            dragState.currentType = null;\n            countDisplay.style.display = 'none';\n            elementCount = 1;\n            \n            // Remove global listeners (both mouse and touch)\n            document.removeEventListener('mousemove', globalMove);\n            document.removeEventListener('mouseup', globalUp);\n            document.removeEventListener('touchmove', globalMove);\n            document.removeEventListener('touchend', globalUp);\n            \n            // Find the key for this type\n            let typeKey = null;\n            for (const [key, value] of allElementTypes.entries()) {\n                if (value === type) {\n                    typeKey = key;\n                    break;\n                }\n            }\n            \n            if (type && typeKey && allElementTypes.has(typeKey)) {\n                if (wasDragging) {\n                    // Dragged - use the captured count\n                    handleOptionClick(type, finalCount);\n                } else {\n                    // Just clicked/tapped - add 1 element\n                    handleOptionClick(type, 1);\n                }\n            }\n            \n            // Reset handledByMouseUp flag after a short delay to allow click event to check it\n            setTimeout(() => {\n                handledByMouseUp = false;\n            }, 100);\n        };\n        \n        // Helper to start drag/touch interaction\n        const startDrag = (e, type, key) => {\n            if (!type || !allElementTypes.has(key)) {\n                return;\n            }\n            \n            // Reset the handled flag\n            handledByMouseUp = false;\n            \n            // Get starting X coordinate\n            const startX = getClientX(e);\n            \n            // Initialize drag state\n            dragState.active = true;\n            dragState.startX = startX;\n            dragState.startCount = 1;\n            dragState.currentType = type;\n            elementCount = 1;\n            \n            // Show count display\n            countDisplay.style.display = 'block';\n            countDisplay.textContent = '1';\n            \n            // Add global listeners (both mouse and touch)\n            document.addEventListener('mousemove', globalMove);\n            document.addEventListener('mouseup', globalUp);\n            document.addEventListener('touchmove', globalMove, { passive: false });\n            document.addEventListener('touchend', globalUp);\n            \n            // Prevent text selection and default behavior\n            e.preventDefault();\n            e.stopPropagation();\n        };\n        \n        // Add click and drag listeners to numbered options\n        modalBody.querySelectorAll('.element-type-option').forEach(option => {\n            const type = option.dataset.type;\n            const key = option.dataset.key;\n            \n            // Mouse down handler\n            option.addEventListener('mousedown', (e) => {\n                startDrag(e, type, key);\n            });\n            \n            // Touch start handler (for mobile)\n            option.addEventListener('touchstart', (e) => {\n                startDrag(e, type, key);\n            }, { passive: false });\n            \n            // Click handler (for non-drag clicks - will be handled by mouseup/touchend if no drag occurred)\n            option.addEventListener('click', (e) => {\n                // Only handle click if mouseup/touchend didn't already handle it\n                // Check both dragState.active (should be false) and handledByMouseUp flag\n                if (handledByMouseUp) {\n                    // Mouseup/touchend already handled this, prevent duplicate creation\n                    e.preventDefault();\n                    e.stopPropagation();\n                    return;\n                }\n                \n                // Fallback: if for some reason mouseup/touchend didn't fire or handle it, handle click here\n                // But only if dragState is not active (meaning we're not in a drag operation)\n                if (!dragState.active) {\n                    if (type && key && allElementTypes.has(key)) {\n                        handleOptionClick(type, 1);\n                    }\n                }\n            });\n        });\n        \n        // Keyboard listener for immediate selection\n        const keyHandler = (e) => {\n            const key = e.key.toLowerCase();\n            if (allElementTypes.has(key)) {\n                e.preventDefault();\n                e.stopPropagation();\n                document.removeEventListener('keydown', keyHandler);\n                // Use handleOptionClick for consistency (adds 1 element on keyboard press)\n                handleOptionClick(allElementTypes.get(key), 1);\n            } else if (e.key === 'Escape') {\n                e.preventDefault();\n                e.stopPropagation();\n                document.removeEventListener('keydown', keyHandler);\n                // Restore original closeModal before closing\n                app.modalHandler.closeModal = originalCloseModal;\n                app.modalHandler.closeModal();\n            }\n        };\n        \n        document.addEventListener('keydown', keyHandler);\n        \n        // Override closeModal to clean up listener when modal is closed by other means\n        this.closeModal = () => {\n            document.removeEventListener('keydown', keyHandler);\n            // Restore original closeModal\n            app.modalHandler.closeModal = originalCloseModal;\n            originalCloseModal();\n        };\n    }\n    \n    showAddChildElementModal(pageId, binId, elementIndex) {\n        // Similar to showAddElementModal but adds to children instead\n        const types = {\n            '1': 'task',\n            '2': 'header',\n            '3': 'header-checkbox',\n            '4': 'multi-checkbox',\n            '5': 'audio',\n            '6': 'one-time',\n            '7': 'timer',\n            '8': 'counter',\n            '9': 'tracker',\n            '0': 'rating',\n            'q': 'time-log'\n        };\n        \n        const modal = document.getElementById('modal');\n        const modalContent = modal.querySelector('.modal-content');\n        const modalBody = document.getElementById('modal-body');\n        \n        // Set up modal structure with count display (same as showAddElementModal)\n        modalContent.innerHTML = `\n            <div id=\"element-count-display\" style=\"position: absolute; top: 10px; left: 50%; transform: translateX(-50%); font-size: 36px; font-weight: bold; color: rgb(74, 158, 255); pointer-events: none; user-select: none; display: none; z-index: 2001; text-shadow: rgba(0, 0, 0, 0.8) 0px 2px 8px; background: rgba(45, 45, 45, 0.95); padding: 8px 16px; border-radius: 8px; border: 2px solid rgb(74, 158, 255); min-width: 60px; text-align: center;\">1</div>\n            <span class=\"modal-close\"></span>\n            <div id=\"modal-body\">\n                <h3>Add Child Element</h3>\n                <p style=\"margin-bottom: 15px;\">Press a number key, click, or drag to set count:</p>\n                <div style=\"margin: 10px 0;\">\n                    <div class=\"element-type-option\" data-type=\"task\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>1</strong> - Task</div>\n                    <div class=\"element-type-option\" data-type=\"header-checkbox\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>2</strong> - Header</div>\n                    <div class=\"element-type-option\" data-type=\"header-checkbox\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>3</strong> - Header with Checkbox</div>\n                    <div class=\"element-type-option\" data-type=\"multi-checkbox\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>4</strong> - Multi-checkbox</div>\n                    <div class=\"element-type-option\" data-type=\"audio\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>5</strong> - Audio</div>\n                    <div class=\"element-type-option\" data-type=\"one-time\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>6</strong> - One-time Task</div>\n                    <div class=\"element-type-option\" data-type=\"timer\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>7</strong> - Timer</div>\n                    <div class=\"element-type-option\" data-type=\"counter\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>8</strong> - Counter</div>\n                    <div class=\"element-type-option\" data-type=\"tracker\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>9</strong> - Tracker</div>\n                    <div class=\"element-type-option\" data-type=\"rating\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>0</strong> - Rating</div>\n                    <div class=\"element-type-option\" data-type=\"time-log\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>Q</strong> - Time Log</div>\n                    <div class=\"element-type-option\" data-type=\"image\" style=\"padding: 5px; cursor: pointer; user-select: none;\"><strong>I</strong> - Image</div>\n                </div>\n                <div style=\"margin-top: 20px;\">\n                    <button class=\"cancel\" onclick=\"app.modalHandler.closeModal()\">Cancel</button>\n                </div>\n            </div>\n        `;\n        \n        modal.classList.add('active');\n        \n        // Store original closeModal\n        const originalCloseModal = this.closeModal.bind(this);\n        const app = this._getApp();\n        \n        // Track element count for drag functionality\n        let elementCount = 1;\n        \n        // Get count display element (now part of the HTML structure)\n        const countDisplay = document.getElementById('element-count-display');\n        \n        // Re-attach close button handler\n        const closeBtn = modalContent.querySelector('.modal-close');\n        if (closeBtn) {\n            closeBtn.onclick = () => {\n                document.removeEventListener('keydown', keyHandler);\n                app.modalHandler.closeModal = originalCloseModal;\n                app.modalHandler.closeModal();\n            };\n        }\n        \n        // Click handler for numbered options\n        const handleOptionClick = (type, count = 1) => {\n            document.removeEventListener('keydown', keyHandler);\n            if (!app) {\n                console.error('[ModalHandler] app is undefined in handleOptionClick');\n                this.closeModal();\n                return;\n            }\n            app.modalHandler.closeModal = originalCloseModal;\n            app.modalHandler.closeModal();\n            \n            const page = (app.appState?.documents || app.documents || []).find(p => p.id === pageId);\n            if (!page) return;\n            const bin = page.groups?.find(b => b.id === binId);\n            if (!bin) return;\n            const items = bin.items || [];\n            bin.items = items;\n            const element = ItemHierarchy.getRootItemAtIndex(items, elementIndex);\n            if (!element) return;\n            \n            if (!Array.isArray(element.childIds)) {\n                element.childIds = [];\n            }\n            \n            // Add multiple child elements\n            for (let i = 0; i < count; i++) {\n                const newChild = app.elementManager.createElementTemplate(type);\n                if (!newChild.id) {\n                    newChild.id = `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\n                }\n                newChild.parentId = element.id;\n                newChild.childIds = Array.isArray(newChild.childIds) ? newChild.childIds : [];\n                element.childIds.push(newChild.id);\n                items.push(newChild);\n            }\n            \n            app.dataManager.saveData();\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        };\n        \n        // Drag state tracking\n        let dragState = {\n            active: false,\n            startX: 0,\n            startCount: 1,\n            currentType: null,\n            pixelsPerElement: 20\n        };\n        \n        // Track if mouseup already handled the action (to prevent click handler from firing)\n        let handledByMouseUp = false;\n        \n        // Helper to get X coordinate from mouse or touch event\n        const getClientX = (e) => {\n            if (e.touches && e.touches.length > 0) {\n                return e.touches[0].clientX;\n            }\n            if (e.changedTouches && e.changedTouches.length > 0) {\n                return e.changedTouches[0].clientX;\n            }\n            return e.clientX;\n        };\n        \n        // Global mouse/touch move handler for dragging\n        const globalMove = (e) => {\n            if (!dragState.active) return;\n            \n            const currentX = getClientX(e);\n            const deltaX = currentX - dragState.startX;\n            const countChange = Math.round(deltaX / dragState.pixelsPerElement);\n            const newCount = Math.max(1, Math.min(10, dragState.startCount + countChange)); // Cap at 10\n            \n            if (newCount !== elementCount) {\n                elementCount = newCount;\n                countDisplay.textContent = elementCount;\n                countDisplay.style.display = 'block';\n            }\n        };\n        \n        // Global mouse/touch up handler for dragging\n        const globalUp = (e) => {\n            if (!dragState.active) return;\n            \n            handledByMouseUp = true; // Mark that we handled it (set before any async operations)\n            \n            const currentX = getClientX(e);\n            const wasDragging = Math.abs(currentX - dragState.startX) > 5;\n            const type = dragState.currentType;\n            \n            // Capture the count BEFORE resetting it\n            const finalCount = elementCount;\n            \n            // Reset drag state immediately\n            dragState.active = false;\n            dragState.startX = 0;\n            dragState.currentType = null;\n            countDisplay.style.display = 'none';\n            elementCount = 1;\n            \n            // Remove global listeners (both mouse and touch)\n            document.removeEventListener('mousemove', globalMove);\n            document.removeEventListener('mouseup', globalUp);\n            document.removeEventListener('touchmove', globalMove);\n            document.removeEventListener('touchend', globalUp);\n            \n            if (type && types[Object.keys(types).find(k => types[k] === type)]) {\n                if (wasDragging) {\n                    // Dragged - use the captured count\n                    handleOptionClick(type, finalCount);\n                } else {\n                    // Just clicked/tapped - add 1 element\n                    handleOptionClick(type, 1);\n                }\n            }\n            \n            // Reset handledByMouseUp flag after a short delay to allow click event to check it\n            setTimeout(() => {\n                handledByMouseUp = false;\n            }, 100);\n        };\n        \n        // Keyboard handler\n        const keyHandler = (e) => {\n            if (types[e.key]) {\n                e.preventDefault();\n                handleOptionClick(types[e.key], 1);\n            } else if (e.key === 'Escape') {\n                document.removeEventListener('keydown', keyHandler);\n                app.modalHandler.closeModal = originalCloseModal;\n                app.modalHandler.closeModal();\n            }\n        };\n        document.addEventListener('keydown', keyHandler);\n        \n        // Helper to start drag/touch interaction for child elements\n        const startDragChild = (e, type) => {\n            if (!type) {\n                return;\n            }\n            \n            // Reset the handled flag\n            handledByMouseUp = false;\n            \n            // Get starting X coordinate\n            const startX = getClientX(e);\n            \n            // Initialize drag state\n            dragState.active = true;\n            dragState.startX = startX;\n            dragState.startCount = elementCount;\n            dragState.currentType = type;\n            elementCount = 1;\n            countDisplay.textContent = '1';\n            countDisplay.style.display = 'block';\n            \n            // Add global listeners (both mouse and touch)\n            document.addEventListener('mousemove', globalMove);\n            document.addEventListener('mouseup', globalUp);\n            document.addEventListener('touchmove', globalMove, { passive: false });\n            document.addEventListener('touchend', globalUp);\n            \n            // Prevent text selection and default behavior\n            e.preventDefault();\n            e.stopPropagation();\n        };\n        \n        // Click and drag handlers for each option\n        modalBody.querySelectorAll('.element-type-option').forEach(option => {\n            const type = option.dataset.type;\n            \n            // Mouse down handler\n            option.addEventListener('mousedown', (e) => {\n                startDragChild(e, type);\n            });\n            \n            // Touch start handler (for mobile)\n            option.addEventListener('touchstart', (e) => {\n                startDragChild(e, type);\n            }, { passive: false });\n            \n            option.addEventListener('click', (e) => {\n                // Only handle click if it wasn't already handled by mouseup/touchend (drag)\n                if (handledByMouseUp) {\n                    return;\n                }\n                const type = option.dataset.type;\n                handleOptionClick(type, 1);\n                document.removeEventListener('keydown', keyHandler);\n            });\n        });\n    }\n    \n    /**\n     * Show an alert dialog (replaces browser alert)\n     * @param {string} message - Message to display\n     * @returns {Promise<void>}\n     */\n    async showAlert(message) {\n        return new Promise((resolve) => {\n            const modalBodyHtml = `\n                <div style=\"padding: 20px; text-align: center;\">\n                    <p style=\"margin-bottom: 20px; color: #e0e0e0;\">${this.escapeHtml(message)}</p>\n                    <button onclick=\"app.modalHandler.closeModal(); app.modalHandler._alertResolve();\" \n                            style=\"padding: 10px 20px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                        OK\n                    </button>\n                </div>\n            `;\n            this.modalRenderer?.setContent(modalBodyHtml);\n            this.modalRenderer?.show();\n            this._alertResolve = resolve;\n        });\n    }\n    \n    /**\n     * Show a confirmation dialog (replaces browser confirm)\n     * @param {string} message - Message to display\n     * @returns {Promise<boolean>}\n     */\n    async showConfirm(message) {\n        return new Promise((resolve) => {\n            this._confirmResolve = resolve;\n            \n            const builder = new ModalBuilder(this.app)\n                .setTitle('Confirm')\n                .setContent(`<p style=\"margin-bottom: 20px; color: #e0e0e0; text-align: center;\">${this.escapeHtml(message)}</p>`)\n                .addButton('OK', () => {\n                    this._confirmResolve(true);\n                }, { primary: true })\n                .addButton('Cancel', () => {\n                    this._confirmResolve(false);\n                });\n            \n            builder.show();\n        });\n    }\n    \n    /**\n     * Show a prompt dialog (replaces browser prompt)\n     * @param {string} message - Message to display\n     * @param {string} defaultValue - Default input value\n     * @returns {Promise<string|null>}\n     */\n    async showPrompt(message, defaultValue = '') {\n        return new Promise((resolve) => {\n            const inputId = 'prompt-input-' + Date.now();\n            const modalBodyHtml = `\n                <div style=\"padding: 20px;\">\n                    <p style=\"margin-bottom: 15px; color: #e0e0e0;\">${this.escapeHtml(message)}</p>\n                    <input type=\"text\" id=\"${inputId}\" value=\"${this.escapeHtml(defaultValue)}\" \n                           style=\"width: 100%; padding: 8px; margin-bottom: 20px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; box-sizing: border-box;\" \n                           autofocus />\n                    <div style=\"display: flex; gap: 10px; justify-content: flex-end;\">\n                        <button onclick=\"app.modalHandler.closeModal(); app.modalHandler._promptResolve(null);\" \n                                style=\"padding: 10px 20px; background: #555; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                            Cancel\n                        </button>\n                        <button onclick=\"app.modalHandler._handlePromptSubmit('${inputId}');\" \n                                style=\"padding: 10px 20px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                            OK\n                        </button>\n                    </div>\n                </div>\n            `;\n            this.modalRenderer?.setContent(modalBodyHtml);\n            this.modalRenderer?.show();\n            this._promptResolve = resolve;\n            \n            // Focus input and handle Enter key\n            setTimeout(() => {\n                const input = document.getElementById(inputId);\n                if (input) {\n                    input.focus();\n                    input.select();\n                    input.addEventListener('keydown', (e) => {\n                        if (e.key === 'Enter') {\n                            this._handlePromptSubmit(inputId);\n                        }\n                    });\n                }\n            }, 100);\n        });\n    }\n    \n    _handlePromptSubmit(inputId) {\n        const input = document.getElementById(inputId);\n        const value = input ? input.value.trim() : null;\n        this.closeModal();\n        if (this._promptResolve) {\n            this._promptResolve(value || null);\n            this._promptResolve = null;\n        }\n    }\n    \n    closeModal() {\n        const modal = document.getElementById('modal');\n        if (modal) {\n            modal.classList.remove('active');\n        }\n        \n        // Clear current edit from app state\n        const appState = this._getAppState();\n        if (appState) {\n            if (appState.currentEdit !== undefined) {\n                appState.currentEdit = null;\n            }\n            if (appState.currentEditModal !== undefined) {\n                appState.currentEditModal = null;\n            }\n        }\n        \n        // Clean up format:registered event listeners\n        if (this._formatRegisteredHandlers && this._formatRegisteredHandlers.size > 0) {\n            this._formatRegisteredHandlers.forEach((handler, pageId) => {\n                eventBus.off('format:registered', handler);\n            });\n            this._formatRegisteredHandlers.clear();\n        }\n        \n        // Remove Enter key handler if it exists\n        if (this._currentEnterKeyHandler) {\n            document.removeEventListener('keydown', this._currentEnterKeyHandler, true);\n            this._currentEnterKeyHandler = null;\n        }\n    }\n    \n    showTooltip(text) {\n        const tooltip = document.getElementById('global-tooltip');\n        if (tooltip) {\n            tooltip.textContent = text;\n            tooltip.classList.add('visible');\n        }\n    }\n    \n    hideTooltip() {\n        const tooltip = document.getElementById('global-tooltip');\n        if (tooltip) {\n            tooltip.classList.remove('visible');\n        }\n    }\n    \n    showViewDataModal(element, isSubtask = false) {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        let html = `<h3>Element Data</h3>`;\n        html += `<div class=\"data-display\">`;\n        html += `<pre>${this.escapeHtml(JSON.stringify(element, null, 2))}</pre>`;\n        html += `</div>`;\n        html += `\n            <div style=\"margin-top: 20px;\">\n                <button class=\"cancel\" onclick=\"app.modalHandler.closeModal()\">Close</button>\n            </div>\n        `;\n        \n        modalBody.innerHTML = html;\n        modal.classList.add('active');\n        \n        // Add Enter key handler to close modal\n        const handleEnterKey = (e) => {\n            if (e.key === 'Enter') {\n                e.preventDefault();\n                this.closeModal();\n                document.removeEventListener('keydown', handleEnterKey);\n                const appState = this._getAppState();\n                if (appState) {\n                    appState.currentEnterKeyHandler = null;\n                }\n            }\n        };\n        document.addEventListener('keydown', handleEnterKey);\n        const appState = this._getAppState();\n        if (appState) {\n            appState.currentEnterKeyHandler = handleEnterKey;\n        }\n    }\n    \n    showEditModal(pageId, binId, elementIndex, element) {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        // Get bin to ensure it exists\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        \n        let html = ``;\n        \n        // Text field (only for elements that have text)\n        if (element.type === 'task' || element.type === 'header-checkbox' || element.type === 'audio' || element.type === 'timer' || \n            element.type === 'counter' || element.type === 'tracker' || element.type === 'rating' || element.type === 'time-log') {\n            // Show raw text for editing (preserve markdown/HTML as stored)\n            // If text contains HTML, extract plain text; otherwise show as-is (for markdown)\n            let editText = element.text || '';\n            \n            // If text contains HTML tags, extract plain text for editing\n            // Otherwise, show markdown/raw text as-is\n            if (/<[a-z][a-z0-9]*[^>]*>/i.test(editText)) {\n                // Contains HTML - extract plain text for editing\n                const tempDiv = document.createElement('div');\n                tempDiv.innerHTML = editText;\n                editText = tempDiv.textContent || tempDiv.innerText || editText;\n            }\n            // If it's markdown (like **bold**), show it as-is so user can edit the markdown\n            \n            html += `\n                <label>Text:</label>\n                <textarea id=\"edit-text\" style=\"width: 100%; min-height: 60px; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; font-family: inherit; resize: vertical;\">${this.escapeHtml(editText)}</textarea>\n            `;\n        }\n        \n        // Audio-specific fields\n        if (element.type === 'audio') {\n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Current Recording:</label>\n                    <div style=\"margin-top: 5px; color: #888; font-size: 12px;\">\n                        ${element.audioFile ? `File: ${element.audioFile}${element.date ? ` (${element.date})` : ''}` : 'No recording'}\n                    </div>\n                    <div style=\"margin-top: 10px; display: flex; gap: 8px;\">\n                        ${element.audioFile ? `\n                            <button onclick=\"window.app && window.app.modalHandler && window.app.modalHandler.overwriteAudioRecording('${pageId}', '${binId}', ${elementIndex})\" style=\"padding: 6px 12px; background: #ff5555; color: white; border: none; border-radius: 4px; cursor: pointer;\">Overwrite Recording</button>\n                        ` : ''}\n                        <button onclick=\"window.app && window.app.modalHandler && window.app.modalHandler.toggleArchiveViewInEdit('${pageId}', '${binId}', ${elementIndex})\" style=\"padding: 6px 12px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">View Archive</button>\n                    </div>\n                    <div id=\"archive-view-edit-${pageId}-${elementIndex}\" style=\"display: none; margin-top: 10px;\"></div>\n                </div>\n            `;\n        }\n        \n        // Counter-specific fields\n        if (element.type === 'counter') {\n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Counter Settings:</label>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Current Value:</label>\n                        <input type=\"number\" id=\"edit-counter-value\" value=\"${element.value || 0}\" style=\"width: 100px;\" />\n                    </div>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Increment +5:</label>\n                        <input type=\"number\" id=\"edit-counter-increment5\" value=\"${element.increment5 || 5}\" style=\"width: 100px;\" />\n                    </div>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Custom Increment:</label>\n                        <input type=\"number\" id=\"edit-counter-custom\" value=\"${element.customIncrement || 10}\" style=\"width: 100px;\" />\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Tracker-specific fields\n        if (element.type === 'tracker') {\n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Tracker Settings:</label>\n                    <div style=\"margin-top: 10px;\">\n                        <label style=\"display: flex; align-items: center; gap: 8px;\">\n                            <input type=\"radio\" name=\"tracker-mode-${pageId}-${elementIndex}\" value=\"daily\" ${element.mode === 'daily' || !element.mode ? 'checked' : ''} />\n                            <span>Daily (tracks completions per day, resets daily)</span>\n                        </label>\n                        <label style=\"display: flex; align-items: center; gap: 8px; margin-top: 5px;\">\n                            <input type=\"radio\" name=\"tracker-mode-${pageId}-${elementIndex}\" value=\"page\" ${element.mode === 'page' ? 'checked' : ''} />\n                            <span>Page (counts checked elements in page, each check counts once)</span>\n                        </label>\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Rating-specific fields\n        if (element.type === 'rating') {\n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Rating:</label>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Stars (0-5):</label>\n                        <input type=\"number\" id=\"edit-rating-stars\" min=\"0\" max=\"5\" value=\"${element.rating || 0}\" style=\"width: 100px;\" />\n                    </div>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Review:</label>\n                        <textarea id=\"edit-rating-review\" placeholder=\"Optional review...\" style=\"width: 100%; min-height: 60px;\">${this.escapeHtml(element.review || '')}</textarea>\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Timer-specific fields\n        if (element.type === 'timer') {\n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Timer Settings:</label>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Duration (seconds):</label>\n                        <input type=\"number\" id=\"edit-timer-duration\" value=\"${element.duration || 3600}\" min=\"1\" style=\"width: 100px;\" />\n                    </div>\n                    <div style=\"margin-top: 10px;\">\n                        <label>Alarm Sound:</label>\n                        <select id=\"edit-timer-alarm\" style=\"width: 200px;\">\n                            <option value=\"\" ${!element.alarmSound ? 'selected' : ''}>No Alarm</option>\n                            <option value=\"/sounds/alarm.mp3\" ${element.alarmSound === '/sounds/alarm.mp3' ? 'selected' : ''}>Default Alarm</option>\n                        </select>\n                    </div>\n                </div>\n            `;\n        }\n\n        // Time log doesn't need special fields in edit modal (controlled by buttons in UI)\n        \n        // Calendar-specific fields\n        if (element.type === 'calendar') {\n            const defaultTags = ['work', 'personal', 'urgent', 'important', 'meeting', 'deadline', 'chore', 'hobby'];\n            const allTags = [...new Set([...defaultTags, ...(element.targetTags || [])])];\n            \n            html += `\n                <div style=\"margin-top: 15px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600;\">Calendar Settings:</label>\n                    \n                    <div style=\"margin-top: 10px;\">\n                        <label>Display Mode:</label>\n                        <select id=\"edit-calendar-display-mode\" style=\"width: 200px; margin-left: 10px;\">\n                            <option value=\"current-date\" ${element.displayMode === 'current-date' ? 'selected' : ''}>Current Date & Summary</option>\n                            <option value=\"one-day\" ${element.displayMode === 'one-day' ? 'selected' : ''}>One Day (Scrollable)</option>\n                            <option value=\"week\" ${element.displayMode === 'week' ? 'selected' : ''}>Week View</option>\n                            <option value=\"month\" ${element.displayMode === 'month' ? 'selected' : ''}>Month View</option>\n                        </select>\n                    </div>\n                    \n                    <div style=\"margin-top: 15px;\">\n                        <label style=\"font-weight: 600;\">Targeting Mode:</label>\n                        <div style=\"margin-top: 5px;\">\n                            <label style=\"display: flex; align-items: center; gap: 8px;\">\n                                <input type=\"radio\" name=\"calendar-targeting-${pageId}-${elementIndex}\" value=\"default\" ${element.targetingMode === 'default' || !element.targetingMode ? 'checked' : ''} />\n                                <span>Default (all pages/bins)</span>\n                            </label>\n                            <label style=\"display: flex; align-items: center; gap: 8px; margin-top: 5px;\">\n                                <input type=\"radio\" name=\"calendar-targeting-${pageId}-${elementIndex}\" value=\"specific\" ${element.targetingMode === 'specific' ? 'checked' : ''} />\n                                <span>Specific (pages/bins/elements)</span>\n                            </label>\n                            <label style=\"display: flex; align-items: center; gap: 8px; margin-top: 5px;\">\n                                <input type=\"radio\" name=\"calendar-targeting-${pageId}-${elementIndex}\" value=\"tags\" ${element.targetingMode === 'tags' ? 'checked' : ''} />\n                                <span>Tags (automated selection)</span>\n                            </label>\n                        </div>\n                    </div>\n                    \n                    <div id=\"edit-calendar-specific-options\" style=\"margin-top: 10px; ${element.targetingMode === 'specific' ? '' : 'display: none;'}\">\n                        <div style=\"margin-top: 10px;\">\n                            <label>Target Pages:</label>\n                            <div id=\"edit-calendar-target-pages\" style=\"margin-top: 5px;\">\n                                ${(element.targetPages || []).map(pageId => `\n                                    <div style=\"display: flex; gap: 5px; margin-bottom: 5px;\">\n                                        <select class=\"calendar-target-page\" style=\"flex: 1;\">\n                                            ${(app.appState?.documents || app.documents || []).map(p => `<option value=\"${p.id}\" ${p.id === pageId ? 'selected' : ''}>${p.title || p.id}</option>`).join('')}\n                                        </select>\n                                        <button type=\"button\" class=\"remove-target-page\" style=\"padding: 2px 8px; background: #ff5555; color: white; border: none; border-radius: 4px; cursor: pointer;\"></button>\n                                    </div>\n                                `).join('')}\n                                <button type=\"button\" id=\"add-target-page-btn\" style=\"padding: 5px 10px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 5px;\">+ Add Page</button>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div id=\"edit-calendar-tags-options\" style=\"margin-top: 10px; ${element.targetingMode === 'tags' ? '' : 'display: none;'}\">\n                        <div style=\"margin-top: 10px;\">\n                            <label>Target Tags:</label>\n                            <div id=\"edit-calendar-target-tags\" style=\"margin-top: 5px; display: flex; flex-wrap: wrap; gap: 5px;\">\n                                ${(element.targetTags || []).map(tag => `\n                                    <span style=\"display: inline-flex; align-items: center; gap: 5px; padding: 3px 8px; background: #4a9eff; color: white; border-radius: 12px; font-size: 12px;\">\n                                        ${this.escapeHtml(tag)}\n                                        <button type=\"button\" class=\"remove-tag\" data-tag=\"${this.escapeHtml(tag)}\" style=\"background: transparent; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: 14px; line-height: 1;\"></button>\n                                    </span>\n                                `).join('')}\n                            </div>\n                            <div style=\"margin-top: 10px;\">\n                                <label>Available Tags:</label>\n                                <div style=\"display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;\">\n                                    ${allTags.map(tag => `\n                                        <button type=\"button\" class=\"add-tag-btn\" data-tag=\"${this.escapeHtml(tag)}\" \n                                                style=\"padding: 3px 8px; background: ${(element.targetTags || []).includes(tag) ? '#555' : '#2a2a2a'}; color: #e0e0e0; border: 1px solid #555; border-radius: 12px; cursor: pointer; font-size: 12px;\"\n                                                ${(element.targetTags || []).includes(tag) ? 'disabled' : ''}>\n                                            ${this.escapeHtml(tag)}\n                                        </button>\n                                    `).join('')}\n                                </div>\n                                <div style=\"margin-top: 10px;\">\n                                    <input type=\"text\" id=\"new-tag-input\" placeholder=\"Add custom tag\" style=\"width: 150px; padding: 5px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                                    <button type=\"button\" id=\"add-custom-tag-btn\" style=\"padding: 5px 10px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px;\">Add</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Tags section (available for all element types)\n        const tagManager = this._getTagManager();\n        const defaultTags = tagManager ? tagManager.getDefaultTags() : ['work', 'personal', 'urgent', 'important', 'meeting', 'deadline', 'chore', 'hobby'];\n        const allTags = tagManager ? tagManager.getAvailableTags() : [...new Set([...defaultTags, ...(element.tags || [])])];\n        \n        html += `\n            <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Tags:</label>\n                <div id=\"edit-element-tags\" style=\"margin-top: 5px; display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px;\">\n                    ${(element.tags || []).map(tag => `\n                        <span style=\"display: inline-flex; align-items: center; gap: 5px; padding: 3px 8px; background: #4a9eff; color: white; border-radius: 12px; font-size: 12px;\">\n                            ${this.escapeHtml(tag)}\n                            <button type=\"button\" class=\"remove-element-tag\" data-tag=\"${this.escapeHtml(tag)}\" style=\"background: transparent; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: 14px; line-height: 1;\"></button>\n                        </span>\n                    `).join('')}\n                </div>\n                <div style=\"margin-top: 10px;\">\n                    <label>Available Tags:</label>\n                    <div style=\"display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;\">\n                        ${allTags.map(tag => `\n                            <button type=\"button\" class=\"add-element-tag-btn\" data-tag=\"${this.escapeHtml(tag)}\" \n                                    style=\"padding: 3px 8px; background: ${(element.tags || []).includes(tag) ? '#555' : '#2a2a2a'}; color: #e0e0e0; border: 1px solid #555; border-radius: 12px; cursor: pointer; font-size: 12px;\"\n                                    ${(element.tags || []).includes(tag) ? 'disabled' : ''}>\n                                ${this.escapeHtml(tag)}\n                            </button>\n                        `).join('')}\n                    </div>\n                    <div style=\"margin-top: 10px;\">\n                        <input type=\"text\" id=\"new-element-tag-input\" placeholder=\"Add custom tag\" style=\"width: 150px; padding: 5px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                        <button type=\"button\" id=\"add-custom-element-tag-btn\" style=\"padding: 5px 10px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px;\">Add</button>\n                    </div>\n                </div>\n            </div>\n        `;\n        \n        // Custom Properties section (if element has custom properties or plugin is enabled)\n        const elementTypeManager = this._getElementTypeManager();\n        if (element.customProperties || elementTypeManager) {\n            html += `\n                <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                    <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Custom Properties:</label>\n                    <div id=\"custom-properties-list\" style=\"margin-bottom: 10px;\">\n            `;\n            \n            if (element.customProperties && Object.keys(element.customProperties).length > 0) {\n                Object.keys(element.customProperties).forEach(key => {\n                    html += `\n                        <div class=\"custom-property-item\" style=\"display: flex; gap: 10px; margin-bottom: 10px; padding: 8px; background: #1a1a1a; border-radius: 4px; align-items: center;\">\n                            <input type=\"text\" class=\"custom-property-key\" value=\"${this.escapeHtml(key)}\" placeholder=\"Property name\" style=\"flex: 1; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <input type=\"text\" class=\"custom-property-value\" value=\"${this.escapeHtml(element.customProperties[key])}\" placeholder=\"Property value\" style=\"flex: 1; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <button type=\"button\" class=\"remove-custom-property-btn\" style=\"padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;\">Remove</button>\n                        </div>\n                    `;\n                });\n            } else {\n                html += '<p style=\"color: #888; font-size: 12px;\">No custom properties</p>';\n            }\n            \n            html += `\n                    </div>\n                    <button type=\"button\" id=\"add-custom-property-btn\" style=\"padding: 6px 12px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">\n                        + Add Property\n                    </button>\n                </div>\n            `;\n        }\n        \n        // Plugins section (available for all element types)\n        const hasTimeAllocated = element.timeAllocated && element.timeAllocated.trim() !== '';\n        const hasFunModifier = element.funModifier && element.funModifier.trim() !== '';\n        const hasRepeats = element.repeats !== false;\n        \n        html += `\n            <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Plugins:</label>\n                <div style=\"display: flex; align-items: center; gap: 20px; flex-wrap: wrap;\">\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-progress\" ${element.progress !== undefined ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Progress Bar</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-recurring\" ${element.recurringSchedule ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Recurring Schedule</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-deadline\" ${element.deadline ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Deadline</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-persistent\" ${element.persistent || element.type === 'image' ? 'checked' : ''} ${element.type === 'image' ? 'disabled' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Persistent${element.type === 'image' ? ' (always on for images)' : ''}</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-time\" ${hasTimeAllocated ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Time Allocated</span>\n                    </label>\n                    ${element.type !== 'header-checkbox' ? `\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-fun\" ${hasFunModifier ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Fun Modifier</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                        <input type=\"checkbox\" id=\"edit-plugin-repeats\" ${hasRepeats ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                        <span>Reset Daily</span>\n                    </label>\n                    ` : ''}\n                </div>\n                \n                <!-- Progress Bar options -->\n                <div id=\"edit-plugin-progress-options\" style=\"margin-top: 10px; ${element.progress === undefined ? 'display: none;' : ''}\">\n                    <label>Progress (0-100%):</label>\n                    <input type=\"number\" id=\"edit-progress-value\" min=\"0\" max=\"100\" value=\"${element.progress || 0}\" style=\"width: 100px;\" />\n                </div>\n                \n                <!-- Recurring Schedule options -->\n                <div id=\"edit-plugin-recurring-options\" style=\"margin-top: 10px; ${!element.recurringSchedule ? 'display: none;' : ''}\">\n                    <label>Schedule:</label>\n                    <select id=\"edit-recurring-schedule\" style=\"width: 150px;\">\n                        <option value=\"daily\" ${element.recurringSchedule === 'daily' ? 'selected' : ''}>Daily</option>\n                        <option value=\"weekly\" ${element.recurringSchedule === 'weekly' ? 'selected' : ''}>Weekly</option>\n                        <option value=\"monthly\" ${element.recurringSchedule === 'monthly' ? 'selected' : ''}>Monthly</option>\n                        <option value=\"custom\" ${element.recurringSchedule === 'custom' ? 'selected' : ''}>Custom</option>\n                    </select>\n                    <div id=\"edit-recurring-custom\" style=\"margin-top: 5px; ${element.recurringSchedule === 'custom' ? '' : 'display: none;'}\">\n                        <label>Custom Pattern (e.g., \"every 3 days\"):</label>\n                        <input type=\"text\" id=\"edit-recurring-custom-pattern\" value=\"${element.recurringCustomPattern || ''}\" placeholder=\"every 3 days\" />\n                    </div>\n                </div>\n                \n                <!-- Deadline options -->\n                <div id=\"edit-plugin-deadline-options\" style=\"margin-top: 10px; ${!element.deadline ? 'display: none;' : ''}\">\n                    <label>Date:</label>\n                    <input type=\"date\" id=\"edit-deadline-date\" value=\"${element.deadline ? element.deadline.split('T')[0] : ''}\" style=\"width: 150px;\" />\n                    <label style=\"margin-left: 10px;\">Time:</label>\n                    <input type=\"time\" id=\"edit-deadline-time\" value=\"${element.deadline ? element.deadline.split('T')[1]?.substring(0, 5) || '' : ''}\" style=\"width: 100px;\" />\n                </div>\n                \n                <!-- Time Allocated options -->\n                <div id=\"edit-plugin-time-options\" style=\"margin-top: 10px; ${!hasTimeAllocated ? 'display: none;' : ''}\">\n                    <label>Time Allocated:</label>\n                    <input type=\"text\" id=\"edit-time\" value=\"${this.escapeHtml(element.timeAllocated || '')}\" \n                           placeholder=\"e.g., 30 min+ or 20 min\" />\n                </div>\n                \n                <!-- Fun Modifier options -->\n                ${element.type !== 'header-checkbox' ? `\n                <div id=\"edit-plugin-fun-options\" style=\"margin-top: 10px; ${!hasFunModifier ? 'display: none;' : ''}\">\n                    <label>Fun Modifier:</label>\n                    <textarea id=\"edit-fun\" placeholder=\"How to make this task fun\">${this.escapeHtml(element.funModifier || '')}</textarea>\n                </div>\n                ` : ''}\n            </div>\n        `;\n        \n        // For multi-checkbox, show items editor\n        if (element.type === 'multi-checkbox' && element.items) {\n            html += `<label style=\"margin-top: 15px;\">Items:</label>`;\n            html += `<div id=\"edit-items\">`;\n            element.items.forEach((item, idx) => {\n                html += `\n                    <div class=\"subtask-item\">\n                        <input type=\"text\" class=\"edit-item-text\" data-index=\"${idx}\" \n                               value=\"${this.escapeHtml(item.text)}\" />\n                        <input type=\"text\" class=\"edit-item-fun\" data-index=\"${idx}\" \n                               value=\"${this.escapeHtml(item.funModifier || '')}\" placeholder=\"Fun modifier\" />\n                        <button data-remove-item=\"${idx}\"></button>\n                    </div>\n                `;\n            });\n            html += `</div>`;\n            html += `<button onclick=\"app.modalHandler.addEditItem()\" style=\"margin-top: 10px;\">+ Add Item</button>`;\n        }\n        \n        html += `\n            <div style=\"margin-top: 20px;\">\n                <button id=\"edit-save-btn\">Save</button>\n                <button class=\"cancel\" id=\"edit-cancel-btn\">Cancel</button>\n            </div>\n        `;\n        \n        modalBody.innerHTML = html;\n        modal.classList.add('active');\n        \n        // Attach event listeners to save and cancel buttons\n        const saveBtn = document.getElementById('edit-save-btn');\n        const cancelBtn = document.getElementById('edit-cancel-btn');\n        const addItemBtn = document.getElementById('add-edit-item-btn');\n        if (saveBtn) {\n            saveBtn.addEventListener('click', () => {\n                this.saveEdit(pageId, binId, elementIndex);\n            });\n        }\n        if (cancelBtn) {\n            cancelBtn.addEventListener('click', () => {\n                this.closeModal();\n            });\n        }\n        if (addItemBtn) {\n            addItemBtn.addEventListener('click', () => {\n                this.addEditItem();\n            });\n        }\n        \n        // Attach event listeners to remove item buttons (they're created dynamically)\n        // Use event delegation since items are added dynamically\n        const itemsContainer = document.getElementById('edit-items');\n        if (itemsContainer) {\n            itemsContainer.addEventListener('click', (e) => {\n                if (e.target.hasAttribute('data-remove-item')) {\n                    const idx = parseInt(e.target.getAttribute('data-remove-item'));\n                    this.removeEditItem(idx);\n                }\n            });\n        }\n        \n        // Set up plugin checkbox event handlers\n        const progressCheckbox = document.getElementById('edit-plugin-progress');\n        if (progressCheckbox) {\n            progressCheckbox.addEventListener('change', (e) => {\n                const optionsDiv = document.getElementById('edit-plugin-progress-options');\n                if (optionsDiv) {\n                    optionsDiv.style.display = e.target.checked ? 'block' : 'none';\n                }\n            });\n        }\n        \n        const recurringCheckbox = document.getElementById('edit-plugin-recurring');\n        if (recurringCheckbox) {\n            recurringCheckbox.addEventListener('change', (e) => {\n                const optionsDiv = document.getElementById('edit-plugin-recurring-options');\n                if (optionsDiv) {\n                    optionsDiv.style.display = e.target.checked ? 'block' : 'none';\n                }\n            });\n        }\n        \n        const deadlineCheckbox = document.getElementById('edit-plugin-deadline');\n        if (deadlineCheckbox) {\n            deadlineCheckbox.addEventListener('change', (e) => {\n                const optionsDiv = document.getElementById('edit-plugin-deadline-options');\n                if (optionsDiv) {\n                    optionsDiv.style.display = e.target.checked ? 'block' : 'none';\n                }\n            });\n        }\n        \n        const timeCheckbox = document.getElementById('edit-plugin-time');\n        if (timeCheckbox) {\n            timeCheckbox.addEventListener('change', (e) => {\n                const optionsDiv = document.getElementById('edit-plugin-time-options');\n                if (optionsDiv) {\n                    optionsDiv.style.display = e.target.checked ? 'block' : 'none';\n                }\n            });\n        }\n        \n        const funCheckbox = document.getElementById('edit-plugin-fun');\n        if (funCheckbox) {\n            funCheckbox.addEventListener('change', (e) => {\n                const optionsDiv = document.getElementById('edit-plugin-fun-options');\n                if (optionsDiv) {\n                    optionsDiv.style.display = e.target.checked ? 'block' : 'none';\n                }\n            });\n        }\n        \n        // Recurring schedule change handler (for custom pattern visibility)\n        const recurringScheduleSelect = document.getElementById('edit-recurring-schedule');\n        if (recurringScheduleSelect) {\n            recurringScheduleSelect.addEventListener('change', (e) => {\n                const customDiv = document.getElementById('edit-recurring-custom');\n                if (customDiv) {\n                    customDiv.style.display = e.target.value === 'custom' ? 'block' : 'none';\n                }\n            });\n        }\n        \n        // Calendar-specific event listeners\n        if (element.type === 'calendar') {\n            // Targeting mode radio buttons\n            const targetingRadios = document.querySelectorAll(`input[name=\"calendar-targeting-${pageId}-${elementIndex}\"]`);\n            targetingRadios.forEach(radio => {\n                radio.addEventListener('change', (e) => {\n                    const specificDiv = document.getElementById('edit-calendar-specific-options');\n                    const tagsDiv = document.getElementById('edit-calendar-tags-options');\n                    if (specificDiv) specificDiv.style.display = e.target.value === 'specific' ? 'block' : 'none';\n                    if (tagsDiv) tagsDiv.style.display = e.target.value === 'tags' ? 'block' : 'none';\n                });\n            });\n            \n            // Add target page button\n            const addPageBtn = document.getElementById('add-target-page-btn');\n            if (addPageBtn) {\n                addPageBtn.addEventListener('click', () => {\n                    const container = document.getElementById('edit-calendar-target-pages');\n                    const newDiv = document.createElement('div');\n                    newDiv.style.display = 'flex';\n                    newDiv.style.gap = '5px';\n                    newDiv.style.marginBottom = '5px';\n                    const select = document.createElement('select');\n                    select.className = 'calendar-target-page';\n                    select.style.flex = '1';\n                    const appState = this._getAppState();\n                    appState.documents.forEach(p => {\n                        const option = document.createElement('option');\n                        option.value = p.id;\n                        option.textContent = p.title || p.id;\n                        select.appendChild(option);\n                    });\n                    const removeBtn = document.createElement('button');\n                    removeBtn.textContent = '';\n                    removeBtn.type = 'button';\n                    removeBtn.className = 'remove-target-page';\n                    removeBtn.style.padding = '2px 8px';\n                    removeBtn.style.background = '#ff5555';\n                    removeBtn.style.color = 'white';\n                    removeBtn.style.border = 'none';\n                    removeBtn.style.borderRadius = '4px';\n                    removeBtn.style.cursor = 'pointer';\n                    removeBtn.addEventListener('click', () => newDiv.remove());\n                    newDiv.appendChild(select);\n                    newDiv.appendChild(removeBtn);\n                    container.insertBefore(newDiv, addPageBtn);\n                });\n            }\n            \n            // Remove target page buttons\n            document.querySelectorAll('.remove-target-page').forEach(btn => {\n                btn.addEventListener('click', (e) => {\n                    e.target.closest('div').remove();\n                });\n            });\n            \n            // Tag buttons\n            document.querySelectorAll('.add-tag-btn').forEach(btn => {\n                btn.addEventListener('click', (e) => {\n                    const tag = e.target.dataset.tag;\n                    if (!element.targetTags) element.targetTags = [];\n                    if (!element.targetTags.includes(tag)) {\n                        element.targetTags.push(tag);\n                        const dataManager = this._getDataManager();\n                        if (dataManager) {\n                            dataManager.saveData();\n                        }\n                        this.showEditModal(pageId, binId, elementIndex, element);\n                    }\n                });\n            });\n            \n            // Remove tag buttons\n            document.querySelectorAll('.remove-tag').forEach(btn => {\n                btn.addEventListener('click', (e) => {\n                    const tag = e.target.dataset.tag;\n                    if (element.targetTags) {\n                        element.targetTags = element.targetTags.filter(t => t !== tag);\n                        const dataManager = this._getDataManager();\n                        if (dataManager) {\n                            dataManager.saveData();\n                        }\n                        this.showEditModal(pageId, binId, elementIndex, element);\n                    }\n                });\n            });\n            \n            // Add custom tag\n            const addCustomTagBtn = document.getElementById('add-custom-tag-btn');\n            const newTagInput = document.getElementById('new-tag-input');\n            if (addCustomTagBtn && newTagInput) {\n                addCustomTagBtn.addEventListener('click', () => {\n                    const tag = newTagInput.value.trim().toLowerCase();\n                    if (tag && !element.targetTags?.includes(tag)) {\n                        if (!element.targetTags) element.targetTags = [];\n                        element.targetTags.push(tag);\n                        const dataManager = this._getDataManager();\n                        if (dataManager) {\n                            dataManager.saveData();\n                        }\n                        this.showEditModal(pageId, binId, elementIndex, element);\n                    }\n                });\n                newTagInput.addEventListener('keypress', (e) => {\n                    if (e.key === 'Enter') {\n                        addCustomTagBtn.click();\n                    }\n                });\n            }\n        }\n        \n        // Tags event handlers\n        document.querySelectorAll('.add-element-tag-btn').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const tag = e.target.dataset.tag;\n                if (!element.tags) element.tags = [];\n                if (!element.tags.includes(tag)) {\n                    element.tags.push(tag);\n                    const tagManager = this._getTagManager();\n                    if (tagManager) {\n                        tagManager.addTag(tag);\n                    }\n                    const dataManager = this._getDataManager();\n                    if (dataManager) {\n                        dataManager.saveData();\n                    }\n                    this.showEditModal(pageId, binId, elementIndex, element);\n                }\n            });\n        });\n        \n        document.querySelectorAll('.remove-element-tag').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                const tag = e.target.dataset.tag;\n                if (element.tags) {\n                    element.tags = element.tags.filter(t => t !== tag);\n                    const dataManager = this._getDataManager();\n                    if (dataManager) {\n                        dataManager.saveData();\n                    }\n                    this.showEditModal(pageId, binId, elementIndex, element);\n                }\n            });\n        });\n        \n        const addCustomElementTagBtn = document.getElementById('add-custom-element-tag-btn');\n        const newElementTagInput = document.getElementById('new-element-tag-input');\n        if (addCustomElementTagBtn && newElementTagInput) {\n            addCustomElementTagBtn.addEventListener('click', () => {\n                const tag = newElementTagInput.value.trim().toLowerCase();\n                if (tag && !element.tags?.includes(tag)) {\n                    if (!element.tags) element.tags = [];\n                    element.tags.push(tag);\n                    const tagManager = this._getTagManager();\n                    if (tagManager) {\n                        tagManager.addTag(tag);\n                    }\n                    const dataManager = this._getDataManager();\n                    if (dataManager) {\n                        dataManager.saveData();\n                    }\n                    this.showEditModal(pageId, binId, elementIndex, element);\n                }\n            });\n            newElementTagInput.addEventListener('keypress', (e) => {\n                if (e.key === 'Enter') {\n                    addCustomElementTagBtn.click();\n                }\n            });\n        }\n        \n        // Custom Properties event handlers\n        const addPropertyBtn = document.getElementById('add-custom-property-btn');\n        if (addPropertyBtn) {\n            addPropertyBtn.addEventListener('click', () => {\n                const propertiesList = document.getElementById('custom-properties-list');\n                if (propertiesList) {\n                    const newItem = document.createElement('div');\n                    newItem.className = 'custom-property-item';\n                    newItem.style.cssText = 'display: flex; gap: 10px; margin-bottom: 10px; padding: 8px; background: #1a1a1a; border-radius: 4px; align-items: center;';\n                    newItem.innerHTML = `\n                        <input type=\"text\" class=\"custom-property-key\" placeholder=\"Property name\" style=\"flex: 1; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                        <input type=\"text\" class=\"custom-property-value\" placeholder=\"Property value\" style=\"flex: 1; padding: 6px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                        <button type=\"button\" class=\"remove-custom-property-btn\" style=\"padding: 6px 12px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;\">Remove</button>\n                    `;\n                    newItem.querySelector('.remove-custom-property-btn').addEventListener('click', () => {\n                        newItem.remove();\n                    });\n                    propertiesList.appendChild(newItem);\n                }\n            });\n        }\n        \n        // Remove property buttons\n        document.querySelectorAll('.remove-custom-property-btn').forEach(btn => {\n            btn.addEventListener('click', (e) => {\n                e.target.closest('.custom-property-item').remove();\n            });\n        });\n        \n        // Store current editing state (appState already declared at line 881)\n        if (appState) {\n            appState.currentEditModal = {\n                pageId: pageId,\n                binId: binId,\n                elementIndex: elementIndex,\n                itemCount: element.items ? element.items.length : 0,\n                elementType: element.type\n            };\n        }\n        \n        // Update modal close button to show it's a save button and add navigation arrow buttons\n        const modalClose = document.querySelector('.modal-close');\n        const modalContent = modal.querySelector('.modal-content');\n        \n        // Style the close button to match arrow buttons\n        modalClose.style.cssText = 'position: absolute; top: 10px; right: 15px; font-size: 24px; font-weight: bold; cursor: pointer; color: #888888; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: none; background: transparent; padding: 0; margin: 0; z-index: 2002;';\n        modalClose.style.transition = 'color 0.2s';\n        \n        // Check if navigation buttons already exist\n        let prevElementBtn = document.getElementById('modal-prev-element-btn');\n        let nextElementBtn = document.getElementById('modal-next-element-btn');\n        \n        if (!prevElementBtn) {\n            // Create left arrow button\n            prevElementBtn = document.createElement('button');\n            prevElementBtn.id = 'modal-prev-element-btn';\n            prevElementBtn.className = 'modal-prev-element-btn';\n            prevElementBtn.innerHTML = '';\n            prevElementBtn.title = 'Save and edit previous element (hold to create new)';\n            prevElementBtn.style.cssText = 'position: absolute; top: 10px; right: 110px; font-size: 24px; font-weight: bold; cursor: pointer; color: #888888; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: none; background: transparent; padding: 0; margin: 0; z-index: 2002; transition: color 0.2s;';\n            modalContent.insertBefore(prevElementBtn, modalClose);\n        }\n        \n        if (!nextElementBtn) {\n            // Create right arrow button\n            nextElementBtn = document.createElement('button');\n            nextElementBtn.id = 'modal-next-element-btn';\n            nextElementBtn.className = 'modal-next-element-btn';\n            nextElementBtn.innerHTML = '';\n            nextElementBtn.title = 'Save and edit next element (hold to create new)';\n            nextElementBtn.style.cssText = 'position: absolute; top: 10px; right: 60px; font-size: 24px; font-weight: bold; cursor: pointer; color: #888888; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: none; background: transparent; padding: 0; margin: 0; z-index: 2002; transition: color 0.2s;';\n            modalContent.insertBefore(nextElementBtn, modalClose);\n        }\n        \n        // Add hover effects to all buttons\n        const setupButtonHover = (btn) => {\n            btn.addEventListener('mouseenter', () => {\n                btn.style.color = '#ffffff';\n            });\n            btn.addEventListener('mouseleave', () => {\n                btn.style.color = '#888888';\n            });\n        };\n        setupButtonHover(modalClose);\n        setupButtonHover(prevElementBtn);\n        setupButtonHover(nextElementBtn);\n        \n        // Set up close button handler (save and close)\n        modalClose.onclick = (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.saveEdit(pageId, binId, elementIndex);\n            this.closeModal();\n        };\n        \n        // Set up next element button handler\n        let nextElementMouseDownTime = 0;\n        let nextElementIsHolding = false;\n        \n        const setupNextElementButton = () => {\n            nextElementBtn.onmousedown = (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                nextElementMouseDownTime = Date.now();\n                nextElementIsHolding = false;\n                \n                // Check if holding after 200ms\n                const holdTimer = setTimeout(() => {\n                    nextElementIsHolding = true;\n                }, 200);\n                \n                const handleMouseUp = () => {\n                    clearTimeout(holdTimer);\n                    const wasHolding = nextElementIsHolding;\n                    const appState = this._getAppState();\n                    const page = appState?.documents?.find(p => p.id === pageId);\n                    if (!page) return;\n                    const bin = page.groups?.find(b => b.id === binId);\n                    if (!bin) return;\n                    const items = bin.items || [];\n                    bin.items = items;\n                    \n                    if (wasHolding) {\n                        // Create new element of matching type\n                        const currentElement = items[elementIndex];\n                        if (currentElement) {\n                            const elementManager = this._getElementManager();\n                            const newElement = elementManager ? elementManager.createElementTemplate(currentElement.type) : null;\n                            const insertIndex = elementIndex + 1;\n                            items.splice(insertIndex, 0, newElement);\n                            this.saveEdit(pageId, binId, elementIndex, true); // Skip close\n                            const dataManager = this._getDataManager();\n                            if (dataManager) {\n                                dataManager.saveData();\n                            }\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            // Open new element editor without visible transition\n                            setTimeout(() => {\n                                this.showEditModal(pageId, binId, insertIndex, newElement);\n                            }, 10);\n                        }\n                    } else {\n                        // Save current, open next\n                        const nextIndex = elementIndex + 1;\n                        if (nextIndex < items.length) {\n                            // Next element exists\n                            this.saveEdit(pageId, binId, elementIndex, true); // Skip close\n                            const dataManager = this._getDataManager();\n                            if (dataManager) {\n                                dataManager.saveData();\n                            }\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            // Open next element editor without visible transition\n                            setTimeout(() => {\n                                const nextElement = items[nextIndex];\n                                this.showEditModal(pageId, binId, nextIndex, nextElement);\n                            }, 10);\n                        } else {\n                            // No next element, create new one\n                            const currentElement = items[elementIndex];\n                            if (currentElement) {\n                                const elementManager = this._getElementManager();\n                                const newElement = elementManager ? elementManager.createElementTemplate(currentElement.type) : null;\n                                items.push(newElement);\n                                this.saveEdit(pageId, binId, elementIndex, true); // Skip close\n                                const dataManager = this._getDataManager();\n                                if (dataManager) {\n                                    dataManager.saveData();\n                                }\n                                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                                // Open new element editor without visible transition\n                                setTimeout(() => {\n                                    this.showEditModal(pageId, binId, items.length - 1, newElement);\n                                }, 10);\n                            }\n                        }\n                    }\n                    \n                    nextElementMouseDownTime = 0;\n                    nextElementIsHolding = false;\n                    document.removeEventListener('mouseup', handleMouseUp);\n                };\n                \n                document.addEventListener('mouseup', handleMouseUp);\n            };\n        };\n        \n        setupNextElementButton();\n        \n        // Set up previous element button handler\n        let prevElementMouseDownTime = 0;\n        let prevElementIsHolding = false;\n        \n        const setupPrevElementButton = () => {\n            prevElementBtn.onmousedown = (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                prevElementMouseDownTime = Date.now();\n                prevElementIsHolding = false;\n                \n                // Check if holding after 200ms\n                const holdTimer = setTimeout(() => {\n                    prevElementIsHolding = true;\n                }, 200);\n                \n                const handleMouseUp = () => {\n                    clearTimeout(holdTimer);\n                    const wasHolding = prevElementIsHolding;\n                    const appState = this._getAppState();\n                    const page = appState?.documents?.find(p => p.id === pageId);\n                    if (!page) return;\n                    const bin = page.groups?.find(b => b.id === binId);\n                    if (!bin) return;\n                    const items = bin.items || [];\n                    bin.items = items;\n                    \n                    if (wasHolding) {\n                        // Create new element of matching type before current\n                        const currentElement = items[elementIndex];\n                        if (currentElement) {\n                            const elementManager = this._getElementManager();\n                            const newElement = elementManager ? elementManager.createElementTemplate(currentElement.type) : null;\n                            items.splice(elementIndex, 0, newElement);\n                            this.saveEdit(pageId, binId, elementIndex + 1, true); // Skip close (elementIndex shifted)\n                            const dataManager = this._getDataManager();\n                        if (dataManager) {\n                            dataManager.saveData();\n                        }\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            // Open new element editor without visible transition\n                            setTimeout(() => {\n                                this.showEditModal(pageId, binId, elementIndex, newElement);\n                            }, 10);\n                        }\n                    } else {\n                        // Save current, open previous\n                        const prevIndex = elementIndex - 1;\n                        if (prevIndex >= 0) {\n                            // Previous element exists\n                            this.saveEdit(pageId, binId, elementIndex, true); // Skip close\n                            const dataManager = this._getDataManager();\n                            if (dataManager) {\n                                dataManager.saveData();\n                            }\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            // Open previous element editor without visible transition\n                            setTimeout(() => {\n                                const prevElement = items[prevIndex];\n                                this.showEditModal(pageId, binId, prevIndex, prevElement);\n                            }, 10);\n                        } else {\n                            // No previous element, create new one at start\n                            const currentElement = items[elementIndex];\n                            if (currentElement) {\n                                const elementManager = this._getElementManager();\n                            const newElement = elementManager ? elementManager.createElementTemplate(currentElement.type) : null;\n                                items.unshift(newElement);\n                                this.saveEdit(pageId, binId, elementIndex + 1, true); // Skip close (elementIndex shifted)\n                                const dataManager = this._getDataManager();\n                        if (dataManager) {\n                            dataManager.saveData();\n                        }\n                                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                                // Open new element editor without visible transition\n                                setTimeout(() => {\n                                    this.showEditModal(pageId, binId, 0, newElement);\n                                }, 10);\n                            }\n                        }\n                    }\n                    \n                    prevElementMouseDownTime = 0;\n                    prevElementIsHolding = false;\n                    document.removeEventListener('mouseup', handleMouseUp);\n                };\n                \n                document.addEventListener('mouseup', handleMouseUp);\n            };\n        };\n        \n        setupPrevElementButton();\n        \n        // Update close button to show it saves\n        modalClose.title = 'Save and close';\n        \n        // Add Enter key handler to save and close modal (or advance to next if multi-edit)\n        const handleEnterKey = (e) => {\n            // Skip if not Enter key\n            if (e.key !== 'Enter') return;\n            \n            const target = e.target || e.srcElement;\n            \n            // In textareas, allow Shift+Enter for new lines, but Enter alone saves/advances\n            if (target.tagName === 'TEXTAREA') {\n                if (!e.shiftKey) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.handleEnterKeyAction(pageId, binId, elementIndex, handleEnterKey);\n                }\n                return;\n            }\n            \n            // For all other inputs (including text inputs) and anywhere else, Enter saves/advances\n            // Don't prevent if it's a button click\n            if (target.tagName !== 'BUTTON') {\n                e.preventDefault();\n                e.stopPropagation();\n                this.handleEnterKeyAction(pageId, binId, elementIndex, handleEnterKey);\n            }\n        };\n        document.addEventListener('keydown', handleEnterKey, true); // Use capture phase to catch before inputs\n        // appState already declared at line 881\n        if (appState) {\n            appState.currentEnterKeyHandler = handleEnterKey;\n        }\n    }\n    \n    handleEnterKeyAction(pageId, binId, elementIndex, handleEnterKey) {\n        // Check if we're in a multi-edit session\n        const appState = this._getAppState();\n        const multiEdit = appState?.multiEditState;\n        if (multiEdit && multiEdit.pageId === pageId && multiEdit.binId === binId) {\n            // Check if there's a next element to edit\n            const nextIndex = elementIndex + 1;\n            if (nextIndex <= multiEdit.endIndex) {\n                // Save current and advance to next\n                            this.saveEdit(pageId, binId, elementIndex, true); // Skip close\n                            const dataManager = this._getDataManager();\n                            if (dataManager) {\n                                dataManager.saveData();\n                            }\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                \n                // Update multi-edit state\n                multiEdit.currentIndex = nextIndex;\n                \n                // Open next element editor\n                setTimeout(() => {\n                    const nextAppState = this._getAppState();\n                    const page = nextAppState?.documents?.find(p => p.id === pageId);\n                    const bin = page?.groups?.find(b => b.id === binId);\n                    const items = bin?.items || [];\n                    if (bin) {\n                        bin.items = items;\n                    }\n                    if (items[nextIndex]) {\n                        this.showEditModal(pageId, binId, nextIndex, items[nextIndex]);\n                        // Focus on the text input\n                        setTimeout(() => {\n                            const textInput = document.getElementById('edit-text');\n                            if (textInput) {\n                                textInput.focus();\n                                textInput.select();\n                            }\n                        }, 50);\n                    }\n                }, 10);\n                \n                // Remove old handler\n                document.removeEventListener('keydown', handleEnterKey, true);\n                if (appState && appState.currentEnterKeyHandler === handleEnterKey) {\n                    appState.currentEnterKeyHandler = null;\n                }\n                return;\n            } else {\n                // Last element - clear multi-edit state and close\n                if (appState) {\n                    appState.multiEditState = null;\n                }\n            }\n        }\n        \n        // Normal save and close\n        this.saveEdit(pageId, binId, elementIndex);\n        document.removeEventListener('keydown', handleEnterKey, true);\n        const finalAppState = this._getAppState();\n        if (finalAppState && finalAppState.currentEnterKeyHandler === handleEnterKey) {\n            finalAppState.currentEnterKeyHandler = null;\n        }\n    }\n    \n    addEditItem() {\n        const container = document.getElementById('edit-items');\n        const idx = container.children.length;\n        const newItem = document.createElement('div');\n        newItem.className = 'subtask-item';\n        newItem.innerHTML = `\n            <input type=\"text\" class=\"edit-item-text\" data-index=\"${idx}\" value=\"New item\" />\n            <input type=\"text\" class=\"edit-item-fun\" data-index=\"${idx}\" value=\"\" placeholder=\"Fun modifier\" />\n            <button data-remove-item=\"${idx}\"></button>\n        `;\n        container.appendChild(newItem);\n    }\n    \n    removeEditItem(idx) {\n        const container = document.getElementById('edit-items');\n        const item = container.querySelector(`.subtask-item .edit-item-text[data-index=\"${idx}\"]`)?.closest('.subtask-item');\n        if (item && container.children.length > 1) {\n            item.remove();\n        }\n    }\n    \n    saveEdit(pageId, binId, elementIndex, skipClose = false) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        const items = bin.items || [];\n        bin.items = items;\n        \n        const element = items[elementIndex];\n        if (!element) return;\n        \n        const textField = document.getElementById('edit-text');\n        const progressCheckbox = document.getElementById('edit-plugin-progress');\n        const progressValue = document.getElementById('edit-progress-value');\n        const recurringCheckbox = document.getElementById('edit-plugin-recurring');\n        const scheduleSelect = document.getElementById('edit-recurring-schedule');\n        const customPattern = document.getElementById('edit-recurring-custom-pattern');\n        const deadlineCheckbox = document.getElementById('edit-plugin-deadline');\n        const dateField = document.getElementById('edit-deadline-date');\n        const timeField = document.getElementById('edit-deadline-time');\n        const persistentCheckbox = document.getElementById('edit-plugin-persistent');\n        const timeCheckbox = document.getElementById('edit-plugin-time');\n        const timeValueField = document.getElementById('edit-time');\n        const funCheckbox = document.getElementById('edit-plugin-fun');\n        const funField = document.getElementById('edit-fun');\n        const repeatsCheckbox = document.getElementById('edit-plugin-repeats');\n\n        const undoRedoManager = this._getUndoRedoManager();\n        this.modalService?.applyElementEditUpdates({\n            element,\n            updates: {\n                text: textField ? textField.value : undefined,\n                progressEnabled: progressCheckbox ? progressCheckbox.checked : undefined,\n                progressValue: progressValue ? progressValue.value : undefined,\n                recurringEnabled: recurringCheckbox ? recurringCheckbox.checked : undefined,\n                recurringSchedule: scheduleSelect ? scheduleSelect.value : undefined,\n                recurringCustomPattern: customPattern ? customPattern.value : undefined,\n                deadlineEnabled: deadlineCheckbox ? deadlineCheckbox.checked : undefined,\n                deadlineDate: dateField ? dateField.value : undefined,\n                deadlineTime: timeField ? timeField.value : undefined,\n                persistentEnabled: persistentCheckbox ? persistentCheckbox.checked : undefined,\n                timeEnabled: timeCheckbox ? timeCheckbox.checked : undefined,\n                timeValue: timeValueField ? timeValueField.value : undefined,\n                funEnabled: funCheckbox ? funCheckbox.checked : undefined,\n                funValue: funField ? funField.value : undefined,\n                repeatsEnabled: repeatsCheckbox ? repeatsCheckbox.checked : true\n            },\n            undoRedoManager,\n            pageId,\n            binId,\n            elementIndex\n        });\n        \n        // Update items for multi-checkbox (preserve completion states)\n        if (element.type === 'multi-checkbox') {\n            const itemInputs = document.querySelectorAll('.edit-item-text');\n            const itemFunInputs = document.querySelectorAll('.edit-item-fun');\n            const oldItems = [...(element.items || [])];\n            \n            element.items = [];\n            itemInputs.forEach((input) => {\n                const idx = parseInt(input.dataset.index);\n                const oldItem = oldItems[idx];\n                const funInput = Array.from(itemFunInputs).find(f => f.dataset.index === input.dataset.index);\n                element.items.push({\n                    text: input.value.trim() || 'Item',\n                    completed: oldItem ? oldItem.completed : false,\n                    funModifier: funInput ? funInput.value.trim() : ''\n                });\n            });\n        }\n        \n        // Update counter-specific fields\n        if (element.type === 'counter') {\n            const valueField = document.getElementById('edit-counter-value');\n            const increment5Field = document.getElementById('edit-counter-increment5');\n            const customField = document.getElementById('edit-counter-custom');\n            if (valueField) element.value = parseInt(valueField.value) || 0;\n            if (increment5Field) element.increment5 = parseInt(increment5Field.value) || 5;\n            if (customField) element.customIncrement = parseInt(customField.value) || 10;\n        }\n        \n        // Update tracker-specific fields\n        if (element.type === 'tracker') {\n            const modeRadios = document.querySelectorAll(`input[name=\"tracker-mode-${pageId}-${elementIndex}\"]`);\n            modeRadios.forEach(radio => {\n                if (radio.checked) {\n                    element.mode = radio.value;\n                }\n            });\n        }\n        \n        // Update rating-specific fields\n        if (element.type === 'rating') {\n            const starsField = document.getElementById('edit-rating-stars');\n            const reviewField = document.getElementById('edit-rating-review');\n            if (starsField) element.rating = parseInt(starsField.value) || 0;\n            if (reviewField) element.review = reviewField.value.trim();\n        }\n\n        // Update timer-specific fields\n        if (element.type === 'timer') {\n            const durationField = document.getElementById('edit-timer-duration');\n            const alarmField = document.getElementById('edit-timer-alarm');\n            if (durationField) element.duration = parseInt(durationField.value) || 3600;\n            if (alarmField) element.alarmSound = alarmField.value || null;\n        }\n        \n        // Update calendar-specific fields\n        if (element.type === 'calendar') {\n            const displayModeSelect = document.getElementById('edit-calendar-display-mode');\n            if (displayModeSelect) {\n                element.displayMode = displayModeSelect.value;\n            }\n            \n            const targetingRadios = document.querySelectorAll(`input[name=\"calendar-targeting-${pageId}-${elementIndex}\"]`);\n            targetingRadios.forEach(radio => {\n                if (radio.checked) {\n                    element.targetingMode = radio.value;\n                }\n            });\n            \n            // Update target pages\n            if (element.targetingMode === 'specific') {\n                const pageSelects = document.querySelectorAll('.calendar-target-page');\n                element.targetPages = Array.from(pageSelects).map(select => select.value);\n            } else {\n                element.targetPages = [];\n            }\n            \n            // Target tags are handled by event listeners (see calendar modal setup)\n        }\n        \n        // Update tags (tags are handled by event listeners, but ensure they're saved)\n        // Tags are already updated via event listeners, just ensure they're normalized\n        if (element.tags && Array.isArray(element.tags)) {\n            element.tags = element.tags.map(tag => tag.trim().toLowerCase()).filter(tag => tag);\n            const tagManager = this._getTagManager();\n            if (tagManager) {\n                element.tags.forEach(tag => tagManager.addTag(tag));\n            }\n        }\n        \n        // Update custom properties\n        const propertyItems = document.querySelectorAll('.custom-property-item');\n        if (propertyItems.length > 0) {\n            if (!element.customProperties) element.customProperties = {};\n            const newProperties = {};\n            propertyItems.forEach(item => {\n                const keyInput = item.querySelector('.custom-property-key');\n                const valueInput = item.querySelector('.custom-property-value');\n                if (keyInput && valueInput) {\n                    const key = keyInput.value.trim();\n                    const value = valueInput.value.trim();\n                    if (key) {\n                        newProperties[key] = value;\n                    }\n                }\n            });\n            element.customProperties = newProperties;\n        }\n        \n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        if (!skipClose) {\n        this.closeModal();\n        }\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n    }\n    \n    addEditChildModal() {\n        const container = document.getElementById('edit-children-in-modal');\n        if (!container) return;\n        const idx = container.children.length;\n        const newChild = document.createElement('div');\n        newChild.className = 'subtask-item';\n        newChild.innerHTML = `\n            <input type=\"text\" class=\"edit-child-text-modal\" data-index=\"${idx}\" value=\"New child\" placeholder=\"Child text\" />\n            <input type=\"text\" class=\"edit-child-time-modal\" data-index=\"${idx}\" value=\"\" placeholder=\"Time\" />\n            <label class=\"edit-subtask-repeat-label\">\n                <input type=\"checkbox\" class=\"edit-child-repeats-modal\" data-index=\"${idx}\" checked />\n                Repeats\n            </label>\n            <button onclick=\"app.modalHandler.removeEditChildModal(${idx})\" class=\"remove-subtask-btn\"></button>\n        `;\n        container.appendChild(newChild);\n        container.scrollTop = container.scrollHeight;\n    }\n    \n    removeEditChildModal(idx) {\n        const container = document.getElementById('edit-children-in-modal');\n        if (!container) return;\n        const item = container.querySelector(`.edit-child-text-modal[data-index=\"${idx}\"]`)?.closest('.subtask-item');\n        if (item) {\n            item.remove();\n            // Update data-index for remaining items\n            Array.from(container.children).forEach((child, index) => {\n                const textInput = child.querySelector('.edit-child-text-modal');\n                const timeInput = child.querySelector('.edit-child-time-modal');\n                const repeatInput = child.querySelector('.edit-child-repeats-modal');\n                if (textInput) textInput.dataset.index = index;\n                if (timeInput) timeInput.dataset.index = index;\n                if (repeatInput) repeatInput.dataset.index = index;\n                const removeBtn = child.querySelector('button');\n                if (removeBtn) {\n                    removeBtn.onclick = () => app.modalHandler.removeEditChildModal(index);\n                }\n            });\n        }\n    }\n    \n    removeAllChildrenModal() {\n        if (confirm('Remove all children?')) {\n            const container = document.getElementById('edit-children-in-modal');\n            if (container) {\n                container.innerHTML = '';\n            }\n        }\n    }\n    \n    toggleArchiveViewInEdit(pageId, binId, elementIndex) {\n        const archiveView = document.getElementById(`archive-view-edit-${pageId}-${elementIndex}`);\n        if (!archiveView) return;\n        \n        if (archiveView.style.display === 'none') {\n            const dataManager = this._getDataManager();\n            const archived = dataManager ? dataManager.getArchivedRecordings(pageId, elementIndex) : [];\n            if (archived.length === 0) {\n                archiveView.innerHTML = '<div style=\"padding: 10px; color: #888;\">No archived recordings</div>';\n            } else {\n                let html = '<div style=\"padding: 10px;\"><strong>Archived Recordings:</strong><ul style=\"margin-top: 10px; padding-left: 20px;\">';\n                archived.forEach(entry => {\n                    html += `<li style=\"margin: 5px 0;\"><button onclick=\"window.app && window.app.dataManager && window.app.dataManager.playArchivedAudio('${entry.filename}')\" style=\"background: #4a9eff; color: white; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; margin-right: 8px;\">Play</button>${entry.date} - ${entry.filename}</li>`;\n                });\n                html += '</ul></div>';\n                archiveView.innerHTML = html;\n            }\n            archiveView.style.display = 'block';\n        } else {\n            archiveView.style.display = 'none';\n        }\n    }\n    \n    async overwriteAudioRecording(pageId, binId, elementIndex) {\n        // Close the modal first\n        this.closeModal();\n        \n        // Get the element to determine the correct audioElementIndex\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        const items = bin.items || [];\n        bin.items = items;\n        \n        const element = items[elementIndex];\n        if (!element || !element.audioFile) {\n            alert('No existing recording to overwrite.');\n            return;\n        }\n        \n        // Handle nested children - elementIndex might be a string like \"0-1\"\n        let audioElementIndex = elementIndex;\n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n            const parts = elementIndex.split('-');\n            audioElementIndex = parseInt(parts[0]);\n        } else {\n            audioElementIndex = parseInt(elementIndex);\n        }\n        \n        // Start recording with overwrite flag\n        const app = this._getApp();\n        if (app && app.startInlineRecording) {\n            await app.startInlineRecording(pageId, binId, audioElementIndex, elementIndex, true);\n        }\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED); // Re-render to update UI\n    }\n    \n    showEditBinModal(pageId, binId) {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        \n        let html = `\n            <h3>Edit Bin</h3>\n            <div style=\"margin-bottom: 15px;\">\n                <label>Bin Title:</label>\n                <input type=\"text\" id=\"edit-bin-title\" value=\"${this.escapeHtml(bin.title || '')}\" style=\"width: 100%; padding: 8px; margin-top: 5px;\" />\n            </div>\n            <div style=\"margin-bottom: 15px;\">\n                <label>Max Height (px):</label>\n                <input type=\"number\" id=\"edit-bin-max-height\" value=\"${bin.maxHeight || ''}\" placeholder=\"Leave empty for no limit\" min=\"0\" style=\"width: 100%; padding: 8px; margin-top: 5px;\" />\n                <small style=\"color: #888; display: block; margin-top: 5px;\">If set, the bin will be scrollable when content exceeds this height.</small>\n            </div>\n        `;\n        \n        // Bin Plugins Section\n        const binPluginManager = this._getBinPluginManager();\n        if (binPluginManager) {\n            const allPlugins = binPluginManager.getAvailablePlugins();\n            const enabledPlugins = binPluginManager.getBinPlugins(pageId, binId);\n            const enabledPluginIds = new Set(enabledPlugins.map(p => p.id));\n            \n            if (allPlugins.length > 0) {\n                html += `\n                    <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                        <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Bin Plugins:</label>\n                        <div style=\"display: flex; align-items: center; gap: 20px; flex-wrap: wrap;\">\n                `;\n                \n                allPlugins.forEach(plugin => {\n                    const isEnabled = enabledPluginIds.has(plugin.id);\n                    html += `\n                        <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                            <input type=\"checkbox\" class=\"bin-plugin-checkbox\" data-plugin-id=\"${plugin.id}\" ${isEnabled ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                            <span>${this.escapeHtml(plugin.name || plugin.id)}</span>\n                        </label>\n                    `;\n                });\n                \n                html += `\n                        </div>\n                    </div>\n                `;\n            }\n        }\n        \n        html += `\n            <div style=\"margin-top: 20px;\">\n                <button onclick=\"app.saveBinEdit('${pageId}', '${binId}')\">Save</button>\n                <button class=\"cancel\" onclick=\"app.closeModal()\">Cancel</button>\n            </div>\n        `;\n        \n        modalBody.innerHTML = html;\n        modal.classList.add('active');\n        \n        // Add event listeners for plugin checkboxes\n        modalBody.querySelectorAll('.bin-plugin-checkbox').forEach(checkbox => {\n            checkbox.addEventListener('change', async (e) => {\n                const pluginId = e.target.dataset.pluginId;\n                if (e.target.checked) {\n                    await binPluginManager.enablePlugin(pageId, binId, pluginId);\n                } else {\n                    await binPluginManager.disablePlugin(pageId, binId, pluginId);\n                }\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            });\n        });\n    }\n    \n    showEditPageModal(pageId) {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        // Use appState.documents (source of truth)\n        const appState = this._getAppState();\n        const pages = appState.documents || [];\n        const page = pages.find(p => p.id === pageId);\n        if (!page) {\n            console.error('[ModalHandler] Page not found:', pageId, 'Available pages:', pages.map(p => p.id));\n            return;\n        }\n        \n        let html = `\n            <h3>Edit Page</h3>\n            <div style=\"margin-bottom: 15px;\">\n                <label>Page Title:</label>\n                <input type=\"text\" id=\"edit-page-title\" value=\"${this.escapeHtml(page.title || '')}\" style=\"width: 100%; padding: 8px; margin-top: 5px;\" />\n            </div>\n        `;\n        \n        // Format Renderer Section\n        const formatRendererManager = this._getFormatRendererManager();\n        if (!formatRendererManager) {\n            console.warn('[ModalHandler] formatRendererManager not available in showEditPageModal');\n        }\n        if (formatRendererManager) {\n            const allFormats = formatRendererManager.getAllFormats();\n            \n            // Check if we're editing a tab (from pane context menu)\n            let currentFormat = null;\n            let editingTabInfo = null;\n            const appState = this._getAppState();\n            const app = this._getApp();\n            if (appState && appState._editingTabInfo) {\n                editingTabInfo = appState._editingTabInfo;\n                // Get format from the tab being edited\n                if (app && app.renderService && app.renderService.getRenderer) {\n                    const appRenderer = app.renderService.getRenderer();\n                    if (appRenderer && appRenderer.paneManager) {\n                        const pane = appRenderer.paneManager.getPane(editingTabInfo.paneId);\n                        if (pane) {\n                            const tab = pane.tabs.find(t => t.id === editingTabInfo.tabId);\n                            if (tab) {\n                                currentFormat = tab.format || null;\n                            }\n                        }\n                    }\n                }\n            }\n            \n            // Fallback to page format if not editing a tab\n            if (currentFormat === null) {\n                currentFormat = formatRendererManager.getPageFormat(pageId);\n            }\n            \n            // Debug: log all formats to help diagnose missing formats\n            console.log('[ModalHandler] All formats:', allFormats.map(f => ({ id: f.id, formatName: f.formatName, name: f.name })));\n            \n            // Filter to only show formats that support pages\n            // Include all page-supported formats: default layouts, document view, and new views\n            const filteredFormats = allFormats.filter(format => {\n                // Only show formats that support pages\n                return format.supportsPages !== false;\n            }).sort((a, b) => {\n                // Sort formats: default first, then by preferred order, then alphabetical\n                const aName = a.formatName || a.id;\n                const bName = b.formatName || b.id;\n                \n                // Default format first\n                if (aName === 'default' || aName === '') return -1;\n                if (bName === 'default' || bName === '') return 1;\n                \n                // Preferred order for common formats\n                const preferredOrder = [\n                    'grid-layout-format',\n                    'horizontal-layout-format',\n                    'document-view-format',\n                    'latex-editor',\n                    'mindmap',\n                    'logic-graph',\n                    'flowchart',\n                    'page-kanban-format',\n                    'trello-board'\n                ];\n                \n                const aIndex = preferredOrder.indexOf(aName);\n                const bIndex = preferredOrder.indexOf(bName);\n                \n                // If both in preferred order, sort by order\n                if (aIndex !== -1 && bIndex !== -1) {\n                    return aIndex - bIndex;\n                }\n                \n                // If only one in preferred order, it comes first\n                if (aIndex !== -1) return -1;\n                if (bIndex !== -1) return 1;\n                \n                // Otherwise, sort alphabetically by display name\n                const aDisplay = a.name || aName;\n                const bDisplay = b.name || bName;\n                return aDisplay.localeCompare(bDisplay);\n            });\n            \n            console.log('[ModalHandler] Filtered formats:', filteredFormats.map(f => ({ id: f.id, formatName: f.formatName, name: f.name })));\n            \n            // Determine label text based on context\n            const formatLabel = editingTabInfo ? 'Tab Display Format:' : 'Page Format:';\n            \n            html += `\n                <div style=\"margin-top: 20px; padding: 15px; background: #1a1a1a; border-radius: 4px;\">\n                    <label style=\"font-weight: 600; display: block; margin-bottom: 10px;\">${formatLabel}</label>\n                    <select id=\"page-format-select\" style=\"width: 100%; padding: 8px; margin-top: 5px;\">\n                        <option value=\"\">Default Format (Vertical)</option>\n            `;\n            \n            filteredFormats.forEach(format => {\n                const formatName = format.formatName || format.id;\n                const selected = currentFormat === formatName ? 'selected' : '';\n                html += `<option value=\"${formatName}\" ${selected}>${this.escapeHtml(format.name || formatName)}</option>`;\n            });\n            \n            html += `\n                    </select>\n                </div>\n            `;\n            \n            // Grid Layout Configuration (always include, show/hide based on selection)\n            const gridConfig = page.formatConfig?.grid || {};\n            const showGridConfig = currentFormat === 'grid-layout-format';\n            html += `\n                <div id=\"grid-layout-config\" style=\"margin-top: 15px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444; display: ${showGridConfig ? 'block' : 'none'};\">\n                    <label style=\"font-weight: 600; display: block; margin-bottom: 10px;\">Grid Layout Settings:</label>\n                    <div style=\"display: flex; flex-direction: column; gap: 10px;\">\n                        <div>\n                            <label style=\"display: block; margin-bottom: 5px; font-size: 14px;\">Min Column Width (px):</label>\n                            <input type=\"number\" id=\"grid-min-column-width\" value=\"${gridConfig.minColumnWidth || 350}\" min=\"100\" step=\"10\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <small style=\"color: #888; font-size: 12px;\">Minimum width for each grid column</small>\n                        </div>\n                        <div>\n                            <label style=\"display: block; margin-bottom: 5px; font-size: 14px;\">Gap (px):</label>\n                            <input type=\"number\" id=\"grid-gap\" value=\"${gridConfig.gap || 20}\" min=\"0\" step=\"5\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <small style=\"color: #888; font-size: 12px;\">Space between grid items</small>\n                        </div>\n                        <div>\n                            <label style=\"display: block; margin-bottom: 5px; font-size: 14px;\">Padding (px):</label>\n                            <input type=\"number\" id=\"grid-padding\" value=\"${gridConfig.padding || 20}\" min=\"0\" step=\"5\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <small style=\"color: #888; font-size: 12px;\">Padding around the grid container</small>\n                        </div>\n                        <div>\n                            <label style=\"display: block; margin-bottom: 5px; font-size: 14px;\">Max Height (px):</label>\n                            <input type=\"number\" id=\"grid-max-height\" value=\"${gridConfig.maxHeight || ''}\" min=\"0\" step=\"50\" placeholder=\"Leave empty for no limit\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\n                            <small style=\"color: #888; font-size: 12px;\">Maximum height of grid container (becomes scrollable if exceeded)</small>\n                        </div>\n                    </div>\n                </div>\n            `;\n        }\n        \n        // Page Plugins Section\n        const pagePluginManager = this._getPagePluginManager();\n        if (!pagePluginManager) {\n            console.warn('[ModalHandler] pagePluginManager not available in showEditPageModal');\n        }\n        if (pagePluginManager) {\n            const allPlugins = pagePluginManager.getAvailablePlugins();\n            const enabledPlugins = pagePluginManager.getPagePlugins(pageId);\n            const enabledPluginIds = new Set(enabledPlugins.map(p => p.id));\n            \n            console.log('[ModalHandler] Page plugins check:', {\n                hasPagePluginManager: !!pagePluginManager,\n                allPluginsCount: allPlugins.length,\n                allPlugins: allPlugins.map(p => ({ id: p.id, name: p.name, type: p.type })),\n                enabledPluginsCount: enabledPlugins.length\n            });\n            \n            if (allPlugins.length > 0) {\n                html += `\n                    <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                        <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Page Plugins:</label>\n                        <div style=\"display: flex; align-items: center; gap: 20px; flex-wrap: wrap;\">\n                `;\n                \n                allPlugins.forEach(plugin => {\n                    const isEnabled = enabledPluginIds.has(plugin.id);\n                    html += `\n                        <label style=\"display: flex; align-items: center; gap: 10px; margin: 0;\">\n                            <input type=\"checkbox\" class=\"page-plugin-checkbox\" data-plugin-id=\"${plugin.id}\" ${isEnabled ? 'checked' : ''} style=\"width: 18px; height: 18px; margin: 0;\" />\n                            <span>${this.escapeHtml(plugin.name || plugin.id)}</span>\n                        </label>\n                    `;\n                });\n                \n                html += `\n                        </div>\n                    </div>\n                `;\n            } else {\n                // Show message if no plugins available (for debugging)\n                html += `\n                    <div style=\"margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 4px; border: 1px solid #444;\">\n                        <label style=\"font-weight: 600; margin-bottom: 10px; display: block;\">Page Plugins:</label>\n                        <div style=\"color: #888; font-size: 14px;\">No page plugins available. Plugins may still be loading...</div>\n                    </div>\n                `;\n            }\n        } else {\n            console.warn('[ModalHandler] pagePluginManager not found on app instance');\n        }\n        \n        html += `\n            <div style=\"margin-top: 20px;\">\n                <button onclick=\"app.savePageEdit('${pageId}')\">Save</button>\n                <button class=\"cancel\" onclick=\"app.closeModal()\">Cancel</button>\n            </div>\n        `;\n        \n        modalBody.innerHTML = html;\n        modal.classList.add('active');\n        \n        // Listen for format registration events and update dropdown dynamically\n        const updateFormatsDropdown = () => {\n            if (!formatRendererManager) return;\n            \n            const formatSelect = modalBody.querySelector('#page-format-select');\n            if (!formatSelect) return;\n            \n            const allFormats = formatRendererManager.getAllFormats();\n            \n            // Check if we're editing a tab (from pane context menu)\n            let currentFormat = null;\n            const appState = this._getAppState();\n            const app = this._getApp();\n            const editingTabInfo = appState?._editingTabInfo;\n            if (editingTabInfo && app && app.renderService && app.renderService.getRenderer) {\n                const appRenderer = app.renderService.getRenderer();\n                if (appRenderer && appRenderer.paneManager) {\n                    const pane = appRenderer.paneManager.getPane(editingTabInfo.paneId);\n                    if (pane) {\n                        const tab = pane.tabs.find(t => t.id === editingTabInfo.tabId);\n                        if (tab) {\n                            currentFormat = tab.format || null;\n                        }\n                    }\n                }\n            }\n            \n            // Fallback to page format if not editing a tab\n            if (currentFormat === null) {\n                currentFormat = formatRendererManager.getPageFormat(pageId);\n            }\n            // Filter to only show formats that support pages\n            const filteredFormats = allFormats.filter(format => {\n                // Only show formats that support pages\n                return format.supportsPages !== false;\n            }).sort((a, b) => {\n                const aName = a.formatName || a.id;\n                const bName = b.formatName || b.id;\n                \n                // Default format first\n                if (aName === 'default' || aName === '') return -1;\n                if (bName === 'default' || bName === '') return 1;\n                \n                // Preferred order for common formats\n                const preferredOrder = [\n                    'grid-layout-format',\n                    'horizontal-layout-format',\n                    'document-view-format',\n                    'latex-editor',\n                    'mindmap',\n                    'logic-graph',\n                    'flowchart',\n                    'page-kanban-format',\n                    'trello-board'\n                ];\n                \n                const aIndex = preferredOrder.indexOf(aName);\n                const bIndex = preferredOrder.indexOf(bName);\n                \n                // If both in preferred order, sort by order\n                if (aIndex !== -1 && bIndex !== -1) {\n                    return aIndex - bIndex;\n                }\n                \n                // If only one in preferred order, it comes first\n                if (aIndex !== -1) return -1;\n                if (bIndex !== -1) return 1;\n                \n                // Otherwise, sort alphabetically by display name\n                const aDisplay = a.name || aName;\n                const bDisplay = b.name || bName;\n                return aDisplay.localeCompare(bDisplay);\n            });\n            \n            // Clear existing options except default\n            formatSelect.innerHTML = '<option value=\"\">Default Format (Vertical)</option>';\n            \n            // Add filtered formats\n            filteredFormats.forEach(format => {\n                const formatName = format.formatName || format.id;\n                const selected = currentFormat === formatName ? 'selected' : '';\n                const option = document.createElement('option');\n                option.value = formatName;\n                option.textContent = format.name || formatName;\n                if (selected) option.selected = true;\n                formatSelect.appendChild(option);\n            });\n            \n            console.log('[ModalHandler] Updated formats dropdown with', filteredFormats.length, 'formats');\n        };\n        \n        // Update formats when they're registered\n        const eventBus = getService(SERVICES.EVENT_BUS);\n        if (eventBus) {\n            const formatRegisteredHandler = () => {\n                updateFormatsDropdown();\n            };\n            eventBus.on('format:registered', formatRegisteredHandler);\n            \n            // Store handler for cleanup\n            if (!this._formatRegisteredHandlers) {\n                this._formatRegisteredHandlers = new Map();\n            }\n            this._formatRegisteredHandlers.set(pageId, formatRegisteredHandler);\n        }\n        \n        // Update formats immediately in case they're already loaded\n        setTimeout(updateFormatsDropdown, 100);\n        \n        // Add event listener for format selector\n        const formatSelect = modalBody.querySelector('#page-format-select');\n        if (formatSelect) {\n            const updateGridConfigVisibility = () => {\n                const gridConfigDiv = modalBody.querySelector('#grid-layout-config');\n                if (gridConfigDiv) {\n                    gridConfigDiv.style.display = formatSelect.value === 'grid-layout-format' ? 'block' : 'none';\n                }\n            };\n            \n            // Initial visibility\n            updateGridConfigVisibility();\n            \n            formatSelect.addEventListener('change', async (e) => {\n                const formatName = e.target.value || null;\n                \n                // Check if we're editing a tab (from pane context menu)\n                const appState = this._getAppState();\n                const app = this._getApp();\n                const editingTabInfo = appState?._editingTabInfo;\n                if (editingTabInfo && app && app.renderService && app.renderService.getRenderer) {\n                    const appRenderer = app.renderService.getRenderer();\n                    if (appRenderer && appRenderer.paneManager) {\n                        const pane = appRenderer.paneManager.getPane(editingTabInfo.paneId);\n                        if (pane) {\n                            const tab = pane.tabs.find(t => t.id === editingTabInfo.tabId);\n                            if (tab) {\n                                // Update the tab's format\n                                tab.format = formatName;\n                                // Re-render the pane to show the new format\n                                appRenderer.paneManager.renderPane(pane);\n                                // Clear the editing tab info\n                                if (appState) {\n                                    delete appState._editingTabInfo;\n                                }\n                                // Update grid config visibility\n                                updateGridConfigVisibility();\n                                // Close modal to show format change immediately\n                                this.closeModal();\n                                return;\n                            }\n                        }\n                    }\n                }\n                \n                // Fallback: update page format (for non-tab context)\n                const formatRendererManager = this._getFormatRendererManager();\n                if (formatRendererManager) {\n                    if (formatName) {\n                        await formatRendererManager.setPageFormat(pageId, formatName);\n                    } else {\n                        // Clear format (use default) - use the proper method to clear from activeFormats too\n                        formatRendererManager.clearPageFormat(pageId);\n                    }\n                }\n                // Update grid config visibility\n                updateGridConfigVisibility();\n                // Close modal to show format change immediately\n                this.closeModal();\n            });\n        }\n        \n        // Add event listeners for plugin checkboxes\n        modalBody.querySelectorAll('.page-plugin-checkbox').forEach(checkbox => {\n            checkbox.addEventListener('change', async (e) => {\n                const pluginId = e.target.dataset.pluginId;\n                if (e.target.checked) {\n                    await pagePluginManager.enablePlugin(pageId, pluginId);\n                } else {\n                    await pagePluginManager.disablePlugin(pageId, pluginId);\n                }\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            });\n        });\n    }\n    \n    /**\n     * Show visual customization modal for an object\n     * @param {string} type - 'pane', 'page', 'bin', or 'element'\n     * @param {string} id - Object ID\n     * @param {Object} options - Additional options (pageId, viewFormat, etc.)\n     */\n    showVisualCustomizationModal(type, id, options = {}) {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        // Get current effective settings\n        const visualSettingsManager = this._getVisualSettingsManager();\n        let currentSettings = {};\n        if (visualSettingsManager) {\n            const pageId = options.pageId || null;\n            const viewFormat = options.viewFormat || 'default';\n            currentSettings = visualSettingsManager.getEffectiveSettings(type, id, pageId, viewFormat);\n        }\n        \n        // Get object-specific settings\n        let objectSettings = { custom: {}, preserveAll: false };\n        if (visualSettingsManager) {\n            objectSettings = visualSettingsManager.getObjectSettings(type, id);\n        }\n        \n        // Determine object name\n        const appState = this._getAppState();\n        let objectName = type;\n        if (type === 'pane') {\n            objectName = 'Pane';\n        } else if (type === 'page') {\n            const page = appState?.documents?.find(p => p.id === id);\n            objectName = page ? `Document: ${page.title || id}` : 'Document';\n        } else if (type === 'bin') {\n            const page = appState?.documents?.find(p => p.id === options.pageId);\n            const bin = page?.groups?.find(b => b.id === id);\n            objectName = bin ? `Group: ${bin.title || id}` : 'Group';\n        } else if (type === 'element') {\n            objectName = 'Item';\n        }\n        \n        let html = `<h3 style=\"margin-bottom: 20px; color: #ffffff;\">Visual Customization: ${objectName}</h3>`;\n        \n        // Instance-specific checkbox (default: unchecked - apply to all objects of this type)\n        html += '<div class=\"settings-control\" style=\"margin-bottom: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px;\">';\n        html += '<label style=\"display: flex; align-items: center; gap: 10px; cursor: pointer;\">';\n        html += `<input type=\"checkbox\" id=\"visual-instance-specific\" style=\"width: 18px; height: 18px; cursor: pointer;\">`;\n        html += '<span style=\"font-weight: 600; color: #ffffff;\">Apply settings to this specific instance only</span>';\n        html += '</label>';\n        html += '<div style=\"margin-top: 10px; color: #888; font-size: 12px;\">By default, settings apply to all objects of this type. Enable this to apply only to this specific instance.</div>';\n        html += '</div>';\n        \n        // Preserve all checkbox (shown when instance-specific is checked)\n        html += '<div class=\"settings-control\" id=\"visual-preserve-all-container\" style=\"margin-bottom: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px; display: none;\">';\n        html += '<label style=\"display: flex; align-items: center; gap: 10px; cursor: pointer;\">';\n        html += `<input type=\"checkbox\" id=\"visual-preserve-all\" ${objectSettings.preserveAll ? 'checked' : ''} style=\"width: 18px; height: 18px; cursor: pointer;\">`;\n        html += '<span style=\"font-weight: 600; color: #ffffff;\">Preserve all current values</span>';\n        html += '</label>';\n        html += '<div style=\"margin-top: 10px; color: #888; font-size: 12px;\">When enabled, all current visual values will be preserved, not just the ones you customize.</div>';\n        html += '</div>';\n        \n        // Tag-based customization section\n        html += '<div class=\"settings-control\" style=\"margin-bottom: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px; border: 2px solid #4a9eff;\">';\n        html += '<div style=\"font-weight: 600; color: #4a9eff; margin-bottom: 15px; font-size: 16px;\">Tag-Based Customization</div>';\n        html += '<div style=\"color: #888; font-size: 12px; margin-bottom: 15px;\">Apply visual settings to all objects with a specific tag. These settings will override theme settings but can be overridden by instance-specific settings.</div>';\n        \n        // Tag selector\n        html += '<div class=\"settings-control\" style=\"margin-bottom: 10px;\">';\n        html += '<label>Tag:</label>';\n        html += '<select id=\"visual-tag-select\" style=\"width: 100%; padding: 6px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px; margin-bottom: 10px;\">';\n        html += '<option value=\"\">-- Select or Create Tag --</option>';\n        \n        // Get all available tags\n        const tagManager = this._getTagManager();\n        const allTags = tagManager?.getAvailableTags() || [];\n        allTags.forEach(tag => {\n            html += `<option value=\"${this.escapeHtml(tag)}\">${this.escapeHtml(tag)}</option>`;\n        });\n        html += '</select>';\n        html += '<input type=\"text\" id=\"visual-new-tag\" placeholder=\"Or enter new tag name\" style=\"width: 100%; padding: 6px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px; margin-bottom: 10px;\">';\n        html += '</div>';\n        \n        // View format selector for tag settings\n        html += '<div class=\"settings-control\" style=\"margin-bottom: 10px;\">';\n        html += '<label>Apply to View:</label>';\n        html += '<select id=\"visual-tag-view-format\" style=\"width: 100%; padding: 6px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #404040; border-radius: 4px;\">';\n        html += '<option value=\"\">All Views</option>';\n        const themeManager = this._getThemeManager();\n        const viewFormats = themeManager?.getViewFormats() || [];\n        viewFormats.forEach(format => {\n            const formatName = format === 'default' ? 'Default' : format.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n            html += `<option value=\"${format}\">${formatName}</option>`;\n        });\n        html += '</select>';\n        html += '</div>';\n        \n        // Load tag settings button\n        html += '<button id=\"visual-tag-load-btn\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; margin-bottom: 10px;\">Load Tag Settings</button>';\n        html += '<button id=\"visual-tag-reset-btn\" style=\"padding: 8px 16px; background: #888; color: white; border: none; border-radius: 4px; cursor: pointer; margin-bottom: 10px;\">Reset Tag Settings</button>';\n        html += '</div>';\n        \n        // Visual customization controls based on type\n        if (type === 'pane' || type === 'page') {\n            html += this.createPageVisualControls(currentSettings);\n        } else if (type === 'bin') {\n            html += this.createBinVisualControls(currentSettings);\n        } else if (type === 'element') {\n            html += this.createElementVisualControls(currentSettings);\n        }\n        \n        // Export/Import buttons\n        html += '<div style=\"margin-top: 30px; padding-top: 20px; border-top: 1px solid #404040; display: flex; gap: 10px;\">';\n        html += '<button id=\"visual-export-btn\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">Export Settings</button>';\n        html += '<button id=\"visual-import-btn\" style=\"padding: 8px 16px; background: #58a858; color: white; border: none; border-radius: 4px; cursor: pointer;\">Import Settings</button>';\n        html += '<input type=\"file\" id=\"visual-import-file\" accept=\".json\" style=\"display: none;\">';\n        html += '<button id=\"visual-reset-btn\" style=\"padding: 8px 16px; background: #888; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: auto;\">Reset</button>';\n        html += '</div>';\n        \n        modalBody.innerHTML = html;\n        modal.classList.add('active');\n        \n        // Show/hide preserve-all checkbox based on instance-specific\n        const instanceSpecificCheckbox = document.getElementById('visual-instance-specific');\n        const preserveAllContainer = document.getElementById('visual-preserve-all-container');\n        \n        if (instanceSpecificCheckbox && preserveAllContainer) {\n            const togglePreserveAll = () => {\n                preserveAllContainer.style.display = instanceSpecificCheckbox.checked ? 'block' : 'none';\n            };\n            instanceSpecificCheckbox.addEventListener('change', togglePreserveAll);\n            togglePreserveAll(); // Initial state\n        }\n        \n        // Real-time update function\n        const applyRealTimeUpdate = (path, value) => {\n            const instanceSpecific = instanceSpecificCheckbox?.checked || false;\n            const preserveAll = document.getElementById('visual-preserve-all')?.checked || false;\n            \n            // If not instance-specific, apply to all objects of this type via theme\n            if (!instanceSpecific) {\n                // Apply directly to global theme for real-time updates\n                if (this.app.themeManager) {\n                    const globalTheme = this.app.themeManager.themes.global || {};\n                    const pathParts = path.split('.');\n                    \n                    // Navigate/create nested structure\n                    let target = globalTheme;\n                    for (let i = 0; i < pathParts.length - 1; i++) {\n                        if (!target[pathParts[i]]) target[pathParts[i]] = {};\n                        target = target[pathParts[i]];\n                    }\n                    target[pathParts[pathParts.length - 1]] = value;\n                    \n                    // Apply theme immediately\n                    this.app.themeManager.setGlobalTheme(globalTheme);\n                    \n                    // Also update settings manager for CSS variables\n                    if (this.app.settingsManager) {\n                        this.app.settingsManager.updateSetting(path, value);\n                    }\n                }\n            } else {\n                // Instance-specific: apply only to this object\n                if (visualSettingsManager) {\n                    const customSettings = {};\n                    const pathParts = path.split('.');\n                    let target = customSettings;\n                    for (let i = 0; i < pathParts.length - 1; i++) {\n                        if (!target[pathParts[i]]) target[pathParts[i]] = {};\n                        target = target[pathParts[i]];\n                    }\n                    target[pathParts[pathParts.length - 1]] = value;\n                    \n                    visualSettingsManager.setObjectSettings(type, id, customSettings, preserveAll);\n                }\n            }\n            \n            // Apply visual changes without full render to preserve modal\n            applyVisualChangesOnly(path, value);\n        };\n        \n        // Apply visual changes without closing modal\n        const applyVisualChangesOnly = (path, value) => {\n            const isInstanceSpecific = instanceSpecificCheckbox?.checked || false;\n            \n            // Apply CSS variables directly for immediate visual feedback\n            const root = document.documentElement;\n            const cssVarName = pathToCssVar(path);\n            if (cssVarName) {\n                root.style.setProperty(cssVarName, value);\n            }\n            \n            // Apply theme to DOM directly if not instance-specific\n            if (this.app.themeManager && !isInstanceSpecific) {\n                const scope = document.documentElement;\n                this.app.themeManager.applyTheme(this.app.themeManager.themes.global, scope);\n            }\n            \n            // For instance-specific, find and update specific elements\n            if (isInstanceSpecific && visualSettingsManager) {\n                const elements = document.querySelectorAll(`[data-${type}-id=\"${id}\"]`);\n                elements.forEach(el => {\n                    visualSettingsManager.applyVisualSettings(el, type, id);\n                });\n            }\n        };\n        \n        // Convert setting path to CSS variable name\n        const pathToCssVar = (path) => {\n            const mapping = {\n                'page.background': '--page-bg',\n                'page.margin': '--page-margin',\n                'page.padding': '--page-padding',\n                'page.borderRadius': '--page-border-radius',\n                'page.fontFamily': '--page-font-family',\n                'page.fontSize': '--page-font-size',\n                'page.opacity': '--page-opacity',\n                'page.color': '--page-color',\n                'element.background': '--element-bg',\n                'element.margin': '--element-margin',\n                'element.padding': '--element-padding',\n                'element.paddingVertical': '--element-padding-vertical',\n                'element.paddingHorizontal': '--element-padding-horizontal',\n                'element.gap': '--element-gap',\n                'element.fontFamily': '--element-font-family',\n                'element.fontSize': '--element-font-size',\n                'element.opacity': '--element-opacity',\n                'element.color': '--element-color',\n                'element.hoverBackground': '--element-hover-bg',\n                'background': '--bg-color'\n            };\n            return mapping[path] || null;\n        };\n        \n        // Add real-time listeners to all inputs\n        const allInputs = modalBody.querySelectorAll('[data-setting-path]');\n        allInputs.forEach(input => {\n            const path = input.dataset.settingPath;\n            \n            if (input.type === 'range') {\n                // Sync range slider with number input\n                const numberInput = modalBody.querySelector(`input[type=\"number\"][data-setting-path=\"${path}\"]`);\n                \n                input.addEventListener('input', (e) => {\n                    const value = e.target.value;\n                    if (numberInput) {\n                        numberInput.value = value;\n                    }\n                    \n                    // Convert value based on path\n                    let finalValue = value;\n                    if (path.includes('opacity')) {\n                        finalValue = (parseFloat(value) / 100).toFixed(2);\n                    } else if (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size') || path.includes('gap')) {\n                        finalValue = value + 'px';\n                    }\n                    \n                    applyRealTimeUpdate(path, finalValue);\n                });\n            } else if (input.type === 'number') {\n                // Sync number input with range slider\n                const rangeInput = modalBody.querySelector(`input[type=\"range\"][data-setting-path=\"${path}\"]`);\n                \n                input.addEventListener('input', (e) => {\n                    const value = e.target.value;\n                    if (rangeInput) {\n                        rangeInput.value = value;\n                    }\n                    \n                    // Convert value based on path\n                    let finalValue = value;\n                    if (path.includes('opacity')) {\n                        finalValue = (parseFloat(value) / 100).toFixed(2);\n                    } else if (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size') || path.includes('gap')) {\n                        finalValue = value + 'px';\n                    }\n                    \n                    applyRealTimeUpdate(path, finalValue);\n                });\n            } else if (input.type === 'color' || input.type === 'text') {\n                input.addEventListener('input', (e) => {\n                    applyRealTimeUpdate(path, e.target.value);\n                });\n            }\n        });\n        \n        // Save button handler\n        const saveVisualSettings = () => {\n            if (!visualSettingsManager) return;\n            \n            const instanceSpecific = instanceSpecificCheckbox?.checked || false;\n            const preserveAll = document.getElementById('visual-preserve-all')?.checked || false;\n            \n            if (!instanceSpecific) {\n                // Apply to all objects of this type - save to theme\n                // The real-time updates already applied to theme, just need to save\n                if (this.app.themeManager) {\n                    this.app.themeManager.saveThemes();\n                }\n                if (this.app.settingsManager) {\n                    this.app.settingsManager.saveSettings();\n                }\n                this.closeModal();\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                return;\n            }\n            \n            // Collect all changed values from inputs\n            const customSettings = {};\n            const pageSettings = currentSettings.page || {};\n            const elementSettings = currentSettings.element || {};\n            \n            // Helper to get value from input\n            const getInputValue = (path) => {\n                // Try modalBody first, then fall back to document\n                const input = modalBody.querySelector(`[data-setting-path=\"${path}\"]`) || \n                             document.querySelector(`[data-setting-path=\"${path}\"]`);\n                if (!input) return null;\n                if (input.type === 'color') return input.value;\n                if (input.type === 'range' || input.type === 'number') {\n                    const numValue = parseFloat(input.value);\n                    if (path.includes('opacity')) {\n                        return (numValue / 100).toFixed(2);\n                    } else if (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size') || path.includes('gap')) {\n                        return numValue + 'px';\n                    }\n                    return input.value;\n                }\n                return input.value;\n            };\n            \n            // Page-level settings\n            if (type === 'pane' || type === 'page' || type === 'bin') {\n                const pageBg = getInputValue('page.background');\n                const pageMargin = getInputValue('page.margin');\n                const pagePadding = getInputValue('page.padding');\n                const pageBorderRadius = getInputValue('page.borderRadius');\n                const pageFontFamily = getInputValue('page.fontFamily');\n                const pageFontSize = getInputValue('page.fontSize');\n                const pageOpacity = getInputValue('page.opacity');\n                const pageColor = getInputValue('page.color');\n                \n                if (!preserveAll) {\n                    // Only store changed values\n                    if (!customSettings.page) customSettings.page = {};\n                    if (pageBg && pageBg !== pageSettings.background) customSettings.page.background = pageBg;\n                    if (pageMargin && pageMargin !== pageSettings.margin) customSettings.page.margin = pageMargin;\n                    if (pagePadding && pagePadding !== pageSettings.padding) customSettings.page.padding = pagePadding;\n                    if (pageBorderRadius && pageBorderRadius !== pageSettings.borderRadius) customSettings.page.borderRadius = pageBorderRadius;\n                    if (pageFontFamily && pageFontFamily !== pageSettings.fontFamily) customSettings.page.fontFamily = pageFontFamily;\n                    if (pageFontSize && pageFontSize !== pageSettings.fontSize) customSettings.page.fontSize = pageFontSize;\n                    if (pageOpacity && pageOpacity !== pageSettings.opacity) customSettings.page.opacity = pageOpacity;\n                    if (pageColor && pageColor !== pageSettings.color) customSettings.page.color = pageColor;\n                } else {\n                    // Store all values\n                    customSettings.page = {\n                        background: pageBg || pageSettings.background,\n                        margin: pageMargin || pageSettings.margin,\n                        padding: pagePadding || pageSettings.padding,\n                        borderRadius: pageBorderRadius || pageSettings.borderRadius,\n                        fontFamily: pageFontFamily || pageSettings.fontFamily,\n                        fontSize: pageFontSize || pageSettings.fontSize,\n                        opacity: pageOpacity || pageSettings.opacity,\n                        color: pageColor || pageSettings.color\n                    };\n                }\n            }\n            \n            // Element-level settings\n            if (type === 'element' || type === 'bin') {\n                const elementBg = getInputValue('element.background');\n                const elementMargin = getInputValue('element.margin');\n                const elementPadding = getInputValue('element.padding');\n                const elementPaddingVertical = getInputValue('element.paddingVertical');\n                const elementPaddingHorizontal = getInputValue('element.paddingHorizontal');\n                const elementGap = getInputValue('element.gap');\n                const elementFontFamily = getInputValue('element.fontFamily');\n                const elementFontSize = getInputValue('element.fontSize');\n                const elementOpacity = getInputValue('element.opacity');\n                const elementColor = getInputValue('element.color');\n                const elementHoverBg = getInputValue('element.hoverBackground');\n                \n                if (!preserveAll) {\n                    // Only store changed values\n                    if (!customSettings.element) customSettings.element = {};\n                    if (elementBg && elementBg !== elementSettings.background) customSettings.element.background = elementBg;\n                    if (elementMargin && elementMargin !== elementSettings.margin) customSettings.element.margin = elementMargin;\n                    if (elementPadding && elementPadding !== elementSettings.padding) customSettings.element.padding = elementPadding;\n                    if (elementPaddingVertical && elementPaddingVertical !== (elementSettings.paddingVertical || elementSettings.padding)) customSettings.element.paddingVertical = elementPaddingVertical;\n                    if (elementPaddingHorizontal && elementPaddingHorizontal !== (elementSettings.paddingHorizontal || elementSettings.padding)) customSettings.element.paddingHorizontal = elementPaddingHorizontal;\n                    if (elementGap && elementGap !== elementSettings.gap) customSettings.element.gap = elementGap;\n                    if (elementFontFamily && elementFontFamily !== elementSettings.fontFamily) customSettings.element.fontFamily = elementFontFamily;\n                    if (elementFontSize && elementFontSize !== elementSettings.fontSize) customSettings.element.fontSize = elementFontSize;\n                    if (elementOpacity && elementOpacity !== elementSettings.opacity) customSettings.element.opacity = elementOpacity;\n                    if (elementColor && elementColor !== elementSettings.color) customSettings.element.color = elementColor;\n                    if (elementHoverBg && elementHoverBg !== elementSettings.hoverBackground) customSettings.element.hoverBackground = elementHoverBg;\n                } else {\n                    // Store all values\n                    customSettings.element = {\n                        background: elementBg || elementSettings.background,\n                        margin: elementMargin || elementSettings.margin,\n                        padding: elementPadding || elementSettings.padding,\n                        paddingVertical: elementPaddingVertical || elementSettings.paddingVertical || elementSettings.padding,\n                        paddingHorizontal: elementPaddingHorizontal || elementSettings.paddingHorizontal || elementSettings.padding,\n                        gap: elementGap || elementSettings.gap,\n                        fontFamily: elementFontFamily || elementSettings.fontFamily,\n                        fontSize: elementFontSize || elementSettings.fontSize,\n                        opacity: elementOpacity || elementSettings.opacity,\n                        color: elementColor || elementSettings.color,\n                        hoverBackground: elementHoverBg || elementSettings.hoverBackground\n                    };\n                }\n            }\n            \n            if (visualSettingsManager) {\n                visualSettingsManager.setObjectSettings(type, id, customSettings, preserveAll);\n            }\n            this.closeModal();\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        };\n        \n        // Add save button\n        const saveBtn = document.createElement('button');\n        saveBtn.textContent = 'Save';\n        saveBtn.style.cssText = 'padding: 10px 20px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: 600; margin-top: 20px; width: 100%;';\n        \n        // Enhanced save handler that supports both instance-specific and tag-based settings\n        saveBtn.addEventListener('click', () => {\n            const tagSelect = document.getElementById('visual-tag-select');\n            const newTagInput = document.getElementById('visual-new-tag');\n            const tagViewFormat = document.getElementById('visual-tag-view-format');\n            \n            const selectedTag = tagSelect?.value || newTagInput?.value?.trim().toLowerCase();\n            const instanceSpecific = instanceSpecificCheckbox?.checked || false;\n            \n            // If tag is selected, save as tag settings\n            if (selectedTag) {\n                const viewFormat = tagViewFormat?.value || null;\n                const preserveAll = document.getElementById('visual-preserve-all')?.checked || false;\n                \n                // Collect settings (reuse the same logic)\n                const customSettings = {};\n                const pageSettings = currentSettings.page || {};\n                const elementSettings = currentSettings.element || {};\n                \n                const getInputValue = (path) => {\n                    const input = modalBody.querySelector(`[data-setting-path=\"${path}\"]`) || \n                                 document.querySelector(`[data-setting-path=\"${path}\"]`);\n                    if (!input) return null;\n                    if (input.type === 'color') return input.value;\n                    if (input.type === 'range' || input.type === 'number') {\n                        const numValue = parseFloat(input.value);\n                        if (path.includes('opacity')) {\n                            return (numValue / 100).toFixed(2);\n                        } else if (path.includes('Size') || path.includes('margin') || path.includes('padding') || path.includes('borderRadius') || path.includes('size') || path.includes('gap')) {\n                            return numValue + 'px';\n                        }\n                        return input.value;\n                    }\n                    return input.value;\n                };\n                \n                // Collect page settings\n                if (type === 'pane' || type === 'page' || type === 'bin') {\n                    const pageBg = getInputValue('page.background');\n                    const pageMargin = getInputValue('page.margin');\n                    const pagePadding = getInputValue('page.padding');\n                    const pageBorderRadius = getInputValue('page.borderRadius');\n                    const pageFontFamily = getInputValue('page.fontFamily');\n                    const pageFontSize = getInputValue('page.fontSize');\n                    const pageOpacity = getInputValue('page.opacity');\n                    const pageColor = getInputValue('page.color');\n                    \n                    if (!preserveAll) {\n                        if (!customSettings.page) customSettings.page = {};\n                        if (pageBg && pageBg !== pageSettings.background) customSettings.page.background = pageBg;\n                        if (pageMargin && pageMargin !== pageSettings.margin) customSettings.page.margin = pageMargin;\n                        if (pagePadding && pagePadding !== pageSettings.padding) customSettings.page.padding = pagePadding;\n                        if (pageBorderRadius && pageBorderRadius !== pageSettings.borderRadius) customSettings.page.borderRadius = pageBorderRadius;\n                        if (pageFontFamily && pageFontFamily !== pageSettings.fontFamily) customSettings.page.fontFamily = pageFontFamily;\n                        if (pageFontSize && pageFontSize !== pageSettings.fontSize) customSettings.page.fontSize = pageFontSize;\n                        if (pageOpacity && pageOpacity !== pageSettings.opacity) customSettings.page.opacity = pageOpacity;\n                        if (pageColor && pageColor !== pageSettings.color) customSettings.page.color = pageColor;\n                    } else {\n                        customSettings.page = {\n                            background: pageBg || pageSettings.background,\n                            margin: pageMargin || pageSettings.margin,\n                            padding: pagePadding || pageSettings.padding,\n                            borderRadius: pageBorderRadius || pageSettings.borderRadius,\n                            fontFamily: pageFontFamily || pageSettings.fontFamily,\n                            fontSize: pageFontSize || pageSettings.fontSize,\n                            opacity: pageOpacity || pageSettings.opacity,\n                            color: pageColor || pageSettings.color\n                        };\n                    }\n                }\n                \n                // Collect element settings\n                if (type === 'element' || type === 'bin') {\n                    const elementBg = getInputValue('element.background');\n                    const elementMargin = getInputValue('element.margin');\n                    const elementPadding = getInputValue('element.padding');\n                    const elementPaddingVertical = getInputValue('element.paddingVertical');\n                    const elementPaddingHorizontal = getInputValue('element.paddingHorizontal');\n                    const elementGap = getInputValue('element.gap');\n                    const elementFontFamily = getInputValue('element.fontFamily');\n                    const elementFontSize = getInputValue('element.fontSize');\n                    const elementOpacity = getInputValue('element.opacity');\n                    const elementColor = getInputValue('element.color');\n                    const elementHoverBg = getInputValue('element.hoverBackground');\n                    \n                    if (!preserveAll) {\n                        if (!customSettings.element) customSettings.element = {};\n                        if (elementBg && elementBg !== elementSettings.background) customSettings.element.background = elementBg;\n                        if (elementMargin && elementMargin !== elementSettings.margin) customSettings.element.margin = elementMargin;\n                        if (elementPadding && elementPadding !== elementSettings.padding) customSettings.element.padding = elementPadding;\n                        if (elementPaddingVertical && elementPaddingVertical !== (elementSettings.paddingVertical || elementSettings.padding)) customSettings.element.paddingVertical = elementPaddingVertical;\n                        if (elementPaddingHorizontal && elementPaddingHorizontal !== (elementSettings.paddingHorizontal || elementSettings.padding)) customSettings.element.paddingHorizontal = elementPaddingHorizontal;\n                        if (elementGap && elementGap !== elementSettings.gap) customSettings.element.gap = elementGap;\n                        if (elementFontFamily && elementFontFamily !== elementSettings.fontFamily) customSettings.element.fontFamily = elementFontFamily;\n                        if (elementFontSize && elementFontSize !== elementSettings.fontSize) customSettings.element.fontSize = elementFontSize;\n                        if (elementOpacity && elementOpacity !== elementSettings.opacity) customSettings.element.opacity = elementOpacity;\n                        if (elementColor && elementColor !== elementSettings.color) customSettings.element.color = elementColor;\n                        if (elementHoverBg && elementHoverBg !== elementSettings.hoverBackground) customSettings.element.hoverBackground = elementHoverBg;\n                    } else {\n                        customSettings.element = {\n                            background: elementBg || elementSettings.background,\n                            margin: elementMargin || elementSettings.margin,\n                            padding: elementPadding || elementSettings.padding,\n                            paddingVertical: elementPaddingVertical || elementSettings.paddingVertical || elementSettings.padding,\n                            paddingHorizontal: elementPaddingHorizontal || elementSettings.paddingHorizontal || elementSettings.padding,\n                            gap: elementGap || elementSettings.gap,\n                            fontFamily: elementFontFamily || elementSettings.fontFamily,\n                            fontSize: elementFontSize || elementSettings.fontSize,\n                            opacity: elementOpacity || elementSettings.opacity,\n                            color: elementColor || elementSettings.color,\n                            hoverBackground: elementHoverBg || elementSettings.hoverBackground\n                        };\n                    }\n                }\n                \n                // Save tag settings\n                visualSettingsManager.setTagSettings(selectedTag, customSettings, preserveAll, viewFormat);\n                \n                // Add tag to tag manager if it's new\n                if (newTagInput?.value?.trim() && !allTags.includes(selectedTag)) {\n                    const tagManager = this._getTagManager();\n                    tagManager?.addTag(selectedTag);\n                }\n                \n                this.closeModal();\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            } else if (instanceSpecific) {\n                // Save as instance-specific settings\n                saveVisualSettings();\n            } else {\n                // No tag and not instance-specific - just close\n                this.closeModal();\n            }\n        });\n        \n        modalBody.appendChild(saveBtn);\n        \n        // Export button\n        const exportBtn = document.getElementById('visual-export-btn');\n        if (exportBtn) {\n            exportBtn.addEventListener('click', () => {\n                if (!visualSettingsManager) return;\n                const settings = visualSettingsManager.exportSettings(type, id);\n                const blob = new Blob([settings], { type: 'application/json' });\n                const url = URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.href = url;\n                a.download = `visual-settings-${type}-${id}.json`;\n                a.click();\n                URL.revokeObjectURL(url);\n            });\n        }\n        \n        // Import button\n        const importBtn = document.getElementById('visual-import-btn');\n        const importFile = document.getElementById('visual-import-file');\n        if (importBtn && importFile) {\n            importBtn.addEventListener('click', () => importFile.click());\n            importFile.addEventListener('change', (e) => {\n                const file = e.target.files[0];\n                if (file) {\n                    const reader = new FileReader();\n                    reader.onload = (event) => {\n                        const imported = JSON.parse(event.target.result);\n                        if (imported.custom && visualSettingsManager) {\n                            const preserveAll = imported.preserveAll || false;\n                            visualSettingsManager.setObjectSettings(type, id, imported.custom, preserveAll);\n                            this.closeModal();\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                        }\n                    };\n                    reader.readAsText(file);\n                }\n            });\n        }\n        \n        // Reset button\n        const resetBtn = document.getElementById('visual-reset-btn');\n        if (resetBtn) {\n            resetBtn.addEventListener('click', () => {\n                if (confirm('Remove all custom visual settings for this object?') && visualSettingsManager) {\n                    visualSettingsManager.removeObjectSettings(type, id);\n                    this.closeModal();\n                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                }\n            });\n        }\n    }\n    \n    createPageVisualControls(settings) {\n        const pageSettings = settings.page || {};\n        const settingsManager = this.app.settingsManager;\n        \n        let html = '<div class=\"settings-section\">';\n        html += '<div class=\"settings-section-title\" style=\"cursor: pointer; padding: 10px; background: #2a2a2a; border-radius: 4px; margin-bottom: 10px;\">';\n        html += '<span style=\"font-weight: 600;\">Page Styles</span>';\n        html += '</div>';\n        html += '<div class=\"settings-section-content\">';\n        html += settingsManager.createColorControl('page.background', 'Background Color', pageSettings.background || '#2d2d2d');\n        html += settingsManager.createSliderControl('page.margin', 'Margin', pageSettings.margin || '0px', 0, 50, 1, 'px');\n        html += settingsManager.createSliderControl('page.padding', 'Padding', pageSettings.padding || '20px', 0, 50, 1, 'px');\n        html += settingsManager.createSliderControl('page.borderRadius', 'Border Radius', pageSettings.borderRadius || '8px', 0, 30, 1, 'px');\n        html += settingsManager.createTextControl('page.fontFamily', 'Font Family', pageSettings.fontFamily || '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif');\n        html += settingsManager.createSliderControl('page.fontSize', 'Font Size', pageSettings.fontSize || '14px', 8, 32, 1, 'px');\n        html += settingsManager.createOpacityControl('page.opacity', 'Opacity', pageSettings.opacity || '1');\n        html += settingsManager.createColorControl('page.color', 'Text Color', pageSettings.color || '#e0e0e0');\n        html += '</div>';\n        html += '</div>';\n        \n        return html;\n    }\n    \n    createBinVisualControls(settings) {\n        let html = this.createPageVisualControls(settings);\n        html += this.createElementVisualControls(settings);\n        return html;\n    }\n    \n    createElementVisualControls(settings) {\n        const elementSettings = settings.element || {};\n        const settingsManager = this.app.settingsManager;\n        \n        let html = '<div class=\"settings-section\">';\n        html += '<div class=\"settings-section-title\" style=\"cursor: pointer; padding: 10px; background: #2a2a2a; border-radius: 4px; margin-bottom: 10px; margin-top: 20px;\">';\n        html += '<span style=\"font-weight: 600;\">Element Styles</span>';\n        html += '</div>';\n        html += '<div class=\"settings-section-content\">';\n        html += settingsManager.createColorControl('element.background', 'Background Color', elementSettings.background || 'transparent');\n        html += settingsManager.createSliderControl('element.margin', 'Margin', elementSettings.margin || '0px', 0, 30, 1, 'px');\n        html += settingsManager.createSliderControl('element.padding', 'Padding (All)', elementSettings.padding || '10px', 0, 30, 1, 'px');\n        html += settingsManager.createSliderControl('element.paddingVertical', 'Padding (Vertical)', elementSettings.paddingVertical || elementSettings.padding || '10px', 0, 30, 1, 'px');\n        html += settingsManager.createSliderControl('element.paddingHorizontal', 'Padding (Horizontal)', elementSettings.paddingHorizontal || elementSettings.padding || '10px', 0, 30, 1, 'px');\n        html += settingsManager.createSliderControl('element.gap', 'Element Gap', elementSettings.gap || '8px', 0, 30, 1, 'px');\n        html += settingsManager.createTextControl('element.fontFamily', 'Font Family', elementSettings.fontFamily || '-apple-system, BlinkMacSystemFont, \\'Segoe UI\\', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif');\n        html += settingsManager.createSliderControl('element.fontSize', 'Font Size', elementSettings.fontSize || '14px', 8, 32, 1, 'px');\n        html += settingsManager.createOpacityControl('element.opacity', 'Opacity', elementSettings.opacity || '1');\n        html += settingsManager.createColorControl('element.color', 'Text Color', elementSettings.color || '#e0e0e0');\n        html += settingsManager.createColorControl('element.hoverBackground', 'Hover Background', elementSettings.hoverBackground || '#363636');\n        html += '</div>';\n        html += '</div>';\n        \n        return html;\n    }\n}\n\n","// FileManager.js - Handles server-side file management\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class FileManager {\n    constructor() {\n        this.currentFilename = null;\n        this.lastOpenedFileKey = 'twodo-last-opened-file';\n        // Backup loading state\n        this.originalFilename = null;  // The original file that was backed up\n        this.tempFilename = null;  // Temporary filename for saves (filename-1.json, overwritten by autosaves)\n        this.isBackupLoaded = false;  // Whether a backup file was loaded\n        this.backupDiffers = false;  // Whether the backup differs from current file\n    }\n    \n    /**\n     * Get services\n     */\n    _getModalHandler() {\n        return getService(SERVICES.MODAL_HANDLER);\n    }\n    \n    _getUndoRedoManager() {\n        return getService(SERVICES.UNDO_REDO_MANAGER);\n    }\n    \n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n\n    _normalizeFileData(rawData) {\n        if (!rawData || typeof rawData !== 'object') {\n            return { documents: [] };\n        }\n        const normalized = { ...rawData };\n        normalized.documents = normalized.documents || [];\n        const dataManager = this._getDataManager();\n        return dataManager ? dataManager.normalizeDataModel(normalized) : normalized;\n    }\n    \n    async listFiles() {\n        try {\n            const response = await fetch('/files');\n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            const result = await response.json();\n            if (result.success) {\n                return result.files || [];\n            } else {\n                throw new Error(result.error || 'Failed to list files');\n            }\n        } catch (error) {\n            console.error('Error listing files:', error);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                modalHandler.showAlert('Failed to list files: ' + error.message);\n            } else {\n                alert('Failed to list files: ' + error.message);\n            }\n            return [];\n        }\n    }\n    \n    async saveFile(filename, data, silent = false, saveIndexes = true) {\n        try {\n            // If backup is loaded and differs, use temp filename for saves\n            let actualFilename = filename;\n            if (this.isBackupLoaded && this.backupDiffers && this.tempFilename) {\n                actualFilename = this.tempFilename;\n            }\n            \n            const response = await fetch('/files/save', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    filename: actualFilename,\n                    data: data,\n                    createBackup: !silent  // Create backup only for manual saves (not autosave)\n                })\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                // If this was an autosave with temp file, keep using the same temp filename (overwrite)\n                if (this.isBackupLoaded && this.backupDiffers && silent && this.tempFilename) {\n                    this.currentFilename = this.tempFilename;\n                    // Keep tempFilename the same - autosaves overwrite the same temp file\n                } else if (!this.isBackupLoaded || !this.backupDiffers || !silent) {\n                    // Normal save or manual save that resolved temp file\n                    this.currentFilename = result.filename;\n                } else {\n                    this.currentFilename = this.tempFilename;\n                }\n                \n                // Trigger buffer save after main file save\n                const undoRedoManager = this._getUndoRedoManager();\n                if (undoRedoManager) {\n                    undoRedoManager._debouncedSaveBuffer();\n                }\n                \n                if (saveIndexes) {\n                    await this._saveDerivedIndexes(actualFilename, data, true);\n                }\n                return result;\n            } else {\n                throw new Error(result.error || 'Failed to save file');\n            }\n        } catch (error) {\n            console.error('Error saving file:', error);\n            // Only show alert if not silent (for autosave)\n            if (!silent) {\n                const modalHandler = this._getModalHandler();\n                if (modalHandler) {\n                    await modalHandler.showAlert('Failed to save file: ' + error.message);\n                } else {\n                    alert('Failed to save file: ' + error.message);\n                }\n            }\n            throw error;\n        }\n    }\n    \n    async saveAsFile(filename, data, saveIndexes = true) {\n        try {\n            const response = await fetch('/files/save-as', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    filename: filename,\n                    data: data,\n                    createBackup: true  // Always create backup for Save As (manual save)\n                })\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                this.currentFilename = result.filename;\n                if (saveIndexes) {\n                    await this._saveDerivedIndexes(result.filename, data, true);\n                }\n                return result;\n            } else {\n                throw new Error(result.error || 'Failed to save file');\n            }\n        } catch (error) {\n            console.error('Error saving file:', error);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                await modalHandler.showAlert('Failed to save file: ' + error.message);\n            } else {\n                alert('Failed to save file: ' + error.message);\n            }\n            throw error;\n        }\n    }\n\n    _buildGroupIndexPayload(documents) {\n        const payload = {\n            generatedAt: new Date().toISOString(),\n            documents: {}\n        };\n\n        (documents || []).forEach(doc => {\n            const groupIndex = {};\n            const groups = doc.groups || [];\n            groups.forEach(group => {\n                groupIndex[group.id] = {\n                    id: group.id,\n                    parentGroupId: group.parentGroupId ?? null,\n                    level: typeof group.level === 'number' ? group.level : 0,\n                    childIds: [],\n                    ancestorIds: []\n                };\n            });\n\n            groups.forEach(group => {\n                const entry = groupIndex[group.id];\n                if (!entry) return;\n                const parentId = entry.parentGroupId;\n                if (parentId && groupIndex[parentId]) {\n                    groupIndex[parentId].childIds.push(group.id);\n                }\n            });\n\n            Object.values(groupIndex).forEach(entry => {\n                const ancestors = [];\n                let currentParent = entry.parentGroupId;\n                while (currentParent && groupIndex[currentParent]) {\n                    ancestors.push(currentParent);\n                    currentParent = groupIndex[currentParent].parentGroupId;\n                }\n                entry.ancestorIds = ancestors;\n            });\n\n            payload.documents[doc.id] = {\n                groupMode: doc.groupMode || doc.config?.groupMode || 'manual',\n                groups: groupIndex\n            };\n        });\n\n        return payload;\n    }\n\n    async _saveDerivedIndexes(filename, data, silent = true) {\n        if (!data || !Array.isArray(data.documents)) {\n            return;\n        }\n\n        const indexPayload = this._buildGroupIndexPayload(data.documents);\n        const indexFilename = `indexes/${filename}.groups.json`;\n        await this.saveFile(indexFilename, indexPayload, silent, false);\n    }\n    \n    async loadFile(filename, loadBuffer = true) {\n        const perfStart = performance.now();\n        try {\n            const encodedFilename = encodeURIComponent(filename);\n            // Use AbortController for timeout handling\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 5000);\n            \n            try {\n                const fetchStart = performance.now();\n                // Add timestamp to bypass browser cache and ensure fresh data\n                const fetchUrl = `/files/${encodedFilename}?t=${Date.now()}`;\n                \n                // Check how many requests are in flight before our fetch\n                const requestsBefore = performance.getEntriesByType('resource').length;\n                // console.log(`[DIAG] FileManager.loadFile(): ${requestsBefore} resource requests before fetch`);\n                \n                const response = await fetch(fetchUrl, {\n                    signal: controller.signal,\n                    cache: 'no-store' // Use no-store instead of no-cache for stronger cache bypass\n                });\n                const fetchTime = performance.now() - fetchStart;\n                clearTimeout(timeoutId);\n                \n                // Extract network timing - wait a bit for timing to be available\n                setTimeout(() => {\n                    const resourceTimings = performance.getEntriesByType('resource');\n                    const resourceTiming = resourceTimings.find(entry => entry.name.includes(encodedFilename));\n                    if (resourceTiming) {\n                        // console.log('[DIAG] FileManager.loadFile() network timing:', {\n                        //     stalled: (resourceTiming.requestStart - resourceTiming.fetchStart).toFixed(1) + 'ms',\n                        //     dns: (resourceTiming.domainLookupEnd - resourceTiming.domainLookupStart).toFixed(1) + 'ms',\n                        //     tcp: (resourceTiming.connectEnd - resourceTiming.connectStart).toFixed(1) + 'ms',\n                        //     ttfb: (resourceTiming.responseStart - resourceTiming.requestStart).toFixed(1) + 'ms',\n                        //     download: (resourceTiming.responseEnd - resourceTiming.responseStart).toFixed(1) + 'ms',\n                        //     total: resourceTiming.duration.toFixed(1) + 'ms'\n                        // });\n                    } else {\n                        // console.log('[DIAG] FileManager.loadFile(): Could not find resource timing entry');\n                    }\n                }, 100);\n                \n                if (!response.ok) {\n                    // If 404, the file doesn't exist - rethrow to allow caller to handle\n                    if (response.status === 404) {\n                        const error = new Error(`File not found: ${filename}`);\n                        error.status = 404;\n                        throw error;\n                    }\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n                \n                const parseStart = performance.now();\n                const result = await response.json();\n                const parseTime = performance.now() - parseStart;\n                \n                if (result.success) {\n                    this.currentFilename = result.filename;\n                    \n                    // Set timestamp to prevent stale sync data from overwriting freshly loaded data\n                    const dataManager = this._getDataManager();\n                    if (dataManager) {\n                        dataManager._lastSyncTimestamp = Date.now();\n                    }\n                    \n                    // Load corresponding buffer file after loading main file (if requested)\n                    if (loadBuffer) {\n                        const undoRedoManager = this._getUndoRedoManager();\n                        if (undoRedoManager) {\n                            const bufferStart = performance.now();\n                            await undoRedoManager.loadBuffer(result.filename);\n                            const bufferTime = performance.now() - bufferStart;\n                            console.log(`[PERF] Buffer load: ${bufferTime.toFixed(1)}ms`);\n                        }\n                    }\n                    \n                    const totalTime = performance.now() - perfStart;\n                    console.log(`[PERF] File load ${filename}: fetch=${fetchTime.toFixed(1)}ms, parse=${parseTime.toFixed(1)}ms, total=${totalTime.toFixed(1)}ms`);\n                    \n                    return result.data;\n                } else {\n                    throw new Error(result.error || 'Failed to load file');\n                }\n            } catch (fetchError) {\n                clearTimeout(timeoutId);\n                if (fetchError.name === 'AbortError') {\n                    throw new Error('File load timeout');\n                }\n                throw fetchError;\n            }\n        } catch (error) {\n            // Only show alert for non-404 errors (404 is handled by caller)\n            if (error.status !== 404 && !error.message.includes('timeout')) {\n                console.error('Error loading file:', error);\n                const modalHandler = this._getModalHandler();\n                if (modalHandler) {\n                    await modalHandler.showAlert('Failed to load file: ' + error.message);\n                } else {\n                    alert('Failed to load file: ' + error.message);\n                }\n            }\n            throw error;\n        }\n    }\n    \n    async renameFile(oldFilename, newFilename) {\n        try {\n            const encodedFilename = encodeURIComponent(oldFilename);\n            const response = await fetch(`/files/${encodedFilename}/rename`, {\n                method: 'PUT',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    filename: newFilename\n                })\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                if (this.currentFilename === oldFilename) {\n                    this.currentFilename = result.filename;\n                }\n                return result;\n            } else {\n                throw new Error(result.error || 'Failed to rename file');\n            }\n        } catch (error) {\n            console.error('Error renaming file:', error);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                await modalHandler.showAlert('Failed to rename file: ' + error.message);\n            } else {\n                alert('Failed to rename file: ' + error.message);\n            }\n            throw error;\n        }\n    }\n    \n    async deleteFile(filename) {\n        try {\n            const encodedFilename = encodeURIComponent(filename);\n            const response = await fetch(`/files/${encodedFilename}`, {\n                method: 'DELETE'\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                if (this.currentFilename === filename) {\n                    this.currentFilename = null;\n                }\n                return result;\n            } else {\n                throw new Error(result.error || 'Failed to delete file');\n            }\n        } catch (error) {\n            console.error('Error deleting file:', error);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                await modalHandler.showAlert('Failed to delete file: ' + error.message);\n            } else {\n                alert('Failed to delete file: ' + error.message);\n            }\n            throw error;\n        }\n    }\n    \n    showFileManager() {\n        const modal = document.getElementById('modal');\n        const modalBody = document.getElementById('modal-body');\n        \n        if (!modal || !modalBody) {\n            console.error('[FileManager] Modal elements not found!');\n            return;\n        }\n        \n        modalBody.innerHTML = `\n            <h3>File Manager</h3>\n            <div style=\"margin-top: 20px;\">\n                <div style=\"display: flex; gap: 10px; margin-bottom: 20px;\">\n                    <button id=\"file-manager-new\" style=\"padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 18px; line-height: 1;\">+</button>\n                    <button id=\"file-manager-save\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\"> Save</button>\n                    <button id=\"file-manager-save-as\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\"> Save As</button>\n                    <button id=\"file-manager-refresh\" style=\"padding: 8px 16px; background: #555; color: white; border: none; border-radius: 4px; cursor: pointer;\"> Refresh</button>\n                </div>\n                <div id=\"file-manager-list\" style=\"max-height: 400px; overflow-y: auto; border: 1px solid #444; border-radius: 4px; padding: 10px; background: #1a1a1a;\">\n                    <div style=\"text-align: center; color: #888; padding: 20px;\">Loading files...</div>\n                </div>\n            </div>\n        `;\n        \n        modal.classList.add('active');\n        \n        // Attach event listeners\n        const newBtn = document.getElementById('file-manager-new');\n        const saveBtn = document.getElementById('file-manager-save');\n        const saveAsBtn = document.getElementById('file-manager-save-as');\n        const refreshBtn = document.getElementById('file-manager-refresh');\n        \n        if (newBtn) {\n            newBtn.onclick = () => this.handleNew();\n        }\n        if (saveBtn) {\n            saveBtn.onclick = () => this.handleSave();\n        }\n        if (saveAsBtn) {\n            saveAsBtn.onclick = () => this.handleSaveAs();\n        }\n        if (refreshBtn) {\n            refreshBtn.onclick = () => this.refreshFileList();\n        }\n        \n        // Load file list\n        this.refreshFileList();\n    }\n    \n    async refreshFileList() {\n        const listDiv = document.getElementById('file-manager-list');\n        if (!listDiv) return;\n        \n        listDiv.innerHTML = '<div style=\"text-align: center; color: #888; padding: 20px;\">Loading files...</div>';\n        \n        const files = await this.listFiles();\n        \n        if (files.length === 0) {\n            listDiv.innerHTML = '<div style=\"text-align: center; color: #888; padding: 20px;\">No saved files</div>';\n            return;\n        }\n        \n        let html = '<div style=\"display: flex; flex-direction: column; gap: 8px;\">';\n        files.forEach(file => {\n            const isCurrent = file.filename === this.currentFilename;\n            const modifiedDate = new Date(file.modified * 1000).toLocaleString();\n            const sizeKB = (file.size / 1024).toFixed(1);\n            \n            html += `\n                <div style=\"display: flex; align-items: center; justify-content: space-between; padding: 10px; background: ${isCurrent ? '#2a4a6a' : '#2a2a2a'}; border-radius: 4px; border: 1px solid #444;\">\n                    <div style=\"flex: 1;\">\n                        <div style=\"font-weight: ${isCurrent ? 'bold' : 'normal'}; color: ${isCurrent ? '#4a9eff' : '#e0e0e0'};\">\n                            ${file.filename} ${isCurrent ? '(current)' : ''}\n                        </div>\n                        <div style=\"font-size: 12px; color: #888; margin-top: 4px;\">\n                            ${sizeKB} KB  ${modifiedDate}\n                        </div>\n                    </div>\n                    <div style=\"display: flex; gap: 8px;\">\n                        <button onclick=\"window.app.fileManager.handleLoad('${file.filename}')\" \n                                style=\"padding: 6px 12px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;\"> Load</button>\n                        <button onclick=\"window.app.fileManager.handleLoadBackup('${file.filename}')\" \n                                style=\"padding: 6px 12px; background: #6a8eff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;\"> Load .bak</button>\n                        <button onclick=\"window.app.fileManager.handleRename('${file.filename}')\" \n                                style=\"padding: 6px 12px; background: #888; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;\"> Rename</button>\n                        <button onclick=\"window.app.fileManager.handleDelete('${file.filename}')\" \n                                style=\"padding: 6px 12px; background: #ff5555; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;\"> Delete</button>\n                    </div>\n                </div>\n            `;\n        });\n        html += '</div>';\n        \n        listDiv.innerHTML = html;\n    }\n    \n    async handleSave() {\n        // If backup was loaded and differs, prompt user to overwrite or save as\n        if (this.isBackupLoaded && this.backupDiffers && this.originalFilename) {\n            let choice;\n            if (this.app && this.app.modalHandler) {\n                choice = await this.app.modalHandler.showConfirm(\n                    `You loaded a backup file that differs from ${this.originalFilename}.\\n\\n` +\n                    `Do you want to overwrite ${this.originalFilename} with your current changes?\\n\\n` +\n                    `Click OK to overwrite, or Cancel to save as a new file.`\n                );\n            } else {\n                choice = confirm(\n                    `You loaded a backup file that differs from ${this.originalFilename}.\\n\\n` +\n                    `Do you want to overwrite ${this.originalFilename} with your current changes?\\n\\n` +\n                    `Click OK to overwrite, or Cancel to save as a new file.`\n                );\n            }\n            \n            if (choice) {\n                // Overwrite original file\n                try {\n                    const fileData = {\n                        documents: this._getAppState().documents\n                    };\n                    \n                    // Store temp filename for cleanup\n                    const tempFileToDelete = this.tempFilename;\n                    \n                    // Reset backup loading state BEFORE saving so saveFile uses original filename\n                    const originalFile = this.originalFilename;\n                    this.originalFilename = null;\n                    this.tempFilename = null;\n                    this.isBackupLoaded = false;\n                    this.backupDiffers = false;\n                    \n                    // Now save to original file\n                    await this.saveFile(originalFile, fileData);\n                    \n                    // Clean up temporary file\n                    if (tempFileToDelete) {\n                        await this.deleteFile(tempFileToDelete).catch(err => {\n                            console.warn('Failed to delete temp file:', err);\n                        });\n                    }\n                    \n                    if (this.app && this.app.modalHandler) {\n                        await this.app.modalHandler.showAlert(`File saved: ${originalFile}`);\n                    } else {\n                        alert(`File saved: ${originalFile}`);\n                    }\n                    this.refreshFileList();\n                } catch (error) {\n                    // Error already shown in saveFile\n                }\n            } else {\n                // Save as new file\n                this.handleSaveAs();\n            }\n            return;\n        }\n        \n        // Normal save flow\n        if (!this.currentFilename) {\n            this.handleSaveAs();\n            return;\n        }\n        \n        try {\n            const fileData = {\n                documents: this._getAppState().documents\n            };\n            \n            console.log('[FileManager] Manual save - currentFilename:', this.currentFilename);\n            await this.saveFile(this.currentFilename, fileData);\n            console.log('[FileManager] Manual save successful');\n            \n            // If we just saved and had a temp file, clean it up and reset state\n            if (this.isBackupLoaded && this.tempFilename && this.currentFilename === this.tempFilename) {\n                // This shouldn't happen in normal flow, but handle it just in case\n                this.isBackupLoaded = false;\n                this.backupDiffers = false;\n                this.tempFilename = null;\n                this.originalFilename = null;\n                this.tempFileCounter = 0;\n            }\n            \n            if (this.app && this.app.modalHandler) {\n                await this.app.modalHandler.showAlert(`File saved: ${this.currentFilename}`);\n            } else {\n                alert(`File saved: ${this.currentFilename}`);\n            }\n            this.refreshFileList();\n        } catch (error) {\n            // Error already shown in saveFile\n        }\n    }\n    \n    async handleSaveAs() {\n        const defaultName = this.currentFilename ? this.currentFilename.replace('.json', '').replace(/-\\d+$/, '') : '';\n        let filename;\n        \n        if (this.app && this.app.modalHandler) {\n            filename = await this.app.modalHandler.showPrompt('Enter filename (without .json extension):', defaultName);\n        } else {\n            filename = prompt('Enter filename (without .json extension):', defaultName);\n        }\n        \n        if (!filename) return;\n        \n        try {\n            const fileData = {\n                documents: this._getAppState().documents\n            };\n            \n            // Store temp filename for cleanup\n            const tempFileToDelete = this.tempFilename;\n            \n            // Reset backup loading state BEFORE saving\n            this.originalFilename = null;\n            this.tempFilename = null;\n            this.isBackupLoaded = false;\n            this.backupDiffers = false;\n            \n            await this.saveAsFile(filename, fileData);\n            \n            // Clean up temporary file if backup was loaded\n            if (tempFileToDelete) {\n                await this.deleteFile(tempFileToDelete).catch(err => {\n                    console.warn('Failed to delete temp file:', err);\n                });\n            }\n            \n            if (this.app && this.app.modalHandler) {\n                await this.app.modalHandler.showAlert(`File saved as: ${this.currentFilename}`);\n            } else {\n                alert(`File saved as: ${this.currentFilename}`);\n            }\n            this.refreshFileList();\n        } catch (error) {\n            // Error already shown in saveAsFile\n        }\n    }\n    \n    async handleLoad(filename) {\n        let confirmed;\n        if (this.app && this.app.modalHandler) {\n            confirmed = await this.app.modalHandler.showConfirm(`Load ${filename}? This will replace your current data.`);\n        } else {\n            confirmed = confirm(`Load ${filename}? This will replace your current data.`);\n        }\n        \n        if (!confirmed) {\n            return;\n        }\n        \n        try {\n            const fileData = await this.loadFile(filename);\n            const normalizedFile = this._normalizeFileData(fileData);\n            \n            if (!normalizedFile.documents || !Array.isArray(normalizedFile.documents)) {\n                if (this.app && this.app.modalHandler) {\n                    await this.app.modalHandler.showAlert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                } else {\n                    alert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                }\n                return;\n            }\n            \n            // Update appState.documents\n            const appState = this._getAppState();\n            appState.documents = normalizedFile.documents;\n            // Update currentDocumentId if needed\n            if (normalizedFile.documents.length > 0 && !normalizedFile.documents.find(doc => doc.id === appState.currentDocumentId)) {\n                appState.currentDocumentId = normalizedFile.documents[0].id;\n            }\n            \n            // Store last opened file in localStorage (device-specific)\n            localStorage.setItem(this.lastOpenedFileKey, filename);\n            \n            // Request render via EventBus\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                modalHandler.closeModal();\n                await modalHandler.showAlert(`File loaded: ${filename}`);\n            } else {\n                alert(`File loaded: ${filename}`);\n            }\n            this.refreshFileList();\n            \n            // Connect to sync and join file session\n            if (this.app.syncManager) {\n                if (!this.app.syncManager.isConnected) {\n                    await this.app.syncManager.connect();\n                }\n                this.app.syncManager.joinFile(filename);\n            }\n            \n            // Set current file in undo/redo manager (this loads the buffer)\n            if (this.app.undoRedoManager) {\n                await this.app.undoRedoManager.setCurrentFile(filename);\n            }\n        } catch (error) {\n            // Error already shown in loadFile\n        }\n    }\n    \n    async handleLoadBackup(filename) {\n        const backupFilename = filename + '.bak';\n        let confirmed;\n        if (this.app && this.app.modalHandler) {\n            confirmed = await this.app.modalHandler.showConfirm(`Load backup file ${backupFilename}? This will replace your current data.`);\n        } else {\n            confirmed = confirm(`Load backup file ${backupFilename}? This will replace your current data.`);\n        }\n        \n        if (!confirmed) {\n            return;\n        }\n        \n        try {\n            // Load the backup file\n            const backupData = await this.loadFile(backupFilename);\n            const normalizedBackup = this._normalizeFileData(backupData);\n            \n            if (!normalizedBackup.documents || !Array.isArray(normalizedBackup.documents)) {\n                if (this.app && this.app.modalHandler) {\n                    await this.app.modalHandler.showAlert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                } else {\n                    alert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                }\n                return;\n            }\n            \n            // Load the current file to compare\n            let currentData = null;\n            let differs = true;\n            try {\n                currentData = await this.loadFile(filename);\n                // Compare the documents data (normalize by stringifying)\n                const backupDocsStr = JSON.stringify(normalizedBackup.documents);\n                const currentDocsStr = JSON.stringify(currentData.documents || []);\n                differs = backupDocsStr !== currentDocsStr;\n            } catch (error) {\n                // Current file doesn't exist or can't be loaded - assume it differs\n                differs = true;\n            }\n            \n            // Set backup loading state\n            this.originalFilename = filename;\n            this.isBackupLoaded = true;\n            this.backupDiffers = differs;\n            \n            // Generate temporary filename if backup differs (always use -1, autosaves will overwrite it)\n            if (differs) {\n                const baseName = filename.replace('.json', '');\n                this.tempFilename = `${baseName}-1.json`;\n                this.currentFilename = this.tempFilename;\n            } else {\n                // Backup is same as current, no temp file needed\n                this.tempFilename = null;\n                this.currentFilename = filename;\n            }\n            \n            // Update appState.documents\n            const appState = this._getAppState();\n            appState.documents = normalizedBackup.documents;\n            // Update currentDocumentId if needed\n            if (normalizedBackup.documents.length > 0 && !normalizedBackup.documents.find(doc => doc.id === appState.currentDocumentId)) {\n                appState.currentDocumentId = normalizedBackup.documents[0].id;\n            }\n            \n            // Store last opened file in localStorage (device-specific) - use original filename, not backup\n            localStorage.setItem(this.lastOpenedFileKey, filename);\n            \n            // Request render via EventBus\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                modalHandler.closeModal();\n                \n                if (differs) {\n                    await modalHandler.showAlert(`Backup file loaded: ${backupFilename}\\n\\nThis backup differs from the current file. Saves will go to temporary file: ${this.tempFilename}\\n\\nWhen you manually save, you'll be asked to overwrite the original or save as a new file.`);\n                } else {\n                    await modalHandler.showAlert(`Backup file loaded: ${backupFilename}\\n\\nThis backup is identical to the current file.`);\n                }\n            } else {\n                if (differs) {\n                    alert(`Backup file loaded: ${backupFilename}\\n\\nThis backup differs from the current file. Saves will go to temporary file: ${this.tempFilename}\\n\\nWhen you manually save, you'll be asked to overwrite the original or save as a new file.`);\n                } else {\n                    alert(`Backup file loaded: ${backupFilename}\\n\\nThis backup is identical to the current file.`);\n                }\n            }\n            \n            this.refreshFileList();\n            \n            // Connect to sync and join file session (use original filename, not backup)\n            if (this.app.syncManager) {\n                if (!this.app.syncManager.isConnected) {\n                    await this.app.syncManager.connect();\n                }\n                this.app.syncManager.joinFile(filename);\n            }\n            \n            // Set current file in undo/redo manager (this loads the buffer) - use original filename\n            if (this.app.undoRedoManager) {\n                await this.app.undoRedoManager.setCurrentFile(filename);\n            }\n        } catch (error) {\n            if (this.app && this.app.modalHandler) {\n                await this.app.modalHandler.showAlert(`Failed to load backup file: ${error.message}`);\n            } else {\n                alert(`Failed to load backup file: ${error.message}`);\n            }\n        }\n    }\n    \n    async handleRename(filename) {\n        const defaultName = filename.replace('.json', '');\n        let newFilename;\n        \n        if (this.app && this.app.modalHandler) {\n            newFilename = await this.app.modalHandler.showPrompt('Enter new filename (without .json extension):', defaultName);\n        } else {\n            newFilename = prompt('Enter new filename (without .json extension):', defaultName);\n        }\n        \n        if (!newFilename || newFilename === defaultName) return;\n        \n        try {\n            await this.renameFile(filename, newFilename);\n            if (this.app && this.app.modalHandler) {\n                await this.app.modalHandler.showAlert(`File renamed to: ${newFilename}.json`);\n            } else {\n                alert(`File renamed to: ${newFilename}.json`);\n            }\n            this.refreshFileList();\n        } catch (error) {\n            // Error already shown in renameFile\n        }\n    }\n    \n    async handleDelete(filename) {\n        let confirmed;\n        if (this.app && this.app.modalHandler) {\n            confirmed = await this.app.modalHandler.showConfirm(`Delete ${filename}? This cannot be undone.`);\n        } else {\n            confirmed = confirm(`Delete ${filename}? This cannot be undone.`);\n        }\n        \n        if (!confirmed) {\n            return;\n        }\n        \n        try {\n            await this.deleteFile(filename);\n            if (this.app && this.app.modalHandler) {\n                await this.app.modalHandler.showAlert(`File deleted: ${filename}`);\n            } else {\n                alert(`File deleted: ${filename}`);\n            }\n            this.refreshFileList();\n        } catch (error) {\n            // Error already shown in deleteFile\n        }\n    }\n    \n    async handleNew() {\n        let filename;\n        if (this.app && this.app.modalHandler) {\n            filename = await this.app.modalHandler.showPrompt('Enter filename for new todo file (without .json extension):', 'new-todo');\n        } else {\n            filename = prompt('Enter filename for new todo file (without .json extension):', 'new-todo');\n        }\n        \n        if (!filename) return;\n        \n        try {\n            // Auto-save current file if one is open\n            const appState = this._getAppState();\n            if (this.currentFilename && appState && appState.documents) {\n                try {\n                    const currentData = {\n                        documents: this._getAppState().documents\n                    };\n                    await this.saveFile(this.currentFilename, currentData);\n                } catch (saveError) {\n                    // Log but don't block - continue with creating new file\n                    console.warn('Failed to auto-save current file:', saveError);\n                }\n            }\n            \n            // Create a new empty todo file with default structure\n            const newFileData = {\n                documents: []\n            };\n            \n            await this.saveAsFile(filename, newFileData);\n            \n            // Verify currentFilename was set\n            if (!this.currentFilename) {\n                console.error('[FileManager] currentFilename not set after saveAsFile!');\n                if (this.app && this.app.modalHandler) {\n                    await this.app.modalHandler.showAlert('Error: File was created but currentFilename was not set. Please reload the page.');\n                }\n                return;\n            }\n            \n            console.log('[FileManager] New file created, currentFilename:', this.currentFilename);\n            \n            // Load the new file into the UI\n            const loadedData = await this.loadFile(this.currentFilename);\n            const normalizedLoaded = this._normalizeFileData(loadedData);\n            \n            if (!normalizedLoaded.documents || !Array.isArray(normalizedLoaded.documents)) {\n                if (this.app && this.app.modalHandler) {\n                    await this.app.modalHandler.showAlert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                } else {\n                    alert('Invalid file format. Expected a JSON file with a \"documents\" array.');\n                }\n                return;\n            }\n            \n            // Update appState.documents (reuse appState from line 791)\n            appState.documents = normalizedLoaded.documents;\n            // Update currentDocumentId if needed\n            if (normalizedLoaded.documents.length > 0 && !normalizedLoaded.documents.find(doc => doc.id === appState.currentDocumentId)) {\n                appState.currentDocumentId = normalizedLoaded.documents[0].id;\n            }\n            \n            // Store last opened file in localStorage (device-specific)\n            localStorage.setItem(this.lastOpenedFileKey, this.currentFilename);\n            \n            // Request render via EventBus\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            const modalHandler = this._getModalHandler();\n            if (modalHandler) {\n                modalHandler.closeModal();\n            }\n            \n            // Refresh file list to show the new file as current\n            this.refreshFileList();\n            \n            // Connect to sync and join file session\n            if (this.app.syncManager) {\n                if (!this.app.syncManager.isConnected) {\n                    await this.app.syncManager.connect();\n                }\n                this.app.syncManager.joinFile(this.currentFilename);\n            }\n            \n            // Set current file in undo/redo manager (this initializes empty buffer for new file)\n            if (this.app.undoRedoManager) {\n                await this.app.undoRedoManager.setCurrentFile(this.currentFilename);\n                // Clear stacks for new file\n                this.app.undoRedoManager.clear();\n            }\n        } catch (error) {\n            // Error already shown in saveAsFile or loadFile\n        }\n    }\n    \n    /**\n     * Diagnose file integrity - checks for structural issues\n     */\n    async diagnoseFileIntegrity(filename) {\n        const issues = [];\n        let elementCounts = { documents: 0, groups: 0, items: 0 };\n        const structure = { documents: [], groups: [], items: [] };\n        \n        try {\n            // Load the file\n            const fileData = await this.loadFile(filename);\n            const normalizedFile = this._normalizeFileData(fileData);\n            \n            if (!normalizedFile || !normalizedFile.documents) {\n                issues.push({\n                    type: 'missing_documents',\n                    location: 'root',\n                    description: 'File does not contain a documents array'\n                });\n                return {\n                    isValid: false,\n                    issues,\n                    elementCounts,\n                    structure\n                };\n            }\n            \n            if (!Array.isArray(normalizedFile.documents)) {\n                issues.push({\n                    type: 'invalid_documents',\n                    location: 'root',\n                    description: 'Documents is not an array'\n                });\n                return {\n                    isValid: false,\n                    issues,\n                    elementCounts,\n                    structure\n                };\n            }\n            \n            elementCounts.documents = normalizedFile.documents.length;\n            \n            // Check each document\n            normalizedFile.documents.forEach((document, documentIndex) => {\n                const documentId = document.id || `document-${documentIndex}`;\n                structure.documents.push({ id: documentId, index: documentIndex });\n                \n                if (!document.groups) {\n                    issues.push({\n                        type: 'missing_groups',\n                        location: `documents[${documentIndex}]`,\n                        description: `Document ${documentId} does not have a groups array`\n                    });\n                    return;\n                }\n                \n                if (!Array.isArray(document.groups)) {\n                    issues.push({\n                        type: 'invalid_groups',\n                        location: `documents[${documentIndex}]`,\n                        description: `Document ${documentId} groups is not an array`\n                    });\n                    return;\n                }\n                \n                elementCounts.groups += document.groups.length;\n                \n                // Check each group\n                document.groups.forEach((group, groupIndex) => {\n                    const groupId = group.id || `group-${groupIndex}`;\n                    structure.groups.push({ \n                        documentId, \n                        groupId, \n                        documentIndex, \n                        groupIndex \n                    });\n                    \n                    if (!group.items) {\n                        issues.push({\n                            type: 'missing_items',\n                            location: `documents[${documentIndex}].groups[${groupIndex}]`,\n                            description: `Group ${groupId} does not have an items array`\n                        });\n                        return;\n                    }\n                    \n                    if (!Array.isArray(group.items)) {\n                        issues.push({\n                            type: 'invalid_items',\n                            location: `documents[${documentIndex}].groups[${groupIndex}]`,\n                            description: `Group ${groupId} items is not an array`\n                        });\n                        return;\n                    }\n                    \n                    elementCounts.items += group.items.length;\n                    \n                    const itemIndexMap = {};\n                    group.items.forEach(item => {\n                        if (item && item.id) {\n                            itemIndexMap[item.id] = item;\n                        }\n                    });\n                    \n                    // Check each item\n                    group.items.forEach((item, itemIndex) => {\n                        structure.items.push({\n                            documentId,\n                            groupId,\n                            documentIndex,\n                            groupIndex,\n                            itemIndex\n                        });\n                        \n                        // Check for null/undefined items\n                        if (item === null || item === undefined) {\n                            issues.push({\n                                type: 'null_item',\n                                location: `documents[${documentIndex}].groups[${groupIndex}].items[${itemIndex}]`,\n                                description: `Item at index ${itemIndex} is null or undefined`\n                            });\n                            return;\n                        }\n                        \n                        // Check for missing critical properties\n                        if (item.type === undefined || item.type === null) {\n                            issues.push({\n                                type: 'missing_type',\n                                location: `documents[${documentIndex}].groups[${groupIndex}].items[${itemIndex}]`,\n                                description: `Item at index ${itemIndex} is missing type property`\n                            });\n                        }\n                        \n                        // Check for orphaned child ID references\n                        if (Array.isArray(item.childIds)) {\n                            item.childIds.forEach((childId, childIndex) => {\n                                if (!itemIndexMap[childId]) {\n                                    issues.push({\n                                        type: 'missing_child',\n                                        location: `documents[${documentIndex}].groups[${groupIndex}].items[${itemIndex}].childIds[${childIndex}]`,\n                                        description: `Child id ${childId} at index ${childIndex} is missing from items`\n                                    });\n                                }\n                            });\n                        }\n                    });\n                });\n            });\n            \n            // Check for array length mismatches (if we have structure info)\n            // This would require comparing with expected counts, which we don't have\n            // So we'll just report what we found\n            \n            return {\n                isValid: issues.length === 0,\n                issues,\n                elementCounts,\n                structure\n            };\n        } catch (error) {\n            issues.push({\n                type: 'load_error',\n                location: 'file',\n                description: `Failed to load file: ${error.message}`\n            });\n            return {\n                isValid: false,\n                issues,\n                elementCounts,\n                structure\n            };\n        }\n    }\n}\n\n","// Data Utilities - Data transformation and manipulation\r\nexport const DataUtils = {\r\n    /**\r\n     * Deep clone an object\r\n     * @param {*} obj - Object to clone\r\n     * @returns {*}\r\n     */\r\n    deepClone(obj) {\r\n        if (obj === null || typeof obj !== 'object') {\r\n            return obj;\r\n        }\r\n        \r\n        if (obj instanceof Date) {\r\n            return new Date(obj.getTime());\r\n        }\r\n        \r\n        if (obj instanceof Array) {\r\n            return obj.map(item => this.deepClone(item));\r\n        }\r\n        \r\n        if (typeof obj === 'object') {\r\n            const cloned = {};\r\n            for (const key in obj) {\r\n                if (obj.hasOwnProperty(key)) {\r\n                    cloned[key] = this.deepClone(obj[key]);\r\n                }\r\n            }\r\n            return cloned;\r\n        }\r\n        \r\n        return obj;\r\n    },\r\n    \r\n    /**\r\n     * Deep merge objects\r\n     * @param {Object} target - Target object\r\n     * @param {...Object} sources - Source objects\r\n     * @returns {Object}\r\n     */\r\n    deepMerge(target, ...sources) {\r\n        if (!sources.length) return target;\r\n        const source = sources.shift();\r\n        \r\n        if (this.isObject(target) && this.isObject(source)) {\r\n            for (const key in source) {\r\n                if (this.isObject(source[key])) {\r\n                    if (!target[key]) Object.assign(target, { [key]: {} });\r\n                    this.deepMerge(target[key], source[key]);\r\n                } else {\r\n                    Object.assign(target, { [key]: source[key] });\r\n                }\r\n            }\r\n        }\r\n        \r\n        return this.deepMerge(target, ...sources);\r\n    },\r\n    \r\n    /**\r\n     * Check if value is a plain object\r\n     * @param {*} value - Value to check\r\n     * @returns {boolean}\r\n     */\r\n    isObject(value) {\r\n        return value !== null && typeof value === 'object' && !Array.isArray(value);\r\n    },\r\n    \r\n    /**\r\n     * Filter array by predicate\r\n     * @param {Array} array - Array to filter\r\n     * @param {Function|Object|string} predicate - Filter function, object (key-value pairs), or key path\r\n     * @returns {Array}\r\n     */\r\n    filter(array, predicate) {\r\n        if (typeof predicate === 'function') {\r\n            return array.filter(predicate);\r\n        }\r\n        \r\n        if (typeof predicate === 'object') {\r\n            return array.filter(item => {\r\n                return Object.keys(predicate).every(key => item[key] === predicate[key]);\r\n            });\r\n        }\r\n        \r\n        if (typeof predicate === 'string') {\r\n            return array.filter(item => {\r\n                const value = this.getNestedValue(item, predicate);\r\n                return value !== undefined && value !== null && value !== '';\r\n            });\r\n        }\r\n        \r\n        return array;\r\n    },\r\n    \r\n    /**\r\n     * Sort array by key or function\r\n     * @param {Array} array - Array to sort\r\n     * @param {string|Function} keyOrFn - Sort key or function\r\n     * @param {boolean} descending - Sort descending\r\n     * @returns {Array}\r\n     */\r\n    sort(array, keyOrFn, descending = false) {\r\n        const sorted = [...array];\r\n        const compareFn = typeof keyOrFn === 'function' \r\n            ? keyOrFn \r\n            : (a, b) => {\r\n                const aVal = this.getNestedValue(a, keyOrFn);\r\n                const bVal = this.getNestedValue(b, keyOrFn);\r\n                if (aVal < bVal) return descending ? 1 : -1;\r\n                if (aVal > bVal) return descending ? -1 : 1;\r\n                return 0;\r\n            };\r\n        \r\n        sorted.sort(compareFn);\r\n        return sorted;\r\n    },\r\n    \r\n    /**\r\n     * Get nested value from object by path\r\n     * @param {Object} obj - Object\r\n     * @param {string} path - Dot-separated path (e.g., 'user.profile.name')\r\n     * @returns {*}\r\n     */\r\n    getNestedValue(obj, path) {\r\n        return path.split('.').reduce((current, key) => current?.[key], obj);\r\n    },\r\n    \r\n    /**\r\n     * Set nested value in object by path\r\n     * @param {Object} obj - Object\r\n     * @param {string} path - Dot-separated path\r\n     * @param {*} value - Value to set\r\n     */\r\n    setNestedValue(obj, path, value) {\r\n        const keys = path.split('.');\r\n        const lastKey = keys.pop();\r\n        const target = keys.reduce((current, key) => {\r\n            if (!current[key] || !this.isObject(current[key])) {\r\n                current[key] = {};\r\n            }\r\n            return current[key];\r\n        }, obj);\r\n        target[lastKey] = value;\r\n    },\r\n    \r\n    /**\r\n     * Group array by key\r\n     * @param {Array} array - Array to group\r\n     * @param {string|Function} keyOrFn - Group key or function\r\n     * @returns {Object}\r\n     */\r\n    groupBy(array, keyOrFn) {\r\n        return array.reduce((groups, item) => {\r\n            const key = typeof keyOrFn === 'function' \r\n                ? keyOrFn(item) \r\n                : this.getNestedValue(item, keyOrFn);\r\n            if (!groups[key]) {\r\n                groups[key] = [];\r\n            }\r\n            groups[key].push(item);\r\n            return groups;\r\n        }, {});\r\n    },\r\n    \r\n    /**\r\n     * Remove duplicates from array\r\n     * @param {Array} array - Array to deduplicate\r\n     * @param {string|Function} keyOrFn - Key or function to compare\r\n     * @returns {Array}\r\n     */\r\n    unique(array, keyOrFn) {\r\n        if (!keyOrFn) {\r\n            return [...new Set(array)];\r\n        }\r\n        \r\n        const seen = new Set();\r\n        return array.filter(item => {\r\n            const key = typeof keyOrFn === 'function' \r\n                ? keyOrFn(item) \r\n                : this.getNestedValue(item, keyOrFn);\r\n            if (seen.has(key)) {\r\n                return false;\r\n            }\r\n            seen.add(key);\r\n            return true;\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * Flatten nested array\r\n     * @param {Array} array - Array to flatten\r\n     * @param {number} depth - Flatten depth\r\n     * @returns {Array}\r\n     */\r\n    flatten(array, depth = Infinity) {\r\n        return array.flat(depth);\r\n    },\r\n    \r\n    /**\r\n     * Pick properties from object\r\n     * @param {Object} obj - Source object\r\n     * @param {Array<string>} keys - Keys to pick\r\n     * @returns {Object}\r\n     */\r\n    pick(obj, keys) {\r\n        return keys.reduce((result, key) => {\r\n            if (key in obj) {\r\n                result[key] = obj[key];\r\n            }\r\n            return result;\r\n        }, {});\r\n    },\r\n    \r\n    /**\r\n     * Omit properties from object\r\n     * @param {Object} obj - Source object\r\n     * @param {Array<string>} keys - Keys to omit\r\n     * @returns {Object}\r\n     */\r\n    omit(obj, keys) {\r\n        const result = { ...obj };\r\n        keys.forEach(key => delete result[key]);\r\n        return result;\r\n    }\r\n};\r\n\r\n","// PluginManager - Central registry for all plugins\r\nimport { DataUtils } from '../utils/data.js';\r\n\r\nexport class PluginManager {\r\n    constructor() {\r\n        this.plugins = new Map(); // pluginId -> plugin instance\r\n        this.pluginsByType = new Map(); // type -> Set of pluginIds\r\n        this.dependencies = new Map(); // pluginId -> Set of dependency pluginIds\r\n        this.initialized = new Set(); // Set of initialized pluginIds\r\n        this.enabled = new Set(); // Set of enabled pluginIds\r\n    }\r\n    \r\n    /**\r\n     * Register a plugin\r\n     * @param {Object} plugin - Plugin instance\r\n     * @param {string} plugin.id - Plugin ID\r\n     * @param {string} plugin.type - Plugin type (page, bin, element, format)\r\n     * @param {Array<string>} plugin.dependencies - Plugin dependencies\r\n     * @returns {boolean} - Success status\r\n     */\r\n    register(plugin) {\r\n        if (!plugin || !plugin.id || !plugin.type) {\r\n            console.error('Plugin must have id and type');\r\n            return false;\r\n        }\r\n        \r\n        // Check if already registered\r\n        if (this.plugins.has(plugin.id)) {\r\n            console.warn(`Plugin \"${plugin.id}\" is already registered`);\r\n            return false;\r\n        }\r\n        \r\n        // Register plugin\r\n        this.plugins.set(plugin.id, plugin);\r\n        \r\n        // Add to type index\r\n        if (!this.pluginsByType.has(plugin.type)) {\r\n            this.pluginsByType.set(plugin.type, new Set());\r\n        }\r\n        this.pluginsByType.get(plugin.type).add(plugin.id);\r\n        \r\n        // Store dependencies\r\n        if (plugin.dependencies && Array.isArray(plugin.dependencies)) {\r\n            this.dependencies.set(plugin.id, new Set(plugin.dependencies));\r\n        } else {\r\n            this.dependencies.set(plugin.id, new Set());\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Unregister a plugin\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {boolean} - Success status\r\n     */\r\n    unregister(pluginId) {\r\n        const plugin = this.plugins.get(pluginId);\r\n        if (!plugin) return false;\r\n        \r\n        // Disable and destroy if enabled\r\n        if (this.enabled.has(pluginId)) {\r\n            this.disable(pluginId);\r\n        }\r\n        \r\n        // Remove from type index\r\n        const typeSet = this.pluginsByType.get(plugin.type);\r\n        if (typeSet) {\r\n            typeSet.delete(pluginId);\r\n        }\r\n        \r\n        // Remove from maps\r\n        this.plugins.delete(pluginId);\r\n        this.dependencies.delete(pluginId);\r\n        this.initialized.delete(pluginId);\r\n        this.enabled.delete(pluginId);\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Get plugin by ID\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Object|null} - Plugin instance\r\n     */\r\n    get(pluginId) {\r\n        return this.plugins.get(pluginId) || null;\r\n    }\r\n    \r\n    /**\r\n     * Get all plugins of a type\r\n     * @param {string} type - Plugin type\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getByType(type) {\r\n        const pluginIds = this.pluginsByType.get(type) || new Set();\r\n        return Array.from(pluginIds)\r\n            .map(id => this.plugins.get(id))\r\n            .filter(plugin => plugin !== undefined);\r\n    }\r\n    \r\n    /**\r\n     * Get all registered plugins\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getAll() {\r\n        return Array.from(this.plugins.values());\r\n    }\r\n    \r\n    /**\r\n     * Check if plugin is registered\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {boolean}\r\n     */\r\n    has(pluginId) {\r\n        return this.plugins.has(pluginId);\r\n    }\r\n    \r\n    /**\r\n     * Initialize a plugin\r\n     * @param {string} pluginId - Plugin ID\r\n     * @param {Object} context - App context\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async initialize(pluginId, context) {\r\n        if (this.initialized.has(pluginId)) {\r\n            return true;\r\n        }\r\n        \r\n        const plugin = this.plugins.get(pluginId);\r\n        if (!plugin) {\r\n            console.error(`Plugin \"${pluginId}\" not found`);\r\n            return false;\r\n        }\r\n        \r\n        // Initialize dependencies first\r\n        const deps = this.dependencies.get(pluginId) || new Set();\r\n        for (const depId of deps) {\r\n            if (!this.initialized.has(depId)) {\r\n                const depSuccess = await this.initialize(depId, context);\r\n                if (!depSuccess) {\r\n                    console.error(`Failed to initialize dependency \"${depId}\" for plugin \"${pluginId}\"`);\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Initialize plugin\r\n        try {\r\n            if (plugin.init && typeof plugin.init === 'function') {\r\n                await plugin.init(context);\r\n            }\r\n            this.initialized.add(pluginId);\r\n            return true;\r\n        } catch (error) {\r\n            console.error(`Error initializing plugin \"${pluginId}\":`, error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Enable a plugin\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async enable(pluginId) {\r\n        if (this.enabled.has(pluginId)) {\r\n            return true;\r\n        }\r\n        \r\n        const plugin = this.plugins.get(pluginId);\r\n        if (!plugin) {\r\n            console.error(`Plugin \"${pluginId}\" not found`);\r\n            return false;\r\n        }\r\n        \r\n        // Ensure initialized\r\n        if (!this.initialized.has(pluginId)) {\r\n            const initSuccess = await this.initialize(pluginId, {});\r\n            if (!initSuccess) {\r\n                return false;\r\n            }\r\n        }\r\n        \r\n        // Enable plugin\r\n        try {\r\n            if (plugin.enable && typeof plugin.enable === 'function') {\r\n                await plugin.enable();\r\n            }\r\n            this.enabled.add(pluginId);\r\n            return true;\r\n        } catch (error) {\r\n            console.error(`Error enabling plugin \"${pluginId}\":`, error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Disable a plugin\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async disable(pluginId) {\r\n        if (!this.enabled.has(pluginId)) {\r\n            return true;\r\n        }\r\n        \r\n        const plugin = this.plugins.get(pluginId);\r\n        if (!plugin) {\r\n            return false;\r\n        }\r\n        \r\n        // Disable plugin\r\n        try {\r\n            if (plugin.disable && typeof plugin.disable === 'function') {\r\n                await plugin.disable();\r\n            }\r\n            this.enabled.delete(pluginId);\r\n            return true;\r\n        } catch (error) {\r\n            console.error(`Error disabling plugin \"${pluginId}\":`, error);\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Check if plugin is enabled\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {boolean}\r\n     */\r\n    isEnabled(pluginId) {\r\n        return this.enabled.has(pluginId);\r\n    }\r\n    \r\n    /**\r\n     * Check if plugin is initialized\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {boolean}\r\n     */\r\n    isInitialized(pluginId) {\r\n        return this.initialized.has(pluginId);\r\n    }\r\n    \r\n    /**\r\n     * Get plugin dependencies\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Set<string>} - Set of dependency plugin IDs\r\n     */\r\n    getDependencies(pluginId) {\r\n        return this.dependencies.get(pluginId) || new Set();\r\n    }\r\n    \r\n    /**\r\n     * Get initialization order for all plugins\r\n     * @returns {Array<string>} - Array of plugin IDs in initialization order\r\n     */\r\n    getInitializationOrder() {\r\n        const ordered = [];\r\n        const visited = new Set();\r\n        const visiting = new Set();\r\n        \r\n        const visit = (pluginId) => {\r\n            if (visiting.has(pluginId)) {\r\n                console.warn(`Circular dependency detected involving plugin \"${pluginId}\"`);\r\n                return;\r\n            }\r\n            \r\n            if (visited.has(pluginId)) {\r\n                return;\r\n            }\r\n            \r\n            visiting.add(pluginId);\r\n            \r\n            const deps = this.dependencies.get(pluginId) || new Set();\r\n            deps.forEach(depId => {\r\n                if (this.plugins.has(depId)) {\r\n                    visit(depId);\r\n                }\r\n            });\r\n            \r\n            visiting.delete(pluginId);\r\n            visited.add(pluginId);\r\n            ordered.push(pluginId);\r\n        };\r\n        \r\n        this.plugins.forEach((plugin, pluginId) => {\r\n            if (!visited.has(pluginId)) {\r\n                visit(pluginId);\r\n            }\r\n        });\r\n        \r\n        return ordered;\r\n    }\r\n    \r\n    /**\r\n     * Clear all plugins\r\n     */\r\n    clear() {\r\n        // Disable and destroy all plugins\r\n        this.enabled.forEach(pluginId => {\r\n            this.disable(pluginId);\r\n        });\r\n        \r\n        this.plugins.clear();\r\n        this.pluginsByType.clear();\r\n        this.dependencies.clear();\r\n        this.initialized.clear();\r\n        this.enabled.clear();\r\n    }\r\n}\r\n\r\n// Singleton instance\r\nexport const pluginRegistry = new PluginManager();\r\n\r\n","// PagePluginManager - Manages page plugin lifecycle and rendering\r\nimport { pluginRegistry } from '../core/PluginManager.js';\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { DOMUtils } from '../utils/dom.js';\r\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\r\n\r\nexport class PagePluginManager {\r\n    constructor() {\r\n        this.pagePlugins = new Map(); // pageId -> Set of enabled pluginIds\r\n        this.setupEventListeners();\r\n    }\r\n    \r\n    /**\r\n     * Get AppState service\r\n     */\r\n    _getAppState() {\r\n        return getService(SERVICES.APP_STATE);\r\n    }\r\n    \r\n    /**\r\n     * Setup event listeners\r\n     */\r\n    setupEventListeners() {\r\n        eventBus.on('page:created', (data) => {\r\n            this.initializePagePlugins(data.pageId);\r\n        });\r\n        \r\n        eventBus.on('page:deleted', (data) => {\r\n            this.cleanupPagePlugins(data.pageId);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Initialize plugins for a page\r\n     * @param {string} pageId - Page ID\r\n     */\r\n    async initializePagePlugins(pageId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return;\r\n        \r\n        const enabledPlugins = page.plugins || [];\r\n        const pluginSet = new Set();\r\n        \r\n        for (const pluginId of enabledPlugins) {\r\n            const plugin = pluginRegistry.get(pluginId);\r\n            if (plugin && plugin.type === 'page') {\r\n                await pluginRegistry.enable(pluginId);\r\n                pluginSet.add(pluginId);\r\n            }\r\n        }\r\n        \r\n        this.pagePlugins.set(pageId, pluginSet);\r\n    }\r\n    \r\n    /**\r\n     * Cleanup plugins for a page\r\n     * @param {string} pageId - Page ID\r\n     */\r\n    async cleanupPagePlugins(pageId) {\r\n        const pluginSet = this.pagePlugins.get(pageId);\r\n        if (pluginSet) {\r\n            for (const pluginId of pluginSet) {\r\n                await pluginRegistry.disable(pluginId);\r\n            }\r\n            this.pagePlugins.delete(pageId);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Enable plugin for a page\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async enablePlugin(pageId, pluginId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return false;\r\n        \r\n        const plugin = pluginRegistry.get(pluginId);\r\n        if (!plugin || plugin.type !== 'page') {\r\n            console.error(`Plugin \"${pluginId}\" not found or not a page plugin`);\r\n            return false;\r\n        }\r\n        \r\n        // Initialize plugin if needed\r\n        if (!pluginRegistry.isInitialized(pluginId)) {\r\n            await pluginRegistry.initialize(pluginId, null);\r\n        }\r\n        \r\n        // Enable plugin\r\n        const success = await pluginRegistry.enable(pluginId);\r\n        if (success) {\r\n            // Add to page's plugin list\r\n            if (!page.plugins) {\r\n                page.plugins = [];\r\n            }\r\n            if (!page.plugins.includes(pluginId)) {\r\n                page.plugins.push(pluginId);\r\n            }\r\n            \r\n            // Track in manager\r\n            let pluginSet = this.pagePlugins.get(pageId);\r\n            if (!pluginSet) {\r\n                pluginSet = new Set();\r\n                this.pagePlugins.set(pageId, pluginSet);\r\n            }\r\n            pluginSet.add(pluginId);\r\n            \r\n            // Save and re-render\r\n            const dataManager = this._getDataManager();\r\n            if (dataManager) {\r\n                dataManager.saveData();\r\n            }\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n            \r\n            eventBus.emit('page:plugin:enabled', { pageId, pluginId });\r\n        }\r\n        \r\n        return success;\r\n    }\r\n    \r\n    /**\r\n     * Disable plugin for a page\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async disablePlugin(pageId, pluginId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return false;\r\n        \r\n        const success = await pluginRegistry.disable(pluginId);\r\n        if (success) {\r\n            // Remove from page's plugin list\r\n            if (page.plugins) {\r\n                page.plugins = page.plugins.filter(id => id !== pluginId);\r\n            }\r\n            \r\n            // Remove from manager tracking\r\n            const pluginSet = this.pagePlugins.get(pageId);\r\n            if (pluginSet) {\r\n                pluginSet.delete(pluginId);\r\n            }\r\n            \r\n            // Save and re-render\r\n            const dataManager = this._getDataManager();\r\n            if (dataManager) {\r\n                dataManager.saveData();\r\n            }\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n            \r\n            eventBus.emit('page:plugin:disabled', { pageId, pluginId });\r\n        }\r\n        \r\n        return success;\r\n    }\r\n    \r\n    /**\r\n     * Get enabled plugins for a page\r\n     * @param {string} pageId - Page ID\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getPagePlugins(pageId) {\r\n        const pluginSet = this.pagePlugins.get(pageId) || new Set();\r\n        return Array.from(pluginSet)\r\n            .map(id => pluginRegistry.get(id))\r\n            .filter(plugin => plugin !== null);\r\n    }\r\n    \r\n    /**\r\n     * Get all available page plugins\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getAvailablePlugins() {\r\n        return pluginRegistry.getByType('page');\r\n    }\r\n    \r\n    /**\r\n     * Render plugin UI sections for page edit modal\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {string} pageId - Page ID\r\n     */\r\n    renderPluginUI(container, pageId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return;\r\n        \r\n        const availablePlugins = this.getAvailablePlugins();\r\n        if (availablePlugins.length === 0) {\r\n            const noPlugins = DOMUtils.createElement('div', {\r\n                class: 'plugin-section'\r\n            }, 'No page plugins available');\r\n            container.appendChild(noPlugins);\r\n            return;\r\n        }\r\n        \r\n        const section = DOMUtils.createElement('div', {\r\n            class: 'plugin-section'\r\n        });\r\n        \r\n        const title = DOMUtils.createElement('h4', {}, 'Page Plugins');\r\n        section.appendChild(title);\r\n        \r\n        availablePlugins.forEach(plugin => {\r\n            const enabled = page.plugins && page.plugins.includes(plugin.id);\r\n            \r\n            const pluginItem = DOMUtils.createElement('div', {\r\n                class: 'plugin-item'\r\n            });\r\n            \r\n            const checkbox = DOMUtils.createElement('input', {\r\n                type: 'checkbox',\r\n                id: `plugin-${plugin.id}`,\r\n                checked: enabled\r\n            });\r\n            \r\n            checkbox.addEventListener('change', async (e) => {\r\n                if (e.target.checked) {\r\n                    await this.enablePlugin(pageId, plugin.id);\r\n                } else {\r\n                    await this.disablePlugin(pageId, plugin.id);\r\n                }\r\n            });\r\n            \r\n            const label = DOMUtils.createElement('label', {\r\n                for: `plugin-${plugin.id}`\r\n            }, plugin.name || plugin.id);\r\n            \r\n            if (plugin.description) {\r\n                const desc = DOMUtils.createElement('div', {\r\n                    class: 'plugin-description'\r\n                }, plugin.description);\r\n                label.appendChild(desc);\r\n            }\r\n            \r\n            pluginItem.appendChild(checkbox);\r\n            pluginItem.appendChild(label);\r\n            section.appendChild(pluginItem);\r\n        });\r\n        \r\n        container.appendChild(section);\r\n    }\r\n    \r\n    /**\r\n     * Render plugin content for a page\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {string} pageId - Page ID\r\n     */\r\n    renderPluginContent(container, pageId) {\r\n        const plugins = this.getPagePlugins(pageId);\r\n        plugins.forEach(plugin => {\r\n            if (plugin.render && typeof plugin.render === 'function') {\r\n                const pluginContainer = DOMUtils.createElement('div', {\r\n                    class: `plugin-content plugin-${plugin.id}`\r\n                });\r\n                const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n                plugin.render(pluginContainer, page);\r\n                container.appendChild(pluginContainer);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n","// BinPluginManager - Manages bin plugin lifecycle and rendering\r\nimport { pluginRegistry } from '../core/PluginManager.js';\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { EVENTS } from '../core/AppEvents.js';\r\nimport { DOMUtils } from '../utils/dom.js';\r\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\r\n\r\nexport class BinPluginManager {\r\n    constructor() {\r\n        this.binPlugins = new Map(); // binId -> Set of enabled pluginIds\r\n        this.setupEventListeners();\r\n    }\r\n    \r\n    /**\r\n     * Get AppState service\r\n     */\r\n    _getAppState() {\r\n        return getService(SERVICES.APP_STATE);\r\n    }\r\n    \r\n    /**\r\n     * Setup event listeners\r\n     */\r\n    setupEventListeners() {\r\n        eventBus.on('bin:created', (data) => {\r\n            this.initializeBinPlugins(data.pageId, data.binId);\r\n        });\r\n        \r\n        eventBus.on('bin:deleted', (data) => {\r\n            this.cleanupBinPlugins(data.pageId, data.binId);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Initialize plugins for a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     */\r\n    async initializeBinPlugins(pageId, binId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return;\r\n        \r\n        const bin = page.groups?.find(b => b.id === binId);\r\n        if (!bin) return;\r\n        \r\n        const enabledPlugins = bin.plugins || [];\r\n        const pluginSet = new Set();\r\n        \r\n        for (const pluginId of enabledPlugins) {\r\n            const plugin = pluginRegistry.get(pluginId);\r\n            if (plugin && plugin.type === 'bin') {\r\n                await pluginRegistry.enable(pluginId);\r\n                pluginSet.add(pluginId);\r\n            }\r\n        }\r\n        \r\n        const key = `${pageId}:${binId}`;\r\n        this.binPlugins.set(key, pluginSet);\r\n    }\r\n    \r\n    /**\r\n     * Cleanup plugins for a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     */\r\n    async cleanupBinPlugins(pageId, binId) {\r\n        const key = `${pageId}:${binId}`;\r\n        const pluginSet = this.binPlugins.get(key);\r\n        if (pluginSet) {\r\n            for (const pluginId of pluginSet) {\r\n                await pluginRegistry.disable(pluginId);\r\n            }\r\n            this.binPlugins.delete(key);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Enable plugin for a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async enablePlugin(pageId, binId, pluginId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return false;\r\n        \r\n        const bin = page.groups?.find(b => b.id === binId);\r\n        if (!bin) return false;\r\n        \r\n        const plugin = pluginRegistry.get(pluginId);\r\n        if (!plugin || plugin.type !== 'bin') {\r\n            console.error(`Plugin \"${pluginId}\" not found or not a bin plugin`);\r\n            return false;\r\n        }\r\n        \r\n        // Initialize plugin if needed\r\n        if (!pluginRegistry.isInitialized(pluginId)) {\r\n            await pluginRegistry.initialize(pluginId, null);\r\n        }\r\n        \r\n        // Enable plugin\r\n        const success = await pluginRegistry.enable(pluginId);\r\n        if (success) {\r\n            // Add to bin's plugin list\r\n            if (!bin.plugins) {\r\n                bin.plugins = [];\r\n            }\r\n            if (!bin.plugins.includes(pluginId)) {\r\n                bin.plugins.push(pluginId);\r\n            }\r\n            \r\n            // Track in manager\r\n            const key = `${pageId}:${binId}`;\r\n            let pluginSet = this.binPlugins.get(key);\r\n            if (!pluginSet) {\r\n                pluginSet = new Set();\r\n                this.binPlugins.set(key, pluginSet);\r\n            }\r\n            pluginSet.add(pluginId);\r\n            \r\n            // Save and re-render\r\n            const dataManager = this._getDataManager();\r\n            if (dataManager) {\r\n                dataManager.saveData();\r\n            }\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n            \r\n            eventBus.emit('bin:plugin:enabled', { pageId, binId, pluginId });\r\n        }\r\n        \r\n        return success;\r\n    }\r\n    \r\n    /**\r\n     * Disable plugin for a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {string} pluginId - Plugin ID\r\n     * @returns {Promise<boolean>} - Success status\r\n     */\r\n    async disablePlugin(pageId, binId, pluginId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return false;\r\n        \r\n        const bin = page.groups?.find(b => b.id === binId);\r\n        if (!bin) return false;\r\n        \r\n        const success = await pluginRegistry.disable(pluginId);\r\n        if (success) {\r\n            // Remove from bin's plugin list\r\n            if (bin.plugins) {\r\n                bin.plugins = bin.plugins.filter(id => id !== pluginId);\r\n            }\r\n            \r\n            // Remove from manager tracking\r\n            const key = `${pageId}:${binId}`;\r\n            const pluginSet = this.binPlugins.get(key);\r\n            if (pluginSet) {\r\n                pluginSet.delete(pluginId);\r\n            }\r\n            \r\n            // Save and re-render\r\n            const dataManager = this._getDataManager();\r\n            if (dataManager) {\r\n                dataManager.saveData();\r\n            }\r\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n            \r\n            eventBus.emit('bin:plugin:disabled', { pageId, binId, pluginId });\r\n        }\r\n        \r\n        return success;\r\n    }\r\n    \r\n    /**\r\n     * Get enabled plugins for a bin\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getBinPlugins(pageId, binId) {\r\n        const key = `${pageId}:${binId}`;\r\n        const pluginSet = this.binPlugins.get(key) || new Set();\r\n        return Array.from(pluginSet)\r\n            .map(id => pluginRegistry.get(id))\r\n            .filter(plugin => plugin !== null);\r\n    }\r\n    \r\n    /**\r\n     * Get all available bin plugins\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getAvailablePlugins() {\r\n        return pluginRegistry.getByType('bin');\r\n    }\r\n    \r\n    /**\r\n     * Render plugin UI sections for bin edit modal\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     */\r\n    renderPluginUI(container, pageId, binId) {\r\n        const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n        if (!page) return;\r\n        \r\n        const bin = page.groups?.find(b => b.id === binId);\r\n        if (!bin) return;\r\n        \r\n        const availablePlugins = this.getAvailablePlugins();\r\n        if (availablePlugins.length === 0) {\r\n            const noPlugins = DOMUtils.createElement('div', {\r\n                class: 'plugin-section'\r\n            }, 'No bin plugins available');\r\n            container.appendChild(noPlugins);\r\n            return;\r\n        }\r\n        \r\n        const section = DOMUtils.createElement('div', {\r\n            class: 'plugin-section'\r\n        });\r\n        \r\n        const title = DOMUtils.createElement('h4', {}, 'Bin Plugins');\r\n        section.appendChild(title);\r\n        \r\n        availablePlugins.forEach(plugin => {\r\n            const enabled = bin.plugins && bin.plugins.includes(plugin.id);\r\n            \r\n            const pluginItem = DOMUtils.createElement('div', {\r\n                class: 'plugin-item'\r\n            });\r\n            \r\n            const checkbox = DOMUtils.createElement('input', {\r\n                type: 'checkbox',\r\n                id: `bin-plugin-${plugin.id}`,\r\n                checked: enabled\r\n            });\r\n            \r\n            checkbox.addEventListener('change', async (e) => {\r\n                if (e.target.checked) {\r\n                    await this.enablePlugin(pageId, binId, plugin.id);\r\n                } else {\r\n                    await this.disablePlugin(pageId, binId, plugin.id);\r\n                }\r\n            });\r\n            \r\n            const label = DOMUtils.createElement('label', {\r\n                for: `bin-plugin-${plugin.id}`\r\n            }, plugin.name || plugin.id);\r\n            \r\n            if (plugin.description) {\r\n                const desc = DOMUtils.createElement('div', {\r\n                    class: 'plugin-description'\r\n                }, plugin.description);\r\n                label.appendChild(desc);\r\n            }\r\n            \r\n            pluginItem.appendChild(checkbox);\r\n            pluginItem.appendChild(label);\r\n            section.appendChild(pluginItem);\r\n        });\r\n        \r\n        container.appendChild(section);\r\n    }\r\n    \r\n    /**\r\n     * Render plugin content for a bin\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     */\r\n    renderPluginContent(container, pageId, binId) {\r\n        const plugins = this.getBinPlugins(pageId, binId);\r\n        plugins.forEach(plugin => {\r\n            if (plugin.render && typeof plugin.render === 'function') {\r\n                const pluginContainer = DOMUtils.createElement('div', {\r\n                    class: `plugin-content plugin-${plugin.id}`\r\n                });\r\n                const appState = this._getAppState();\r\n        const page = appState.documents.find(p => p.id === pageId);\r\n                const bin = page.groups?.find(b => b.id === binId);\r\n                plugin.render(pluginContainer, bin, { page });\r\n                container.appendChild(pluginContainer);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n","// ElementTypeManager - Manages element type registration and rendering\r\nimport { pluginRegistry } from '../core/PluginManager.js';\r\nimport { eventBus } from '../core/EventBus.js';\r\nimport { DOMUtils } from '../utils/dom.js';\r\n\r\nexport class ElementTypeManager {\r\n    constructor() {\r\n        this.elementTypes = new Map(); // elementType -> plugin instance\r\n        this.setupEventListeners();\r\n    }\r\n    \r\n    /**\r\n     * Setup event listeners\r\n     */\r\n    setupEventListeners() {\r\n        eventBus.on('element:type:registered', (data) => {\r\n            this.registerElementType(data.pluginId);\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Register an element type plugin\r\n     * @param {string} pluginId - Plugin ID\r\n     */\r\n    registerElementType(pluginId) {\r\n        const plugin = pluginRegistry.get(pluginId);\r\n        if (plugin && plugin.type === 'element') {\r\n            this.elementTypes.set(plugin.elementType, plugin);\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get element type plugin\r\n     * @param {string} elementType - Element type\r\n     * @returns {Object|null} - Plugin instance\r\n     */\r\n    getElementType(elementType) {\r\n        return this.elementTypes.get(elementType) || null;\r\n    }\r\n    \r\n    /**\r\n     * Get all registered element types\r\n     * @returns {Array<Object>} - Array of plugin instances\r\n     */\r\n    getAllElementTypes() {\r\n        return Array.from(this.elementTypes.values());\r\n    }\r\n    \r\n    /**\r\n     * Create element template\r\n     * @param {string} elementType - Element type\r\n     * @returns {Object|null} - Element template\r\n     */\r\n    createTemplate(elementType) {\r\n        const plugin = this.getElementType(elementType);\r\n        if (plugin && plugin.createTemplate) {\r\n            return plugin.createTemplate();\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Render element\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {Object} element - Element data\r\n     * @param {Object} context - Context (pageId, binId, elementIndex)\r\n     * @returns {HTMLElement}\r\n     */\r\n    render(container, element, context) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.render) {\r\n            return plugin.render(container, element, context);\r\n        }\r\n        \r\n        // Fallback to default rendering\r\n        return this.renderDefault(container, element, context);\r\n    }\r\n    \r\n    /**\r\n     * Default element rendering\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {Object} element - Element data\r\n     * @param {Object} context - Context\r\n     * @returns {HTMLElement}\r\n     */\r\n    renderDefault(container, element, context) {\r\n        const div = DOMUtils.createElement('div', {\r\n            class: 'element'\r\n        }, element.text || '');\r\n        container.appendChild(div);\r\n        return div;\r\n    }\r\n    \r\n    /**\r\n     * Render element edit UI\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {Object} element - Element data\r\n     * @param {Object} context - Context\r\n     * @returns {HTMLElement}\r\n     */\r\n    renderEditUI(container, element, context) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.renderEditUI) {\r\n            return plugin.renderEditUI(container, element, context);\r\n        }\r\n        \r\n        // Fallback to default edit UI\r\n        return this.renderDefaultEditUI(container, element, context);\r\n    }\r\n    \r\n    /**\r\n     * Default element edit UI\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {Object} element - Element data\r\n     * @param {Object} context - Context\r\n     * @returns {HTMLElement}\r\n     */\r\n    renderDefaultEditUI(container, element, context) {\r\n        const input = DOMUtils.createElement('input', {\r\n            type: 'text',\r\n            value: element.text || '',\r\n            placeholder: 'Element text'\r\n        });\r\n        container.appendChild(input);\r\n        return input;\r\n    }\r\n    \r\n    /**\r\n     * Validate element\r\n     * @param {Object} element - Element data\r\n     * @returns {Object} - { valid: boolean, errors: Array<string> }\r\n     */\r\n    validate(element) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.validate) {\r\n            return plugin.validate(element);\r\n        }\r\n        \r\n        return {\r\n            valid: true,\r\n            errors: []\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Handle element update\r\n     * @param {Object} element - Element data\r\n     * @param {Object} updates - Updates to apply\r\n     * @returns {Object} - Updated element\r\n     */\r\n    update(element, updates) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.update) {\r\n            return plugin.update(element, updates);\r\n        }\r\n        \r\n        return { ...element, ...updates };\r\n    }\r\n    \r\n    /**\r\n     * Handle element deletion\r\n     * @param {Object} element - Element data\r\n     * @param {Object} context - Context\r\n     * @returns {Promise<boolean>} - Allow deletion\r\n     */\r\n    async onDelete(element, context) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.onDelete) {\r\n            return await plugin.onDelete(element, context);\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    \r\n    /**\r\n     * Handle element completion toggle\r\n     * @param {Object} element - Element data\r\n     * @param {boolean} completed - New completion state\r\n     * @returns {Object} - Updated element\r\n     */\r\n    onToggleComplete(element, completed) {\r\n        const plugin = this.getElementType(element.type);\r\n        if (plugin && plugin.onToggleComplete) {\r\n            return plugin.onToggleComplete(element, completed);\r\n        }\r\n        \r\n        return { ...element, completed };\r\n    }\r\n    \r\n    /**\r\n     * Get element type metadata\r\n     * @param {string} elementType - Element type\r\n     * @returns {Object|null}\r\n     */\r\n    getElementTypeMetadata(elementType) {\r\n        const plugin = this.getElementType(elementType);\r\n        if (plugin && plugin.getMetadata) {\r\n            return plugin.getMetadata();\r\n        }\r\n        return null;\r\n    }\r\n    \r\n    /**\r\n     * Get all element types for add modal\r\n     * @returns {Array<Object>} - Array of { type, name, shortcut, icon }\r\n     */\r\n    getElementTypesForModal() {\r\n        return this.getAllElementTypes().map(plugin => ({\r\n            type: plugin.elementType,\r\n            name: plugin.name || plugin.elementType,\r\n            shortcut: plugin.keyboardShortcut,\r\n            icon: plugin.icon\r\n        }));\r\n    }\r\n}\r\n\r\n","// FormatRendererManager - Manages format renderer registration and rendering\nimport { pluginRegistry } from '../core/PluginManager.js';\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { DOMUtils } from '../utils/dom.js';\nimport { getService, SERVICES } from '../core/AppServices.js';\n\nexport class FormatRendererManager {\n    constructor() {\n        this.formatRenderers = new Map(); // formatName -> plugin instance\n        this.activeFormats = new Map(); // pageId/binId -> formatName\n        this.setupEventListeners();\n        // Scan for already-loaded format plugins\n        this.scanForFormats();\n        // Initialize activeFormats from saved page data\n        this.initializeFromSavedData();\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Initialize activeFormats from saved page data\n     */\n    initializeFromSavedData() {\n        const appState = this._getAppState();\n        if (appState && appState.documents) {\n            appState.documents.forEach(page => {\n                if (page.format) {\n                    this.activeFormats.set(page.id, page.format);\n                }\n            });\n        }\n    }\n    \n    /**\n     * Setup event listeners\n     */\n    setupEventListeners() {\n        eventBus.on('format:registered', (data) => {\n            this.registerFormat(data.pluginId);\n        });\n        \n        // Also listen for plugin loaded events\n        eventBus.on('plugin:loaded', (data) => {\n            const plugin = pluginRegistry.get(data.pluginId);\n            if (plugin && plugin.type === 'format') {\n                this.registerFormat(data.pluginId);\n            }\n        });\n    }\n    \n    /**\n     * Scan plugin registry for format plugins and register them\n     */\n    scanForFormats() {\n        const formatPlugins = pluginRegistry.getByType('format');\n        // console.log(`[FormatRendererManager] scanForFormats found ${formatPlugins.length} format plugins:`, formatPlugins.map(p => ({ id: p.id, formatName: p.formatName, name: p.name })));\n        formatPlugins.forEach(plugin => {\n            const formatName = plugin.formatName || plugin.id;\n            if (formatName && !this.formatRenderers.has(formatName)) {\n                this.formatRenderers.set(formatName, plugin);\n                // console.log(`[FormatRendererManager] Scanned and registered format: ${formatName} (${plugin.name || plugin.id})`);\n            }\n        });\n    }\n    \n    /**\n     * Register a format renderer plugin\n     * @param {string} pluginId - Plugin ID\n     */\n    registerFormat(pluginId) {\n        const plugin = pluginRegistry.get(pluginId);\n        // console.log(`[FormatRendererManager] registerFormat called for ${pluginId}, plugin found:`, !!plugin, 'type:', plugin?.type);\n        if (plugin && plugin.type === 'format') {\n            const formatName = plugin.formatName || plugin.id;\n            this.formatRenderers.set(formatName, plugin);\n            // console.log(`[FormatRendererManager] Registered format: ${formatName} (${plugin.name || plugin.id})`);\n        } else {\n            // Plugin might not be registered yet - this is OK, it will be picked up by scanForFormats\n            // or when the plugin:loaded event fires\n            // console.log(`[FormatRendererManager] Plugin ${pluginId} not found or not a format plugin`);\n        }\n    }\n    \n    /**\n     * Get format renderer\n     * @param {string} formatName - Format name\n     * @returns {Object|null} - Plugin instance\n     */\n    getFormat(formatName) {\n        return this.formatRenderers.get(formatName) || null;\n    }\n    \n    /**\n     * Get all registered formats\n     * @returns {Array<Object>} - Array of plugin instances\n     */\n    getAllFormats() {\n        // Refresh format list from registry before returning (in case formats were loaded after manager init)\n        this.scanForFormats();\n        const formats = Array.from(this.formatRenderers.values());\n        return formats;\n    }\n    \n    /**\n     * Set active format for a page\n     * @param {string} pageId - Page ID\n     * @param {string} formatName - Format name\n     * @returns {Promise<boolean>} - Success status\n     */\n    async setPageFormat(pageId, formatName) {\n        const format = this.getFormat(formatName);\n        if (!format || !format.supportsPages) {\n            console.error(`Format \"${formatName}\" not found or doesn't support pages`);\n            return false;\n        }\n        \n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return false;\n        \n        // Initialize format if needed\n        if (!pluginRegistry.isInitialized(format.id)) {\n            await pluginRegistry.initialize(format.id, null);\n        }\n        \n        // Enable format\n        await pluginRegistry.enable(format.id);\n        \n        // Set as active format\n        page.format = formatName;\n        this.activeFormats.set(pageId, formatName);\n        \n        // Save and re-render\n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        eventBus.emit('format:changed', { pageId, formatName, type: 'page' });\n        \n        return true;\n    }\n    \n    /**\n     * Clear active format for a page (return to default)\n     * @param {string} pageId - Page ID\n     * @returns {boolean} - Success status\n     */\n    clearPageFormat(pageId) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return false;\n        \n        // Remove from activeFormats\n        this.activeFormats.delete(pageId);\n        \n        // Remove from page data\n        delete page.format;\n        \n        // Save and re-render\n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        eventBus.emit('format:changed', { pageId, formatName: null, type: 'page' });\n        \n        return true;\n    }\n    \n    /**\n     * Set active format for a bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {string} formatName - Format name\n     * @returns {Promise<boolean>} - Success status\n     */\n    async setBinFormat(pageId, binId, formatName) {\n        const format = this.getFormat(formatName);\n        if (!format || !format.supportsBins) {\n            console.error(`Format \"${formatName}\" not found or doesn't support bins`);\n            return false;\n        }\n        \n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return false;\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return false;\n        \n        // Initialize format if needed\n        if (!pluginRegistry.isInitialized(format.id)) {\n            await pluginRegistry.initialize(format.id, null);\n        }\n        \n        // Enable format\n        await pluginRegistry.enable(format.id);\n        \n        // Set as active format\n        bin.format = formatName;\n        const key = `${pageId}:${binId}`;\n        this.activeFormats.set(key, formatName);\n        \n        // Save and re-render\n        eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        eventBus.emit('format:changed', { pageId, binId, formatName, type: 'bin' });\n        \n        return true;\n    }\n    \n    /**\n     * Get active format for a page\n     * @param {string} pageId - Page ID\n     * @returns {string|null} - Format name\n     */\n    getPageFormat(pageId) {\n        // First check activeFormats map\n        if (this.activeFormats.has(pageId)) {\n            return this.activeFormats.get(pageId);\n        }\n        \n        // Fallback: check page data (for when data is loaded but activeFormats wasn't initialized)\n        const appState = this._getAppState();\n        if (appState && appState.documents) {\n            const page = appState.documents.find(p => p.id === pageId);\n            if (page && page.format) {\n                // Sync to activeFormats for future lookups\n                this.activeFormats.set(pageId, page.format);\n                return page.format;\n            }\n        }\n        \n        return null;\n    }\n    \n    /**\n     * Get active format for a bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @returns {string|null} - Format name\n     */\n    getBinFormat(pageId, binId) {\n        const key = `${pageId}:${binId}`;\n        return this.activeFormats.get(key) || null;\n    }\n    \n    /**\n     * Render page in format\n     * @param {HTMLElement} container - Container element\n     * @param {string} pageId - Page ID\n     */\n    renderPage(container, pageId) {\n        const formatName = this.getPageFormat(pageId);\n        if (!formatName) {\n            // Use default rendering\n            return;\n        }\n        \n        const format = this.getFormat(formatName);\n        if (format && format.renderPage) {\n            const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n            format.renderPage(container, page, {});\n        }\n    }\n    \n    /**\n     * Render bin in format\n     * @param {HTMLElement} container - Container element\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     */\n    renderBin(container, pageId, binId) {\n        const formatName = this.getBinFormat(pageId, binId);\n        if (!formatName) {\n            // Use default rendering\n            return;\n        }\n        \n        const format = this.getFormat(formatName);\n        if (format && format.renderBin) {\n            const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n            const bin = page.groups?.find(b => b.id === binId);\n            format.renderBin(container, bin, { page });\n        }\n    }\n    \n    /**\n     * Render format settings UI\n     * @param {HTMLElement} container - Container element\n     * @param {string} formatName - Format name\n     * @param {Object} currentSettings - Current settings\n     */\n    renderSettingsUI(container, formatName, currentSettings) {\n        const format = this.getFormat(formatName);\n        if (format && format.renderSettingsUI) {\n            format.renderSettingsUI(container, currentSettings);\n        }\n    }\n    \n    /**\n     * Export data in format\n     * @param {Object} data - Data to export\n     * @param {string} formatName - Format name\n     * @returns {string|Blob} - Exported data\n     */\n    export(data, formatName) {\n        const format = this.getFormat(formatName);\n        if (format && format.export) {\n            return format.export(data);\n        }\n        return JSON.stringify(data, null, 2);\n    }\n    \n    /**\n     * Import data from format\n     * @param {string|Blob} importData - Data to import\n     * @param {string} formatName - Format name\n     * @returns {Object} - Parsed data\n     */\n    import(importData, formatName) {\n        const format = this.getFormat(formatName);\n        if (format && format.import) {\n            return format.import(importData);\n        }\n        \n        // Default JSON import\n        if (typeof importData === 'string') {\n            try {\n                return JSON.parse(importData);\n            } catch (error) {\n                throw new Error('Invalid data format');\n            }\n        }\n        throw new Error('Unsupported data type');\n    }\n}\n\n","// PluginLoader - Dynamic plugin loading\nimport { pluginRegistry } from './PluginManager.js';\nimport { eventBus } from './EventBus.js';\n\nexport class PluginLoader {\n    constructor() {\n        this.loadedPlugins = new Set(); // Set of loaded plugin IDs\n        this.loadingPromises = new Map(); // pluginId -> Promise\n    }\n    \n    /**\n     * Load a plugin module\n     * @param {string} pluginPath - Path to plugin module\n     * @param {string} pluginId - Plugin ID (optional, defaults to filename)\n     * @param {Object} app - App instance (optional, for plugins that need it)\n     * @returns {Promise<Object>} - Plugin instance\n     */\n    async loadPlugin(pluginPath, pluginId = null, app = null) {\n        // Generate plugin ID from path if not provided\n        if (!pluginId) {\n            const parts = pluginPath.split('/');\n            const filename = parts[parts.length - 1];\n            pluginId = filename.replace(/\\.js$/, '');\n        }\n        \n        // Check if already loaded\n        if (this.loadedPlugins.has(pluginId)) {\n            return pluginRegistry.get(pluginId);\n        }\n        \n        // Check if currently loading\n        if (this.loadingPromises.has(pluginId)) {\n            return await this.loadingPromises.get(pluginId);\n        }\n        \n        // Start loading\n        const loadPromise = this._loadPluginModule(pluginPath, pluginId, app);\n        this.loadingPromises.set(pluginId, loadPromise);\n        \n        try {\n            const plugin = await loadPromise;\n            this.loadedPlugins.add(pluginId);\n            this.loadingPromises.delete(pluginId);\n            return plugin;\n        } catch (error) {\n            this.loadingPromises.delete(pluginId);\n            // Only log non-fetch errors (fetch errors are expected for optional plugins)\n            const isFetchError = error instanceof TypeError && \n                (error.message.includes('Failed to fetch') || \n                 error.message.includes('ERR_CONNECTION_REFUSED') ||\n                 error.message.includes('dynamically imported module'));\n            if (!isFetchError) {\n                console.error(`Failed to load plugin \"${pluginId}\" from \"${pluginPath}\":`, error);\n            }\n            throw error;\n        }\n    }\n    \n    /**\n     * Load plugin module (internal)\n     * @param {string} pluginPath - Path to plugin module\n     * @param {string} pluginId - Plugin ID\n     * @param {Object} app - App instance (optional)\n     * @returns {Promise<Object>} - Plugin instance\n     */\n    async _loadPluginModule(pluginPath, pluginId, app = null) {\n        try {\n            // Dynamic import\n            const module = await import(pluginPath);\n            \n            // Get plugin class (default export or named export)\n            const PluginClass = module.default || module[Object.keys(module)[0]];\n            \n            if (!PluginClass) {\n                throw new Error(`No plugin class found in module \"${pluginPath}\"`);\n            }\n            \n            // Instantiate plugin - try with app first, fallback to no args, then with empty config\n            let plugin;\n            try {\n                // Try instantiating with app if provided\n                if (app) {\n                    plugin = new PluginClass(app);\n                } else {\n                    plugin = new PluginClass();\n                }\n            } catch (e) {\n                // If that fails, try without app\n                if (app) {\n                    try {\n                        plugin = new PluginClass();\n                    } catch (e2) {\n                        // If that also fails, try with empty config object\n                        plugin = new PluginClass({});\n                    }\n                } else {\n                    // Try with empty config object\n                    try {\n                        plugin = new PluginClass({});\n                    } catch (e2) {\n                        throw e; // Throw original error\n                    }\n                }\n            }\n            \n            // If app was provided and plugin doesn't have it yet, initialize it\n            if (app && plugin.init && typeof plugin.init === 'function' && !plugin.app) {\n                await plugin.init(app);\n            }\n            \n            // Ensure plugin has required properties\n            if (!plugin.id) {\n                plugin.id = pluginId;\n            }\n            \n            // Register plugin\n            const registered = pluginRegistry.register(plugin);\n            if (!registered) {\n                throw new Error(`Failed to register plugin \"${pluginId}\"`);\n            }\n            \n            eventBus.emit('plugin:loaded', {\n                pluginId: plugin.id,\n                pluginPath\n            });\n            \n            return plugin;\n        } catch (error) {\n            // Only log non-fetch errors (fetch errors are expected for optional plugins)\n            const isFetchError = error instanceof TypeError && \n                (error.message.includes('Failed to fetch') || \n                 error.message.includes('ERR_CONNECTION_REFUSED') ||\n                 error.message.includes('dynamically imported module'));\n            if (!isFetchError) {\n                console.error(`Error loading plugin module \"${pluginPath}\":`, error);\n            }\n            throw error;\n        }\n    }\n    \n    /**\n     * Load multiple plugins\n     * @param {Array<Object>} plugins - Array of { path, id } objects\n     * @returns {Promise<Array<Object>>} - Array of plugin instances\n     */\n    async loadPlugins(plugins) {\n        const results = await Promise.allSettled(\n            plugins.map(plugin => this.loadPlugin(plugin.path, plugin.id))\n        );\n        \n        const loaded = [];\n        const failed = [];\n        \n        results.forEach((result, index) => {\n            if (result.status === 'fulfilled') {\n                loaded.push(result.value);\n            } else {\n                failed.push({\n                    plugin: plugins[index],\n                    error: result.reason\n                });\n            }\n        });\n        \n        if (failed.length > 0) {\n            console.warn('Some plugins failed to load:', failed);\n        }\n        \n        return loaded;\n    }\n    \n    /**\n     * Load plugins from directory\n     * @param {string} directory - Directory path\n     * @param {Array<string>} pluginFiles - Array of plugin filenames\n     * @returns {Promise<Array<Object>>} - Array of plugin instances\n     */\n    async loadPluginsFromDirectory(directory, pluginFiles) {\n        const plugins = pluginFiles.map(filename => ({\n            path: `${directory}/${filename}`,\n            id: filename.replace(/\\.js$/, '')\n        }));\n        \n        return await this.loadPlugins(plugins);\n    }\n    \n    /**\n     * Unload a plugin\n     * @param {string} pluginId - Plugin ID\n     * @returns {Promise<boolean>} - Success status\n     */\n    async unloadPlugin(pluginId) {\n        const plugin = pluginRegistry.get(pluginId);\n        if (!plugin) {\n            return false;\n        }\n        \n        // Destroy plugin\n        if (plugin.destroy && typeof plugin.destroy === 'function') {\n            await plugin.destroy();\n        }\n        \n        // Unregister\n        pluginRegistry.unregister(pluginId);\n        \n        // Remove from loaded set\n        this.loadedPlugins.delete(pluginId);\n        \n        eventBus.emit('plugin:unloaded', { pluginId });\n        \n        return true;\n    }\n    \n    /**\n     * Check if plugin is loaded\n     * @param {string} pluginId - Plugin ID\n     * @returns {boolean}\n     */\n    isLoaded(pluginId) {\n        return this.loadedPlugins.has(pluginId);\n    }\n    \n    /**\n     * Get all loaded plugin IDs\n     * @returns {Array<string>}\n     */\n    getLoadedPlugins() {\n        return Array.from(this.loadedPlugins);\n    }\n    \n    /**\n     * Clear all loaded plugins\n     */\n    clear() {\n        this.loadedPlugins.clear();\n        this.loadingPromises.clear();\n    }\n}\n\n// Singleton instance\nexport const pluginLoader = new PluginLoaderService();\n\n","// RelationshipManager - Manages element relationships\nimport { DataUtils } from '../utils/data.js';\nimport { eventBus } from '../core/EventBus.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class RelationshipManager {\n    constructor() {\n        this.relationships = new Map(); // elementId -> Set of relationship objects\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Get DataManager service\n     */\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    /**\n     * Add a relationship between two elements\n     * @param {string} fromElementId - Source element ID (pageId:binId:elementIndex)\n     * @param {string} toElementId - Target element ID\n     * @param {string} type - Relationship type ('blocks', 'dependsOn', 'relatedTo')\n     * @returns {boolean} - Success status\n     */\n    addRelationship(fromElementId, toElementId, type) {\n        if (!this.isValidRelationshipType(type)) {\n            console.error(`Invalid relationship type: ${type}`);\n            return false;\n        }\n        \n        if (fromElementId === toElementId) {\n            console.error('Cannot create relationship to self');\n            return false;\n        }\n        \n        // Check for circular dependencies (only for non-cyclic relationship types)\n        if (!this.allowsCycles(type)) {\n            if (this.wouldCreateCycle(fromElementId, toElementId, type)) {\n                console.error('Would create circular dependency');\n                return false;\n            }\n        }\n        \n        // Get or create relationship set for source element\n        if (!this.relationships.has(fromElementId)) {\n            this.relationships.set(fromElementId, new Set());\n        }\n        \n        const relationship = {\n            to: toElementId,\n            type: type,\n            createdAt: Date.now()\n        };\n        \n        this.relationships.get(fromElementId).add(relationship);\n        \n        // Update element data\n        this.updateElementRelationships(fromElementId);\n        \n        // Emit event\n        eventBus.emit('relationship:added', {\n            from: fromElementId,\n            to: toElementId,\n            type: type\n        });\n        \n        return true;\n    }\n    \n    /**\n     * Remove a relationship\n     * @param {string} fromElementId - Source element ID\n     * @param {string} toElementId - Target element ID\n     * @param {string} type - Relationship type\n     * @returns {boolean} - Success status\n     */\n    removeRelationship(fromElementId, toElementId, type) {\n        const relSet = this.relationships.get(fromElementId);\n        if (!relSet) return false;\n        \n        for (const rel of relSet) {\n            if (rel.to === toElementId && rel.type === type) {\n                relSet.delete(rel);\n                this.updateElementRelationships(fromElementId);\n                \n                eventBus.emit('relationship:removed', {\n                    from: fromElementId,\n                    to: toElementId,\n                    type: type\n                });\n                \n                return true;\n            }\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Get all relationships for an element\n     * @param {string} elementId - Element ID\n     * @returns {Array<Object>} - Array of relationships\n     */\n    getRelationships(elementId) {\n        const relSet = this.relationships.get(elementId);\n        return relSet ? Array.from(relSet) : [];\n    }\n    \n    /**\n     * Get relationships by type\n     * @param {string} elementId - Element ID\n     * @param {string} type - Relationship type\n     * @returns {Array<Object>} - Array of relationships\n     */\n    getRelationshipsByType(elementId, type) {\n        return this.getRelationships(elementId).filter(rel => rel.type === type);\n    }\n    \n    /**\n     * Get all elements that relate to this element (inverse relationships)\n     * @param {string} elementId - Element ID\n     * @returns {Array<Object>} - Array of {from, type}\n     */\n    getInverseRelationships(elementId) {\n        const inverse = [];\n        \n        for (const [fromId, relSet] of this.relationships.entries()) {\n            for (const rel of relSet) {\n                if (rel.to === elementId) {\n                    inverse.push({\n                        from: fromId,\n                        type: rel.type\n                    });\n                }\n            }\n        }\n        \n        return inverse;\n    }\n    \n    /**\n     * Get all available relationship types\n     * @returns {Array<Object>} - Array of {type, label, description, directional, cyclic}\n     */\n    getRelationshipTypes() {\n        return [\n            // Dependency relationships (directional, non-cyclic)\n            { type: 'dependsOn', label: 'Depends On', description: 'This element depends on the target', directional: true, cyclic: false },\n            { type: 'blocks', label: 'Blocks', description: 'This element blocks the target', directional: true, cyclic: false },\n            { type: 'requiredBy', label: 'Required By', description: 'This element is required by the target', directional: true, cyclic: false },\n            { type: 'enables', label: 'Enables', description: 'This element enables the target', directional: true, cyclic: false },\n            { type: 'prevents', label: 'Prevents', description: 'This element prevents the target', directional: true, cyclic: false },\n            \n            // Temporal relationships (directional, can be cyclic)\n            { type: 'precedes', label: 'Precedes', description: 'This element comes before the target', directional: true, cyclic: true },\n            { type: 'follows', label: 'Follows', description: 'This element comes after the target', directional: true, cyclic: true },\n            { type: 'causes', label: 'Causes', description: 'This element causes the target', directional: true, cyclic: false },\n            { type: 'triggers', label: 'Triggers', description: 'This element triggers the target', directional: true, cyclic: false },\n            \n            // Hierarchical relationships (directional, can be cyclic)\n            { type: 'contains', label: 'Contains', description: 'This element contains the target', directional: true, cyclic: false },\n            { type: 'partOf', label: 'Part Of', description: 'This element is part of the target', directional: true, cyclic: false },\n            { type: 'parentOf', label: 'Parent Of', description: 'This element is parent of the target', directional: true, cyclic: false },\n            { type: 'childOf', label: 'Child Of', description: 'This element is child of the target', directional: true, cyclic: false },\n            \n            // Reference relationships (directional, can be cyclic)\n            { type: 'references', label: 'References', description: 'This element references the target', directional: true, cyclic: true },\n            { type: 'referencedBy', label: 'Referenced By', description: 'This element is referenced by the target', directional: true, cyclic: true },\n            { type: 'linksTo', label: 'Links To', description: 'This element links to the target', directional: true, cyclic: true },\n            { type: 'linkedFrom', label: 'Linked From', description: 'This element is linked from the target', directional: true, cyclic: true },\n            \n            // Similarity relationships (bidirectional, can be cyclic)\n            { type: 'relatedTo', label: 'Related To', description: 'This element is related to the target', directional: false, cyclic: true },\n            { type: 'similarTo', label: 'Similar To', description: 'This element is similar to the target', directional: false, cyclic: true },\n            { type: 'oppositeTo', label: 'Opposite To', description: 'This element is opposite to the target', directional: false, cyclic: true },\n            { type: 'conflictsWith', label: 'Conflicts With', description: 'This element conflicts with the target', directional: false, cyclic: true },\n            { type: 'complements', label: 'Complements', description: 'This element complements the target', directional: false, cyclic: true },\n            \n            // Flow relationships (directional, can be cyclic)\n            { type: 'leadsTo', label: 'Leads To', description: 'This element leads to the target', directional: true, cyclic: true },\n            { type: 'flowsInto', label: 'Flows Into', description: 'This element flows into the target', directional: true, cyclic: true },\n            { type: 'branchesTo', label: 'Branches To', description: 'This element branches to the target', directional: true, cyclic: true },\n            { type: 'mergesWith', label: 'Merges With', description: 'This element merges with the target', directional: true, cyclic: true },\n            \n            // Logical relationships (directional, can be cyclic)\n            { type: 'implies', label: 'Implies', description: 'This element implies the target', directional: true, cyclic: false },\n            { type: 'contradicts', label: 'Contradicts', description: 'This element contradicts the target', directional: false, cyclic: true },\n            { type: 'supports', label: 'Supports', description: 'This element supports the target', directional: true, cyclic: false },\n            { type: 'opposes', label: 'Opposes', description: 'This element opposes the target', directional: false, cyclic: true }\n        ];\n    }\n    \n    /**\n     * Get relationship type metadata\n     * @param {string} type - Relationship type\n     * @returns {Object|null} - Relationship type metadata\n     */\n    getRelationshipTypeMetadata(type) {\n        const types = this.getRelationshipTypes();\n        return types.find(t => t.type === type) || null;\n    }\n    \n    /**\n     * Check if relationship type is valid\n     * @param {string} type - Relationship type\n     * @returns {boolean}\n     */\n    isValidRelationshipType(type) {\n        return this.getRelationshipTypes().some(t => t.type === type);\n    }\n    \n    /**\n     * Check if relationship type allows cycles\n     * @param {string} type - Relationship type\n     * @returns {boolean}\n     */\n    allowsCycles(type) {\n        const metadata = this.getRelationshipTypeMetadata(type);\n        return metadata ? metadata.cyclic : false;\n    }\n    \n    /**\n     * Check if relationship type is directional\n     * @param {string} type - Relationship type\n     * @returns {boolean}\n     */\n    isDirectional(type) {\n        const metadata = this.getRelationshipTypeMetadata(type);\n        return metadata ? metadata.directional : true;\n    }\n    \n    /**\n     * Check if adding relationship would create a cycle\n     * @param {string} fromElementId - Source element ID\n     * @param {string} toElementId - Target element ID\n     * @param {string} type - Relationship type\n     * @returns {boolean}\n     */\n    wouldCreateCycle(fromElementId, toElementId, type) {\n        // For dependsOn and blocks, check if target depends on source\n        if (type === 'dependsOn') {\n            return this.hasPath(toElementId, fromElementId, 'dependsOn');\n        } else if (type === 'blocks') {\n            return this.hasPath(toElementId, fromElementId, 'blocks');\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Check if there's a path from source to target\n     * @param {string} fromId - Source element ID\n     * @param {string} toId - Target element ID\n     * @param {string} type - Relationship type to follow\n     * @returns {boolean}\n     */\n    hasPath(fromId, toId, type) {\n        if (fromId === toId) return true;\n        \n        const visited = new Set();\n        const queue = [fromId];\n        visited.add(fromId);\n        \n        while (queue.length > 0) {\n            const current = queue.shift();\n            const relationships = this.getRelationshipsByType(current, type);\n            \n            for (const rel of relationships) {\n                if (rel.to === toId) {\n                    return true;\n                }\n                \n                if (!visited.has(rel.to)) {\n                    visited.add(rel.to);\n                    queue.push(rel.to);\n                }\n            }\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Update element data with relationships\n     * @param {string} elementId - Element ID\n     */\n    updateElementRelationships(elementId) {\n        const [pageId, binId, elementIndex] = elementId.split(':');\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        const items = bin.items || [];\n        bin.items = items;\n        if (!items) return;\n        \n        const element = items[parseInt(elementIndex)];\n        if (!element) return;\n        \n        // Initialize relationships object with all relationship types\n        if (!element.relationships) {\n            element.relationships = {};\n            this.getRelationshipTypes().forEach(relType => {\n                element.relationships[relType.type] = [];\n            });\n        }\n        \n        // Get all relationships\n        const relationships = this.getRelationships(elementId);\n        \n        // Group by type - dynamically create arrays for all relationship types\n        const allTypes = this.getRelationshipTypes().map(t => t.type);\n        allTypes.forEach(relType => {\n            if (!element.relationships[relType]) {\n                element.relationships[relType] = [];\n            }\n            element.relationships[relType] = relationships\n                .filter(rel => rel.type === relType)\n                .map(rel => rel.to);\n        });\n        \n        // Keep backward compatibility with old structure\n        if (!element.relationships.blocks) element.relationships.blocks = [];\n        if (!element.relationships.dependsOn) element.relationships.dependsOn = [];\n        if (!element.relationships.relatedTo) element.relationships.relatedTo = [];\n        \n        // Save data\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n    }\n    \n    /**\n     * Load relationships from element data\n     * @param {string} elementId - Element ID\n     * @param {Object} element - Element data\n     */\n    loadRelationships(elementId, element) {\n        if (!element.relationships) return;\n        \n        const relSet = new Set();\n        \n        // Load all relationship types dynamically\n        if (element.relationships && typeof element.relationships === 'object') {\n            Object.keys(element.relationships).forEach(relType => {\n                if (this.isValidRelationshipType(relType) && Array.isArray(element.relationships[relType])) {\n                    element.relationships[relType].forEach(toId => {\n                        relSet.add({\n                            to: toId,\n                            type: relType,\n                            createdAt: Date.now()\n                        });\n                    });\n                }\n            });\n        }\n        \n        if (relSet.size > 0) {\n            this.relationships.set(elementId, relSet);\n        }\n    }\n    \n    /**\n     * Get element ID from page, bin, and index\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     * @returns {string}\n     */\n    getElementId(pageId, binId, elementIndex) {\n        return `${pageId}:${binId}:${elementIndex}`;\n    }\n    \n    /**\n     * Parse element ID into components\n     * @param {string} elementId - Element ID\n     * @returns {Object} - {pageId, binId, elementIndex}\n     */\n    parseElementId(elementId) {\n        const parts = elementId.split(':');\n        return {\n            pageId: parts[0],\n            binId: parts[1],\n            elementIndex: parseInt(parts[2])\n        };\n    }\n    \n    /**\n     * Get element by ID\n     * @param {string} elementId - Element ID\n     * @returns {Object|null} - Element data and context\n     */\n    getElement(elementId) {\n        const { pageId, binId, elementIndex } = this.parseElementId(elementId);\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return null;\n        const items = bin.items || [];\n        bin.items = items;\n        if (!items) return null;\n        \n        const element = items[elementIndex];\n        if (!element) return null;\n        \n        return {\n            element,\n            pageId,\n            binId,\n            elementIndex,\n            page,\n            bin\n        };\n    }\n    \n    /**\n     * Initialize relationships from all elements\n     */\n    initializeFromData() {\n        this.relationships.clear();\n        \n        const appState = this._getAppState();\n        appState.documents.forEach(page => {\n            if (page.groups) {\n                page.groups.forEach(bin => {\n                    const items = bin.items || [];\n                    bin.items = items;\n                    items.forEach((element, index) => {\n                            const elementId = this.getElementId(page.id, bin.id, index);\n                            this.loadRelationships(elementId, element);\n                        });\n                });\n            }\n        });\n    }\n}\n\n","// Storage Utilities - LocalStorage wrapper and storage management\r\nexport const StorageUtils = {\r\n    /**\r\n     * Get item from localStorage\r\n     * @param {string} key - Storage key\r\n     * @param {*} defaultValue - Default value if not found\r\n     * @returns {*}\r\n     */\r\n    get(key, defaultValue = null) {\r\n        try {\r\n            const item = localStorage.getItem(key);\r\n            if (item === null) return defaultValue;\r\n            return JSON.parse(item);\r\n        } catch (error) {\r\n            console.error(`Error reading from localStorage key \"${key}\":`, error);\r\n            return defaultValue;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Set item in localStorage\r\n     * @param {string} key - Storage key\r\n     * @param {*} value - Value to store\r\n     * @returns {boolean} - Success status\r\n     */\r\n    set(key, value) {\r\n        try {\r\n            localStorage.setItem(key, JSON.stringify(value));\r\n            return true;\r\n        } catch (error) {\r\n            console.error(`Error writing to localStorage key \"${key}\":`, error);\r\n            if (error.name === 'QuotaExceededError') {\r\n                console.warn('Storage quota exceeded. Attempting to clear old data...');\r\n                this.clearOldData();\r\n                try {\r\n                    localStorage.setItem(key, JSON.stringify(value));\r\n                    return true;\r\n                } catch (retryError) {\r\n                    console.error('Failed to save after cleanup:', retryError);\r\n                    return false;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Remove item from localStorage\r\n     * @param {string} key - Storage key\r\n     */\r\n    remove(key) {\r\n        try {\r\n            localStorage.removeItem(key);\r\n        } catch (error) {\r\n            console.error(`Error removing localStorage key \"${key}\":`, error);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Clear all localStorage\r\n     */\r\n    clear() {\r\n        try {\r\n            localStorage.clear();\r\n        } catch (error) {\r\n            console.error('Error clearing localStorage:', error);\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Check if key exists in localStorage\r\n     * @param {string} key - Storage key\r\n     * @returns {boolean}\r\n     */\r\n    has(key) {\r\n        return localStorage.getItem(key) !== null;\r\n    },\r\n    \r\n    /**\r\n     * Get all keys from localStorage\r\n     * @returns {Array<string>}\r\n     */\r\n    keys() {\r\n        const keys = [];\r\n        for (let i = 0; i < localStorage.length; i++) {\r\n            keys.push(localStorage.key(i));\r\n        }\r\n        return keys;\r\n    },\r\n    \r\n    /**\r\n     * Get storage size in bytes (approximate)\r\n     * @returns {number}\r\n     */\r\n    getSize() {\r\n        let total = 0;\r\n        for (let key in localStorage) {\r\n            if (localStorage.hasOwnProperty(key)) {\r\n                total += localStorage[key].length + key.length;\r\n            }\r\n        }\r\n        return total;\r\n    },\r\n    \r\n    /**\r\n     * Get storage quota information\r\n     * @returns {Promise<Object>} - { quota, usage, available }\r\n     */\r\n    async getQuota() {\r\n        if ('storage' in navigator && 'estimate' in navigator.storage) {\r\n            try {\r\n                const estimate = await navigator.storage.estimate();\r\n                return {\r\n                    quota: estimate.quota,\r\n                    usage: estimate.usage,\r\n                    available: estimate.quota - estimate.usage\r\n                };\r\n            } catch (error) {\r\n                console.error('Error getting storage quota:', error);\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n    \r\n    /**\r\n     * Clear old data based on timestamp or other criteria\r\n     * This is a placeholder - implement based on your app's needs\r\n     */\r\n    clearOldData() {\r\n        // Example: Clear items older than 30 days\r\n        const keys = this.keys();\r\n        const now = Date.now();\r\n        const maxAge = 30 * 24 * 60 * 60 * 1000; // 30 days\r\n        \r\n        keys.forEach(key => {\r\n            if (key.startsWith('temp_') || key.startsWith('cache_')) {\r\n                try {\r\n                    const item = this.get(key);\r\n                    if (item && item.timestamp && (now - item.timestamp) > maxAge) {\r\n                        this.remove(key);\r\n                    }\r\n                } catch (error) {\r\n                    // If item can't be parsed, remove it\r\n                    this.remove(key);\r\n                }\r\n            }\r\n        });\r\n    },\r\n    \r\n    /**\r\n     * Migrate data from old key to new key\r\n     * @param {string} oldKey - Old storage key\r\n     * @param {string} newKey - New storage key\r\n     * @param {Function} transform - Optional transformation function\r\n     * @returns {boolean} - Success status\r\n     */\r\n    migrate(oldKey, newKey, transform = null) {\r\n        if (!this.has(oldKey)) return false;\r\n        \r\n        try {\r\n            let storedValue = this.get(oldKey);\r\n            if (transform && typeof transform === 'function') {\r\n                storedValue = transform(storedValue);\r\n            }\r\n            this.set(newKey, storedValue);\r\n            this.remove(oldKey);\r\n            return true;\r\n        } catch (error) {\r\n            console.error(`Error migrating from \"${oldKey}\" to \"${newKey}\":`, error);\r\n            return false;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Get item with expiration check\r\n     * @param {string} key - Storage key\r\n     * @param {*} defaultValue - Default value\r\n     * @returns {*}\r\n     */\r\n    getWithExpiry(key, defaultValue = null) {\r\n        try {\r\n            const item = this.get(key);\r\n            if (!item || !item.expiry) return defaultValue;\r\n            \r\n            if (Date.now() > item.expiry) {\r\n                this.remove(key);\r\n                return defaultValue;\r\n            }\r\n            \r\n            return item.value;\r\n        } catch (error) {\r\n            console.error(`Error reading expired item from localStorage key \"${key}\":`, error);\r\n            return defaultValue;\r\n        }\r\n    },\r\n    \r\n    /**\r\n     * Set item with expiration\r\n     * @param {string} key - Storage key\r\n     * @param {*} value - Value to store\r\n     * @param {number} ttl - Time to live in milliseconds\r\n     * @returns {boolean} - Success status\r\n     */\r\n    setWithExpiry(key, value, ttl) {\r\n        const item = {\r\n            value: value,\r\n            expiry: Date.now() + ttl\r\n        };\r\n        return this.set(key, item);\r\n    }\r\n};\r\n\r\n","// TemplateManager - Manages document and group templates\nimport { StorageUtils } from '../utils/storage.js';\nimport { DataUtils } from '../utils/data.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class TemplateManager {\n    constructor() {\n        this.templatesKey = 'twodo-templates';\n        this.templates = this.loadTemplates();\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Load templates from storage\n     * @returns {Object} - Templates object\n     */\n    loadTemplates() {\n        const stored = StorageUtils.get(this.templatesKey) || {};\n        return {\n            documents: stored.documents || [],\n            groups: stored.groups || []\n        };\n    }\n    \n    /**\n     * Save templates to storage\n     */\n    saveTemplates() {\n        StorageUtils.set(this.templatesKey, this.templates);\n    }\n    \n    /**\n     * Save a page as a template\n     * @param {string} pageId - Page ID to save\n     * @param {string} templateName - Name for the template\n     * @returns {boolean} - Success status\n     */\n    savePageAsTemplate(pageId, templateName) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return false;\n        \n        // Create template copy (deep clone)\n        const template = {\n            id: `template-${Date.now()}`,\n            name: templateName,\n            type: 'page',\n            createdAt: Date.now(),\n            data: DataUtils.deepClone(page)\n        };\n        \n        // Remove ID from template data to allow new page creation\n        delete template.data.id;\n        \n        this.templates.documents.push(template);\n        this.saveTemplates();\n        \n        return true;\n    }\n    \n    /**\n     * Save a bin as a template\n     * @param {string} pageId - Page ID containing the bin\n     * @param {string} binId - Bin ID to save\n     * @param {string} templateName - Name for the template\n     * @returns {boolean} - Success status\n     */\n    saveBinAsTemplate(pageId, binId, templateName) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return false;\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return false;\n        const items = bin.items || [];\n        bin.items = items;\n        \n        // Create template copy (deep clone)\n        const template = {\n            id: `template-${Date.now()}`,\n            name: templateName,\n            type: 'bin',\n            createdAt: Date.now(),\n            data: DataUtils.deepClone(bin)\n        };\n        \n        // Remove ID from template data to allow new bin creation\n        delete template.data.id;\n        \n        this.templates.groups.push(template);\n        this.saveTemplates();\n        \n        return true;\n    }\n    \n    /**\n     * Get all page templates\n     * @returns {Array} - Array of page templates\n     */\n    getPageTemplates() {\n        return this.templates.documents || [];\n    }\n    \n    /**\n     * Get all bin templates\n     * @returns {Array} - Array of bin templates\n     */\n    getBinTemplates() {\n        return this.templates.groups || [];\n    }\n    \n    /**\n     * Get a template by ID\n     * @param {string} templateId - Template ID\n     * @returns {Object|null} - Template object or null\n     */\n    getTemplate(templateId) {\n        const pageTemplate = this.templates.documents.find(t => t.id === templateId);\n        if (pageTemplate) return pageTemplate;\n        \n        const binTemplate = this.templates.groups.find(t => t.id === templateId);\n        if (binTemplate) return binTemplate;\n        \n        return null;\n    }\n    \n    /**\n     * Create a page from a template\n     * @param {string} templateId - Template ID\n     * @returns {Object|null} - New page object or null\n     */\n    createPageFromTemplate(templateId) {\n        const template = this.getTemplate(templateId);\n        if (!template || template.type !== 'page') return null;\n        \n        // Deep clone template data\n        const newPage = DataUtils.deepClone(template.data);\n        \n        // Generate new ID\n        newPage.id = `page-${Date.now()}`;\n        \n        // Generate new IDs for bins and elements\n        const groups = newPage.groups || [];\n        groups.forEach(bin => {\n                bin.id = `bin-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n                const items = bin.items || [];\n                bin.items = items;\n                if (items.length > 0) {\n                    items.forEach(() => {\n                        // Template elements are validated elsewhere\n                    });\n                }\n            });\n        newPage.groups = groups;\n        \n        return newPage;\n    }\n    \n    /**\n     * Create a bin from a template\n     * @param {string} templateId - Template ID\n     * @returns {Object|null} - New bin object or null\n     */\n    createBinFromTemplate(templateId) {\n        const template = this.getTemplate(templateId);\n        if (!template || template.type !== 'bin') return null;\n        \n        // Deep clone template data\n        const newBin = DataUtils.deepClone(template.data);\n        \n        // Generate new ID\n        newBin.id = `bin-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        \n        // Ensure elements have proper structure\n        const items = newBin.items || [];\n        newBin.items = items;\n        if (items.length > 0) {\n            items.forEach(() => {\n                // Template elements are validated elsewhere\n            });\n        }\n        \n        return newBin;\n    }\n    \n    /**\n     * Delete a template\n     * @param {string} templateId - Template ID\n     * @returns {boolean} - Success status\n     */\n    deleteTemplate(templateId) {\n        const pageIndex = this.templates.documents.findIndex(t => t.id === templateId);\n        if (pageIndex !== -1) {\n            this.templates.documents.splice(pageIndex, 1);\n            this.saveTemplates();\n            return true;\n        }\n        \n        const binIndex = this.templates.groups.findIndex(t => t.id === templateId);\n        if (binIndex !== -1) {\n            this.templates.groups.splice(binIndex, 1);\n            this.saveTemplates();\n            return true;\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Export template as JSON\n     * @param {string} templateId - Template ID\n     * @returns {string|null} - JSON string or null\n     */\n    exportTemplate(templateId) {\n        const template = this.getTemplate(templateId);\n        if (!template) return null;\n        \n        return JSON.stringify(template, null, 2);\n    }\n    \n    /**\n     * Import template from JSON\n     * @param {string} jsonString - JSON string\n     * @returns {boolean} - Success status\n     */\n    importTemplate(jsonString) {\n        try {\n            const template = JSON.parse(jsonString);\n            \n            if (!template.type || !template.data) {\n                return false;\n            }\n            \n            // Generate new ID\n            template.id = `template-${Date.now()}`;\n            template.createdAt = Date.now();\n            \n            if (template.type === 'page') {\n                this.templates.documents.push(template);\n            } else if (template.type === 'bin') {\n                this.templates.groups.push(template);\n            } else {\n                return false;\n            }\n            \n            this.saveTemplates();\n            return true;\n        } catch (err) {\n            console.error('Error importing template:', err);\n            return false;\n        }\n    }\n}\n\n","// AutomationManager - Core automation rule engine\nimport { eventBus } from './EventBus.js';\n\nexport class AutomationManager {\n    constructor(app) {\n        this.app = app;\n        this.rules = new Map(); // binId -> Array of rules\n        this.logs = [];\n        this.maxLogSize = 1000;\n    }\n\n    _getDocument(pageId) {\n        const documents = this.app.appState?.documents || this.app.documents || [];\n        return documents.find(page => page.id === pageId) || null;\n    }\n\n    _getGroup(pageId, binId) {\n        const document = this._getDocument(pageId);\n        const group = document?.groups?.find(bin => bin.id === binId) || null;\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return group;\n    }\n    \n    /**\n     * Add automation rule to a bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} rule - Rule object\n     * @returns {string} - Rule ID\n     */\n    addRule(pageId, binId, rule) {\n        const ruleId = `rule-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n        const fullRule = {\n            id: ruleId,\n            pageId,\n            binId,\n            name: rule.name || 'Unnamed Rule',\n            enabled: rule.enabled !== false,\n            trigger: rule.trigger || {}, // { type: 'elementCompleted', ... }\n            conditions: rule.conditions || [], // Array of condition objects\n            actions: rule.actions || [], // Array of action objects\n            createdAt: Date.now()\n        };\n        \n        const key = `${pageId}:${binId}`;\n        if (!this.rules.has(key)) {\n            this.rules.set(key, []);\n        }\n        \n        this.rules.get(key).push(fullRule);\n        \n        // Subscribe to relevant events\n        this.subscribeToEvents(fullRule);\n        \n        return ruleId;\n    }\n    \n    /**\n     * Remove automation rule\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {string} ruleId - Rule ID\n     * @returns {boolean} - Success status\n     */\n    removeRule(pageId, binId, ruleId) {\n        const key = `${pageId}:${binId}`;\n        const rules = this.rules.get(key);\n        if (!rules) return false;\n        \n        const index = rules.findIndex(r => r.id === ruleId);\n        if (index === -1) return false;\n        \n        const rule = rules[index];\n        this.unsubscribeFromEvents(rule);\n        \n        rules.splice(index, 1);\n        return true;\n    }\n    \n    /**\n     * Get rules for a bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @returns {Array} - Array of rules\n     */\n    getRules(pageId, binId) {\n        const key = `${pageId}:${binId}`;\n        return this.rules.get(key) || [];\n    }\n    \n    /**\n     * Subscribe to events for a rule\n     * @param {Object} rule - Rule object\n     */\n    subscribeToEvents(rule) {\n        if (!rule.enabled) return;\n        \n        const triggerType = rule.trigger?.type;\n        if (!triggerType) return;\n        \n        // Create event handler\n        const handler = (data) => {\n            this.handleTrigger(rule, data);\n        };\n        \n        // Store handler on rule for cleanup\n        rule._eventHandler = handler;\n        \n        // Subscribe based on trigger type\n        switch (triggerType) {\n            case 'elementCompleted':\n                eventBus.on('element:completed', handler);\n                break;\n            case 'elementCreated':\n                eventBus.on('element:created', handler);\n                break;\n            case 'elementUpdated':\n                eventBus.on('element:updated', handler);\n                break;\n            case 'timeBased':\n                // Time-based triggers need interval checking\n                this.setupTimeBasedTrigger(rule);\n                break;\n        }\n    }\n    \n    /**\n     * Unsubscribe from events for a rule\n     * @param {Object} rule - Rule object\n     */\n    unsubscribeFromEvents(rule) {\n        const handler = rule._eventHandler;\n        if (!handler) return;\n        \n        const triggerType = rule.trigger?.type;\n        switch (triggerType) {\n            case 'elementCompleted':\n                eventBus.off('element:completed', handler);\n                break;\n            case 'elementCreated':\n                eventBus.off('element:created', handler);\n                break;\n            case 'elementUpdated':\n                eventBus.off('element:updated', handler);\n                break;\n            case 'timeBased':\n                if (rule._intervalId) {\n                    clearInterval(rule._intervalId);\n                    delete rule._intervalId;\n                }\n                break;\n        }\n        \n        delete rule._eventHandler;\n    }\n    \n    /**\n     * Handle trigger event\n     * @param {Object} rule - Rule object\n     * @param {Object} data - Event data\n     */\n    handleTrigger(rule, data) {\n        if (!rule.enabled) return;\n        \n        // Check if trigger matches\n        if (!this.matchesTrigger(rule.trigger, data)) {\n            return;\n        }\n        \n        // Check conditions\n        if (!this.checkConditions(rule.conditions, data)) {\n            return;\n        }\n        \n        // Execute actions\n        this.executeActions(rule.actions, data);\n        \n        // Log execution\n        this.log({\n            ruleId: rule.id,\n            ruleName: rule.name,\n            trigger: rule.trigger.type,\n            timestamp: Date.now(),\n            data: data\n        });\n    }\n    \n    /**\n     * Check if trigger matches\n     * @param {Object} trigger - Trigger object\n     * @param {Object} data - Event data\n     * @returns {boolean}\n     */\n    matchesTrigger(trigger, data) {\n        if (!trigger || !data) return false;\n        \n        switch (trigger.type) {\n            case 'elementCompleted':\n                return data.pageId === trigger.pageId && \n                       data.binId === trigger.binId &&\n                       (trigger.elementIndex === undefined || data.elementIndex === trigger.elementIndex);\n            case 'elementCreated':\n                return data.pageId === trigger.pageId && \n                       data.binId === trigger.binId;\n            case 'elementUpdated':\n                return data.pageId === trigger.pageId && \n                       data.binId === trigger.binId;\n            default:\n                return false;\n        }\n    }\n    \n    /**\n     * Check conditions\n     * @param {Array} conditions - Array of condition objects\n     * @param {Object} data - Event data\n     * @returns {boolean}\n     */\n    checkConditions(conditions, data) {\n        if (!conditions || conditions.length === 0) return true;\n        \n        // Get element data if needed\n        let element = null;\n        if (data.elementIndex !== undefined) {\n            const group = this._getGroup(data.pageId, data.binId);\n            element = group?.items?.[data.elementIndex];\n        }\n        \n        // Check all conditions (AND logic)\n        return conditions.every(condition => {\n            switch (condition.type) {\n                case 'hasTag':\n                    return element && element.tags && element.tags.includes(condition.value);\n                case 'hasProperty':\n                    return element && element[condition.property] === condition.value;\n                case 'isCompleted':\n                    return element && element.completed === condition.value;\n                case 'timeOfDay':\n                    const now = new Date();\n                    const hour = now.getHours();\n                    return hour >= condition.startHour && hour < condition.endHour;\n                default:\n                    return true;\n            }\n        });\n    }\n    \n    /**\n     * Execute actions\n     * @param {Array} actions - Array of action objects\n     * @param {Object} data - Event data\n     */\n    executeActions(actions, data) {\n        if (!actions || actions.length === 0) return;\n        \n        actions.forEach(action => {\n            switch (action.type) {\n                case 'moveElement':\n                    this.moveElement(data.pageId, data.binId, data.elementIndex, action.targetPageId, action.targetBinId);\n                    break;\n                case 'setProperty':\n                    this.setElementProperty(data.pageId, data.binId, data.elementIndex, action.property, action.value);\n                    break;\n                case 'addTag':\n                    this.addElementTag(data.pageId, data.binId, data.elementIndex, action.tag);\n                    break;\n                case 'removeTag':\n                    this.removeElementTag(data.pageId, data.binId, data.elementIndex, action.tag);\n                    break;\n                case 'createElement':\n                    this.createElement(action.targetPageId, action.targetBinId, action.elementData);\n                    break;\n                case 'deleteElement':\n                    this.deleteElement(data.pageId, data.binId, data.elementIndex);\n                    break;\n            }\n        });\n    }\n    \n    /**\n     * Move element to different bin\n     */\n    moveElement(pageId, binId, elementIndex, targetPageId, targetBinId) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin || !bin.items) return;\n        \n        const element = bin.items[elementIndex];\n        if (!element) return;\n        \n        // Remove from source\n        bin.items.splice(elementIndex, 1);\n        \n        // Add to target\n        const targetBin = this._getGroup(targetPageId, targetBinId);\n        if (targetBin) {\n            if (!targetBin.items) targetBin.items = [];\n            targetBin.items.push(element);\n        }\n        \n        this.app.dataManager.saveData();\n        this.app.render();\n    }\n    \n    /**\n     * Set element property\n     */\n    setElementProperty(pageId, binId, elementIndex, property, value) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin || !bin.items) return;\n        \n        const element = bin.items[elementIndex];\n        if (!element) return;\n        \n        element[property] = value;\n        this.app.dataManager.saveData();\n        this.app.render();\n    }\n    \n    /**\n     * Add tag to element\n     */\n    addElementTag(pageId, binId, elementIndex, tag) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin || !bin.items) return;\n        \n        const element = bin.items[elementIndex];\n        if (!element) return;\n        \n        if (!element.tags) element.tags = [];\n        if (!element.tags.includes(tag)) {\n            element.tags.push(tag);\n            this.app.dataManager.saveData();\n            this.app.render();\n        }\n    }\n    \n    /**\n     * Remove tag from element\n     */\n    removeElementTag(pageId, binId, elementIndex, tag) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin || !bin.items) return;\n        \n        const element = bin.items[elementIndex];\n        if (!element || !element.tags) return;\n        \n        const index = element.tags.indexOf(tag);\n        if (index !== -1) {\n            element.tags.splice(index, 1);\n            this.app.dataManager.saveData();\n            this.app.render();\n        }\n    }\n    \n    /**\n     * Create new element\n     */\n    createElement(pageId, binId, elementData) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin) return;\n        \n        if (!bin.items) bin.items = [];\n        bin.items.push(elementData);\n        \n        this.app.dataManager.saveData();\n        this.app.render();\n    }\n    \n    /**\n     * Delete element\n     */\n    deleteElement(pageId, binId, elementIndex) {\n        const bin = this._getGroup(pageId, binId);\n        if (!bin || !bin.items) return;\n        \n        const deletedElement = bin.items[elementIndex];\n        if (!deletedElement) return;\n        \n        // Record undo/redo change\n        if (this.app.undoRedoManager) {\n            this.app.undoRedoManager.recordElementDelete(pageId, binId, elementIndex, deletedElement);\n        }\n        \n        bin.items.splice(elementIndex, 1);\n        this.app.dataManager.saveData();\n        this.app.render();\n    }\n    \n    /**\n     * Setup time-based trigger\n     * @param {Object} rule - Rule object\n     */\n    setupTimeBasedTrigger(rule) {\n        const schedule = rule.trigger.schedule; // e.g., { hour: 9, minute: 0, days: [1,2,3,4,5] }\n        if (!schedule) return;\n        \n        const checkTime = () => {\n            const now = new Date();\n            const day = now.getDay(); // 0 = Sunday, 6 = Saturday\n            const hour = now.getHours();\n            const minute = now.getMinutes();\n            \n            // Check if current day matches\n            if (schedule.days && !schedule.days.includes(day)) {\n                return;\n            }\n            \n            // Check if current time matches (within 1 minute window)\n            if (hour === schedule.hour && minute === schedule.minute) {\n                this.handleTrigger(rule, {\n                    pageId: rule.pageId,\n                    binId: rule.binId,\n                    type: 'timeBased',\n                    timestamp: Date.now()\n                });\n            }\n        };\n        \n        // Check every minute\n        rule._intervalId = setInterval(checkTime, 60000);\n        checkTime(); // Check immediately\n    }\n    \n    /**\n     * Log automation execution\n     * @param {Object} logEntry - Log entry object\n     */\n    log(logEntry) {\n        this.logs.push(logEntry);\n        \n        // Limit log size\n        if (this.logs.length > this.maxLogSize) {\n            this.logs.shift();\n        }\n        \n        // Emit log event\n        eventBus.emit('automation:executed', logEntry);\n    }\n    \n    /**\n     * Get automation logs\n     * @param {string} ruleId - Optional rule ID to filter\n     * @param {number} limit - Limit number of results\n     * @returns {Array} - Array of log entries\n     */\n    getLogs(ruleId = null, limit = null) {\n        let logs = this.logs;\n        \n        if (ruleId) {\n            logs = logs.filter(log => log.ruleId === ruleId);\n        }\n        \n        if (limit) {\n            logs = logs.slice(-limit);\n        }\n        \n        return logs;\n    }\n    \n    /**\n     * Initialize rules from bin data\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Array} rules - Array of rule objects\n     */\n    initializeRules(pageId, binId, rules) {\n        if (!rules || !Array.isArray(rules)) return;\n        \n        rules.forEach(rule => {\n            this.addRule(pageId, binId, rule);\n        });\n    }\n    \n    /**\n     * Get rules as array for saving\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @returns {Array} - Array of rule objects (without event handlers)\n     */\n    getRulesForSaving(pageId, binId) {\n        const rules = this.getRules(pageId, binId);\n        return rules.map(rule => {\n            const { _eventHandler, _intervalId, ...ruleData } = rule;\n            return ruleData;\n        });\n    }\n}\n\n","// TagManager - Manages tags across all elements\nimport { StorageUtils } from '../utils/storage.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class TagManager {\n    constructor() {\n        this.tagsKey = 'twodo-tags';\n        this.allTags = this.loadTags();\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Load all tags from storage\n     * @returns {Set} - Set of all tags\n     */\n    loadTags() {\n        const stored = StorageUtils.get(this.tagsKey);\n        return stored ? new Set(stored) : new Set();\n    }\n    \n    /**\n     * Save all tags to storage\n     */\n    saveTags() {\n        StorageUtils.set(this.tagsKey, Array.from(this.allTags));\n    }\n    \n    /**\n     * Get all tags\n     * @returns {Array} - Array of all tags\n     */\n    getAllTags() {\n        return Array.from(this.allTags).sort();\n    }\n    \n    /**\n     * Get default tags\n     * @returns {Array} - Array of default tags\n     */\n    getDefaultTags() {\n        return ['work', 'personal', 'urgent', 'important', 'meeting', 'deadline', 'chore', 'hobby', 'project', 'home', 'shopping'];\n    }\n    \n    /**\n     * Get all available tags (default + stored)\n     * @returns {Array} - Array of all available tags\n     */\n    getAvailableTags() {\n        const defaultTags = this.getDefaultTags();\n        const allTags = new Set([...defaultTags, ...this.allTags]);\n        return Array.from(allTags).sort();\n    }\n    \n    /**\n     * Add a tag to the collection\n     * @param {string} tag - Tag to add\n     */\n    addTag(tag) {\n        if (tag && tag.trim()) {\n            const normalizedTag = tag.trim().toLowerCase();\n            this.allTags.add(normalizedTag);\n            this.saveTags();\n        }\n    }\n    \n    /**\n     * Remove a tag from the collection\n     * @param {string} tag - Tag to remove\n     */\n    removeTag(tag) {\n        if (tag) {\n            const normalizedTag = tag.trim().toLowerCase();\n            this.allTags.delete(normalizedTag);\n            this.saveTags();\n        }\n    }\n    \n    /**\n     * Get tags for an element\n     * @param {Object} element - Element object\n     * @returns {Array} - Array of tags\n     */\n    getElementTags(element) {\n        return element.tags || [];\n    }\n    \n    /**\n     * Set tags for an element\n     * @param {Object} element - Element object\n     * @param {Array} tags - Array of tags\n     */\n    setElementTags(element, tags) {\n        if (!Array.isArray(tags)) {\n            tags = [];\n        }\n        element.tags = tags.map(tag => tag.trim().toLowerCase()).filter(tag => tag);\n        \n        // Add new tags to collection\n        tags.forEach(tag => this.addTag(tag));\n    }\n    \n    /**\n     * Add tag to element\n     * @param {Object} element - Element object\n     * @param {string} tag - Tag to add\n     */\n    addElementTag(element, tag) {\n        if (!element.tags) {\n            element.tags = [];\n        }\n        const normalizedTag = tag.trim().toLowerCase();\n        if (!element.tags.includes(normalizedTag)) {\n            element.tags.push(normalizedTag);\n            this.addTag(normalizedTag);\n        }\n    }\n    \n    /**\n     * Remove tag from element\n     * @param {Object} element - Element object\n     * @param {string} tag - Tag to remove\n     */\n    removeElementTag(element, tag) {\n        if (element.tags) {\n            const normalizedTag = tag.trim().toLowerCase();\n            element.tags = element.tags.filter(t => t !== normalizedTag);\n        }\n    }\n    \n    /**\n     * Get elements with a specific tag\n     * @param {string} tag - Tag to search for\n     * @returns {Array} - Array of {page, bin, element, elementIndex}\n     */\n    getElementsByTag(tag) {\n        const results = [];\n        const normalizedTag = tag.trim().toLowerCase();\n        \n        const appState = this._getAppState();\n        appState.documents.forEach(page => {\n            if (page.groups) {\n                page.groups.forEach(bin => {\n                    const items = bin.items || [];\n                    bin.items = items;\n                    items.forEach((element, elementIndex) => {\n                            if (element.tags && element.tags.includes(normalizedTag)) {\n                                results.push({\n                                    page,\n                                    bin,\n                                    element,\n                                    elementIndex,\n                                    pageId: page.id,\n                                    binId: bin.id\n                                });\n                            }\n                    });\n                });\n            }\n        });\n        \n        return results;\n    }\n    \n    /**\n     * Get tag statistics\n     * @returns {Object} - Object mapping tags to counts\n     */\n    getTagStatistics() {\n        const stats = {};\n        \n        const appState = this._getAppState();\n        appState.documents.forEach(page => {\n            if (page.groups) {\n                page.groups.forEach(bin => {\n                    const items = bin.items || [];\n                    bin.items = items;\n                    items.forEach(element => {\n                            if (element.tags) {\n                                element.tags.forEach(tag => {\n                                    stats[tag] = (stats[tag] || 0) + 1;\n                                });\n                            }\n                    });\n                });\n            }\n        });\n        \n        return stats;\n    }\n    \n    /**\n     * Search tags (autocomplete)\n     * @param {string} query - Search query\n     * @returns {Array} - Array of matching tags\n     */\n    searchTags(query) {\n        if (!query || !query.trim()) {\n            return this.getAvailableTags();\n        }\n        \n        const normalizedQuery = query.trim().toLowerCase();\n        const availableTags = this.getAvailableTags();\n        \n        return availableTags.filter(tag => \n            tag.toLowerCase().includes(normalizedQuery)\n        );\n    }\n}\n\n","// SearchIndex.js - Builds and maintains a search index for all elements\nimport { DataUtils } from '../utils/data.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class SearchIndex {\n    constructor() {\n        this.index = new Map(); // elementId -> searchable data\n        this.rebuildIndex();\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Rebuild the entire search index\n     */\n    rebuildIndex() {\n        this.index.clear();\n        \n        const appState = this._getAppState();\n        // Check if app and pages exist and is an array\n        if (!appState || !appState.documents || !Array.isArray(appState.documents)) {\n            return;\n        }\n        \n        appState.documents.forEach(page => {\n            if (page && page.groups) {\n                page.groups.forEach(bin => {\n                    const items = bin.items || [];\n                    bin.items = items;\n                    if (items.length > 0) {\n                        const itemIndex = ItemHierarchy.buildItemIndex(items);\n                        items.forEach((element, elementIndex) => {\n                            const elementId = this.getElementId(page.id, bin.id, elementIndex);\n                            this.index.set(elementId, this.extractSearchableData(page, bin, element, elementIndex, itemIndex));\n                        });\n                    }\n                });\n            }\n        });\n    }\n    \n    /**\n     * Get unique element ID\n     */\n    getElementId(pageId, binId, elementIndex) {\n        return `${pageId}-${binId}-${elementIndex}`;\n    }\n    \n    /**\n     * Extract searchable data from an element\n     */\n    extractSearchableData(page, bin, element, elementIndex, itemIndex) {\n        const childItems = itemIndex ? ItemHierarchy.getChildItems(element, itemIndex) : [];\n        const searchableData = {\n            pageId: page.id,\n            pageTitle: page.title || '',\n            binId: bin.id,\n            binTitle: bin.title || '',\n            elementIndex: elementIndex,\n            text: element.text || '',\n            type: element.type || 'task',\n            tags: element.tags || [],\n            completed: element.completed || false,\n            deadline: element.deadline || null,\n            timeAllocated: element.timeAllocated || '',\n            funModifier: element.funModifier || '',\n            customProperties: element.customProperties || {},\n            // Include children text\n            childrenText: childItems.map(child => child.text || '').join(' '),\n            // Include items text for multi-checkbox\n            itemsText: (element.items || []).map(item => item.text || '').join(' ')\n        };\n        \n        return searchableData;\n    }\n    \n    /**\n     * Search the index\n     * @param {string} query - Search query\n     * @param {Object} filters - Filter options\n     * @returns {Array} - Array of matching element data\n     */\n    search(query, filters = {}) {\n        const normalizedQuery = query ? query.toLowerCase().trim() : '';\n        const results = [];\n        \n        for (const [elementId, elementData] of this.index.entries()) {\n            let matches = true;\n            \n            // Text search\n            if (normalizedQuery) {\n                const searchableText = [\n                    elementData.text,\n                    elementData.pageTitle,\n                    elementData.binTitle,\n                    elementData.timeAllocated,\n                    elementData.funModifier,\n                    elementData.childrenText,\n                    elementData.itemsText,\n                    ...elementData.tags,\n                    ...Object.values(elementData.customProperties)\n                ].join(' ').toLowerCase();\n                \n                if (!searchableText.includes(normalizedQuery)) {\n                    matches = false;\n                }\n            }\n            \n            // Apply filters\n            if (filters.tags && filters.tags.length > 0) {\n                const hasMatchingTag = filters.tags.some(tag => \n                    elementData.tags.includes(tag.toLowerCase())\n                );\n                if (!hasMatchingTag) matches = false;\n            }\n            \n            if (filters.completed !== undefined) {\n                if (elementData.completed !== filters.completed) matches = false;\n            }\n            \n            if (filters.type && filters.type.length > 0) {\n                if (!filters.type.includes(elementData.type)) matches = false;\n            }\n            \n            if (filters.pageId && filters.pageId.length > 0) {\n                if (!filters.pageId.includes(elementData.pageId)) matches = false;\n            }\n            \n            if (filters.binId && filters.binId.length > 0) {\n                if (!filters.binId.includes(elementData.binId)) matches = false;\n            }\n            \n            if (filters.hasDeadline !== undefined) {\n                if ((elementData.deadline !== null) !== filters.hasDeadline) matches = false;\n            }\n            \n            if (filters.deadlineBefore) {\n                if (!elementData.deadline || new Date(elementData.deadline) > new Date(filters.deadlineBefore)) {\n                    matches = false;\n                }\n            }\n            \n            if (filters.deadlineAfter) {\n                if (!elementData.deadline || new Date(elementData.deadline) < new Date(filters.deadlineAfter)) {\n                    matches = false;\n                }\n            }\n            \n            if (matches) {\n                results.push({\n                    ...elementData,\n                    elementId\n                });\n            }\n        }\n        \n        return results;\n    }\n    \n    /**\n     * Update index for a single element\n     */\n    updateElement(pageId, binId, elementIndex) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return;\n        \n        const bin = page.groups?.find(b => b.id === binId);\n        if (!bin) return;\n        \n        const items = bin.items || [];\n        bin.items = items;\n        const element = items?.[elementIndex];\n        if (!element) return;\n        \n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        this.index.set(elementId, this.extractSearchableData(page, bin, element, elementIndex));\n    }\n    \n    /**\n     * Remove element from index\n     */\n    removeElement(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        this.index.delete(elementId);\n    }\n    \n    /**\n     * Get all unique tags from index\n     */\n    getAllTags() {\n        const tags = new Set();\n        for (const entry of this.index.values()) {\n            entry.tags.forEach(tag => tags.add(tag));\n        }\n        return Array.from(tags).sort();\n    }\n    \n    /**\n     * Get all element types from index\n     */\n    getAllTypes() {\n        const types = new Set();\n        for (const entry of this.index.values()) {\n            types.add(entry.type);\n        }\n        return Array.from(types).sort();\n    }\n}\n\n","// ExportService.js - Handles exporting pages to various formats\nimport { DataUtils } from '../utils/data.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class ExportService {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Export page to JSON\n     */\n    exportToJSON(pageId) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        const exportData = DataUtils.deepClone(page);\n        return JSON.stringify(exportData, null, 2);\n    }\n    \n    /**\n     * Export page to CSV\n     */\n    exportToCSV(pageId) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        const rows = [];\n        rows.push(['Page', 'Bin', 'Type', 'Text', 'Completed', 'Tags', 'Deadline', 'Time Allocated'].join(','));\n        \n        page.groups?.forEach(bin => {\n            const items = bin.items || [];\n            bin.items = items;\n            items.forEach(element => {\n                const row = [\n                    `\"${(page.title || page.id).replace(/\"/g, '\"\"')}\"`,\n                    `\"${(bin.title || bin.id).replace(/\"/g, '\"\"')}\"`,\n                    `\"${(element.type || 'task').replace(/\"/g, '\"\"')}\"`,\n                    `\"${(element.text || '').replace(/\"/g, '\"\"')}\"`,\n                    element.completed ? 'Yes' : 'No',\n                    `\"${(element.tags || []).join('; ').replace(/\"/g, '\"\"')}\"`,\n                    element.deadline || '',\n                    element.timeAllocated || ''\n                ];\n                rows.push(row.join(','));\n            });\n        });\n        \n        return rows.join('\\n');\n    }\n    \n    /**\n     * Export page to Markdown\n     */\n    exportToMarkdown(pageId) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        let md = `# ${page.title || page.id}\\n\\n`;\n        \n        page.groups?.forEach(bin => {\n            md += `## ${bin.title || bin.id}\\n\\n`;\n            const items = bin.items || [];\n            bin.items = items;\n            const itemIndex = ItemHierarchy.buildItemIndex(items);\n            const rootItems = ItemHierarchy.getRootItems(items);\n            rootItems.forEach(element => {\n                const checkbox = element.completed ? '[x]' : '[ ]';\n                const tags = element.tags && element.tags.length > 0 \n                    ? ` ${element.tags.map(t => `#${t}`).join(' ')}` \n                    : '';\n                const deadline = element.deadline \n                    ? ` (Deadline: ${new Date(element.deadline).toLocaleDateString()})` \n                    : '';\n                md += `- ${checkbox} ${element.text || 'Untitled'}${tags}${deadline}\\n`;\n                \n                // Add children\n                const childItems = ItemHierarchy.getChildItems(element, itemIndex);\n                if (childItems.length > 0) {\n                    childItems.forEach(child => {\n                        const childCheckbox = child.completed ? '[x]' : '[ ]';\n                        md += `  - ${childCheckbox} ${child.text || ''}\\n`;\n                    });\n                }\n            });\n            \n            md += '\\n';\n        });\n        \n        return md;\n    }\n    \n    /**\n     * Export page to PDF (requires jsPDF library)\n     */\n    async exportToPDF(pageId) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        // Check if jsPDF is available\n        if (typeof window.jsPDF === 'undefined') {\n            // Fallback: download as text\n            const markdown = this.exportToMarkdown(pageId);\n            this.downloadFile(`${pageId}.txt`, markdown, 'text/plain');\n            return;\n        }\n        \n        const { jsPDF } = window.jsPDF;\n        const doc = new jsPDF();\n        \n        let y = 20;\n        doc.setFontSize(18);\n        doc.text(page.title || page.id, 10, y);\n        y += 10;\n        \n        page.groups?.forEach(bin => {\n            if (y > 280) {\n                doc.addPage();\n                y = 20;\n            }\n            \n            doc.setFontSize(14);\n            doc.text(bin.title || bin.id, 10, y);\n            y += 8;\n            \n            const items = bin.items || [];\n            bin.items = items;\n            items.forEach(element => {\n                if (y > 280) {\n                    doc.addPage();\n                    y = 20;\n                }\n                \n                doc.setFontSize(10);\n                const checkbox = element.completed ? '' : '';\n                const text = `${checkbox} ${element.text || 'Untitled'}`;\n                doc.text(text, 15, y);\n                y += 6;\n            });\n            \n            y += 5;\n        });\n        \n        doc.save(`${pageId}.pdf`);\n    }\n    \n    /**\n     * Download file\n     */\n    downloadFile(filename, content, mimeType = 'text/plain') {\n        const blob = new Blob([content], { type: mimeType });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n    \n    /**\n     * Export page with format selection\n     */\n    async exportPage(pageId, format = 'json') {\n        let content = null;\n        let filename = `${pageId}.${format}`;\n        let mimeType = 'text/plain';\n        \n        switch (format) {\n            case 'json':\n                content = this.exportToJSON(pageId);\n                mimeType = 'application/json';\n                break;\n            case 'csv':\n                content = this.exportToCSV(pageId);\n                mimeType = 'text/csv';\n                break;\n            case 'md':\n            case 'markdown':\n                content = this.exportToMarkdown(pageId);\n                mimeType = 'text/markdown';\n                filename = `${pageId}.md`;\n                break;\n            case 'pdf':\n                await this.exportToPDF(pageId);\n                return; // PDF handles its own download\n            default:\n                console.error('Unknown export format:', format);\n                return;\n        }\n        \n        if (content) {\n            this.downloadFile(filename, content, mimeType);\n        }\n    }\n}\n\n","// ImportService.js - Handles importing pages from various formats\nimport { DataUtils } from '../utils/data.js';\n\nexport class ImportService {\n    constructor() {\n    }\n    \n    /**\n     * Import from JSON\n     */\n    importFromJSON(jsonString, options = {}) {\n        try {\n            const importedPage = JSON.parse(jsonString);\n            \n            // Validate structure\n            if (!importedPage.id || !importedPage.groups) {\n                throw new Error('Invalid document structure');\n            }\n            \n            // Generate new ID if needed\n            if (options.newPageId) {\n                importedPage.id = options.newPageId;\n            } else {\n                importedPage.id = `page-${Date.now()}`;\n            }\n            \n            // Re-index groups and items\n            const groups = importedPage.groups || [];\n            groups.forEach((bin, binIndex) => {\n                bin.id = bin.id || `bin-${binIndex}`;\n                const items = bin.items || [];\n                bin.items = items;\n                items.forEach((element, elIndex) => {\n                    element.id = element.id || `element-${importedPage.id}-${bin.id}-${elIndex}`;\n                });\n            });\n            importedPage.groups = groups;\n            \n            return importedPage;\n        } catch (error) {\n            throw new Error(`Failed to parse JSON: ${error.message}`);\n        }\n    }\n    \n    /**\n     * Import from CSV (Todoist format)\n     */\n    importFromCSV(csvString, options = {}) {\n        const lines = csvString.split('\\n').filter(line => line.trim());\n        if (lines.length < 2) {\n            throw new Error('CSV must have at least a header row and one data row');\n        }\n        \n        const headers = lines[0].split(',').map(h => h.trim().replace(/^\"|\"$/g, ''));\n        const pageId = options.newPageId || `page-${Date.now()}`;\n        const binId = options.binId || 'bin-0';\n        \n        const page = {\n            id: pageId,\n            title: options.pageTitle || 'Imported Page',\n            groups: [{\n                id: binId,\n                title: options.binTitle || 'Imported Bin',\n                items: []\n            }]\n        };\n        \n        // Find column indices\n        const textIndex = headers.findIndex(h => \n            h.toLowerCase().includes('task') || \n            h.toLowerCase().includes('content') || \n            h.toLowerCase().includes('text')\n        );\n        const completedIndex = headers.findIndex(h => \n            h.toLowerCase().includes('completed') || \n            h.toLowerCase().includes('done')\n        );\n        const priorityIndex = headers.findIndex(h => \n            h.toLowerCase().includes('priority')\n        );\n        const dueDateIndex = headers.findIndex(h => \n            h.toLowerCase().includes('due') || \n            h.toLowerCase().includes('deadline')\n        );\n        \n        // Parse rows\n        for (let i = 1; i < lines.length; i++) {\n            const values = this.parseCSVLine(lines[i]);\n            if (values.length === 0) continue;\n            \n            const element = {\n                id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                type: 'task',\n                text: values[textIndex] || 'Imported Task',\n                completed: completedIndex >= 0 && (\n                    values[completedIndex]?.toLowerCase() === 'yes' ||\n                    values[completedIndex]?.toLowerCase() === 'true' ||\n                    values[completedIndex] === '1'\n                ) || false,\n                parentId: null,\n                childIds: []\n            };\n            \n            if (dueDateIndex >= 0 && values[dueDateIndex]) {\n                element.deadline = this.parseDate(values[dueDateIndex]);\n            }\n            \n            if (priorityIndex >= 0 && values[priorityIndex]) {\n                const priority = values[priorityIndex].toLowerCase();\n                if (priority === 'high' || priority === 'p1') {\n                    if (!element.tags) element.tags = [];\n                    element.tags.push('urgent');\n                }\n            }\n            \n            page.groups[0].items.push(element);\n        }\n        \n        return page;\n    }\n    \n    /**\n     * Parse CSV line handling quoted values\n     */\n    parseCSVLine(line) {\n        const values = [];\n        let current = '';\n        let inQuotes = false;\n        \n        for (let i = 0; i < line.length; i++) {\n            const char = line[i];\n            \n            if (char === '\"') {\n                if (inQuotes && line[i + 1] === '\"') {\n                    current += '\"';\n                    i++; // Skip next quote\n                } else {\n                    inQuotes = !inQuotes;\n                }\n            } else if (char === ',' && !inQuotes) {\n                values.push(current.trim());\n                current = '';\n            } else {\n                current += char;\n            }\n        }\n        \n        values.push(current.trim());\n        return values;\n    }\n    \n    /**\n     * Import from Markdown (Notion format)\n     */\n    importFromMarkdown(markdownString, options = {}) {\n        const lines = markdownString.split('\\n');\n        const pageId = options.newPageId || `page-${Date.now()}`;\n        const binId = options.binId || 'bin-0';\n        \n        const page = {\n            id: pageId,\n            title: options.pageTitle || this.extractTitleFromMarkdown(markdownString) || 'Imported Page',\n            groups: [{\n                id: binId,\n                title: options.binTitle || 'Imported Bin',\n                items: []\n            }]\n        };\n        \n        let currentElement = null;\n        let currentBin = page.groups[0];\n        \n        lines.forEach(line => {\n            // Check for bin header (##)\n            if (line.startsWith('## ')) {\n                const binTitle = line.substring(3).trim();\n                const newBinId = `bin-${page.groups.length}`;\n                currentBin = {\n                    id: newBinId,\n                    title: binTitle,\n                    items: []\n                };\n                page.groups.push(currentBin);\n                return;\n            }\n            \n            // Check for task item (- [ ] or - [x])\n            const taskMatch = line.match(/^[\\s-]*\\[([ x])\\]\\s*(.+)$/);\n            if (taskMatch) {\n                if (currentElement) {\n                    currentBin.items.push(currentElement);\n                }\n                \n                currentElement = {\n                    id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                    type: 'task',\n                    text: taskMatch[2].trim(),\n                    completed: taskMatch[1] === 'x',\n                    parentId: null,\n                    childIds: []\n                };\n                \n                // Extract tags (#tag)\n                const tagMatches = currentElement.text.match(/#(\\w+)/g);\n                if (tagMatches) {\n                    currentElement.tags = tagMatches.map(t => t.substring(1));\n                    currentElement.text = currentElement.text.replace(/#\\w+/g, '').trim();\n                }\n                \n                // Extract deadline (Deadline: date)\n                const deadlineMatch = currentElement.text.match(/\\(Deadline:\\s*([^)]+)\\)/);\n                if (deadlineMatch) {\n                    currentElement.deadline = this.parseDate(deadlineMatch[1]);\n                    currentElement.text = currentElement.text.replace(/\\(Deadline:[^)]+\\)/g, '').trim();\n                }\n                \n                return;\n            }\n            \n            // Check for child item (indented)\n            if (currentElement && line.match(/^\\s{2,}-/)) {\n                const childMatch = line.match(/\\[([ x])\\]\\s*(.+)$/);\n                if (childMatch) {\n                    const childItem = {\n                        id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                        type: 'task',\n                        text: childMatch[2].trim(),\n                        completed: childMatch[1] === 'x',\n                        parentId: currentElement.id,\n                        childIds: []\n                    };\n                    currentElement.childIds.push(childItem.id);\n                    currentBin.items.push(childItem);\n                }\n            }\n        });\n        \n        if (currentElement) {\n                currentBin.items.push(currentElement);\n        }\n        \n        return page;\n    }\n    \n    /**\n     * Extract title from markdown (first # heading)\n     */\n    extractTitleFromMarkdown(markdown) {\n        const match = markdown.match(/^#\\s+(.+)$/m);\n        return match ? match[1].trim() : null;\n    }\n    \n    /**\n     * Parse date string to ISO format\n     */\n    parseDate(dateString) {\n        if (!dateString) return null;\n        \n        // Try various date formats\n        const date = new Date(dateString);\n        if (!isNaN(date.getTime())) {\n            return date.toISOString();\n        }\n        \n        return null;\n    }\n    \n    /**\n     * Import from Trello JSON export\n     */\n    importFromTrelloJSON(jsonString, options = {}) {\n        try {\n            const trelloData = JSON.parse(jsonString);\n            const pageId = options.newPageId || `page-${Date.now()}`;\n            \n            const page = {\n                id: pageId,\n                title: trelloData.name || 'Imported from Trello',\n                groups: []\n            };\n            \n            // Trello boards have lists (columns) which become bins\n            if (trelloData.lists && Array.isArray(trelloData.lists)) {\n                trelloData.lists.forEach((list, listIndex) => {\n                    const bin = {\n                        id: `bin-${listIndex}`,\n                        title: list.name || `List ${listIndex + 1}`,\n                        items: []\n                    };\n                    \n                    // Find cards in this list\n                    if (trelloData.cards && Array.isArray(trelloData.cards)) {\n                        trelloData.cards\n                            .filter(card => card.idList === list.id)\n                            .forEach((card, cardIndex) => {\n                                const element = {\n                                    id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                                    type: 'task',\n                                    text: card.name || 'Untitled Card',\n                                    completed: card.closed || false,\n                                    parentId: null,\n                                    childIds: []\n                                };\n                                \n                                // Add due date if present\n                                if (card.due) {\n                                    element.deadline = new Date(card.due).toISOString();\n                                }\n                                \n                                // Add labels as tags\n                                if (card.labels && card.labels.length > 0) {\n                                    element.tags = card.labels.map(l => l.name || l.color);\n                                }\n                                \n                                // Add description as child or custom property\n                                if (card.desc) {\n                                    element.customProperties = element.customProperties || {};\n                                    element.customProperties.description = card.desc;\n                                }\n                                \n                                // Add checklists as children\n                                if (trelloData.checklists && Array.isArray(trelloData.checklists)) {\n                                    trelloData.checklists\n                                        .filter(checklist => checklist.idCard === card.id)\n                                        .forEach(checklist => {\n                                            if (checklist.checkItems) {\n                                                checklist.checkItems.forEach(item => {\n                                                    const childItem = {\n                                                        id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\n                                                        type: 'task',\n                                                        text: item.name,\n                                                        completed: item.state === 'complete',\n                                                        parentId: element.id,\n                                                        childIds: []\n                                                    };\n                                                    element.childIds.push(childItem.id);\n                                                    bin.items.push(childItem);\n                                                });\n                                            }\n                                        });\n                                }\n                                \n                                bin.items.push(element);\n                            });\n                    }\n                    \n                    page.groups.push(bin);\n                });\n            }\n            \n            return page;\n        } catch (error) {\n            throw new Error(`Failed to parse Trello JSON: ${error.message}`);\n        }\n    }\n    \n    /**\n     * Import page with format detection\n     */\n    async importPage(file, format = 'auto') {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            \n            reader.onload = (e) => {\n                try {\n                    const content = e.target.result;\n                    let page = null;\n                    \n                    if (format === 'auto') {\n                        // Detect format\n                        if (file.name.endsWith('.json')) {\n                            format = 'json';\n                        } else if (file.name.endsWith('.csv')) {\n                            format = 'csv';\n                        } else if (file.name.endsWith('.md') || file.name.endsWith('.markdown')) {\n                            format = 'markdown';\n                        } else {\n                            // Try to detect from content\n                            if (content.trim().startsWith('{')) {\n                                format = 'json';\n                            } else if (content.includes(',')) {\n                                format = 'csv';\n                            } else {\n                                format = 'markdown';\n                            }\n                        }\n                    }\n                    \n                    switch (format) {\n                        case 'json':\n                            // Try Trello format first\n                            try {\n                                const parsedContent = JSON.parse(content);\n                                if (parsedContent.lists && parsedContent.cards) {\n                                    page = this.importFromTrelloJSON(content);\n                                } else {\n                                    page = this.importFromJSON(content);\n                                }\n                            } catch (err) {\n                                page = this.importFromJSON(content);\n                            }\n                            break;\n                        case 'csv':\n                            page = this.importFromCSV(content);\n                            break;\n                        case 'markdown':\n                        case 'md':\n                            page = this.importFromMarkdown(content);\n                            break;\n                        default:\n                            throw new Error(`Unsupported format: ${format}`);\n                    }\n                    \n                    resolve(page);\n                } catch (error) {\n                    reject(error);\n                }\n            };\n            \n            reader.onerror = () => reject(new Error('Failed to read file'));\n            reader.readAsText(file);\n        });\n    }\n}\n\n","// OAuthManager.js - OAuth 2.0 authentication manager\r\nimport { StorageUtils } from '../utils/storage.js';\r\n\r\nexport class OAuthManager {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this.storageKey = 'twodo-oauth-tokens';\r\n        this.tokens = this.loadTokens();\r\n        this.callbacks = new Map(); // Store OAuth callbacks\r\n    }\r\n    \r\n    loadTokens() {\r\n        return StorageUtils.get(this.storageKey) || {};\r\n    }\r\n    \r\n    saveTokens() {\r\n        StorageUtils.set(this.storageKey, this.tokens);\r\n    }\r\n    \r\n    /**\r\n     * Initiate OAuth flow for a service\r\n     */\r\n    async initiateOAuth(serviceName, config) {\r\n        const {\r\n            clientId,\r\n            redirectUri,\r\n            scope,\r\n            authURL,\r\n            tokenURL\r\n        } = config;\r\n        \r\n        // Generate state for CSRF protection\r\n        const oauthState = this.generateState();\r\n        this.callbacks.set(oauthState, { serviceName, config });\r\n        \r\n        // Build authorization URL\r\n        const params = new URLSearchParams({\r\n            client_id: clientId,\r\n            redirect_uri: redirectUri,\r\n            response_type: 'code',\r\n            scope: scope.join(' '),\r\n            state: oauthState\r\n        });\r\n        \r\n        const authUrl = `${authURL}?${params.toString()}`;\r\n        \r\n        // Open OAuth window\r\n        const width = 600;\r\n        const height = 700;\r\n        const left = (screen.width - width) / 2;\r\n        const top = (screen.height - height) / 2;\r\n        \r\n        const popup = window.open(\r\n            authUrl,\r\n            'OAuth',\r\n            `width=${width},height=${height},left=${left},top=${top}`\r\n        );\r\n        \r\n        // Listen for OAuth callback\r\n        return new Promise((resolve, reject) => {\r\n            const checkClosed = setInterval(() => {\r\n                if (popup.closed) {\r\n                    clearInterval(checkClosed);\r\n                    reject(new Error('OAuth window closed'));\r\n                }\r\n            }, 1000);\r\n            \r\n            // Listen for message from popup\r\n            const messageHandler = (event) => {\r\n                if (event.origin !== window.location.origin) return;\r\n                \r\n                if (event.data.type === 'oauth-callback') {\r\n                    clearInterval(checkClosed);\r\n                    window.removeEventListener('message', messageHandler);\r\n                    this.handleOAuthCallback(event.data, resolve, reject);\r\n                }\r\n            };\r\n            \r\n            window.addEventListener('message', messageHandler);\r\n        });\r\n    }\r\n    \r\n    async handleOAuthCallback(data, resolve, reject) {\r\n        const { code, state, error } = data;\r\n        \r\n        if (error) {\r\n            reject(new Error(error));\r\n            return;\r\n        }\r\n        \r\n        const callback = this.callbacks.get(state);\r\n        if (!callback) {\r\n            reject(new Error('Invalid OAuth state'));\r\n            return;\r\n        }\r\n        \r\n        try {\r\n            const tokens = await this.exchangeCodeForTokens(code, callback.config);\r\n            this.tokens[callback.serviceName] = tokens;\r\n            this.saveTokens();\r\n            resolve(tokens);\r\n        } catch (error) {\r\n            reject(error);\r\n        }\r\n    }\r\n    \r\n    async exchangeCodeForTokens(code, config) {\r\n        const response = await fetch(config.tokenURL, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded'\r\n            },\r\n            body: new URLSearchParams({\r\n                grant_type: 'authorization_code',\r\n                code: code,\r\n                client_id: config.clientId,\r\n                client_secret: config.clientSecret,\r\n                redirect_uri: config.redirectUri\r\n            })\r\n        });\r\n        \r\n        if (!response.ok) {\r\n            throw new Error('Failed to exchange code for tokens');\r\n        }\r\n        \r\n        return response.json();\r\n    }\r\n    \r\n    generateState() {\r\n        return Math.random().toString(36).substring(2, 15) + \r\n               Math.random().toString(36).substring(2, 15);\r\n    }\r\n    \r\n    getTokens(serviceName) {\r\n        return this.tokens[serviceName] || null;\r\n    }\r\n    \r\n    revokeTokens(serviceName) {\r\n        delete this.tokens[serviceName];\r\n        this.saveTokens();\r\n    }\r\n}\r\n\r\n\r\n","// SyncManager.js - Handles real-time synchronization via WebSocket\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class SyncManager {\n    constructor() {\n        this.ws = null;\n        this.clientId = null;\n        this.currentFilename = null;\n        this.reconnectAttempts = 0;\n        this.maxReconnectAttempts = 10;\n        this.reconnectDelay = 1000;\n        this.isConnected = false;\n        this.pendingChanges = [];\n        this.pendingFileJoin = null; // File to join once connected\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    _getFileManager() {\n        return getService(SERVICES.FILE_MANAGER);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    async connect() {\n        // Don't reconnect if already connected\n        if (this.isConnected && this.ws && this.ws.readyState === WebSocket.OPEN) {\n            console.log('WebSocket already connected');\n            return;\n        }\n        \n        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n        // Use window.location.hostname which will be the actual IP when accessed from another device\n        // or localhost when accessed locally\n        const host = window.location.hostname;\n        const wsPort = '8001'; // WebSocket server port\n        \n        const wsUrl = `${protocol}//${host}:${wsPort}`;\n        \n        console.log(`Connecting to WebSocket at ${wsUrl}`);\n        \n        return new Promise((resolve, reject) => {\n            try {\n                this.ws = new WebSocket(wsUrl);\n                \n                // Store resolve function to call when we get 'connected' message\n                this._connectResolve = resolve;\n                this._connectReject = reject;\n                \n                const timeout = setTimeout(() => {\n                    if (this.ws && this.ws.readyState !== WebSocket.OPEN) {\n                        this.ws.close();\n                        if (this._connectReject) {\n                            this._connectReject(new Error('WebSocket connection timeout'));\n                            this._connectReject = null;\n                        }\n                    }\n                }, 3000); // 3 second timeout - fail fast to avoid blocking initialization\n                \n                this.ws.onopen = () => {\n                    console.log('WebSocket connected');\n                    this.isConnected = true;\n                    this.reconnectAttempts = 0;\n                    \n                    // Don't resolve yet - wait for 'connected' message with clientId\n                    // The resolve will happen in handleMessage when we receive 'connected'\n                };\n                \n                this.ws.onmessage = (event) => {\n                    this.handleMessage(JSON.parse(event.data));\n                };\n                \n                this.ws.onerror = (error) => {\n                    clearTimeout(timeout);\n                    console.error('WebSocket error:', error);\n                    if (this._connectReject) {\n                        this._connectReject(error);\n                        this._connectReject = null;\n                    }\n                };\n                \n                this.ws.onclose = () => {\n                    clearTimeout(timeout);\n                    console.log('WebSocket disconnected');\n                    this.isConnected = false;\n                    this._connectResolve = null;\n                    this._connectReject = null;\n                    // Only attempt reconnect if this wasn't a manual close\n                    if (!this.ws || this.ws.readyState === WebSocket.CLOSED) {\n                        this.attemptReconnect();\n                    }\n                };\n            } catch (error) {\n                console.error('Failed to create WebSocket:', error);\n                reject(error);\n                this.attemptReconnect();\n            }\n        });\n    }\n    \n    attemptReconnect() {\n        if (this.reconnectAttempts < this.maxReconnectAttempts) {\n            this.reconnectAttempts++;\n            const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts - 1);\n            console.log(`Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts})...`);\n            setTimeout(() => this.connect(), delay);\n        } else {\n            console.error('Max reconnection attempts reached');\n        }\n    }\n    \n    handleMessage(message) {\n        const { type } = message;\n        \n        switch (type) {\n            case 'connected':\n                this.clientId = message.clientId;\n                console.log(`Received client ID: ${this.clientId}`);\n                \n                // Now that we have clientId, we can join files and send messages\n                // Send any pending changes\n                this.flushPendingChanges();\n                \n                // Join current file if any, or pending file join\n                const fileToJoin = this.currentFilename || this.pendingFileJoin;\n                if (fileToJoin) {\n                    this.currentFilename = fileToJoin;\n                    this.pendingFileJoin = null;\n                    this.joinFile(fileToJoin);\n                }\n                \n                // Resolve the connect promise if it's waiting\n                if (this._connectResolve) {\n                    this._connectResolve();\n                    this._connectResolve = null;\n                    this._connectReject = null;\n                }\n                break;\n            case 'file_joined':\n                this.handleFileJoined(message);\n                break;\n            case 'full_sync':\n                this.handleFullSync(message);\n                break;\n            case 'change':\n                this.handleRemoteChange(message);\n                break;\n            case 'undo':\n                this.handleRemoteUndo(message);\n                break;\n            case 'redo':\n                this.handleRemoteRedo(message);\n                break;\n            case 'client_joined':\n                console.log(`Client ${message.clientId} joined ${message.filename}`);\n                break;\n            case 'client_left':\n                console.log(`Client ${message.clientId} left ${message.filename}`);\n                break;\n        }\n    }\n    \n    handleFileJoined(message) {\n        // File data received from server\n        const fileManager = this._getFileManager();\n        if (message.data && fileManager) {\n            // Update app data if it matches current file\n            if (this.currentFilename === message.filename) {\n                const appState = this._getAppState();\n                const dataManager = this._getDataManager();\n                \n                // Compare data FIRST - if identical, skip entirely\n                const currentData = JSON.stringify(appState.documents);\n                const newData = JSON.stringify(message.data.documents || []);\n                \n                if (currentData === newData) {\n                    console.log('[SyncManager] File join data matches local data exactly, skipping update');\n                    // Update timestamp to match remote but don't overwrite data\n                    const remoteTimestamp = message.timestamp || message.data?._lastSyncTimestamp || message.data?.timestamp || 0;\n                    if (remoteTimestamp > 0 && dataManager) {\n                        dataManager._lastSyncTimestamp = remoteTimestamp;\n                    }\n                    return;\n                }\n                \n                // Data is different - check timestamps\n                const remoteTimestamp = message.timestamp || message.data?._lastSyncTimestamp || message.data?.timestamp || 0;\n                const localTimestamp = dataManager?._lastSyncTimestamp || 0;\n                \n                // If we just loaded the file (timestamp was set recently), be very conservative\n                // Only apply remote if it's significantly newer (more than 2 seconds)\n                if (localTimestamp > 0) {\n                    const timeSinceLoad = Date.now() - localTimestamp;\n                    // If we loaded less than 3 seconds ago, only apply remote if it's significantly newer\n                    if (timeSinceLoad < 3000) {\n                        const timeDiff = remoteTimestamp - localTimestamp;\n                        if (timeDiff < 2000) {\n                            console.log(`[SyncManager] Ignoring file join - just loaded file ${timeSinceLoad}ms ago, remote not significantly newer (diff: ${timeDiff}ms)`);\n                            return;\n                        }\n                    }\n                }\n                \n                // Only apply if remote change is newer (or if we don't have a local timestamp)\n                if (remoteTimestamp < localTimestamp && localTimestamp > 0) {\n                    console.log(`[SyncManager] Ignoring older file join (remote: ${remoteTimestamp}, local: ${localTimestamp})`);\n                    return;\n                }\n                \n                // Update local timestamp\n                if (remoteTimestamp > 0) {\n                    if (dataManager) {\n                        dataManager._lastSyncTimestamp = remoteTimestamp;\n                    }\n                }\n                \n                // Apply remote data\n                console.log('[SyncManager] Applying file join data (remote is newer or equal)');\n                appState.documents = message.data.documents || [];\n                appState.currentDocumentId = message.data.currentDocumentId || (appState.documents.length > 0 ? appState.documents[0].id : 'document-1');\n                appState.groupStates = message.data.groupStates || {};\n                appState.subtaskStates = message.data.subtaskStates || {};\n                appState.allSubtasksExpanded = message.data.allSubtasksExpanded !== undefined ? message.data.allSubtasksExpanded : true;\n                if (message.data.settings) {\n                    const settingsManager = getService(SERVICES.SETTINGS_MANAGER);\n                    if (settingsManager) {\n                        settingsManager.saveSettings(message.data.settings);\n                    }\n                }\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            }\n        }\n    }\n    \n    handleFullSync(message) {\n        // Handle full data sync from another device\n        // Don't apply if it's from ourselves (prevent echo)\n        if (message.clientId && message.clientId === this.clientId) {\n            return;\n        }\n        \n        if (message.filename === this.currentFilename) {\n            const appState = this._getAppState();\n            const dataManager = this._getDataManager();\n            \n            // Check timestamp to prevent older changes from overwriting newer ones\n            const remoteTimestamp = message.timestamp || message.data?.timestamp || 0;\n            const localTimestamp = dataManager?._lastSyncTimestamp || 0;\n            \n            // Only apply if remote change is newer (or if we don't have a local timestamp)\n            if (remoteTimestamp < localTimestamp && localTimestamp > 0) {\n                console.log(`Ignoring older sync (remote: ${remoteTimestamp}, local: ${localTimestamp})`);\n                return;\n            }\n            \n            // Only update if data is different to avoid unnecessary renders\n            const currentData = JSON.stringify(appState.documents);\n            const newData = JSON.stringify(message.data.documents || []);\n            if (currentData !== newData) {\n                // Update local timestamp to match remote\n                if (dataManager) {\n                    dataManager._lastSyncTimestamp = remoteTimestamp;\n                }\n                \n                // Temporarily disable sync to prevent echo loop\n                const wasConnected = this.isConnected;\n                this.isConnected = false;\n                \n                appState.documents = message.data.documents || [];\n                appState.currentDocumentId = message.data.currentDocumentId || (appState.documents.length > 0 ? appState.documents[0].id : 'document-1');\n                appState.groupStates = message.data.groupStates || {};\n                appState.subtaskStates = message.data.subtaskStates || {};\n                appState.allSubtasksExpanded = message.data.allSubtasksExpanded !== undefined ? message.data.allSubtasksExpanded : true;\n                if (message.data.settings) {\n                    const settingsManager = getService(SERVICES.SETTINGS_MANAGER);\n                    if (settingsManager) {\n                        settingsManager.saveSettings(message.data.settings);\n                    }\n                }\n                \n                // Save to localStorage but don't trigger sync (we're already synced)\n                // Request data save with skipSync flag via EventBus\n                eventBus.emit(EVENTS.DATA.SAVE_REQUESTED, true);\n                \n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                \n                // Re-enable sync after a brief delay\n                setTimeout(() => {\n                    this.isConnected = wasConnected;\n                }, 100);\n            }\n        }\n    }\n    \n    handleRemoteChange(message) {\n        // Apply remote change\n        if (message.filename === this.currentFilename && this.app && this.app.undoRedoManager) {\n            this.app.undoRedoManager.applyRemoteChange(message.change);\n        }\n    }\n    \n    handleRemoteUndo(message) {\n        if (message.filename === this.currentFilename && this.app && this.app.undoRedoManager) {\n            this.app.undoRedoManager.handleRemoteUndo(message.changeId);\n        }\n    }\n    \n    handleRemoteRedo(message) {\n        if (message.filename === this.currentFilename && this.app && this.app.undoRedoManager) {\n            this.app.undoRedoManager.handleRemoteRedo(message.changeId);\n        }\n    }\n    \n    joinFile(filename) {\n        if (!this.isConnected || !this.clientId) {\n            console.warn('WebSocket not connected, cannot join file');\n            return;\n        }\n        \n        this.currentFilename = filename;\n        this.send({\n            type: 'join_file',\n            filename: filename\n        });\n    }\n    \n    leaveFile(filename) {\n        if (!this.isConnected || !this.clientId) {\n            return;\n        }\n        \n        this.send({\n            type: 'leave_file',\n            filename: filename\n        });\n        \n        if (this.currentFilename === filename) {\n            this.currentFilename = null;\n        }\n    }\n    \n    sendChange(change) {\n        if (!this.isConnected || !this.clientId || !this.currentFilename) {\n            // Queue for later\n            this.pendingChanges.push(change);\n            return;\n        }\n        \n        this.send({\n            type: 'change',\n            filename: this.currentFilename,\n            change: change\n        });\n    }\n    \n    sendUndo(changeId) {\n        if (!this.isConnected || !this.currentFilename) {\n            return;\n        }\n        \n        this.send({\n            type: 'undo',\n            filename: this.currentFilename,\n            changeId: changeId\n        });\n    }\n    \n    sendRedo(changeId) {\n        if (!this.isConnected || !this.currentFilename) {\n            return;\n        }\n        \n        this.send({\n            type: 'redo',\n            filename: this.currentFilename,\n            changeId: changeId\n        });\n    }\n    \n    send(message) {\n        if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n            this.ws.send(JSON.stringify(message));\n        } else {\n            console.warn('WebSocket not ready, queuing message');\n            this.pendingChanges.push(message);\n        }\n    }\n    \n    flushPendingChanges() {\n        while (this.pendingChanges.length > 0) {\n            const change = this.pendingChanges.shift();\n            if (change.type === 'change') {\n                this.sendChange(change.change);\n            } else {\n                this.send(change);\n            }\n        }\n    }\n    \n    disconnect() {\n        if (this.currentFilename) {\n            this.leaveFile(this.currentFilename);\n        }\n        if (this.ws) {\n            this.ws.close();\n        }\n    }\n}\n\n","// UndoRedoManager.js - Handles undo/redo functionality with change tracking\nimport { serviceLocator } from '../core/ServiceLocator.js';\nimport { SERVICES, getService, hasService } from '../core/AppServices.js';\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\nexport class UndoRedoManager {\n    constructor() {\n        this.undoStack = [];\n        this.redoStack = [];\n        this.maxStackSize = 100;\n        this.isApplyingChange = false;\n        this.remoteChanges = new Map(); // Track remote changes to avoid re-applying\n        \n        // Buffer system properties\n        this.currentBufferFilename = null; // Tracks current file's buffer\n        this.snapshotInterval = 10; // Create snapshot every N changes\n        this.maxSnapshots = 5; // Keep last N snapshots\n        this.bufferSaveTimer = null; // Debounce timer for buffer saves\n        this.changeCounter = 0; // Track number of changes for snapshot intervals\n        this.snapshots = []; // Array of {changeIndex, data} snapshots\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Get documents array from AppState\n     */\n    _getDocuments() {\n        const appState = this._getAppState();\n        return appState.documents || [];\n    }\n    \n    /**\n     * Get DataManager service \n     */\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    /**\n     * Record a change for undo/redo\n     */\n    recordChange(change) {\n        if (this.isApplyingChange) {\n            return; // Don't record changes that are being applied from undo/redo\n        }\n        \n        // Clear redo stack when new change is made\n        this.redoStack = [];\n        \n        // Increment change counter\n        this.changeCounter++;\n        \n        // Check if snapshot needed (every N changes)\n        if (this.changeCounter % this.snapshotInterval === 0) {\n            this.createSnapshot();\n        }\n        \n        // Add to undo stack\n        this.undoStack.push(change);\n        \n        // Limit stack size\n        if (this.undoStack.length > this.maxStackSize) {\n            this.undoStack.shift();\n        }\n        \n        console.log('Change recorded:', change.type, 'at path:', change.path, 'undoStack length:', this.undoStack.length, 'changeCounter:', this.changeCounter);\n        \n        // Auto-save buffer after recording (debounced)\n        this._debouncedSaveBuffer();\n        \n        // Send to sync manager for real-time sync\n        const syncManager = getService(SERVICES.SYNC_MANAGER);\n        if (syncManager) {\n            syncManager.sendChange(change);\n        }\n    }\n    \n    /**\n     * Create a change object for a data modification\n     */\n    createChange(type, path, value, oldValue = null) {\n        return {\n            type: type, // 'set', 'delete', 'add', 'insert'\n            path: path, // Array of keys/indices to navigate to the target\n            value: value,\n            oldValue: oldValue,\n            timestamp: new Date().toISOString()\n        };\n    }\n    \n    /**\n     * Get element counts for logging\n     */\n    _getElementCounts() {\n        const documents = this._getDocuments();\n        if (!documents || documents.length === 0) {\n            return { documents: 0, groups: 0, items: 0 };\n        }\n        \n        let documentCount = documents.length;\n        let groupCount = 0;\n        let itemCount = 0;\n        \n        documents.forEach(document => {\n            const groups = document.groups || [];\n            groupCount += groups.length;\n            groups.forEach(group => {\n                const items = group.items || [];\n                itemCount += items.length;\n            });\n        });\n        \n        return { documents: documentCount, groups: groupCount, items: itemCount };\n    }\n    \n    /**\n     * Apply a change to the data\n     */\n    applyChange(change) {\n        this.isApplyingChange = true;\n        \n        try {\n            const { type, path, value } = change;\n            \n            if (!path || path.length === 0) {\n                console.error('Invalid change path:', change);\n                this.isApplyingChange = false;\n                return false;\n            }\n            \n            // Log element counts before operation\n            const beforeCounts = this._getElementCounts();\n            console.log(`[UNDO/REDO] Applying change: ${type} at path:`, path);\n            console.log(`[UNDO/REDO] Before counts - Documents: ${beforeCounts.documents}, Groups: ${beforeCounts.groups}, Items: ${beforeCounts.items}`);\n            console.log(`[UNDO/REDO] Change value:`, value);\n            \n            // Log array state if applicable\n            if (path.length > 0) {\n                try {\n                    const documents = this._getDocuments();\n                    let target = documents;\n                    let pathStartIndex = path[0] === 'documents' ? 1 : 0;\n                    const navigationEnd = (type === 'insert' || type === 'add') ? path.length : path.length - 1;\n                    \n                    for (let i = pathStartIndex; i < navigationEnd && i < path.length; i++) {\n                        const key = path[i];\n                        if (Array.isArray(target)) {\n                            const index = parseInt(key);\n                            if (!isNaN(index) && index >= 0 && index < target.length) {\n                                target = target[index];\n                                if (Array.isArray(target)) {\n                                    console.log(`[UNDO/REDO] Array at path[${i}]: length=${target.length}, indices=[0..${target.length - 1}]`);\n                                }\n                            }\n                        } else if (typeof target === 'object' && target !== null) {\n                            target = target[key];\n                            if (Array.isArray(target)) {\n                                console.log(`[UNDO/REDO] Array at path[${i}]: length=${target.length}, indices=[0..${target.length - 1}]`);\n                            }\n                        }\n                    }\n                } catch (e) {\n                    // Ignore errors in logging\n                }\n            }\n            \n            // Get documents from app state service\n            let pages;\n            try {\n                const appState = this.serviceLocator.get(SERVICES.APP_STATE);\n                pages = appState.documents;\n            } catch (e) {\n                const documents = this._getDocuments();\n                if (documents && documents.length > 0) {\n                } else {\n                    console.error('[UNDO] Cannot access documents');\n                    return false;\n                }\n            }\n            // Start from documents (skip 'documents' in path since we're already there)\n            let target = pages;\n            let pathStartIndex = 0;\n            \n            // If path starts with 'documents', skip it since we're already at documents\n            if (path[0] === 'documents') {\n                pathStartIndex = 1;\n            }\n            \n            // For 'insert' and 'add' operations, the path points to the array itself\n            // So we need to navigate to the parent of the array, not the array\n            // The last element in the path is the array name (e.g., 'items'), so we stop before it\n            const isArrayOperation = type === 'insert' || type === 'add';\n            const navigationEnd = isArrayOperation ? path.length - 1 : path.length - 1;\n            \n            // Navigate to the target\n            for (let i = pathStartIndex; i < navigationEnd; i++) {\n                const key = path[i];\n                if (target === null || target === undefined) {\n                    console.error('Cannot navigate path - target is null/undefined at key:', key, 'path so far:', path.slice(0, i + 1));\n                    this.isApplyingChange = false;\n                    return false;\n                }\n                if (Array.isArray(target)) {\n                    const index = parseInt(key);\n                    if (isNaN(index) || index < 0 || index >= target.length) {\n                        console.error('Invalid array index:', index, 'for array length:', target.length, 'at path:', path.slice(0, i + 1));\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                    target = target[index];\n                } else if (typeof target === 'object' && target !== null) {\n                    if (target[key] === undefined) {\n                        // Create missing object/array based on next key\n                        const nextKey = path[i + 1];\n                        if (typeof nextKey === 'number' || (!isNaN(parseInt(nextKey)) && i + 2 < path.length)) {\n                            target[key] = [];\n                        } else {\n                            target[key] = {};\n                        }\n                    }\n                    target = target[key];\n                } else {\n                    console.error('Cannot navigate path - target is not object/array at key:', key, 'target type:', typeof target);\n                    this.isApplyingChange = false;\n                    return false;\n                }\n            }\n            \n            // For array operations (insert/add), target should be the array itself\n            // For other operations, we need to get the array/object and the last key\n            let lastKey;\n            let arrayTarget = null;\n            \n            if (isArrayOperation) {\n                // For insert/add, the last element in path is the array name (e.g., 'items')\n                // We need to get the array from the parent object\n                lastKey = path[path.length - 1];\n                if (typeof target === 'object' && target !== null) {\n                    // Ensure the array exists\n                    if (!target[lastKey]) {\n                        target[lastKey] = [];\n                    }\n                    arrayTarget = target[lastKey];\n                    if (!Array.isArray(arrayTarget)) {\n                        console.error('Target for insert/add is not an array:', typeof arrayTarget, arrayTarget);\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                } else {\n                    console.error('Cannot find array at key:', lastKey, 'in target:', target);\n                    this.isApplyingChange = false;\n                    return false;\n                }\n            } else {\n                lastKey = path[path.length - 1];\n                if (target === null || target === undefined) {\n                    console.error('Cannot apply change - target is null/undefined at final key:', lastKey);\n                    this.isApplyingChange = false;\n                    return false;\n                }\n            }\n            \n            // Store old value if not already stored\n            if (change.oldValue === null || change.oldValue === undefined) {\n                if (isArrayOperation) {\n                    // For insert, we don't need to store old value (we're adding)\n                    // For add, we don't need to store old value either\n                } else if (Array.isArray(target)) {\n                    const index = parseInt(lastKey);\n                    if (!isNaN(index) && index >= 0 && index < target.length) {\n                        change.oldValue = target[index];\n                    }\n                } else if (typeof target === 'object' && target !== null) {\n                    change.oldValue = target[lastKey];\n                }\n            }\n            \n            // Apply the change\n            switch (type) {\n                case 'set':\n                    if (Array.isArray(target)) {\n                        const index = parseInt(lastKey);\n                        if (!isNaN(index)) {\n                            if (index >= 0 && index < target.length) {\n                                target[index] = value;\n                            } else {\n                                console.warn('Set index out of bounds:', index, 'array length:', target.length, '- element may have been deleted');\n                                // Don't error, just log - the element might have been deleted by another operation\n                            }\n                        } else {\n                            console.error('Invalid array index for set:', lastKey);\n                        }\n                    } else if (typeof target === 'object' && target !== null) {\n                        target[lastKey] = value;\n                    }\n                    break;\n                case 'delete':\n                    if (Array.isArray(target)) {\n                        const index = parseInt(lastKey);\n                        if (!isNaN(index)) {\n                            if (index >= 0 && index < target.length) {\n                                target.splice(index, 1);\n                            } else {\n                                console.warn('Delete index out of bounds:', index, 'array length:', target.length, '- element may have already been deleted');\n                                // Don't error, just log - the element might have been deleted by another operation\n                            }\n                        } else {\n                            console.error('Invalid array index for delete:', lastKey);\n                        }\n                    } else if (typeof target === 'object' && target !== null) {\n                        delete target[lastKey];\n                    }\n                    break;\n                case 'add':\n                    if (arrayTarget && Array.isArray(arrayTarget)) {\n                        arrayTarget.push(value);\n                        console.log('Added element, array length now:', arrayTarget.length);\n                    } else if (typeof target === 'object' && target !== null) {\n                        target[lastKey] = value;\n                    }\n                    break;\n                case 'insert':\n                    if (arrayTarget && Array.isArray(arrayTarget)) {\n                        // Ensure we have a value to insert\n                        if (!value) {\n                            console.error('Cannot insert - no value provided');\n                            this.isApplyingChange = false;\n                            return false;\n                        }\n                        // For insert, use insertIndex from the change\n                        let insertIndex;\n                        if (change.insertIndex !== undefined && change.insertIndex !== null) {\n                            insertIndex = change.insertIndex;\n                            console.log(`[UNDO/REDO] Using stored insertIndex: ${insertIndex}, array length: ${arrayTarget.length}`);\n                        } else {\n                            // Fallback: try to parse lastKey or use array length\n                            const parsed = parseInt(lastKey);\n                            insertIndex = isNaN(parsed) ? arrayTarget.length : parsed;\n                            console.log(`[UNDO/REDO] No insertIndex in change, using fallback: ${insertIndex} (parsed=${parsed}, lastKey=${lastKey}), array length: ${arrayTarget.length}`);\n                        }\n                        // Ensure index is valid (can be 0 to array.length inclusive)\n                        const validIndex = Math.max(0, Math.min(insertIndex, arrayTarget.length));\n                        console.log(`[UNDO/REDO] Inserting at validIndex: ${validIndex}, array length before: ${arrayTarget.length}, path:`, path);\n                        // Create a deep copy of the value to insert\n                        const valueToInsert = JSON.parse(JSON.stringify(value));\n                        // Check if element already exists at this position (shouldn't happen, but be safe)\n                        if (validIndex < arrayTarget.length && arrayTarget[validIndex] && \n                            valueToInsert && valueToInsert.text && arrayTarget[validIndex].text === valueToInsert.text &&\n                            valueToInsert.type && arrayTarget[validIndex].type === valueToInsert.type) {\n                            console.warn(`[UNDO/REDO] Element already exists at index ${validIndex}, skipping insert`);\n                        } else {\n                            arrayTarget.splice(validIndex, 0, valueToInsert);\n                            console.log(`[UNDO/REDO] Inserted element at index: ${validIndex}, array length now: ${arrayTarget.length}, element text: ${valueToInsert?.text || 'N/A'}`);\n                        }\n                    } else {\n                        console.error('Cannot insert - target is not an array:', typeof arrayTarget, arrayTarget);\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                    break;\n                case 'move':\n                    // Move operation: delete from source, insert at target\n                    if (!change.sourcePath || !change.targetPath) {\n                        console.error('Move operation missing source or target path');\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                    \n                    // First, find and delete from source\n                    let pages = this._getDocuments();\n                    let sourceTarget = pages;\n                    const sourcePath = change.sourcePath;\n                    let sourcePathStart = sourcePath[0] === 'documents' ? 1 : 0;\n                    \n                    // Navigate to source element\n                    for (let i = sourcePathStart; i < sourcePath.length - 1; i++) {\n                        const key = sourcePath[i];\n                        if (Array.isArray(sourceTarget)) {\n                            sourceTarget = sourceTarget[parseInt(key)];\n                        } else if (typeof sourceTarget === 'object' && sourceTarget !== null) {\n                            sourceTarget = sourceTarget[key];\n                        }\n                        if (sourceTarget === null || sourceTarget === undefined) {\n                            console.error('Cannot navigate to source for move');\n                            this.isApplyingChange = false;\n                            return false;\n                        }\n                    }\n                    \n                    const sourceLastKey = sourcePath[sourcePath.length - 1];\n                    let sourceArray = null;\n                    let sourceIndex = -1;\n                    \n                    if (Array.isArray(sourceTarget)) {\n                        sourceIndex = parseInt(sourceLastKey);\n                        if (isNaN(sourceIndex) || sourceIndex < 0 || sourceIndex >= sourceTarget.length) {\n                            console.error('Invalid source index for move:', sourceIndex);\n                            this.isApplyingChange = false;\n                            return false;\n                        }\n                        sourceArray = sourceTarget;\n                    } else if (typeof sourceTarget === 'object' && sourceTarget !== null) {\n                        sourceArray = sourceTarget[sourceLastKey];\n                        if (!Array.isArray(sourceArray)) {\n                            console.error('Source is not an array for move');\n                            this.isApplyingChange = false;\n                            return false;\n                        }\n                        // Find element in source array\n                        if (value) {\n                            sourceIndex = sourceArray.findIndex(el => \n                                el && value && \n                                el.text === value.text && \n                                el.type === value.type\n                            );\n                            if (sourceIndex === -1 && change.sourceIndex !== undefined) {\n                                sourceIndex = change.sourceIndex;\n                            }\n                        } else if (change.sourceIndex !== undefined) {\n                            sourceIndex = change.sourceIndex;\n                        }\n                        if (sourceIndex === -1 || sourceIndex < 0 || sourceIndex >= sourceArray.length) {\n                            console.error('Cannot find element in source array for move');\n                            this.isApplyingChange = false;\n                            return false;\n                        }\n                    }\n                    \n                    // Remove element from source\n                    const movedElement = sourceArray.splice(sourceIndex, 1)[0];\n                    if (!movedElement) {\n                        console.error('No element found at source index for move');\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                    \n                    // Now insert at target\n                    // Reuse pages variable already declared above\n                    // Get fresh pages reference for target navigation\n                    pages = this._getDocuments();\n                    if (!pages || pages.length === 0) {\n                        console.error('[UNDO] Cannot access documents');\n                        this.isApplyingChange = false;\n                        return false;\n                    }\n                    let targetArray = pages;\n                    const targetArrayPath = change.targetPath;\n                    let targetPathStart = targetArrayPath[0] === 'documents' ? 1 : 0;\n                    \n                    // Navigate to target array\n                    for (let i = targetPathStart; i < targetArrayPath.length; i++) {\n                        const key = targetArrayPath[i];\n                        if (Array.isArray(targetArray)) {\n                            targetArray = targetArray[parseInt(key)];\n                        } else if (typeof targetArray === 'object' && targetArray !== null) {\n                            if (!targetArray[key]) {\n                                targetArray[key] = [];\n                            }\n                            targetArray = targetArray[key];\n                        }\n                        if (targetArray === null || targetArray === undefined) {\n                            console.error('Cannot navigate to target for move');\n                            this.isApplyingChange = false;\n                            // Put element back\n                            sourceArray.splice(sourceIndex, 0, movedElement);\n                            return false;\n                        }\n                    }\n                    \n                    if (!Array.isArray(targetArray)) {\n                        console.error('Target is not an array for move');\n                        this.isApplyingChange = false;\n                        // Put element back\n                        sourceArray.splice(sourceIndex, 0, movedElement);\n                        return false;\n                    }\n                    \n                    // Insert at target index\n                    const targetIndex = change.targetIndex !== undefined ? change.targetIndex : targetArray.length;\n                    const validTargetIndex = Math.max(0, Math.min(targetIndex, targetArray.length));\n                    targetArray.splice(validTargetIndex, 0, movedElement);\n                    console.log('Moved item from index', sourceIndex, 'to index', validTargetIndex);\n                    break;\n            }\n            \n            // Log element counts after operation\n            const afterCounts = this._getElementCounts();\n            console.log(`[UNDO/REDO] After counts - Documents: ${afterCounts.documents}, Groups: ${afterCounts.groups}, Items: ${afterCounts.items}`);\n            \n            // Validate that items didn't disappear unexpectedly\n            // Note: Item count only tracks group items, not child items\n            if (type === 'delete' && afterCounts.items > beforeCounts.items) {\n                console.warn(`[UNDO/REDO] WARNING: Delete operation increased item count. Before: ${beforeCounts.items}, After: ${afterCounts.items}`);\n            } else if (type === 'insert' && afterCounts.items < beforeCounts.items) {\n                console.warn(`[UNDO/REDO] WARNING: Insert operation decreased item count. Before: ${beforeCounts.items}, After: ${afterCounts.items}`);\n            }\n            \n            // Validate state after change\n            const validation = this.validateState();\n            if (!validation.valid) {\n                console.error('[UNDO/REDO] State validation failed after applying change:', validation.errors);\n                // Log warnings too\n                if (validation.warnings.length > 0) {\n                    console.warn('[UNDO/REDO] State validation warnings:', validation.warnings);\n                }\n            } else if (validation.warnings.length > 0) {\n                console.warn('[UNDO/REDO] State validation warnings:', validation.warnings);\n            }\n            \n            console.log('[UNDO/REDO] Change applied successfully');\n            \n            // Don't save or render here - let undo/redo handle it\n            // This prevents double-saving and ensures render happens after all changes\n            \n            this.isApplyingChange = false;\n            return true;\n        } catch (error) {\n            console.error('Error applying change:', error, 'change:', change);\n            this.isApplyingChange = false;\n            return false;\n        }\n    }\n    \n    /**\n     * Apply a remote change (from another device)\n     */\n    applyRemoteChange(change) {\n        // Mark as remote to avoid re-sending\n        this.remoteChanges.set(change.changeId, change);\n        \n        // Apply the change\n        this.applyChange(change);\n        \n        // Add to undo stack (but mark as remote)\n        change.isRemote = true;\n        this.undoStack.push(change);\n        if (this.undoStack.length > this.maxStackSize) {\n            this.undoStack.shift();\n        }\n    }\n    \n    /**\n     * Undo the last change\n     */\n    undo() {\n        if (this.undoStack.length === 0) {\n            console.log('[UNDO] Undo stack is empty');\n            return false;\n        }\n        \n        const beforeCounts = this._getElementCounts();\n        console.log(`[UNDO] Starting undo operation. Stack size: ${this.undoStack.length}`);\n        console.log(`[UNDO] Before counts - Documents: ${beforeCounts.documents}, Groups: ${beforeCounts.groups}, Items: ${beforeCounts.items}`);\n        \n        const change = this.undoStack.pop();\n        console.log(`[UNDO] Popped change: ${change.type} at path:`, change.path);\n        \n        // Check if this change is part of a move operation\n        // If so, we need to undo both the delete and insert together as a single atomic operation\n        if (change.isPartOfMove && change.moveChangeId) {\n            console.log(`[UNDO] Change is part of move operation: ${change.moveChangeId}`);\n            \n            // Find the paired change (if insert, find delete; if delete, find insert)\n            const pairedChangeType = change.type === 'insert' ? 'delete' : 'insert';\n            let pairedChangeIndex = -1;\n            \n            // Look for the paired change in the undo stack (should be right before/after since they're recorded sequentially)\n            // Since we just popped 'change', the paired one should be at the top of the stack\n            for (let i = this.undoStack.length - 1; i >= 0; i--) {\n                const candidate = this.undoStack[i];\n                if (candidate.isPartOfMove && \n                    candidate.moveChangeId === change.moveChangeId && \n                    candidate.type === pairedChangeType) {\n                    pairedChangeIndex = i;\n                    break;\n                }\n            }\n            \n            if (pairedChangeIndex !== -1) {\n                // Found the paired change - pop it\n                const pairedChange = this.undoStack.splice(pairedChangeIndex, 1)[0];\n                console.log(`[UNDO] Found paired ${pairedChangeType} change, undoing move as atomic operation`);\n                \n                // For a move operation, we need to:\n                // 1. Undo the insert (delete the element from its new position)\n                // 2. Undo the delete (insert the element back at its original position)\n                // Order: undo insert first, then undo delete\n                const insertChange = change.type === 'insert' ? change : pairedChange;\n                const deleteChange = change.type === 'delete' ? change : pairedChange;\n                \n                // Step 1: Undo insert (delete from new position)\n                // Professional approach: Use element ID first (like VS Code, Photoshop, etc.)\n                const elementToFind = insertChange.value;\n                \n                if (!elementToFind) {\n                    console.error('[UNDO] Cannot undo move - insert change has no element value');\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                let elementDeleted = false;\n                \n                // Professional approach: Use ID-based lookup only\n                if (!elementToFind.id) {\n                    console.error('[UNDO] Cannot undo move - item has no ID. All items should have IDs.');\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                const found = this.findElementById(elementToFind.id);\n                if (!found) {\n                    console.error(`[UNDO] Element with ID ${elementToFind.id} not found - may have been deleted`);\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                // Found by ID - construct path directly and delete\n                const pages = this._getDocuments();\n                const pageIndex = pages.findIndex(p => p.id === found.pageId);\n                if (pageIndex === -1) {\n                    console.error(`[UNDO] Page ${found.pageId} not found`);\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                const page = pages[pageIndex];\n                const binIndex = page.groups.findIndex(b => b.id === found.binId);\n                if (binIndex === -1) {\n                    console.error(`[UNDO] Bin ${found.binId} not found`);\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                let deletePath;\n                if (found.isChild) {\n                    deletePath = ['documents', pageIndex, 'groups', binIndex, 'items', found.elementIndex, 'children', found.childIndex];\n                } else {\n                    deletePath = ['documents', pageIndex, 'groups', binIndex, 'items', found.elementIndex];\n                }\n                \n                console.log(`[UNDO] Found element by ID, deleting from path:`, deletePath);\n                const deleteResult = this.applyChange({\n                    type: 'delete',\n                    path: deletePath,\n                    value: null,\n                    oldValue: elementToFind\n                });\n                \n                if (!deleteResult) {\n                    console.error('[UNDO] Failed to delete element found by ID');\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                // Step 2: Undo delete (insert back at original position)\n                let deleteInversePath = [...deleteChange.path];\n                let deleteInsertIndex = null;\n                if (deleteInversePath.length > 0 && typeof deleteInversePath[deleteInversePath.length - 1] === 'number') {\n                    deleteInsertIndex = deleteInversePath.pop();\n                } else {\n                    deleteInsertIndex = deleteChange.deleteIndex !== undefined ? deleteChange.deleteIndex : 0;\n                }\n                \n                const insertBackResult = this.applyChange({\n                    type: 'insert',\n                    path: deleteInversePath,\n                    value: deleteChange.oldValue,\n                    oldValue: null,\n                    insertIndex: deleteInsertIndex\n                });\n                \n                if (!insertBackResult) {\n                    console.error('[UNDO] Failed to insert element back at original position in move undo');\n                    // Try to recover by re-inserting at new position\n                    this.applyChange({\n                        type: 'insert',\n                        path: insertInversePath.slice(0, -1),\n                        value: insertChange.value,\n                        oldValue: null,\n                        insertIndex: insertElementIndex\n                    });\n                    this.undoStack.push(pairedChange);\n                    this.undoStack.push(change);\n                    return false;\n                }\n                \n                // Move both changes to redo stack (in reverse order so they can be redone correctly)\n                this.redoStack.push(deleteChange);\n                this.redoStack.push(insertChange);\n                if (this.redoStack.length > this.maxStackSize * 2) {\n                    this.redoStack.shift();\n                    this.redoStack.shift();\n                }\n                \n                // Save data and re-render\n                const dataManager = this._getDataManager();\n                if (dataManager) {\n                    dataManager.saveData();\n                }\n                // Render is handled via EventBus now\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                \n                const afterCounts = this._getElementCounts();\n                console.log(`[UNDO] After counts - Documents: ${afterCounts.documents}, Groups: ${afterCounts.groups}, Items: ${afterCounts.items}`);\n                console.log(`[UNDO] Move operation undone successfully as atomic operation`);\n                return true;\n            } else {\n                console.warn(`[UNDO] Move operation detected but paired change not found, undoing single change`);\n                // Fall through to normal undo\n            }\n        }\n        \n        // Create inverse change based on the original change type\n        let inverseType;\n        let inversePath = [...change.path]; // Copy the path\n        let inverseInsertIndex = null;\n        \n        if (change.type === 'delete') {\n            // If we deleted, we need to insert it back\n            inverseType = 'insert';\n            // For delete, the path points to the element (e.g., ['documents', 0, 'groups', 0, 'items', 3])\n            // For insert, we need path to the array (e.g., ['documents', 0, 'groups', 0, 'items'])\n            // and the index should be in insertIndex\n            if (inversePath.length > 0 && typeof inversePath[inversePath.length - 1] === 'number') {\n                // Last element is the index, extract it and remove from path\n                inverseInsertIndex = inversePath.pop();\n                console.log(`[UNDO] Extracted insertIndex ${inverseInsertIndex} from delete path`);\n            } else {\n                // Try to find the index from the change's stored insertIndex or deleteIndex\n                // When a delete is recorded, we should store the original index\n                inverseInsertIndex = change.insertIndex !== undefined ? change.insertIndex : \n                                    (change.deleteIndex !== undefined ? change.deleteIndex : 0);\n                console.log(`[UNDO] Using stored index: insertIndex=${change.insertIndex}, deleteIndex=${change.deleteIndex}, final=${inverseInsertIndex}`);\n            }\n            // Note: We'll clamp this index in applyChange to ensure it's valid for the current array state\n        } else if (change.type === 'insert') {\n            // If we inserted, we need to delete it\n            inverseType = 'delete';\n            // For insert, the path points to the array (e.g., ['documents', 0, 'groups', 0, 'items'])\n            // For delete, we need path to the element (e.g., ['documents', 0, 'groups', 0, 'items', 3])\n            // Always find the element by comparing properties, not by index, since the array may have changed\n            const arrayPath = [...inversePath];\n            const pages = this._getDocuments();\n            let arrayTarget = pages;\n            if (arrayPath[0] === 'documents') {\n                for (let i = 1; i < arrayPath.length; i++) {\n                    const key = arrayPath[i];\n                    if (Array.isArray(arrayTarget)) {\n                        arrayTarget = arrayTarget[parseInt(key)];\n                    } else if (typeof arrayTarget === 'object' && arrayTarget !== null) {\n                        arrayTarget = arrayTarget[key];\n                    }\n                    if (arrayTarget === null || arrayTarget === undefined) {\n                        console.error('Cannot navigate to array for undo insert');\n                        return false;\n                    }\n                }\n                if (Array.isArray(arrayTarget)) {\n                    // First, try to use the insertIndex if it's still valid\n                    let elementIndex = -1;\n                    const elementToFind = change.value;\n                    \n                    if (!elementToFind) {\n                        console.error('Cannot undo insert - no element value stored in change');\n                        return false;\n                    }\n                    \n                    if (change.insertIndex !== undefined && change.insertIndex !== null) {\n                        const storedIndex = change.insertIndex;\n                        if (storedIndex >= 0 && storedIndex < arrayTarget.length) {\n                            // Check if the element at this index matches what we're looking for\n                            const elementAtIndex = arrayTarget[storedIndex];\n                            // Simple check: if text and type match, it's likely the same element\n                            if (elementAtIndex && elementToFind && \n                                elementAtIndex.text === elementToFind.text && \n                                elementAtIndex.type === elementToFind.type) {\n                                elementIndex = storedIndex;\n                                console.log('Found element at stored insertIndex:', storedIndex);\n                            } else {\n                                console.log('Element at stored index does not match:', {\n                                    storedIndex,\n                                    atIndex: elementAtIndex ? { text: elementAtIndex.text, type: elementAtIndex.type } : null,\n                                    lookingFor: { text: elementToFind.text, type: elementToFind.type }\n                                });\n                            }\n                        } else {\n                            console.log('Stored insertIndex out of bounds:', storedIndex, 'array length:', arrayTarget.length);\n                        }\n                    }\n                    \n                    // If index-based lookup failed, try property-based matching\n                    if (elementIndex === -1) {\n                        const elementToFind = change.value;\n                        console.log('[UNDO] Searching for element:', {\n                            text: elementToFind?.text,\n                            type: elementToFind?.type,\n                            completed: elementToFind?.completed,\n                            repeats: elementToFind?.repeats\n                        });\n                        \n                        // Try to find by text and type (most reliable identifiers)\n                        // Use trimmed text comparison to handle whitespace differences\n                        const searchText = elementToFind?.text ? elementToFind.text.trim() : '';\n                        const searchType = elementToFind?.type || '';\n                        \n                        elementIndex = arrayTarget.findIndex(el => {\n                            if (!el || !elementToFind) return false;\n                            // Primary match: text and type must match (with trimmed text)\n                            const elText = el.text ? el.text.trim() : '';\n                            if (elText === searchText && el.type === searchType) {\n                                return true;\n                            }\n                            return false;\n                        });\n                        \n                        // If we found multiple matches, try to narrow it down\n                        if (elementIndex !== -1) {\n                            const matches = arrayTarget\n                                .map((el, idx) => ({ el, idx }))\n                                .filter(({ el }) => {\n                                    if (!el || !elementToFind) return false;\n                                    const elText = el.text ? el.text.trim() : '';\n                                    return elText === searchText && el.type === searchType;\n                                });\n                            \n                            console.log(`[UNDO] Found ${matches.length} matching element(s)`);\n                            \n                            if (matches.length > 1) {\n                                // Multiple matches - try to find the best one\n                                // Prefer matches with more properties matching\n                                const bestMatch = matches.reduce((best, current) => {\n                                    let bestScore = 0;\n                                    let currentScore = 0;\n                                    \n                                    if (best.el.completed === elementToFind.completed) bestScore++;\n                                    if (best.el.repeats === elementToFind.repeats) bestScore++;\n                                    if (best.el.timeAllocated === elementToFind.timeAllocated) bestScore++;\n                                    if (best.el.id === elementToFind.id) bestScore += 10; // ID match is very strong\n                                    \n                                    if (current.el.completed === elementToFind.completed) currentScore++;\n                                    if (current.el.repeats === elementToFind.repeats) currentScore++;\n                                    if (current.el.timeAllocated === elementToFind.timeAllocated) currentScore++;\n                                    if (current.el.id === elementToFind.id) currentScore += 10; // ID match is very strong\n                                    \n                                    return currentScore > bestScore ? current : best;\n                                });\n                                elementIndex = bestMatch.idx;\n                                console.log(`[UNDO] Selected best match at index ${elementIndex} with score`);\n                            }\n                        } else {\n                            // No match found - log detailed comparison\n                            console.warn('[UNDO] No exact text/type match found. Available items:');\n                            arrayTarget.forEach((el, idx) => {\n                                const elText = el?.text ? el.text.trim() : '';\n                                const matchesText = elText === searchText;\n                                const matchesType = el?.type === searchType;\n                                if (matchesText || matchesType) {\n                                    console.warn(`  Index ${idx}: text=\"${elText}\" (match: ${matchesText}), type=\"${el?.type}\" (match: ${matchesType})`);\n                                }\n                            });\n                        }\n                    }\n                    \n                    if (elementIndex !== -1) {\n                        inversePath.push(elementIndex);\n                        console.log(`[UNDO] Found element to delete at index ${elementIndex}`);\n                    } else {\n                        // CRITICAL: Do not delete items if we can't find the exact match\n                        // Try to use snapshot to restore if available\n                        console.error('[UNDO] Cannot find item to delete in array.');\n                        console.error('[UNDO] Item being searched:', change.value);\n                        console.error('[UNDO] Array length:', arrayTarget.length);\n                        console.error('[UNDO] Available items:', arrayTarget.map((el, idx) => ({ \n                            index: idx, \n                            text: el?.text, \n                            type: el?.type,\n                            completed: el?.completed \n                        })));\n                        \n                        // Try recovery from snapshot\n                        console.log('[UNDO] Attempting recovery from snapshot...');\n                        const recoveryResult = this.recoverFromSnapshot(this.changeCounter - 1);\n                        if (recoveryResult && recoveryResult.success) {\n                            console.log(`[UNDO] Recovery successful from change index ${recoveryResult.recoveredFrom}`);\n                            // After recovery, try to find the element again\n                            // Re-navigate to array after recovery\n                            // Get documents from app state service\n                            let pages;\n                            try {\n                                const appState = this.serviceLocator.get(SERVICES.APP_STATE);\n                                pages = appState.documents;\n                            } catch (e) {\n                                pages = this._getDocuments();\n                                if (!pages || pages.length === 0) {\n                                    console.error('[UNDO] Cannot access documents');\n                                    this.undoStack.push(change);\n                                    return false;\n                                }\n                            }\n                            let recoveredArrayTarget = pages;\n                            for (let i = 1; i < arrayPath.length; i++) {\n                                const key = arrayPath[i];\n                                if (Array.isArray(recoveredArrayTarget)) {\n                                    recoveredArrayTarget = recoveredArrayTarget[parseInt(key)];\n                                } else if (typeof recoveredArrayTarget === 'object' && recoveredArrayTarget !== null) {\n                                    recoveredArrayTarget = recoveredArrayTarget[key];\n                                }\n                            }\n                            \n                            if (Array.isArray(recoveredArrayTarget)) {\n                                // Try finding element again after recovery\n                                const elementToFind = change.value;\n                                elementIndex = recoveredArrayTarget.findIndex(el => {\n                                    if (!el || !elementToFind) return false;\n                                    return el.text === elementToFind.text && el.type === elementToFind.type;\n                                });\n                                \n                                if (elementIndex !== -1) {\n                                    inversePath.push(elementIndex);\n                                    console.log(`[UNDO] Found element after recovery at index ${elementIndex}`);\n                                } else {\n                                    console.error('[UNDO] Still cannot find element after recovery. ABORTING UNDO.');\n                                    this.undoStack.push(change);\n                                    return false;\n                                }\n                            } else {\n                                console.error('[UNDO] Array not found after recovery. ABORTING UNDO.');\n                                this.undoStack.push(change);\n                                return false;\n                            }\n                        } else {\n                            console.error('[UNDO] Recovery failed or no snapshot available. ABORTING UNDO to prevent accidental element deletion');\n                            // Put the change back on the stack since we couldn't undo it\n                            this.undoStack.push(change);\n                            return false;\n                        }\n                    }\n                } else {\n                    console.error('Target is not an array for undo insert:', typeof arrayTarget);\n                    return false;\n                }\n            } else {\n                console.error('Invalid path for undo insert:', arrayPath);\n                return false;\n            }\n        } else if (change.type === 'move') {\n            // For move operations, we need to move the element back\n            // This is the inverse of a move: move from target back to source\n            inverseType = 'move';\n            // Swap source and target\n            inversePath = change.sourcePath ? [...change.sourcePath] : [...change.path];\n            // For the inverse move, we need to swap source and target\n            // The inverse move goes from current position (target) back to original position (source)\n            // We'll handle this in applyChange\n        } else if (change.type === 'set') {\n            inverseType = 'set'; // If we set a value, we set it back to old value\n        } else if (change.type === 'add') {\n            inverseType = 'delete'; // If we added, we need to delete it\n            // For add, path points to array, for delete we need the element index\n            // Find the element in the array\n            const arrayPath = [...inversePath];\n            const pages = this._getDocuments();\n            let arrayTarget = pages;\n            if (arrayPath[0] === 'documents') {\n                for (let i = 1; i < arrayPath.length; i++) {\n                    const key = arrayPath[i];\n                    if (Array.isArray(arrayTarget)) {\n                        arrayTarget = arrayTarget[parseInt(key)];\n                    } else if (typeof arrayTarget === 'object' && arrayTarget !== null) {\n                        arrayTarget = arrayTarget[key];\n                    }\n                }\n                if (Array.isArray(arrayTarget)) {\n                    const elementIndex = arrayTarget.findIndex(el => el === change.value || \n                        (el && change.value && el.text === change.value.text && el.type === change.value.type));\n                    if (elementIndex !== -1) {\n                        inversePath.push(elementIndex);\n                    }\n                }\n            }\n        } else {\n            inverseType = change.type; // Fallback\n        }\n        \n        // For delete->insert: value should be the element that was deleted (stored in oldValue)\n        // For insert->delete: value is not needed (we find the element by comparing)\n        // For set->set: value should be the old value (stored in oldValue)\n        let inverseValue;\n        if (inverseType === 'insert') {\n            // When undoing a delete, we need to insert the element back\n            // The element is stored in change.oldValue\n            inverseValue = change.oldValue;\n        } else if (inverseType === 'delete') {\n            // When undoing an insert, we don't need the value (we find it by comparing)\n            // But we should store it for potential redo\n            inverseValue = null;\n        } else if (inverseType === 'set') {\n            // When undoing a set, we set it back to the old value\n            inverseValue = change.oldValue;\n        } else {\n            inverseValue = change.oldValue;\n        }\n        \n        const inverseChange = {\n            type: inverseType,\n            path: inversePath,\n            value: inverseValue,\n            oldValue: change.value,\n            timestamp: new Date().toISOString(),\n            changeId: change.changeId ? `${change.changeId}-undo` : `${Date.now()}-${Math.random()}`\n        };\n        \n        // Set insertIndex for insert operations\n        if (inverseType === 'insert' && inverseInsertIndex !== null) {\n            inverseChange.insertIndex = inverseInsertIndex;\n            console.log(`[UNDO] Set insertIndex on inverse change: ${inverseInsertIndex}`);\n        } else if (inverseType === 'insert') {\n            console.warn(`[UNDO] WARNING: inverseType is insert but inverseInsertIndex is null!`);\n        }\n        \n        // Validate element exists before deleting (for delete operations)\n        if (inverseType === 'delete' && inversePath.length > 0) {\n            try {\n                const pages = this._getDocuments();\n                let target = pages;\n                let pathStartIndex = inversePath[0] === 'documents' ? 1 : 0;\n                \n                // Navigate to the element\n                for (let i = pathStartIndex; i < inversePath.length - 1; i++) {\n                    const key = inversePath[i];\n                    if (Array.isArray(target)) {\n                        const index = parseInt(key);\n                        if (isNaN(index) || index < 0 || index >= target.length) {\n                            console.error(`[UNDO] Invalid array index during validation: ${index} at path step ${i}`);\n                            // Try recovery\n                            const recoveryResult = this.recoverFromSnapshot(this.changeCounter - 1);\n                            if (recoveryResult && recoveryResult.success) {\n                                console.log(`[UNDO] Recovered from snapshot, retrying...`);\n                                // Retry navigation after recovery\n                                target = pages;\n                                for (let j = pathStartIndex; j < inversePath.length - 1; j++) {\n                                    const retryKey = inversePath[j];\n                                    if (Array.isArray(target)) {\n                                        target = target[parseInt(retryKey)];\n                                    } else if (typeof target === 'object' && target !== null) {\n                                        target = target[retryKey];\n                                    }\n                                }\n                            } else {\n                                this.undoStack.push(change);\n                                return false;\n                            }\n                        } else {\n                            target = target[index];\n                        }\n                    } else if (typeof target === 'object' && target !== null) {\n                        target = target[key];\n                    }\n                }\n                \n                // Check if element exists at final index\n                const lastKey = inversePath[inversePath.length - 1];\n                if (Array.isArray(target)) {\n                    const index = parseInt(lastKey);\n                    if (isNaN(index) || index < 0 || index >= target.length) {\n                        console.warn(`[UNDO] Element index ${index} out of bounds (array length: ${target.length})`);\n                        // Try recovery\n                        const recoveryResult = this.recoverFromSnapshot(this.changeCounter - 1);\n                        if (!recoveryResult || !recoveryResult.success) {\n                            console.error('[UNDO] Cannot validate element existence and recovery failed');\n                            this.undoStack.push(change);\n                            return false;\n                        }\n                    }\n                }\n            } catch (error) {\n                console.error('[UNDO] Error validating element existence:', error);\n                // Try recovery\n                const recoveryResult = this.recoverFromSnapshot(this.changeCounter - 1);\n                if (!recoveryResult || !recoveryResult.success) {\n                    this.undoStack.push(change);\n                    return false;\n                }\n            }\n        }\n        \n        // Apply inverse\n        console.log(`[UNDO] Applying inverse change: ${inverseType} at path:`, inversePath);\n        const applied = this.applyChange(inverseChange);\n        if (!applied) {\n            console.error('[UNDO] Failed to apply undo change:', inverseChange);\n            // Try recovery if delete failed\n            if (inverseType === 'delete') {\n                console.log('[UNDO] Attempting recovery after failed delete...');\n                const recoveryResult = this.recoverFromSnapshot(this.changeCounter - 1);\n                if (recoveryResult && recoveryResult.success) {\n                    console.log('[UNDO] Recovery successful, retrying undo...');\n                    // Retry the undo after recovery\n                    return this.undo();\n                }\n            }\n            // Put the change back on the undo stack since we couldn't apply it\n            this.undoStack.push(change);\n            return false;\n        }\n        \n        const afterCounts = this._getElementCounts();\n        console.log(`[UNDO] After counts - Documents: ${afterCounts.documents}, Groups: ${afterCounts.groups}, Items: ${afterCounts.items}`);\n        \n        // Move to redo stack\n        this.redoStack.push(change);\n        if (this.redoStack.length > this.maxStackSize) {\n            this.redoStack.shift();\n        }\n        \n        // Send undo to server if not a remote change\n        const syncManager = getService(SERVICES.SYNC_MANAGER);\n        if (!change.isRemote && syncManager) {\n            syncManager.sendUndo(change.changeId);\n        }\n        \n        // Save data and re-render to reflect changes\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        console.log(`[UNDO] Undo applied successfully: ${change.type} at path:`, change.path);\n        return true;\n    }\n    \n    /**\n     * Redo the last undone change\n     */\n    redo() {\n        if (this.redoStack.length === 0) {\n            console.log('Redo stack is empty');\n            return false;\n        }\n        \n        const change = this.redoStack.pop();\n        console.log(`[REDO] Popped change: ${change.type} at path:`, change.path);\n        \n        // Check if this change is part of a move operation\n        // If so, we need to redo both the delete and insert together as a single atomic operation\n        if (change.isPartOfMove && change.moveChangeId) {\n            console.log(`[REDO] Change is part of move operation: ${change.moveChangeId}`);\n            \n            // Find the paired change in the redo stack\n            const pairedChangeType = change.type === 'insert' ? 'delete' : 'insert';\n            let pairedChangeIndex = -1;\n            \n            for (let i = this.redoStack.length - 1; i >= 0; i--) {\n                const candidate = this.redoStack[i];\n                if (candidate.isPartOfMove && \n                    candidate.moveChangeId === change.moveChangeId && \n                    candidate.type === pairedChangeType) {\n                    pairedChangeIndex = i;\n                    break;\n                }\n            }\n            \n            if (pairedChangeIndex !== -1) {\n                // Found the paired change - pop it and redo both together\n                const pairedChange = this.redoStack.splice(pairedChangeIndex, 1)[0];\n                console.log(`[REDO] Found paired ${pairedChangeType} change, redoing move as atomic operation`);\n                \n                // For a move operation, we need to:\n                // 1. Redo the delete (delete from original position)\n                // 2. Redo the insert (insert at new position)\n                // Order: redo delete first, then redo insert\n                const deleteChange = change.type === 'delete' ? change : pairedChange;\n                const insertChange = change.type === 'insert' ? change : pairedChange;\n                \n                // Step 1: Redo delete (delete from original position)\n                const deleteResult = this.applyChange(deleteChange);\n                if (!deleteResult) {\n                    console.error('[REDO] Failed to delete element from original position in move redo');\n                    this.redoStack.push(pairedChange);\n                    this.redoStack.push(change);\n                    return false;\n                }\n                \n                // Step 2: Redo insert (insert at new position)\n                const insertResult = this.applyChange(insertChange);\n                if (!insertResult) {\n                    console.error('[REDO] Failed to insert element at new position in move redo');\n                    // Try to recover by undoing the delete\n                    const deleteInversePath = [...deleteChange.path];\n                    const deleteInsertIndex = deleteChange.deleteIndex !== undefined ? deleteChange.deleteIndex : \n                                            (deleteInversePath.length > 0 && typeof deleteInversePath[deleteInversePath.length - 1] === 'number' ? deleteInversePath.pop() : 0);\n                    this.applyChange({\n                        type: 'insert',\n                        path: deleteInversePath,\n                        value: deleteChange.oldValue,\n                        oldValue: null,\n                        insertIndex: deleteInsertIndex\n                    });\n                    this.redoStack.push(pairedChange);\n                    this.redoStack.push(change);\n                    return false;\n                }\n                \n                // Move both changes back to undo stack (in reverse order so they can be undone correctly)\n                this.undoStack.push(deleteChange);\n                this.undoStack.push(insertChange);\n                if (this.undoStack.length > this.maxStackSize * 2) {\n                    this.undoStack.shift();\n                    this.undoStack.shift();\n                }\n                \n                // Save data and re-render\n                // Request data save via EventBus\n                eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\n                \n                // Request render via EventBus\n                eventBus.emit('app:render-requested');\n                \n                console.log(`[REDO] Move operation redone successfully as atomic operation`);\n                return true;\n            } else {\n                console.warn(`[REDO] Move operation detected but paired change not found, redoing single change`);\n                // Fall through to normal redo\n            }\n        }\n        \n        // Re-apply the change\n        this.applyChange(change);\n        \n        // Move back to undo stack\n        this.undoStack.push(change);\n        if (this.undoStack.length > this.maxStackSize) {\n            this.undoStack.shift();\n        }\n        \n        // Send redo to server if not a remote change\n        const syncManager = getService(SERVICES.SYNC_MANAGER);\n        if (!change.isRemote && syncManager) {\n            syncManager.sendRedo(change.changeId);\n        }\n        \n        // Save data and re-render to reflect changes\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        console.log('Redo applied:', change.type, 'at path:', change.path);\n        return true;\n    }\n    \n    /**\n     * Handle remote undo\n     */\n    handleRemoteUndo(changeId) {\n        // Find and undo the change\n        for (let i = this.undoStack.length - 1; i >= 0; i--) {\n            const change = this.undoStack[i];\n            if (change.changeId === changeId && !change.undone) {\n                change.undone = true;\n                this.undo();\n                break;\n            }\n        }\n    }\n    \n    /**\n     * Handle remote redo\n     */\n    handleRemoteRedo(changeId) {\n        // Find and redo the change\n        for (let i = this.redoStack.length - 1; i >= 0; i--) {\n            const change = this.redoStack[i];\n            if (change.changeId === changeId && change.undone) {\n                change.undone = false;\n                this.redo();\n                break;\n            }\n        }\n    }\n    \n    /**\n     * Clear undo/redo stacks\n     */\n    clear() {\n        this.undoStack = [];\n        this.redoStack = [];\n        this.remoteChanges.clear();\n        this.changeCounter = 0;\n        this.snapshots = [];\n        \n        // Save empty buffer when clearing\n        if (this.currentBufferFilename) {\n            this._debouncedSaveBuffer();\n        }\n    }\n    \n    /**\n     * Diagnose undo/redo issues\n     */\n    diagnoseUndoIssue() {\n        const issues = [];\n        const stackInfo = {\n            undoSize: this.undoStack.length,\n            redoSize: this.redoStack.length\n        };\n        \n        // Validate undo stack\n        this.undoStack.forEach((change, index) => {\n            if (!change.type) {\n                issues.push({\n                    type: 'missing_type',\n                    location: `undoStack[${index}]`,\n                    description: 'Change object missing type property'\n                });\n            }\n            \n            if (!change.path || !Array.isArray(change.path)) {\n                issues.push({\n                    type: 'invalid_path',\n                    location: `undoStack[${index}]`,\n                    description: 'Change object missing or invalid path property'\n                });\n            }\n            \n            // Check if path still exists in current data structure\n            if (change.path && Array.isArray(change.path) && change.path.length > 0) {\n                try {\n                    const pages = this._getDocuments();\n                    let target = pages;\n                    let pathStartIndex = change.path[0] === 'documents' ? 1 : 0;\n                    const navigationEnd = (change.type === 'insert' || change.type === 'add') \n                        ? change.path.length \n                        : change.path.length - 1;\n                    \n                    for (let i = pathStartIndex; i < navigationEnd; i++) {\n                        const key = change.path[i];\n                        if (target === null || target === undefined) {\n                            issues.push({\n                                type: 'path_not_found',\n                                location: `undoStack[${index}]`,\n                                description: `Path navigation failed at index ${i} (key: ${key}). Path: ${change.path.join(' -> ')}`\n                            });\n                            break;\n                        }\n                        \n                        if (Array.isArray(target)) {\n                            const index = parseInt(key);\n                            if (isNaN(index) || index < 0 || index >= target.length) {\n                                issues.push({\n                                    type: 'invalid_array_index',\n                                    location: `undoStack[${index}]`,\n                                    description: `Array index ${index} out of bounds (array length: ${target.length}) at path step ${i}`\n                                });\n                                break;\n                            }\n                            target = target[index];\n                        } else if (typeof target === 'object' && target !== null) {\n                            if (target[key] === undefined) {\n                                issues.push({\n                                    type: 'missing_property',\n                                    location: `undoStack[${index}]`,\n                                    description: `Property '${key}' not found in object at path step ${i}`\n                                });\n                                break;\n                            }\n                            target = target[key];\n                        } else {\n                            issues.push({\n                                type: 'invalid_target_type',\n                                location: `undoStack[${index}]`,\n                                description: `Target is not object/array at path step ${i} (type: ${typeof target})`\n                            });\n                            break;\n                        }\n                    }\n                    \n                    // For delete operations, verify element exists\n                    if (change.type === 'delete' && change.path.length > 0) {\n                        const lastKey = change.path[change.path.length - 1];\n                        if (Array.isArray(target)) {\n                            const index = parseInt(lastKey);\n                            if (!isNaN(index) && (index < 0 || index >= target.length)) {\n                                issues.push({\n                                    type: 'element_not_found',\n                                    location: `undoStack[${index}]`,\n                                    description: `Element at index ${index} does not exist (array length: ${target.length})`\n                                });\n                            }\n                        }\n                    }\n                } catch (error) {\n                    issues.push({\n                        type: 'path_validation_error',\n                        location: `undoStack[${index}]`,\n                        description: `Error validating path: ${error.message}`\n                    });\n                }\n            }\n        });\n        \n        // Validate redo stack\n        this.redoStack.forEach((change, index) => {\n            if (!change.type) {\n                issues.push({\n                    type: 'missing_type',\n                    location: `redoStack[${index}]`,\n                    description: 'Change object missing type property'\n                });\n            }\n            \n            if (!change.path || !Array.isArray(change.path)) {\n                issues.push({\n                    type: 'invalid_path',\n                    location: `redoStack[${index}]`,\n                    description: 'Change object missing or invalid path property'\n                });\n            }\n        });\n        \n        return {\n            valid: issues.length === 0,\n            issues,\n            stackInfo\n        };\n    }\n    \n    /**\n     * Find an item by its ID across all documents, groups, and children\n     * This is the professional way to locate items for undo/redo\n     */\n    findElementById(elementId) {\n        const pages = this._getDocuments();\n        if (!elementId || !pages || pages.length === 0) return null;\n        \n        for (const page of pages) {\n            if (!page || !page.groups) continue;\n            \n            for (const bin of page.groups) {\n                if (!bin || !bin.items) continue;\n                const itemIndex = ItemHierarchy.buildItemIndex(bin.items);\n                \n                // Search main items\n                for (let i = 0; i < bin.items.length; i++) {\n                    const element = bin.items[i];\n                    if (element && element.id === elementId) {\n                        return {\n                            element,\n                            pageId: page.id,\n                            binId: bin.id,\n                            elementIndex: i,\n                            isChild: false,\n                            childIndex: null\n                        };\n                    }\n                    \n                    // Search child items\n                    if (element) {\n                        const childItems = ItemHierarchy.getChildItems(element, itemIndex);\n                        for (let j = 0; j < childItems.length; j++) {\n                            const child = childItems[j];\n                            if (child && child.id === elementId) {\n                                return {\n                                    element: child,\n                                    pageId: page.id,\n                                    binId: bin.id,\n                                    elementIndex: i,\n                                    isChild: true,\n                                    childIndex: j\n                                };\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        \n        return null;\n    }\n    \n    /**\n     * Validate current state integrity\n     */\n    validateState() {\n        const errors = [];\n        const warnings = [];\n        \n        const pages = this._getDocuments();\n        if (!pages || pages.length === 0) {\n            errors.push('documents are not available');\n            return {\n                valid: false,\n                errors,\n                warnings\n            };\n        }\n        \n        if (!Array.isArray(pages)) {\n            errors.push('documents is not an array');\n            return {\n                valid: false,\n                errors,\n                warnings\n            };\n        }\n        \n        // Check each page\n        pages.forEach((page, pageIndex) => {\n            if (!page) {\n                errors.push(`Page at index ${pageIndex} is null or undefined`);\n                return;\n            }\n            \n            if (!page.groups) {\n                warnings.push(`Document ${page.id || pageIndex} does not have a groups array`);\n                return;\n            }\n            \n            if (!Array.isArray(page.groups)) {\n                errors.push(`Document ${page.id || pageIndex} groups is not an array`);\n                return;\n            }\n            \n            // Check each group\n            page.groups.forEach((bin, binIndex) => {\n                if (!bin) {\n                    errors.push(`Group at documents[${pageIndex}].groups[${binIndex}] is null or undefined`);\n                    return;\n                }\n                \n                if (!bin.items) {\n                    warnings.push(`Group ${bin.id || binIndex} in document ${page.id || pageIndex} does not have an items array`);\n                    return;\n                }\n                \n                if (!Array.isArray(bin.items)) {\n                    errors.push(`Group ${bin.id || binIndex} in document ${page.id || pageIndex} items is not an array`);\n                    return;\n                }\n                \n                // Check each item\n                bin.items.forEach((element, elementIndex) => {\n                    if (element === null || element === undefined) {\n                        errors.push(`Item at documents[${pageIndex}].groups[${binIndex}].items[${elementIndex}] is null or undefined`);\n                    } else {\n                        // Check for missing critical properties\n                        if (element.type === undefined || element.type === null) {\n                            warnings.push(`Element at documents[${pageIndex}].groups[${binIndex}].items[${elementIndex}] is missing type property`);\n                        }\n                    }\n                });\n            });\n        });\n        \n        return {\n            valid: errors.length === 0,\n            errors,\n            warnings\n        };\n    }\n    \n    /**\n     * Get path to an element in the data structure\n     */\n    getElementPath(pageId, binId, elementIndex, childIndex = null) {\n        const path = ['documents'];\n        // Get documents from appState\n        const appState = this._getAppState();\n        const pages = appState.documents || [];\n        const pageIndex = pages.findIndex(p => p.id === pageId);\n        if (pageIndex === -1) return null;\n        \n        path.push(pageIndex);\n        path.push('groups');\n        \n        const page = pages[pageIndex];\n        const binIndex = page.groups ? page.groups.findIndex(b => b.id === binId) : -1;\n        if (binIndex === -1) return null;\n        \n        path.push(binIndex);\n        path.push('items');\n        \n        if (childIndex !== null) {\n            path.push(elementIndex);\n            path.push('children');\n            path.push(childIndex);\n        } else {\n            path.push(elementIndex);\n        }\n        \n        return path;\n    }\n    \n    /**\n     * Helper: Record element property change\n     */\n    recordElementPropertyChange(pageId, binId, elementIndex, property, newValue, oldValue, childIndex = null, itemIndex = null) {\n        const path = this.getElementPath(pageId, binId, elementIndex, childIndex);\n        if (!path) {\n            console.error('Failed to get element path for:', { pageId, binId, elementIndex, childIndex });\n            return;\n        }\n        \n        if (itemIndex !== null) {\n            // For multi-checkbox items\n            path.push('items');\n            path.push(itemIndex);\n            path.push(property);\n        } else if (childIndex !== null) {\n            // For child element properties\n            path.push(property);\n        } else {\n            // For main element properties\n            path.push(property);\n        }\n        \n        const change = this.createChange('set', path, newValue, oldValue);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        console.log('Recording property change:', property, 'from', oldValue, 'to', newValue, 'path:', path);\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record element addition\n     */\n    recordElementAdd(pageId, binId, elementIndex, element) {\n        const path = this.getElementPath(pageId, binId, elementIndex);\n        if (!path) return;\n        \n        // Path should point to the array, not the element\n        path.pop(); // Remove elementIndex\n        \n        const change = this.createChange('insert', path, element, null);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        change.insertIndex = elementIndex;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record element deletion\n     */\n    recordElementDelete(pageId, binId, elementIndex, element) {\n        const path = this.getElementPath(pageId, binId, elementIndex);\n        if (!path) return;\n        \n        // Store a deep copy of the element so we can restore it even if it's been modified\n        const elementCopy = JSON.parse(JSON.stringify(element));\n        const change = this.createChange('delete', path, null, elementCopy);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        // Store the original index so we can restore it at the correct position when undoing\n        change.deleteIndex = elementIndex;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record element move\n     */\n    recordElementMove(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, element) {\n        // Record as delete from source and insert at target\n        // These are recorded as separate changes but should be undone together\n        const sourcePath = this.getElementPath(sourcePageId, sourceBinId, sourceElementIndex);\n        const targetPath = this.getElementPath(targetPageId, targetBinId, targetElementIndex);\n        \n        if (!sourcePath || !targetPath) return;\n        \n        // Remove elementIndex from target path to point to array\n        targetPath.pop();\n        \n        const changeId = `${Date.now()}-${Math.random()}`;\n        \n        // Store deep copies of the element to avoid reference issues\n        const elementCopyForDelete = JSON.parse(JSON.stringify(element));\n        const elementCopyForInsert = JSON.parse(JSON.stringify(element));\n        \n        // Delete from source\n        const deleteChange = this.createChange('delete', sourcePath, null, elementCopyForDelete);\n        deleteChange.changeId = `${changeId}-delete`;\n        deleteChange.isPartOfMove = true; // Mark as part of move operation\n        deleteChange.moveChangeId = changeId;\n        // Store the original source index so we can restore it at the correct position when undoing\n        deleteChange.deleteIndex = sourceElementIndex;\n        this.recordChange(deleteChange);\n        \n        // Insert at target\n        const insertChange = this.createChange('insert', targetPath, elementCopyForInsert, null);\n        insertChange.changeId = `${changeId}-insert`;\n        insertChange.insertIndex = targetElementIndex;\n        insertChange.isPartOfMove = true; // Mark as part of move operation\n        insertChange.moveChangeId = changeId;\n        this.recordChange(insertChange);\n    }\n    \n    /**\n     * Helper: Record child element reorder within same parent\n     */\n    recordChildReorder(pageId, binId, parentElementIndex, sourceChildIndex, targetChildIndex, childElement) {\n        // Get path to parent element's children array\n        const path = this.getElementPath(pageId, binId, parentElementIndex);\n        if (!path) return;\n        \n        path.push('children');\n        \n        const changeId = `${Date.now()}-${Math.random()}`;\n        \n        // Delete from source position\n        const sourcePath = [...path, sourceChildIndex];\n        const deleteChange = this.createChange('delete', sourcePath, null, childElement);\n        deleteChange.changeId = `${changeId}-delete`;\n        this.recordChange(deleteChange);\n        \n        // Insert at target position\n        const insertChange = this.createChange('insert', path, childElement, null);\n        insertChange.changeId = `${changeId}-insert`;\n        insertChange.insertIndex = targetChildIndex;\n        this.recordChange(insertChange);\n    }\n    \n    /**\n     * Helper: Record bin addition\n     */\n    recordBinAdd(pageId, binIndex, bin) {\n        const pages = this._getDocuments();\n        const pageIndex = pages.findIndex(p => p.id === pageId);\n        if (pageIndex === -1) return;\n        \n        const path = ['documents', pageIndex, 'groups'];\n        const change = this.createChange('insert', path, bin, null);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        change.insertIndex = binIndex;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record bin deletion\n     */\n    recordBinDelete(pageId, binId, bin) {\n        const pages = this._getDocuments();\n        const pageIndex = pages.findIndex(p => p.id === pageId);\n        if (pageIndex === -1) return;\n        \n        const page = pages[pageIndex];\n        const binIndex = page.groups ? page.groups.findIndex(b => b.id === binId) : -1;\n        if (binIndex === -1) return;\n        \n        const path = ['documents', pageIndex, 'groups', binIndex];\n        const change = this.createChange('delete', path, null, bin);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record page addition\n     */\n    recordPageAdd(pageIndex, page) {\n        const path = ['documents'];\n        const change = this.createChange('insert', path, page, null);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        change.insertIndex = pageIndex;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Helper: Record page deletion\n     */\n    recordPageDelete(pageId, page) {\n        const pages = this._getDocuments();\n        const pageIndex = pages.findIndex(p => p.id === pageId);\n        if (pageIndex === -1) return;\n        \n        const path = ['documents', pageIndex];\n        const change = this.createChange('delete', path, null, page);\n        change.changeId = `${Date.now()}-${Math.random()}`;\n        this.recordChange(change);\n    }\n    \n    /**\n     * Get buffer filename for a given file\n     */\n    getBufferFilename(filename) {\n        if (!filename) return null;\n        // Remove .json extension if present and add -buffer.json\n        const baseName = filename.replace(/\\.json$/, '');\n        return `${baseName}-buffer.json`;\n    }\n    \n    /**\n     * Create a snapshot of current state\n     */\n    createSnapshot() {\n        const pages = this._getDocuments();\n        if (!pages || pages.length === 0) {\n            console.warn('[BUFFER] Cannot create snapshot - documents not available');\n            return null;\n        }\n        \n        const snapshot = {\n            changeIndex: this.changeCounter,\n            data: JSON.parse(JSON.stringify(pages)), // Deep copy\n            timestamp: new Date().toISOString()\n        };\n        \n        this.snapshots.push(snapshot);\n        console.log(`[BUFFER] Created snapshot at change index ${this.changeCounter}, total snapshots: ${this.snapshots.length}`);\n        \n        // Prune old snapshots if exceeding maxSnapshots\n        if (this.snapshots.length > this.maxSnapshots) {\n            // Keep the most recent snapshots\n            this.snapshots = this.snapshots.slice(-this.maxSnapshots);\n            console.log(`[BUFFER] Pruned snapshots, keeping last ${this.maxSnapshots}`);\n        }\n        \n        return snapshot;\n    }\n    \n    /**\n     * Save buffer to server (debounced)\n     */\n    _debouncedSaveBuffer() {\n        if (this.bufferSaveTimer) {\n            clearTimeout(this.bufferSaveTimer);\n        }\n        \n        this.bufferSaveTimer = setTimeout(() => {\n            this.saveBuffer().catch(error => {\n                console.error('[BUFFER] Failed to save buffer:', error);\n            });\n        }, 500); // 500ms debounce\n    }\n    \n    /**\n     * Save buffer to server\n     */\n    async saveBuffer() {\n        if (!this.currentBufferFilename) {\n            console.log('[BUFFER] No current buffer filename, skipping save');\n            return;\n        }\n        \n        const bufferFilename = this.getBufferFilename(this.currentBufferFilename);\n        if (!bufferFilename) {\n            console.warn('[BUFFER] Cannot generate buffer filename');\n            return;\n        }\n        \n        const buffer = {\n            undoStack: this.undoStack,\n            redoStack: this.redoStack,\n            snapshots: this.snapshots,\n            lastChangeIndex: this.changeCounter,\n            lastModified: new Date().toISOString()\n        };\n        \n        try {\n            const response = await fetch('/files/buffer/save', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    filename: bufferFilename,\n                    buffer: buffer\n                })\n            });\n            \n            if (!response.ok) {\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                console.log(`[BUFFER] Buffer saved: ${bufferFilename}`);\n            } else {\n                throw new Error(result.error || 'Failed to save buffer');\n            }\n        } catch (error) {\n            console.error('[BUFFER] Error saving buffer:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Load buffer from server\n     */\n    async loadBuffer(filename) {\n        if (!filename) {\n            console.log('[BUFFER] No filename provided, skipping buffer load');\n            return;\n        }\n        \n        const bufferFilename = this.getBufferFilename(filename);\n        if (!bufferFilename) {\n            console.warn('[BUFFER] Cannot generate buffer filename');\n            return;\n        }\n        \n        try {\n            const encodedFilename = encodeURIComponent(bufferFilename);\n            const response = await fetch(`/files/buffer/${encodedFilename}`);\n            \n            if (!response.ok) {\n                if (response.status === 404) {\n                    // Buffer doesn't exist yet (first time opening file) - this is OK\n                    // Server should now return 200 with empty buffer, but handle 404 for backwards compatibility\n                    console.log(`[BUFFER] Buffer file not found: ${bufferFilename} (first time opening?)`);\n                    this.currentBufferFilename = filename;\n                    this.undoStack = [];\n                    this.redoStack = [];\n                    this.snapshots = [];\n                    this.changeCounter = 0;\n                    return;\n                }\n                throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            \n            const result = await response.json();\n            if (result.success) {\n                // Server now returns 200 with empty buffer structure if file doesn't exist\n                const buffer = result.buffer || {};\n                this.undoStack = buffer.undoStack || [];\n                this.redoStack = buffer.redoStack || [];\n                this.snapshots = buffer.snapshots || [];\n                this.changeCounter = buffer.lastChangeIndex || 0;\n                this.currentBufferFilename = filename;\n                console.log(`[BUFFER] Buffer loaded: ${bufferFilename} (undo: ${this.undoStack.length}, redo: ${this.redoStack.length}, snapshots: ${this.snapshots.length})`);\n            } else {\n                // Server returned success: false - initialize empty\n                console.log(`[BUFFER] Buffer file not found or invalid: ${bufferFilename}`);\n                this.currentBufferFilename = filename;\n                this.undoStack = [];\n                this.redoStack = [];\n                this.snapshots = [];\n                this.changeCounter = 0;\n            }\n        } catch (error) {\n            console.error('[BUFFER] Error loading buffer:', error);\n            // Initialize empty on error\n            this.currentBufferFilename = filename;\n            this.undoStack = [];\n            this.redoStack = [];\n            this.snapshots = [];\n            this.changeCounter = 0;\n        }\n    }\n    \n    /**\n     * Recover from snapshot\n     */\n    recoverFromSnapshot(targetChangeIndex) {\n        if (!this.snapshots || this.snapshots.length === 0) {\n            console.warn('[RECOVERY] No snapshots available for recovery');\n            return { success: false, recoveredFrom: null, replayedChanges: 0 };\n        }\n        \n        // Find nearest snapshot before the problematic change\n        let bestSnapshot = null;\n        let bestIndex = -1;\n        \n        for (let i = this.snapshots.length - 1; i >= 0; i--) {\n            const snapshot = this.snapshots[i];\n            if (snapshot.changeIndex <= targetChangeIndex) {\n                bestSnapshot = snapshot;\n                bestIndex = i;\n                break;\n            }\n        }\n        \n        if (!bestSnapshot) {\n            console.warn(`[RECOVERY] No snapshot found before change index ${targetChangeIndex}`);\n            return { success: false, recoveredFrom: null, replayedChanges: 0 };\n        }\n        \n        console.log(`[RECOVERY] Found snapshot at change index ${bestSnapshot.changeIndex}, restoring state...`);\n        \n        // Restore full state from snapshot\n        const appState = this._getAppState();\n        appState.documents = JSON.parse(JSON.stringify(bestSnapshot.data));\n        \n        // Replay changes from snapshot to current point (excluding problematic change)\n        let replayedCount = 0;\n        const changesToReplay = [];\n        \n        // Find all changes after the snapshot but before the problematic change\n        for (let i = 0; i < this.undoStack.length; i++) {\n            const change = this.undoStack[i];\n            // We need to track which changes were made after the snapshot\n            // For now, we'll replay changes that have changeId indicating they came after\n            // Actually, we don't have change indices in the changes themselves\n            // So we'll need to replay based on position in stack\n            // This is a simplified approach - in a full implementation, we'd track change indices\n        }\n        \n        // For now, we'll just restore from snapshot and clear the undo stack from that point\n        // This is safer than trying to replay changes\n        console.log(`[RECOVERY] Restored state from snapshot at change index ${bestSnapshot.changeIndex}`);\n        console.log(`[RECOVERY] Replayed ${replayedCount} changes`);\n        \n        return {\n            success: true,\n            recoveredFrom: bestSnapshot.changeIndex,\n            replayedChanges: replayedCount\n        };\n    }\n    \n    /**\n     * Set current file and load its buffer\n     */\n    async setCurrentFile(filename) {\n        // Save buffer for previous file if switching\n        if (this.currentBufferFilename && this.currentBufferFilename !== filename) {\n            await this.saveBuffer().catch(error => {\n                console.warn('[BUFFER] Failed to save buffer for previous file:', error);\n            });\n        }\n        \n        // Load buffer for new file\n        await this.loadBuffer(filename);\n    }\n}\n\n","// TimeTracker.js - Time tracking system for elements and pages\nimport { StorageUtils } from '../utils/storage.js';\nimport { eventBus } from '../core/EventBus.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class TimeTracker {\n    constructor() {\n        this.activeTimers = new Map(); // elementId -> timer data\n        this.timeLogs = this.loadTimeLogs();\n        this.storageKey = 'twodo-time-logs';\n    }\n    \n    /**\n     * Get AppState service\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    /**\n     * Get DataManager service\n     */\n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    loadTimeLogs() {\n        return StorageUtils.get(this.storageKey) || {};\n    }\n    \n    saveTimeLogs() {\n        StorageUtils.set(this.storageKey, this.timeLogs);\n    }\n    \n    /**\n     * Start timer for an element\n     */\n    startTimer(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        \n        // Stop any existing timer for this element\n        if (this.activeTimers.has(elementId)) {\n            this.stopTimer(pageId, binId, elementIndex);\n        }\n        \n        const timerData = {\n            startTime: Date.now(),\n            pageId,\n            binId,\n            elementIndex\n        };\n        \n        this.activeTimers.set(elementId, timerData);\n        \n        // Emit event\n        eventBus.emit('timer:started', { pageId, binId, elementIndex });\n    }\n    \n    /**\n     * Stop timer for an element\n     */\n    stopTimer(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        const timerData = this.activeTimers.get(elementId);\n        \n        if (!timerData) return 0;\n        \n        const duration = Date.now() - timerData.startTime;\n        const seconds = Math.floor(duration / 1000);\n        \n        // Log time\n        this.logTime(pageId, binId, elementIndex, seconds);\n        \n        // Remove from active timers\n        this.activeTimers.delete(elementId);\n        \n        // Emit event\n        eventBus.emit('timer:stopped', { pageId, binId, elementIndex, duration: seconds });\n        \n        return seconds;\n    }\n    \n    /**\n     * Log time for an element\n     */\n    logTime(pageId, binId, elementIndex, seconds) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        const today = new Date().toISOString().split('T')[0];\n        \n        if (!this.timeLogs[elementId]) {\n            this.timeLogs[elementId] = [];\n        }\n        \n        this.timeLogs[elementId].push({\n            date: today,\n            seconds: seconds,\n            timestamp: new Date().toISOString()\n        });\n        \n        // Update element's total time if it has time tracking\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        const bin = page?.groups?.find(b => b.id === binId);\n        const items = bin?.items || [];\n        if (bin) {\n            bin.items = items;\n        }\n        const element = items?.[elementIndex];\n        \n        if (element) {\n            if (!element.timeTracked) element.timeTracked = 0;\n            element.timeTracked += seconds;\n        }\n        \n        this.saveTimeLogs();\n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            dataManager.saveData();\n        }\n    }\n    \n    /**\n     * Get total time for an element\n     */\n    getTotalTime(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        const logs = this.timeLogs[elementId] || [];\n        return logs.reduce((total, log) => total + log.seconds, 0);\n    }\n    \n    /**\n     * Get time for a date range\n     */\n    getTimeForRange(pageId, binId, elementIndex, startDate, endDate) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        const logs = this.timeLogs[elementId] || [];\n        \n        return logs\n            .filter(log => {\n                const logDate = new Date(log.date);\n                return logDate >= startDate && logDate <= endDate;\n            })\n            .reduce((total, log) => total + log.seconds, 0);\n    }\n    \n    /**\n     * Get active timer duration\n     */\n    getActiveTimerDuration(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        const timerData = this.activeTimers.get(elementId);\n        \n        if (!timerData) return 0;\n        \n        return Math.floor((Date.now() - timerData.startTime) / 1000);\n    }\n    \n    /**\n     * Check if timer is active\n     */\n    isTimerActive(pageId, binId, elementIndex) {\n        const elementId = this.getElementId(pageId, binId, elementIndex);\n        return this.activeTimers.has(elementId);\n    }\n    \n    /**\n     * Format seconds to readable string\n     */\n    formatTime(seconds) {\n        if (seconds < 60) return `${seconds}s`;\n        if (seconds < 3600) return `${Math.floor(seconds / 60)}m ${seconds % 60}s`;\n        const hours = Math.floor(seconds / 3600);\n        const minutes = Math.floor((seconds % 3600) / 60);\n        return `${hours}h ${minutes}m`;\n    }\n    \n    /**\n     * Get unique element ID\n     */\n    getElementId(pageId, binId, elementIndex) {\n        return `${pageId}-${binId}-${elementIndex}`;\n    }\n    \n    /**\n     * Get time report for a page\n     */\n    getPageTimeReport(pageId, startDate, endDate) {\n        const appState = this._getAppState();\n        const page = appState.documents.find(p => p.id === pageId);\n        if (!page) return null;\n        \n        const report = {\n            totalTime: 0,\n            byBin: {},\n            byElement: {},\n            byDate: {}\n        };\n        \n        page.groups?.forEach(bin => {\n            const items = bin.items || [];\n            bin.items = items;\n            items.forEach((element, elementIndex) => {\n                const time = this.getTimeForRange(pageId, bin.id, elementIndex, startDate, endDate);\n                if (time > 0) {\n                    report.totalTime += time;\n                    report.byBin[bin.id] = (report.byBin[bin.id] || 0) + time;\n                    report.byElement[`${pageId}-${bin.id}-${elementIndex}`] = time;\n                    \n                    // By date\n                    const elementId = this.getElementId(pageId, bin.id, elementIndex);\n                    const logs = this.timeLogs[elementId] || [];\n                    logs.forEach(log => {\n                        if (new Date(log.date) >= startDate && new Date(log.date) <= endDate) {\n                            report.byDate[log.date] = (report.byDate[log.date] || 0) + log.seconds;\n                        }\n                    });\n                }\n            });\n        });\n        \n        return report;\n    }\n}\n\n\n","// BinRenderer.js - Handles bin rendering\n// Extracted from app.js to improve modularity\nimport { eventBus } from './EventBus.js';\nimport { EventHelper } from '../utils/EventHelper.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\n/**\n * BinRenderer - Handles rendering of bins\n * \n * This class extracts bin rendering logic from app.js to improve modularity.\n */\nexport class BinRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a bin element\n     * @param {string} pageId - Page ID\n     * @param {Object} bin - Bin data object\n     * @returns {HTMLElement} The rendered bin element\n     */\n    renderBin(pageId, bin) {\n        const binDiv = document.createElement('div');\n        binDiv.className = 'bin';\n        binDiv.dataset.binId = bin.id;\n        binDiv.dataset.pageId = pageId;\n        binDiv.draggable = true;\n        binDiv.dataset.dragType = 'bin';\n        \n        // Apply visual settings for this bin (includes tag-based settings)\n        if (this.app.visualSettingsManager) {\n            const page = this.app.appState?.documents?.find(page => page.id === pageId);\n            const viewFormat = page?.format || 'default';\n            // Tags are automatically retrieved and applied in applyVisualSettings\n            this.app.visualSettingsManager.applyVisualSettings(binDiv, 'bin', bin.id, pageId, viewFormat);\n        }\n        \n        // Initialize bin state if not set (default to expanded)\n        if (!(bin.id in this.app.appState.groupStates)) {\n            this.app.appState.groupStates[bin.id] = true;\n        }\n        const isExpanded = this.app.appState.groupStates[bin.id];\n        \n        const header = document.createElement('div');\n        header.className = 'bin-header';\n        \n        const binToggleId = `bin-toggle-${bin.id}`;\n        const binContentId = `bin-content-${bin.id}`;\n        \n        const arrow = isExpanded ? '' : '';\n        header.innerHTML = `\n            <span class=\"bin-toggle-arrow\" id=\"${binToggleId}\" style=\"cursor: pointer; margin-right: 8px; color: #888888; user-select: none;\">${arrow}</span>\n            <div class=\"bin-title\" data-bin-id=\"${bin.id}\">${bin.title}</div>\n        `;\n        \n        const binContent = document.createElement('div');\n        binContent.id = binContentId;\n        binContent.style.display = isExpanded ? 'block' : 'none';\n        \n        // Apply max-height if set\n        if (bin.maxHeight && bin.maxHeight > 0) {\n            binContent.style.maxHeight = `${bin.maxHeight}px`;\n            binContent.style.overflowY = 'auto';\n            binContent.style.overflowX = 'hidden';\n        }\n        \n        // Context menu is now handled by unified handler in EventHandler\n        \n        const elementsList = document.createElement('div');\n        elementsList.className = 'elements-list';\n        elementsList.id = `elements-list-${bin.id}`;\n        \n        // Context menu is now handled by unified handler in EventHandler\n        \n        // Ensure bin.items exists and is an array\n        const items = bin.items || [];\n        if (!Array.isArray(items)) {\n            console.warn('bin.items is not an array:', items, 'for bin:', bin.id);\n        }\n        bin.items = items;\n\n        const rootItems = ItemHierarchy.getRootItems(items);\n        rootItems.forEach((element, elIndex) => {\n            // Delegate to ElementRenderer (will be created)\n            const elementNode = this.app.renderService.getRenderer().renderElement(pageId, bin.id, element, elIndex);\n            elementsList.appendChild(elementNode);\n        });\n        \n        const addElementBtn = document.createElement('button');\n        addElementBtn.className = 'add-element-btn';\n        addElementBtn.textContent = '+ Add Element';\n        addElementBtn.onclick = () => {\n            this.app.modalHandler.showAddElementModal(pageId, bin.id);\n        };\n        \n        // Track active bin when clicking on bin\n        binDiv.addEventListener('click', () => {\n            this.app.appState.activeGroupId = bin.id;\n        });\n        \n        // Context menu is now handled by unified handler in EventHandler\n        \n        // Use EventHelper for double-click detection on bin title\n        const titleElement = binDiv.querySelector('.bin-title');\n        if (titleElement) {\n            EventHelper.setupDoubleClick(\n                titleElement,\n                (e) => {\n                    // Double click on title - make it editable\n                    titleElement.contentEditable = 'true';\n                    titleElement.focus();\n                    // Select all text for easy replacement\n                    const range = document.createRange();\n                    range.selectNodeContents(titleElement);\n                    const selection = window.getSelection();\n                    selection.removeAllRanges();\n                    selection.addRange(range);\n                },\n                this.app.appState.doubleClickDelay\n            );\n        }\n        \n        // Use EventHelper for double-click detection on bin (for context menu)\n        EventHelper.setupDoubleClick(\n            binDiv,\n            (e) => {\n                // Don't trigger if clicking on title (handled separately above)\n                if (e.target.closest('.bin-title')) {\n                    return;\n                }\n                // Double click detected - show context menu\n                handleBinMenu(e);\n            },\n            this.app.appState.doubleClickDelay\n        );\n        \n        binContent.appendChild(elementsList);\n        binContent.appendChild(addElementBtn);\n        \n        binDiv.appendChild(header);\n        binDiv.appendChild(binContent);\n        \n        // Emit bin:render event for plugins (after DOM is ready)\n        setTimeout(() => {\n            if (this.app.eventBus) {\n                this.app.eventBus.emit('bin:render', {\n                    binElement: binDiv,\n                    pageId: pageId,\n                    binData: bin\n                });\n            }\n        }, 0);\n        \n        // Toggle handler for bin collapse/expand\n        // Query from header element directly (it's already created via innerHTML)\n        const toggleArrow = header.querySelector(`#${binToggleId}`);\n        if (toggleArrow) {\n            toggleArrow.addEventListener('click', (e) => {\n            e.stopPropagation();\n                const isCurrentlyExpanded = this.app.appState.groupStates[bin.id] !== false; // default to true\n            this.app.appState.groupStates[bin.id] = !isCurrentlyExpanded;\n            const content = document.getElementById(binContentId);\n            if (content) {\n                content.style.display = this.app.appState.groupStates[bin.id] ? 'block' : 'none';\n            }\n            toggleArrow.textContent = this.app.appState.groupStates[bin.id] ? '' : '';\n                this.app.dataManager.saveData(); // Save collapse state\n            });\n        }\n        \n        // Make bin title editable on double-click (reuse titleElement from above)\n        if (titleElement) {\n            titleElement.addEventListener('blur', (e) => {\n            // Only save if it was actually editable\n            if (e.target.contentEditable === 'true') {\n                bin.title = e.target.textContent.trim() || 'Untitled Bin';\n                e.target.contentEditable = 'false';\n            this.app.dataManager.saveData();\n            }\n            });\n            \n            // Handle Enter key to finish editing\n            titleElement.addEventListener('keydown', (e) => {\n                if (e.target.contentEditable === 'true' && e.key === 'Enter') {\n                    e.preventDefault();\n                    e.target.blur();\n                }\n            });\n        }\n        \n        // Drag and drop handlers for bins\n        binDiv.addEventListener('dragstart', (e) => {\n            // Don't start drag if clicking on interactive elements\n            if (e.target.closest('button') || e.target.closest('input')) {\n                e.preventDefault();\n                return;\n            }\n            \n            // Don't start drag if editing bin title\n            const titleElement = e.target.closest('.bin-title');\n            if (titleElement && titleElement.contentEditable === 'true') {\n                e.preventDefault();\n                return;\n            }\n            \n            // Don't start drag if the target is an element (elements handle their own drag)\n            if (e.target.closest('.element')) {\n                e.preventDefault();\n                return;\n            }\n            \n            e.dataTransfer.effectAllowed = 'move';\n            const dragPayload = {\n                type: 'bin',\n                pageId: pageId,\n                binId: bin.id\n            };\n            // console.log('Bin dragstart:', dragPayload);\n            e.dataTransfer.setData('text/plain', JSON.stringify(dragPayload));\n            this.app.appState.dragData = dragPayload;\n            binDiv.classList.add('dragging');\n            this.app.appState.isDragging = true; // Track dragging state for scroll handlers\n            \n            // Show trash icon\n            const trashIcon = document.getElementById('trash-icon');\n            if (trashIcon) {\n                trashIcon.style.display = 'flex';\n            }\n        });\n        \n        binDiv.addEventListener('dragend', (e) => {\n            binDiv.classList.remove('dragging');\n            this.app.appState.isDragging = false; // Clear dragging state\n            \n            // Hide trash icon\n            const trashIcon = document.getElementById('trash-icon');\n            if (trashIcon) {\n                trashIcon.style.display = 'none';\n                trashIcon.classList.remove('drag-over-trash');\n                trashIcon.style.background = 'rgba(220, 53, 69, 0.9)';\n                trashIcon.style.transform = 'scale(1)';\n            }\n            \n            // Stop auto-scrolling\n            if (this.app.appState.autoScrollInterval) {\n                clearInterval(this.app.appState.autoScrollInterval);\n                this.app.appState.autoScrollInterval = null;\n            }\n            // Don't clear dragData here - let drop handler clear it after processing\n            // If drop didn't fire (drag cancelled), clear it after a delay\n            if (!e.dataTransfer.dropEffect || e.dataTransfer.dropEffect === 'none') {\n                // Drag was cancelled, clear dragData\n                setTimeout(() => {\n            this.app.appState.dragData = null;\n                }, 50);\n            }\n            // Remove all drag-over classes\n            document.querySelectorAll('.drag-over').forEach(el => {\n                el.classList.remove('drag-over');\n            });\n        });\n        \n        binDiv.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.dataTransfer.dropEffect = 'move';\n            \n            // Use stored dragData if available, otherwise try to parse from dataTransfer\n            const dragData = this.app.appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            // Only allow dropping bins on bins-container or other bins\n            if (dragData.type === 'bin' && dragData.binId !== bin.id) {\n                binDiv.classList.add('drag-over');\n            }\n            // Allow dropping elements on bins\n            else if (dragData.type === 'element') {\n                binDiv.classList.add('drag-over');\n            }\n        });\n        \n        binDiv.addEventListener('dragleave', (e) => {\n            // Only remove class if we're leaving the bin div itself\n            if (!binDiv.contains(e.relatedTarget)) {\n                binDiv.classList.remove('drag-over');\n            }\n        });\n        \n        binDiv.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            binDiv.classList.remove('drag-over');\n            \n            let dragData = this.app.appState.dragData;\n            if (!dragData) {\n                try {\n                    const dataStr = e.dataTransfer.getData('text/plain');\n                    if (dataStr) {\n                        dragData = JSON.parse(dataStr);\n                    } else {\n                        console.error('No drag data available in bin drop');\n                        return;\n                    }\n                } catch (err) {\n                    console.error('Failed to parse drag data:', err);\n                    return;\n                }\n            }\n            \n            // console.log('Bin drop event:', dragData, 'onto bin:', bin.id);\n            \n            if (dragData && dragData.type === 'bin') {\n                // console.log('Moving bin:', dragData.binId, '->', bin.id);\n                this.app.binManager.moveBin(dragData.pageId, dragData.binId, pageId, bin.id);\n            } else if (dragData && dragData.type === 'element') {\n                // If this is a nested element being dragged to a bin, un-nest it\n                if (dragData.isChild && dragData.parentElementIndex !== null) {\n                    // Find the parent element to place the un-nested element immediately below it\n                    const sourcePage = this.app.appState.documents.find(page => page.id === dragData.pageId);\n                    const sourceBin = sourcePage?.groups?.find(bin => bin.id === dragData.binId);\n                    if (sourceBin && sourceBin.items[dragData.parentElementIndex]) {\n                        // If dropping on the same bin as parent, place immediately after parent\n                        if (bin.id === dragData.binId && pageId === dragData.pageId) {\n                            const targetIndex = dragData.parentElementIndex + 1;\n                            // console.log('Un-nesting element and placing below parent at index:', targetIndex);\n                            this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, pageId, bin.id, targetIndex,\n                                dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                        } else {\n                            // If dropping on different bin, find parent's position in target bin or add to end\n                            // For now, just add to end - could be enhanced to find matching parent\n                            // console.log('Moving nested element to different bin (un-nesting):', dragData.pageId, dragData.binId, dragData.elementIndex, '->', pageId, bin.id);\n                            this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, pageId, bin.id, bin.items.length,\n                                dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                        }\n                    } else {\n                        // Fallback: just un-nest and add to end\n                        // console.log('Moving nested element to bin (un-nesting):', dragData.pageId, dragData.binId, dragData.elementIndex, '->', pageId, bin.id);\n                        this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, pageId, bin.id, bin.items.length,\n                            dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                    }\n                } else {\n                    // console.log('Moving element to bin:', dragData.pageId, dragData.binId, dragData.elementIndex, '->', pageId, bin.id);\n                // Move element to this bin at the end\n                    this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, pageId, bin.id, bin.items.length,\n                        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                }\n            }\n            \n            // Clear dragData after processing\n            this.app.appState.dragData = null;\n        });\n        \n        // Make elements list a drop zone for elements\n        // Support dropping between elements with visual indicator\n        // Store indicator reference on the elementsList for access from element handlers\n        let dropIndicator = null;\n        let dropTargetIndex = null;\n        elementsList._dropIndicator = null;\n        elementsList._dropTargetIndex = null;\n        \n        // Helper function to clear all drop indicators across the app\n        const clearAllDropIndicators = () => {\n            // Clear all elements list indicators\n            document.querySelectorAll('.elements-list').forEach(list => {\n                if (list._dropIndicator) {\n                    list._dropIndicator.remove();\n                    list._dropIndicator = null;\n                    list._dropTargetIndex = null;\n                }\n            });\n            \n            // Clear all nested children container indicators\n            document.querySelectorAll('.dropdown-content').forEach(content => {\n                if (content._dropIndicator) {\n                    content._dropIndicator.remove();\n                    content._dropIndicator = null;\n                    content._dropTargetIndex = null;\n                }\n            });\n            \n            // Also clear any orphaned indicators (safety check)\n            document.querySelectorAll('.drop-indicator').forEach(indicator => {\n                indicator.remove();\n            });\n        };\n        \n        // Helper function to calculate and show drop indicator\n        const updateDropIndicator = (e, elementsList, bin) => {\n            const dragData = this.app.appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            if (dragData.type !== 'element') {\n                // Remove indicator if not dragging an element\n                if (dropIndicator) {\n                    dropIndicator.remove();\n                    dropIndicator = null;\n                    dropTargetIndex = null;\n                    elementsList._dropIndicator = null;\n                    elementsList._dropTargetIndex = null;\n                }\n                return;\n            }\n            \n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = 'move';\n            \n            // Find which position we're hovering over\n            const elements = Array.from(elementsList.querySelectorAll('.element:not(.child-element)'));\n            const mouseY = e.clientY;\n            const elementsListRect = elementsList.getBoundingClientRect();\n            const relativeY = mouseY - elementsListRect.top;\n            \n            // Find the insertion point\n            let insertIndex = bin.items.length; // Default to end\n            let targetElement = null;\n            \n            for (let i = 0; i < elements.length; i++) {\n                const elementRect = elements[i].getBoundingClientRect();\n                const elementTop = elementRect.top - elementsListRect.top;\n                const elementBottom = elementRect.bottom - elementsListRect.top;\n                const elementMiddle = (elementTop + elementBottom) / 2;\n                \n                // If mouse is above the middle of this element, insert before it\n                if (relativeY < elementMiddle) {\n                    const elementIndexStr = elements[i].dataset.elementIndex;\n                    if (elementIndexStr) {\n                        // Handle child elements - get parent index\n                        if (typeof elementIndexStr === 'string' && elementIndexStr.includes('-')) {\n                            const parentIndex = parseInt(elementIndexStr.split('-')[0]);\n                            if (!isNaN(parentIndex)) {\n                                insertIndex = parentIndex;\n                                targetElement = elements[i];\n                            }\n                        } else {\n                            const elementIndex = parseInt(elementIndexStr);\n                            if (!isNaN(elementIndex)) {\n                                insertIndex = elementIndex;\n                                targetElement = elements[i];\n                            }\n                        }\n                    }\n                    break;\n                }\n            }\n            \n            // If we didn't find a target element, check if we should append at the end\n            if (targetElement === null && insertIndex >= bin.items.length) {\n                const addButton = elementsList.querySelector('.add-element-btn');\n                if (addButton) {\n                    targetElement = addButton;\n                }\n            }\n            \n            // Show visual indicator at the insertion point\n            if (dropTargetIndex !== insertIndex || dropIndicator === null) {\n                dropTargetIndex = insertIndex;\n                \n                // Clear ALL drop indicators before showing a new one\n                clearAllDropIndicators();\n                dropIndicator = null;\n                \n                // Create new indicator\n                dropIndicator = document.createElement('div');\n                dropIndicator.className = 'drop-indicator';\n                dropIndicator.style.cssText = `\n                    height: 2px;\n                    background: #4a9eff;\n                    margin: 4px 0;\n                    border-radius: 1px;\n                    pointer-events: none;\n                    position: relative;\n                    z-index: 1000;\n                `;\n                \n                // Store reference\n                elementsList._dropIndicator = dropIndicator;\n                elementsList._dropTargetIndex = insertIndex;\n                \n                // Insert indicator at the correct position\n                if (targetElement && elementsList.contains(targetElement) && targetElement.parentElement === elementsList) {\n                    elementsList.insertBefore(dropIndicator, targetElement);\n                } else {\n                    // Fallback: append to end\n                    elementsList.appendChild(dropIndicator);\n                }\n            }\n        };\n        \n        elementsList.addEventListener('dragover', (e) => {\n            updateDropIndicator(e, elementsList, bin);\n        });\n        \n        elementsList.addEventListener('dragleave', (e) => {\n            // Only remove indicator if leaving the elements list entirely\n            if (!elementsList.contains(e.relatedTarget)) {\n                if (dropIndicator) {\n                    dropIndicator.remove();\n                    dropIndicator = null;\n                    dropTargetIndex = null;\n                }\n            }\n        });\n        \n        elementsList.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            let dragData = this.app.appState.dragData;\n            if (!dragData) {\n                try {\n                    const dataStr = e.dataTransfer.getData('text/plain');\n                    if (dataStr) {\n                        dragData = JSON.parse(dataStr);\n                    } else {\n                        console.error('No drag data available in elements list drop');\n                        return;\n                    }\n                } catch (err) {\n                    console.error('Failed to parse drag data:', err);\n                    return;\n                }\n            }\n            \n            // console.log('Elements list drop:', dragData);\n            \n            if (dragData && dragData.type === 'element') {\n                // Remove drop indicator\n                if (elementsList._dropIndicator) {\n                    elementsList._dropIndicator.remove();\n                    elementsList._dropIndicator = null;\n                }\n                \n                // PRIORITY: Always use the indicator position if available\n                let targetIndex = bin.items.length; // Default to end\n                let targetElement = null; // Declare outside if/else so it's available later\n                \n                if (elementsList._dropTargetIndex !== null && elementsList._dropTargetIndex !== undefined) {\n                    // Use indicator position (this is where the user intended to drop)\n                    targetIndex = elementsList._dropTargetIndex;\n                    elementsList._dropTargetIndex = null;\n                } else {\n                    // Fallback: calculate from element position (only if no indicator)\n                    targetElement = e.target.closest('.element');\n                    if (targetElement) {\n                        // Handle both regular elements and child elements\n                        const targetElementIndexStr = targetElement.dataset.elementIndex;\n                        if (targetElementIndexStr) {\n                            if (typeof targetElementIndexStr === 'string' && targetElementIndexStr.includes('-')) {\n                                // Target is a child element - get its parent's index\n                                const targetParentIndex = parseInt(targetElementIndexStr.split('-')[0]);\n                                if (!isNaN(targetParentIndex)) {\n                                    // Place after the target's parent\n                                    targetIndex = targetParentIndex + 1;\n                                }\n                            } else {\n                                // Target is a regular element\n                                const targetElementIndex = parseInt(targetElementIndexStr);\n                                if (!isNaN(targetElementIndex)) {\n                                    targetIndex = targetElementIndex;\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                // If this is a nested element being dropped on empty space, un-nest and place below parent\n                if (dragData.isChild && dragData.parentElementIndex !== null && !targetElement) {\n                    const sourcePage = this.app.appState.documents.find(page => page.id === dragData.pageId);\n                    const sourceBin = sourcePage?.groups?.find(bin => bin.id === dragData.binId);\n                    if (sourceBin && bin.id === dragData.binId && pageId === dragData.pageId && sourceBin.items[dragData.parentElementIndex]) {\n                        // Place immediately after parent\n                        targetIndex = dragData.parentElementIndex + 1;\n                        // console.log('Un-nesting element and placing below parent at index:', targetIndex);\n                    }\n                }\n                \n                // moveElement will handle un-nesting if isChild is true\n                // console.log('Moving element within bin (un-nesting if needed):', dragData.pageId, dragData.binId, dragData.elementIndex, '->', pageId, bin.id, targetIndex);\n                this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, pageId, bin.id, targetIndex,\n                    dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                \n                // Clean up drag-over classes\n                document.querySelectorAll('.drag-over').forEach(el => {\n                    el.classList.remove('drag-over');\n                });\n            }\n            \n            // Clear dragData after processing\n            this.app.appState.dragData = null;\n        });\n        \n        return binDiv;\n    }\n}\n\n","// TaskRenderer.js - Handles task element rendering\n// TaskRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\nimport { ItemHierarchy } from '../../utils/ItemHierarchy.js';\n\n/**\n * TaskRenderer - Handles rendering of task elements\n */\nexport class TaskRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a task element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const taskHeader = document.createElement('div');\n        taskHeader.className = 'task-header';\n\n        const hasChildren = Array.isArray(element.childIds) && element.childIds.length > 0;\n        const childrenToggleId = `children-toggle-${pageId}-${elementIndex}`;\n        const childrenContentId = `children-content-${pageId}-${elementIndex}`;\n\n        const taskTextSpan = document.createElement('span');\n        taskTextSpan.className = 'task-text';\n        if (hasChildren) {\n        // Get or initialize individual children state\n        const childrenStateKey = `${binId}-${elementIndex}`;\n        if (!(childrenStateKey in this.app.appState.subtaskStates)) {\n        this.app.appState.subtaskStates[childrenStateKey] = this.app.appState.allSubtasksExpanded;\n        }\n        const isExpanded = this.app.appState.subtaskStates[childrenStateKey];\n        const initialArrow = isExpanded ? '' : '';\n    \n        // Parse HTML in text if present, otherwise escape it\n        const textFragment = this.app.parseLinks(element.text);\n        const arrowSpan = document.createElement('span');\n        arrowSpan.className = 'subtask-arrow';\n        arrowSpan.id = childrenToggleId;\n        arrowSpan.textContent = initialArrow;\n        taskTextSpan.appendChild(arrowSpan);\n        taskTextSpan.appendChild(document.createTextNode(' '));\n        taskTextSpan.appendChild(textFragment);\n        // For tasks with children, clicking the text toggles children, not completion\n        taskTextSpan.onclick = (e) => {\n        e.stopPropagation();\n        const arrow = document.getElementById(childrenToggleId);\n        const content = document.getElementById(childrenContentId);\n        if (arrow && content) {\n        // Toggle individual state\n        this.app.appState.subtaskStates[childrenStateKey] = !this.app.appState.subtaskStates[childrenStateKey];\n        const newState = this.app.appState.subtaskStates[childrenStateKey];\n        content.style.display = newState ? 'block' : 'none';\n        arrow.textContent = newState ? '' : '';\n        }\n        };\n        } else {\n        const textFragment = this.app.parseLinks(element.text);\n        taskTextSpan.appendChild(textFragment);\n        // Clicking text enables inline editing instead of toggling checkbox\n        taskTextSpan.style.cursor = 'text';\n        taskTextSpan.addEventListener('click', (e) => {\n        // Don't enable editing if clicking on a link\n        if (e.target.tagName === 'A') {\n        return;\n        }\n        e.stopPropagation();\n        this.app.enableInlineEditing(taskTextSpan, pageId, binId, elementIndex, element);\n        });\n        }\n\n        const checkbox = document.createElement('input');\n        checkbox.type = 'checkbox';\n        checkbox.checked = element.completed;\n        checkbox.onchange = (e) => {\n        e.stopPropagation();\n        this.app.toggleElement(pageId, binId, elementIndex);\n        };\n        // Prevent text click from firing when clicking checkbox\n        checkbox.addEventListener('click', (e) => {\n        e.stopPropagation();\n        });\n\n        // Add dragover handler on checkbox to allow drops (required for input elements)\n        checkbox.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        // Let the parent div's dragover handler set the dropEffect\n        // We just need to prevent default to allow the drop\n        });\n\n        // Add drop handler on checkbox for nesting\n        checkbox.addEventListener('drop', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        let dragData = this.app.appState.dragData;\n        if (!dragData) {\n        try {\n        const dataStr = e.dataTransfer.getData('text/plain');\n        if (dataStr) {\n        dragData = JSON.parse(dataStr);\n        } else {\n        console.error('No drag data available in checkbox drop');\n        return;\n        }\n        } catch (err) {\n        console.error('Failed to parse drag data:', err);\n        return;\n        }\n        }\n    \n        if (dragData && dragData.type === 'element') {\n        // Get the element index from the checkbox's parent element\n        const checkboxElement = checkbox.closest('.element');\n        if (checkboxElement) {\n        const checkboxPageId = checkboxElement.dataset.pageId;\n        const actualBinId = checkboxElement.dataset.binId;\n        const checkboxElementIndexStr = checkboxElement.dataset.elementIndex;\n        let checkboxElementIndex = elementIndex;\n        if (checkboxElementIndexStr) {\n        if (typeof checkboxElementIndexStr === 'string' && checkboxElementIndexStr.includes('-')) {\n        checkboxElementIndex = parseInt(checkboxElementIndexStr.split('-')[0]);\n        } else {\n        checkboxElementIndex = parseInt(checkboxElementIndexStr);\n        }\n        }\n            \n        // When dropping on checkbox, always treat as regular element nesting (not child nesting)\n        // This ensures it becomes a direct child, not a grandchild\n        if (dragData.isChild && dragData.parentElementIndex !== null && dragData.childIndex !== null) {\n        // Un-nest the child first, then nest it as a regular element\n        const sourcePage = this.app.appState.documents?.find(p => p.id === dragData.pageId);\n        const sourceBin = sourcePage?.groups?.find(b => b.id === dragData.binId);\n        const items = sourceBin?.items || [];\n        if (sourceBin) {\n        sourceBin.items = items;\n        }\n        const itemIndex = ItemHierarchy.buildItemIndex(items);\n        const parentElement = ItemHierarchy.getRootItemAtIndex(items, dragData.parentElementIndex);\n        const childItems = parentElement ? ItemHierarchy.getChildItems(parentElement, itemIndex) : [];\n        const childElement = childItems[dragData.childIndex];\n        if (parentElement && childElement) {\n        if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n        parentElement.childIds.splice(dragData.childIndex, 1);\n        childElement.parentId = null;\n        // Now nest it as a regular element (not a child)\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.parentElementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        false, null, null, childElement);\n        } else {\n        // Fallback: use original logic\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n        }\n        } else {\n        // Source is already a regular element, nest normally\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        false, null, null);\n        }\n        }\n        }\n    \n        // Clear drag data\n        this.app.appState.dragData = null;\n        });\n\n        taskHeader.appendChild(checkbox);\n        taskHeader.appendChild(taskTextSpan);\n        div.appendChild(taskHeader);\n\n        // Add tooltip hover handlers\n        let tooltipText = '';\n        if (element.timeAllocated) {\n            tooltipText += `Time: ${element.timeAllocated}`;\n        }\n        if (element.funModifier) {\n            tooltipText += tooltipText ? ` | Fun: ${element.funModifier}` : `Fun: ${element.funModifier}`;\n        }\n        if (tooltipText) {\n            div.addEventListener('mouseenter', () => {\n                this.app.showTooltip(tooltipText);\n            });\n            div.addEventListener('mouseleave', () => {\n                this.app.hideTooltip();\n            });\n        }\n\n        // Render children using renderChildren helper\n        if (hasChildren) {\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\n            if (childrenContainer) {\n                // Update the content div ID for toggle functionality\n                const contentDiv = childrenContainer.querySelector('.dropdown-content');\n                if (contentDiv) {\n                    contentDiv.id = childrenContentId;\n                }\n                div.appendChild(childrenContainer);\n            }\n        }\n    }\n}","// HeaderRenderer.js - Handles header element rendering (non-checkbox headers)\r\nimport { eventBus } from '../EventBus.js';\r\nimport { EVENTS } from '../AppEvents.js';\r\n\r\n/**\r\n * HeaderRenderer - Handles rendering of header elements (without checkbox)\r\n */\r\nexport class HeaderRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    /**\r\n     * Render a header element\r\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        // Create header text element\r\n        const headerText = document.createElement('div');\r\n        headerText.className = 'header-text';\r\n        const headerTextFragment = this.app.parseLinks(element.text || '');\r\n        headerText.appendChild(headerTextFragment);\r\n        \r\n        // Enable inline editing\r\n        headerText.style.cursor = 'text';\r\n        headerText.addEventListener('click', (e) => {\r\n            // Don't enable editing if clicking on a link\r\n            if (e.target.tagName === 'A') {\r\n                return;\r\n            }\r\n            e.stopPropagation();\r\n            this.app.enableInlineEditing(headerText, pageId, binId, elementIndex, element);\r\n        });\r\n\r\n        div.appendChild(headerText);\r\n\r\n        // Add tooltip hover handlers\r\n        let tooltipText = '';\r\n        if (element.timeAllocated) {\r\n            tooltipText += `Time: ${element.timeAllocated}`;\r\n        }\r\n        if (element.funModifier) {\r\n            tooltipText += tooltipText ? ` | Fun: ${element.funModifier}` : `Fun: ${element.funModifier}`;\r\n        }\r\n        if (tooltipText) {\r\n            div.addEventListener('mouseenter', () => {\r\n                this.app.showTooltip(tooltipText);\r\n            });\r\n            div.addEventListener('mouseleave', () => {\r\n                this.app.hideTooltip();\r\n            });\r\n        }\r\n\r\n        // Render children if they exist\r\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\r\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\r\n            if (childrenContainer) {\r\n                div.appendChild(childrenContainer);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n","// HeaderCheckboxRenderer.js - Handles header-checkbox element rendering\n// HeaderCheckboxRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\nimport { ItemHierarchy } from '../../utils/ItemHierarchy.js';\n\n/**\n * HeaderCheckboxRenderer - Handles rendering of header-checkbox elements\n */\nexport class HeaderCheckboxRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a header-checkbox element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const headerCheckbox = document.createElement('input');\n        headerCheckbox.type = 'checkbox';\n        headerCheckbox.checked = element.completed;\n        headerCheckbox.onchange = (e) => {\n        e.stopPropagation();\n        this.app.toggleElement(pageId, binId, elementIndex);\n        };\n\n        // Add dragover handler on checkbox to allow drops (required for input elements)\n        headerCheckbox.addEventListener('dragover', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n        // Let the parent div's dragover handler set the dropEffect\n        // We just need to prevent default to allow the drop\n        });\n\n        // Add drop handler on checkbox for nesting\n        headerCheckbox.addEventListener('drop', (e) => {\n        e.preventDefault();\n        e.stopPropagation();\n    \n        let dragData = this.app.appState.dragData;\n        if (!dragData) {\n        try {\n        const dataStr = e.dataTransfer.getData('text/plain');\n        if (dataStr) {\n        dragData = JSON.parse(dataStr);\n        } else {\n        console.error('No drag data available in checkbox drop');\n        return;\n        }\n        } catch (err) {\n        console.error('Failed to parse drag data:', err);\n        return;\n        }\n        }\n    \n        if (dragData && dragData.type === 'element') {\n        // Get the element index from the checkbox's parent element\n        const checkboxElement = headerCheckbox.closest('.element');\n        if (checkboxElement) {\n        const checkboxPageId = checkboxElement.dataset.pageId;\n        const actualBinId = checkboxElement.dataset.binId;\n        const checkboxElementIndexStr = checkboxElement.dataset.elementIndex;\n        let checkboxElementIndex = elementIndex;\n        if (checkboxElementIndexStr) {\n        if (typeof checkboxElementIndexStr === 'string' && checkboxElementIndexStr.includes('-')) {\n        checkboxElementIndex = parseInt(checkboxElementIndexStr.split('-')[0]);\n        } else {\n        checkboxElementIndex = parseInt(checkboxElementIndexStr);\n        }\n        }\n            \n        // When dropping on checkbox, always treat as regular element nesting (not child nesting)\n        // This ensures it becomes a direct child, not a grandchild\n        if (dragData.isChild && dragData.parentElementIndex !== null && dragData.childIndex !== null) {\n        // Un-nest the child first, then nest it as a regular element\n        const sourcePage = this.app.appState.documents?.find(p => p.id === dragData.pageId);\n        const sourceBin = sourcePage?.groups?.find(b => b.id === dragData.binId);\n        const items = sourceBin?.items || [];\n        if (sourceBin) {\n        sourceBin.items = items;\n        }\n        const itemIndex = ItemHierarchy.buildItemIndex(items);\n        const parentElement = ItemHierarchy.getRootItemAtIndex(items, dragData.parentElementIndex);\n        const childItems = parentElement ? ItemHierarchy.getChildItems(parentElement, itemIndex) : [];\n        const childElement = childItems[dragData.childIndex];\n        if (parentElement && childElement) {\n        if (!Array.isArray(parentElement.childIds)) parentElement.childIds = [];\n        parentElement.childIds.splice(dragData.childIndex, 1);\n        childElement.parentId = null;\n        // Now nest it as a regular element (not a child)\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.parentElementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        false, null, null, childElement);\n        } else {\n        // Fallback: use original logic\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n        }\n        } else {\n        // Source is already a regular element, nest normally\n        this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, checkboxPageId, actualBinId, checkboxElementIndex,\n        false, null, null);\n        }\n        }\n        }\n    \n        // Clear drag data\n        this.app.appState.dragData = null;\n        });\n\n        const headerText = document.createElement('span');\n        headerText.className = 'header-text';\n        const headerTextFragment = this.app.parseLinks(element.text);\n        headerText.appendChild(headerTextFragment);\n        // Clicking text enables inline editing instead of toggling checkbox\n        headerText.style.cursor = 'text';\n        headerText.addEventListener('click', (e) => {\n        // Don't enable editing if clicking on a link\n        if (e.target.tagName === 'A') {\n        return;\n        }\n        e.stopPropagation();\n        this.app.enableInlineEditing(headerText, pageId, binId, elementIndex, element);\n        });\n\n        div.appendChild(headerCheckbox);\n        div.appendChild(headerText);\n\n        // Prevent text click from firing when clicking checkbox\n        headerCheckbox.addEventListener('click', (e) => {\n            e.stopPropagation();\n        });\n\n        // Add tooltip hover handlers\n        let tooltipText = '';\n        if (element.timeAllocated) {\n            tooltipText += `Time: ${element.timeAllocated}`;\n        }\n        if (element.funModifier) {\n            tooltipText += tooltipText ? ` | Fun: ${element.funModifier}` : `Fun: ${element.funModifier}`;\n        }\n        if (tooltipText) {\n            div.addEventListener('mouseenter', () => {\n                this.app.showTooltip(tooltipText);\n            });\n            div.addEventListener('mouseleave', () => {\n                this.app.hideTooltip();\n            });\n        }\n\n        // Render children if they exist\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\n            if (childrenContainer) {\n                div.appendChild(childrenContainer);\n            }\n        }\n    }\n}","// MultiCheckboxRenderer.js - Handles multi-checkbox element rendering\r\n// MultiCheckboxRenderer.js - Extracted from ElementRenderer.js to improve modularity\r\nimport { eventBus } from '../EventBus.js';\r\nimport { EVENTS } from '../AppEvents.js';\r\n\r\n/**\r\n * MultiCheckboxRenderer - Handles rendering of multi-checkbox elements\r\n */\r\nexport class MultiCheckboxRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    /**\r\n     * Render a multi-checkbox element\r\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        const itemsHtml = element.items.map((item, itemIndex) => {\r\n        return `\r\n        <div class=\"multi-checkbox-row\" data-item-index=\"${itemIndex}\">\r\n        <input type=\"checkbox\" ${item.completed ? 'checked' : ''} \r\n        onchange=\"this.app.toggleElement('${pageId}', '${binId}', ${elementIndex}, null, ${itemIndex})\">\r\n        <span class=\"checkbox-label\">${this.app.escapeHtml(item.text)}</span>\r\n        ${element.items.length > 1 ? `<button onclick=\"app.removeMultiCheckboxItem('${pageId}', '${binId}', ${elementIndex}, ${itemIndex})\" style=\"padding: 2px 6px; font-size: 11px; background: #e74c3c;\"></button>` : ''}\r\n        </div>\r\n        `;\r\n        }).join('');\r\n\r\n        div.innerHTML = `\r\n        ${itemsHtml}\r\n        <div class=\"multi-checkbox-controls\">\r\n        <button onclick=\"app.addMultiCheckboxItem('${pageId}', '${binId}', ${elementIndex})\">+ Add</button>\r\n        </div>\r\n        `;\r\n\r\n        // Add event handlers for multi-checkbox items\r\n        element.items.forEach((item, itemIndex) => {\r\n        const row = div.querySelector(`.multi-checkbox-row[data-item-index=\"${itemIndex}\"]`);\r\n        if (row) {\r\n        const checkbox = row.querySelector('input[type=\"checkbox\"]');\r\n        if (checkbox) {\r\n        checkbox.onchange = (e) => {\r\n        e.stopPropagation();\r\n        const pageId = checkbox.dataset.pageId;\r\n        const elementIndex = parseInt(checkbox.dataset.elementIndex);\r\n        const itemIndex = parseInt(checkbox.dataset.itemIndex);\r\n        this.app.toggleElement(pageId, binId, elementIndex, null, itemIndex);\r\n        };\r\n        }\r\n        \r\n        if (item.funModifier) {\r\n        row.addEventListener('mouseenter', () => {\r\n        this.app.showTooltip(`Fun: ${item.funModifier}`);\r\n        });\r\n        row.addEventListener('mouseleave', () => {\r\n        this.app.hideTooltip();\r\n        });\r\n        }\r\n        }\r\n        });\r\n\r\n        // Add tooltip handler for the main element\r\n        let tooltipText = '';\r\n        if (element.timeAllocated) {\r\n            tooltipText += `Time: ${element.timeAllocated}`;\r\n        }\r\n        if (element.funModifier) {\r\n            tooltipText += tooltipText ? ` | Fun: ${element.funModifier}` : `Fun: ${element.funModifier}`;\r\n        }\r\n        if (tooltipText) {\r\n            div.addEventListener('mouseenter', () => {\r\n                this.app.showTooltip(tooltipText);\r\n            });\r\n            div.addEventListener('mouseleave', () => {\r\n                this.app.hideTooltip();\r\n            });\r\n        }\r\n\r\n        // Render children if they exist\r\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\r\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\r\n            if (childrenContainer) {\r\n                div.appendChild(childrenContainer);\r\n            }\r\n        }\r\n    }\r\n}","// AudioRenderer.js - Handles audio element rendering\r\n// AudioRenderer.js - Extracted from ElementRenderer.js to improve modularity\r\nimport { eventBus } from '../EventBus.js';\r\nimport { EVENTS } from '../AppEvents.js';\r\n\r\n/**\r\n * AudioRenderer - Handles rendering of audio elements\r\n */\r\nexport class AudioRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    /**\r\n     * Render a audio element\r\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        // Handle nested children - elementIndex might be a string like \"0-1\"\r\n        let audioPageId = pageId;\r\n        let audioElementIndex = elementIndex;\r\n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\r\n        // For nested children, use parent elementIndex for audio key\r\n        const parts = elementIndex.split('-');\r\n        audioElementIndex = parseInt(parts[0]);\r\n        } else {\r\n        audioElementIndex = parseInt(elementIndex);\r\n        }\r\n        const audioKey = `${audioPageId}-${binId}-${audioElementIndex}`;\r\n        const hasFile = element.audioFile && element.audioFile !== null;\r\n\r\n        // Create audio header container\r\n        const audioHeader = document.createElement('div');\r\n        audioHeader.className = 'task-header';\r\n\r\n        // Add checkbox for audio element\r\n        const audioCheckbox = document.createElement('input');\r\n        audioCheckbox.type = 'checkbox';\r\n        audioCheckbox.checked = element.completed || false;\r\n        audioCheckbox.onchange = (e) => {\r\n        e.stopPropagation();\r\n        this.app.toggleElement(pageId, binId, elementIndex);\r\n        };\r\n        // Prevent text click from firing when clicking checkbox\r\n        audioCheckbox.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        });\r\n        audioHeader.appendChild(audioCheckbox);\r\n\r\n        // Get recorder for button state\r\n        const recorder = this.app.appState.inlineAudioRecorders[audioKey];\r\n        const isRecording = recorder && recorder.recorder && recorder.recorder.state === 'recording';\r\n\r\n        // Audio status inline - reflect current state\r\n        const audioStatus = document.createElement('span');\r\n        audioStatus.className = 'audio-status';\r\n        audioStatus.style.fontSize = '12px';\r\n        audioStatus.style.marginLeft = '10px';\r\n        audioStatus.style.whiteSpace = 'nowrap';\r\n\r\n        // Set status text based on current state\r\n        if (isRecording) {\r\n        audioStatus.textContent = ' Recording...';\r\n        audioStatus.style.color = '#ff5555';\r\n        } else if (hasFile) {\r\n        // Show filename and date if available\r\n        const fileInfo = element.audioFile + (element.date ? ` (${element.date})` : '');\r\n        audioStatus.textContent = ` ${fileInfo}`;\r\n        audioStatus.style.color = '#888';\r\n        } else {\r\n        audioStatus.textContent = ' Ready to record';\r\n        audioStatus.style.color = '#888';\r\n        }\r\n        audioHeader.appendChild(audioStatus);\r\n\r\n        // Record button (always visible, toggles between start/stop/append)\r\n        // Store original elementIndex for DOM updates (may be string like \"0-1\" for nested children)\r\n        const originalElementIndex = elementIndex;\r\n        const recordBtn = this.app.styleButton(isRecording ? '' : '', async () => {\r\n        if (isRecording) {\r\n        await this.app.stopInlineRecording(audioPageId, binId, audioElementIndex, originalElementIndex);\r\n        } else {\r\n        // If file exists, automatically append; otherwise create new\r\n        if (hasFile) {\r\n        await this.app.appendInlineRecording(audioPageId, binId, audioElementIndex, originalElementIndex);\r\n        } else {\r\n        await this.app.startInlineRecording(audioPageId, binId, audioElementIndex, originalElementIndex);\r\n        }\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED); // Re-render to update button states\r\n        });\r\n        recordBtn.style.marginLeft = '8px';\r\n        // Make icon red, not the button background\r\n        recordBtn.style.color = '#ff5555';\r\n        if (isRecording) {\r\n        recordBtn.title = 'Stop recording';\r\n        } else {\r\n        recordBtn.title = hasFile ? 'Append to existing recording' : 'Start recording';\r\n        }\r\n        audioHeader.appendChild(recordBtn);\r\n\r\n        // Play/Stop controls (always visible)\r\n        const player = this.app.appState.inlineAudioPlayers[audioKey];\r\n        const isPlaying = player && player.audio && !player.audio.paused;\r\n        const playStopBtn = this.app.styleButton(isPlaying ? '' : '', () => {\r\n        if (isPlaying) {\r\n        this.app.stopInlineAudio(audioPageId, binId, audioElementIndex);\r\n        } else {\r\n        this.app.playInlineAudio(audioPageId, binId, audioElementIndex);\r\n        }\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED); // Re-render to update button state\r\n        });\r\n        playStopBtn.style.marginLeft = '4px';\r\n        if (!hasFile) {\r\n        playStopBtn.disabled = true;\r\n        playStopBtn.style.opacity = '0.5';\r\n        }\r\n        audioHeader.appendChild(playStopBtn);\r\n\r\n        div.appendChild(audioHeader);\r\n\r\n        // Audio progress bar (shown during playback)\r\n        const progressBarContainer = document.createElement('div');\r\n        progressBarContainer.className = 'audio-progress-container';\r\n        progressBarContainer.id = `audio-progress-${audioKey}`;\r\n        progressBarContainer.style.display = isPlaying ? 'block' : 'none';\r\n        progressBarContainer.style.marginTop = '8px';\r\n        progressBarContainer.style.marginLeft = '10px';\r\n        progressBarContainer.style.marginRight = '10px';\r\n\r\n        const audioProgressBarInput = document.createElement('input');\r\n        audioProgressBarInput.type = 'range';\r\n        audioProgressBarInput.min = '0';\r\n        audioProgressBarInput.max = '100';\r\n        audioProgressBarInput.value = '0';\r\n        audioProgressBarInput.step = '0.1';\r\n        audioProgressBarInput.className = 'audio-progress-bar';\r\n        audioProgressBarInput.style.width = '100%';\r\n        audioProgressBarInput.style.height = '4px';\r\n        audioProgressBarInput.style.background = '#404040';\r\n        audioProgressBarInput.style.borderRadius = '2px';\r\n        audioProgressBarInput.style.outline = 'none';\r\n        audioProgressBarInput.style.cursor = 'pointer';\r\n    \r\n        // Style the progress bar thumb\r\n        audioProgressBarInput.style.setProperty('-webkit-appearance', 'none');\r\n        audioProgressBarInput.style.setProperty('appearance', 'none');\r\n\r\n        // Webkit thumb styling\r\n        const style = document.createElement('style');\r\n        style.textContent = `\r\n        .audio-progress-bar::-webkit-slider-thumb {\r\n        appearance: none;\r\n        width: 12px;\r\n        height: 12px;\r\n        background: #4a9eff;\r\n        border-radius: 50%;\r\n        cursor: pointer;\r\n        }\r\n        .audio-progress-bar::-moz-range-thumb {\r\n        width: 12px;\r\n        height: 12px;\r\n        background: #4a9eff;\r\n        border-radius: 50%;\r\n        cursor: pointer;\r\n        border: none;\r\n        }\r\n        `;\r\n        if (!document.getElementById('audio-progress-bar-styles')) {\r\n        style.id = 'audio-progress-bar-styles';\r\n        document.head.appendChild(style);\r\n        }\r\n\r\n        // Progress bar will be set up when playback starts\r\n\r\n        progressBarContainer.appendChild(audioProgressBarInput);\r\n        div.appendChild(progressBarContainer);\r\n\r\n        // Render children if they exist\r\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\r\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\r\n            if (childrenContainer) {\r\n                div.appendChild(childrenContainer);\r\n            }\r\n        }\r\n    }\r\n}","// TimerRenderer.js - Handles timer element rendering\n// TimerRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\n\n/**\n * TimerRenderer - Handles rendering of timer elements\n */\nexport class TimerRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a timer element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const getTimerElement = () => {\n            const document = this.app.appState.documents?.find(page => page.id === pageId);\n            const group = document?.groups?.find(bin => bin.id === binId);\n            if (!group) return null;\n            const items = group.items || [];\n            group.items = items;\n            return items[elementIndex];\n        };\n\n        // Initialize timer state if needed\n        if (element.duration === undefined) element.duration = 3600;\n        if (element.elapsed === undefined) element.elapsed = 0;\n        if (element.running === undefined) element.running = false;\n        if (element.pausedAt === undefined) element.pausedAt = 0;\n        if (element.alarmSound === undefined || element.alarmSound === null) element.alarmSound = '/sounds/alarm.mp3';\n        if (element.alarmPlaying === undefined) element.alarmPlaying = false;\n        if (element.completed === undefined) element.completed = false;\n\n        // Restore running timer state if it was running when saved\n        if (element.running && !element.intervalId) {\n        element.startTime = Date.now() - (element.elapsed * 1000);\n        element.intervalId = setInterval(() => {\n        const timerElement = getTimerElement();\n        if (!timerElement || !timerElement.running) return;\n\n        timerElement.elapsed = Math.floor((Date.now() - timerElement.startTime) / 1000) + timerElement.pausedAt;\n        updateTimerDisplay();\n\n        // Autosave timer state every 5 seconds\n        const currentTime = Date.now();\n        if (!timerElement.lastSaveTime || currentTime - timerElement.lastSaveTime >= 5000) {\n        timerElement.lastSaveTime = currentTime;\n        this.app.dataManager.saveData();\n        }\n\n        // Check if timer reached duration\n        if (timerElement.elapsed >= timerElement.duration) {\n        timerElement.elapsed = timerElement.duration;\n        timerElement.running = false;\n        if (timerElement.intervalId) {\n        clearInterval(timerElement.intervalId);\n        timerElement.intervalId = null;\n        }\n        updateTimerDisplay();\n\n        // Play looping alarm sound if set and not already playing and checkbox not checked\n        if (timerElement.alarmSound && !timerElement.alarmPlaying && !timerElement.completed) {\n        const audio = new Audio(timerElement.alarmSound);\n        audio.loop = true;\n        audio.play().then(() => {\n        timerElement.alarmPlaying = true;\n        timerElement.alarmAudio = audio;\n        }).catch(err => console.log('Alarm play failed:', err));\n        }\n        }\n        }, 100);\n        }\n\n        // Create timer header container (like task elements)\n        const timerHeader = document.createElement('div');\n        timerHeader.className = 'task-header';\n        timerHeader.style.position = 'relative';\n\n        // Create progress bar background\n        const progressBar = document.createElement('div');\n        progressBar.className = 'timer-progress-bar';\n        progressBar.style.position = 'absolute';\n        progressBar.style.top = '0';\n        progressBar.style.left = '0';\n        progressBar.style.width = '0%';\n        progressBar.style.height = '100%';\n        progressBar.style.backgroundColor = 'rgba(74, 158, 255, 0.3)';\n        progressBar.style.transition = 'width 0.1s linear';\n        progressBar.style.pointerEvents = 'none';\n        progressBar.style.zIndex = '0';\n        timerHeader.appendChild(progressBar);\n\n        // Add checkbox\n        const timerCheckbox = document.createElement('input');\n        timerCheckbox.type = 'checkbox';\n        timerCheckbox.checked = element.completed || false;\n        // Prevent text click from firing when clicking checkbox\n        timerCheckbox.addEventListener('click', (e) => {\n        e.stopPropagation();\n        });\n        timerHeader.appendChild(timerCheckbox);\n\n        // Timer display and controls inline (need to define before checkbox handler)\n        const timerDisplay = document.createElement('span');\n        timerDisplay.className = 'timer-display';\n        timerDisplay.style.fontSize = '14px';\n        timerDisplay.style.fontWeight = 'bold';\n        timerDisplay.style.marginLeft = '10px';\n        timerDisplay.style.whiteSpace = 'nowrap';\n\n        const updateTimerDisplay = () => {\n        const remaining = Math.max(0, element.duration - element.elapsed);\n        const hours = Math.floor(remaining / 3600);\n        const minutes = Math.floor((remaining % 3600) / 60);\n        const seconds = remaining % 60;\n        timerDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\n    \n        // Update progress bar\n        const progress = element.duration > 0 ? (element.elapsed / element.duration) * 100 : 0;\n        progressBar.style.width = `${Math.min(100, progress)}%`;\n        };\n        updateTimerDisplay();\n        timerHeader.appendChild(timerDisplay);\n\n        // Start/Stop button inline (need to define before checkbox handler)\n        const timerStartStopBtn = this.app.styleButton(element.running ? '' : '', (e) => {\n        e.stopPropagation();\n        const timerElement = getTimerElement();\n        if (!timerElement) return;\n    \n        if (timerElement.running) {\n        // Pause\n        timerElement.running = false;\n        timerElement.pausedAt = timerElement.elapsed;\n        if (timerElement.intervalId) {\n        clearInterval(timerElement.intervalId);\n        timerElement.intervalId = null;\n        }\n        timerStartStopBtn.textContent = '';\n        } else {\n        // Start\n        timerElement.running = true;\n        timerElement.startTime = Date.now() - (timerElement.elapsed * 1000);\n        timerElement.intervalId = setInterval(() => {\n        const timerElement = getTimerElement();\n        if (!timerElement || !timerElement.running) return;\n            \n        timerElement.elapsed = Math.floor((Date.now() - timerElement.startTime) / 1000) + timerElement.pausedAt;\n        updateTimerDisplay();\n\n        // Autosave timer state every 5 seconds\n        const currentTime = Date.now();\n        if (!timerElement.lastSaveTime || currentTime - timerElement.lastSaveTime >= 5000) {\n        timerElement.lastSaveTime = currentTime;\n        this.app.dataManager.saveData();\n        }\n            \n        // Check if timer reached duration\n        if (timerElement.elapsed >= timerElement.duration) {\n        timerElement.elapsed = timerElement.duration;\n        timerElement.running = false;\n        if (timerElement.intervalId) {\n        clearInterval(timerElement.intervalId);\n        timerElement.intervalId = null;\n        }\n        updateTimerDisplay();\n        timerStartStopBtn.textContent = '';\n                \n        // Play looping alarm sound if set and not already playing and checkbox not checked\n        if (timerElement.alarmSound && !timerElement.alarmPlaying && !timerElement.completed) {\n        const audio = new Audio(timerElement.alarmSound);\n        audio.loop = true;\n        audio.play().then(() => {\n        timerElement.alarmPlaying = true;\n        timerElement.alarmAudio = audio;\n        }).catch(err => console.log('Alarm play failed:', err));\n        }\n        }\n        }, 100);\n        timerStartStopBtn.textContent = '';\n        }\n        this.app.dataManager.saveData();\n        });\n        timerStartStopBtn.style.marginLeft = '8px';\n        timerHeader.appendChild(timerStartStopBtn);\n\n        // Now set up the checkbox handler (after timerStartStopBtn is defined)\n        timerCheckbox.onchange = (e) => {\n        e.stopPropagation();\n        const timerElement = getTimerElement();\n        if (!timerElement) return;\n    \n        timerElement.completed = timerCheckbox.checked;\n    \n        if (timerElement.completed) {\n        // Checkbox checked - stop alarm if playing\n        if (timerElement.alarmPlaying && timerElement.alarmAudio) {\n        timerElement.alarmAudio.pause();\n        timerElement.alarmAudio.currentTime = 0;\n        timerElement.alarmPlaying = false;\n        timerElement.alarmAudio = null;\n        }\n        } else {\n        // Checkbox unchecked - reset timer and stop alarm (don't restart)\n        timerElement.running = false;\n        timerElement.elapsed = 0;\n        timerElement.pausedAt = 0;\n        timerElement.completed = false;\n        if (timerElement.intervalId) {\n        clearInterval(timerElement.intervalId);\n        timerElement.intervalId = null;\n        }\n        if (timerElement.alarmPlaying && timerElement.alarmAudio) {\n        timerElement.alarmAudio.pause();\n        timerElement.alarmAudio.currentTime = 0;\n        timerElement.alarmPlaying = false;\n        timerElement.alarmAudio = null;\n        }\n        updateTimerDisplay();\n        timerStartStopBtn.textContent = '';\n        }\n        this.app.dataManager.saveData();\n        };\n\n        // Reset button inline\n        const timerResetBtn = this.app.styleButton('', (e) => {\n        e.stopPropagation();\n        const page = this.app.appState.documents.find(p => p.id === pageId);\n        const bin = page?.groups?.find(b => b.id === binId);\n        const timerElement = bin?.items?.[elementIndex];\n        if (!timerElement) return;\n    \n        // Stop timer and reset to zero\n        timerElement.running = false;\n        timerElement.elapsed = 0;\n        timerElement.pausedAt = 0;\n        timerElement.completed = false;\n        if (timerElement.intervalId) {\n        clearInterval(timerElement.intervalId);\n        timerElement.intervalId = null;\n        }\n        if (timerElement.alarmPlaying && timerElement.alarmAudio) {\n        timerElement.alarmAudio.pause();\n        timerElement.alarmAudio.currentTime = 0;\n        timerElement.alarmPlaying = false;\n        timerElement.alarmAudio = null;\n        }\n        updateTimerDisplay();\n        timerStartStopBtn.textContent = '';\n        this.app.dataManager.saveData();\n        });\n        timerResetBtn.style.marginLeft = '4px';\n        timerResetBtn.title = 'Reset timer';\n        timerHeader.appendChild(timerResetBtn);\n\n        div.appendChild(timerHeader);\n    }\n}","// CounterRenderer.js - Handles counter element rendering\n// CounterRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\n\n/**\n * CounterRenderer - Handles rendering of counter elements\n */\nexport class CounterRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a counter element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const getCounterElement = () => {\n        const document = this.app.appState.documents?.find(page => page.id === pageId);\n        const group = document?.groups?.find(bin => bin.id === binId);\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return items[elementIndex];\n        };\n        // Create counter header container (like task elements)\n        const counterHeader = document.createElement('div');\n        counterHeader.className = 'task-header';\n\n        // Add checkbox\n        const counterCheckbox = document.createElement('input');\n        counterCheckbox.type = 'checkbox';\n        counterCheckbox.checked = element.completed || false;\n        counterCheckbox.onchange = (e) => {\n        e.stopPropagation();\n        this.app.toggleElement(pageId, binId, elementIndex);\n        };\n        counterHeader.appendChild(counterCheckbox);\n\n        // Add title text only if it has a custom title\n        const counterHasCustomTitle = element.text && element.text.trim() && element.text.trim() !== 'Counter';\n        if (counterHasCustomTitle) {\n        const counterTextSpan = document.createElement('span');\n        counterTextSpan.className = 'task-text';\n        const counterTextFragment = this.app.parseLinks(element.text);\n        counterTextSpan.appendChild(counterTextFragment);\n        // Clicking text enables inline editing instead of toggling checkbox\n        counterTextSpan.style.cursor = 'text';\n        counterTextSpan.addEventListener('click', (e) => {\n        // Don't enable editing if clicking on a link\n        if (e.target.tagName === 'A') {\n        return;\n        }\n        e.stopPropagation();\n        this.app.enableInlineEditing(counterTextSpan, pageId, binId, elementIndex, element);\n        });\n        counterHeader.appendChild(counterTextSpan);\n        }\n\n        // Prevent text click from firing when clicking checkbox\n        counterCheckbox.addEventListener('click', (e) => {\n        e.stopPropagation();\n        });\n\n        div.appendChild(counterHeader);\n\n        // Counter display and controls\n        const counterControls = document.createElement('div');\n        counterControls.className = 'counter-controls';\n        counterControls.style.display = 'flex';\n        counterControls.style.alignItems = 'center';\n        counterControls.style.gap = '10px';\n        counterControls.style.marginTop = '10px';\n\n        // Decrement button\n        const decBtn = document.createElement('button');\n        decBtn.textContent = '';\n        decBtn.style.fontSize = '20px';\n        decBtn.onclick = (e) => {\n        e.stopPropagation();\n        const counterElement = getCounterElement();\n        if (counterElement) {\n        counterElement.value = Math.max(0, counterElement.value - counterElement.increment1);\n        valueDisplay.textContent = counterElement.value;\n        this.app.dataManager.saveData();\n        }\n        };\n        counterControls.appendChild(decBtn);\n\n        // Value display\n        const valueDisplay = document.createElement('span');\n        valueDisplay.className = 'counter-value';\n        valueDisplay.textContent = element.value || 0;\n        valueDisplay.style.fontSize = '24px';\n        valueDisplay.style.fontWeight = 'bold';\n        valueDisplay.style.minWidth = '60px';\n        valueDisplay.style.textAlign = 'center';\n        counterControls.appendChild(valueDisplay);\n\n        // Increment button\n        const incBtn = document.createElement('button');\n        incBtn.textContent = '+';\n        incBtn.style.fontSize = '20px';\n        incBtn.onclick = (e) => {\n        e.stopPropagation();\n        const counterElement = getCounterElement();\n        if (counterElement) {\n        counterElement.value = (counterElement.value || 0) + counterElement.increment1;\n        valueDisplay.textContent = counterElement.value;\n        this.app.dataManager.saveData();\n        }\n        };\n        counterControls.appendChild(incBtn);\n\n        // Custom increment buttons\n        const customInc5 = document.createElement('button');\n        customInc5.textContent = `+${element.increment5 || 5}`;\n        customInc5.onclick = (e) => {\n        e.stopPropagation();\n        const counterElement = getCounterElement();\n        if (counterElement) {\n        counterElement.value = (counterElement.value || 0) + (counterElement.increment5 || 5);\n        valueDisplay.textContent = counterElement.value;\n        this.app.dataManager.saveData();\n        }\n        };\n        counterControls.appendChild(customInc5);\n\n        const customInc = document.createElement('button');\n        customInc.textContent = `+${element.customIncrement || 10}`;\n        customInc.onclick = (e) => {\n        e.stopPropagation();\n        const counterElement = getCounterElement();\n        if (counterElement) {\n        counterElement.value = (counterElement.value || 0) + (counterElement.customIncrement || 10);\n        valueDisplay.textContent = counterElement.value;\n        this.app.dataManager.saveData();\n        }\n        };\n        counterControls.appendChild(customInc);\n\n        div.appendChild(counterControls);\n\n        // Render children if they exist\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\n            if (childrenContainer) {\n                div.appendChild(childrenContainer);\n            }\n        }\n    }\n}","// TrackerRenderer.js - Handles tracker element rendering\r\n// TrackerRenderer.js - Extracted from ElementRenderer.js to improve modularity\r\nimport { eventBus } from '../EventBus.js';\r\nimport { EVENTS } from '../AppEvents.js';\r\n\r\n/**\r\n * TrackerRenderer - Handles rendering of tracker elements\r\n */\r\nexport class TrackerRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    /**\r\n     * Render a tracker element\r\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        // Initialize tracker state if needed\r\n        if (element.mode === undefined) element.mode = 'daily';\r\n        if (element.dailyCompletions === undefined) element.dailyCompletions = {};\r\n        if (element.pageCompletions === undefined) element.pageCompletions = {};\r\n\r\n        // Create tracker header container\r\n        const trackerHeader = document.createElement('div');\r\n        trackerHeader.className = 'task-header';\r\n\r\n        // Add checkbox\r\n        const trackerCheckbox = document.createElement('input');\r\n        trackerCheckbox.type = 'checkbox';\r\n        trackerCheckbox.checked = element.completed || false;\r\n        trackerCheckbox.onchange = (e) => {\r\n        e.stopPropagation();\r\n        this.app.toggleElement(pageId, binId, elementIndex);\r\n        };\r\n        trackerHeader.appendChild(trackerCheckbox);\r\n\r\n        // Add title text only if it has a custom title\r\n        const trackerHasCustomTitle = element.text && element.text.trim() && element.text.trim() !== 'Tracker';\r\n        if (trackerHasCustomTitle) {\r\n        const trackerTextSpan = document.createElement('span');\r\n        trackerTextSpan.className = 'task-text';\r\n        const trackerTextFragment = this.app.parseLinks(element.text);\r\n        trackerTextSpan.appendChild(trackerTextFragment);\r\n        // Clicking text enables inline editing instead of toggling checkbox\r\n        trackerTextSpan.style.cursor = 'text';\r\n        trackerTextSpan.addEventListener('click', (e) => {\r\n        // Don't enable editing if clicking on a link\r\n        if (e.target.tagName === 'A') {\r\n        return;\r\n        }\r\n        e.stopPropagation();\r\n        this.app.enableInlineEditing(trackerTextSpan, pageId, binId, elementIndex, element);\r\n        });\r\n        trackerHeader.appendChild(trackerTextSpan);\r\n        }\r\n\r\n        // Prevent text click from firing when clicking checkbox\r\n        trackerCheckbox.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        });\r\n\r\n        // Tracker display inline\r\n        const trackerDisplay = document.createElement('span');\r\n        trackerDisplay.className = 'tracker-display';\r\n        trackerDisplay.style.fontSize = '12px';\r\n        trackerDisplay.style.marginLeft = '10px';\r\n        trackerDisplay.style.whiteSpace = 'nowrap';\r\n\r\n        const updateTrackerDisplay = () => {\r\n        if (element.mode === 'daily') {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const todayData = element.dailyCompletions[today];\r\n        const count = todayData?._count || (todayData ? Object.keys(todayData).filter(k => k !== '_count').length : 0);\r\n        trackerDisplay.textContent = `${count} today`;\r\n        } else {\r\n        // Page mode - count unique checked elements in the page\r\n        const count = element.pageCompletions?.count || 0;\r\n        trackerDisplay.textContent = `${count} page`;\r\n        }\r\n        };\r\n        updateTrackerDisplay();\r\n        trackerHeader.appendChild(trackerDisplay);\r\n\r\n        div.appendChild(trackerHeader);\r\n    }\r\n}","// RatingRenderer.js - Handles rating element rendering\n// RatingRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\n\n/**\n * RatingRenderer - Handles rendering of rating elements\n */\nexport class RatingRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a rating element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const getRatingElement = () => {\n        const document = this.app.appState.documents?.find(page => page.id === pageId);\n        const group = document?.groups?.find(bin => bin.id === binId);\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return items[elementIndex];\n        };\n        // Initialize rating state if needed\n        if (element.rating === undefined) element.rating = 0;\n        if (element.review === undefined) element.review = '';\n\n        // Create rating header container\n        const ratingHeader = document.createElement('div');\n        ratingHeader.className = 'task-header';\n\n        // Add checkbox\n        const ratingCheckbox = document.createElement('input');\n        ratingCheckbox.type = 'checkbox';\n        ratingCheckbox.checked = element.completed || false;\n        ratingCheckbox.onchange = (e) => {\n        e.stopPropagation();\n        this.app.toggleElement(pageId, binId, elementIndex);\n        };\n        // Prevent text click from firing when clicking checkbox\n        ratingCheckbox.addEventListener('click', (e) => {\n        e.stopPropagation();\n        });\n        ratingHeader.appendChild(ratingCheckbox);\n\n        // Rating stars inline\n        const starsContainer = document.createElement('span');\n        starsContainer.style.display = 'inline-flex';\n        starsContainer.style.gap = '2px';\n        starsContainer.style.marginLeft = '10px';\n        starsContainer.style.alignItems = 'center';\n\n        for (let i = 1; i <= 5; i++) {\n        const star = document.createElement('span');\n        star.textContent = i <= (element.rating || 0) ? '' : '';\n        star.style.fontSize = '16px';\n        star.style.cursor = 'pointer';\n        star.style.color = i <= (element.rating || 0) ? '#ffd700' : '#888';\n        star.onclick = (e) => {\n        e.stopPropagation();\n        const ratingElement = getRatingElement();\n        if (ratingElement) {\n        ratingElement.rating = i;\n        // Update all stars\n        starsContainer.querySelectorAll('span').forEach((s, idx) => {\n        s.textContent = idx + 1 <= i ? '' : '';\n        s.style.color = idx + 1 <= i ? '#ffd700' : '#888';\n        });\n        this.app.dataManager.saveData();\n        }\n        };\n        starsContainer.appendChild(star);\n        }\n        ratingHeader.appendChild(starsContainer);\n\n        div.appendChild(ratingHeader);\n    }\n}","// TimeLogRenderer.js - Handles time-log element rendering\n// TimeLogRenderer.js - Extracted from ElementRenderer.js to improve modularity\nimport { eventBus } from '../EventBus.js';\nimport { EVENTS } from '../AppEvents.js';\n\n/**\n * TimeLogRenderer - Handles rendering of time-log elements\n */\nexport class TimeLogRenderer {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Render a time-log element\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index\n     * @param {number} depth - Current nesting depth\n     * @param {Function} renderChildren - Function to render children elements\n     * @returns {void}\n     */\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\n        const getTimeLogElement = () => {\n        const document = this.app.appState.documents?.find(page => page.id === pageId);\n        const group = document?.groups?.find(bin => bin.id === binId);\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return items[elementIndex];\n        };\n        // Initialize time-log state if needed\n        if (element.totalTime === undefined) element.totalTime = 0;\n        if (element.isRunning === undefined) element.isRunning = false;\n        if (element.startTime === undefined) element.startTime = null;\n        if (element.sessions === undefined) element.sessions = [];\n\n        // Create time-log header container\n        const timeLogHeader = document.createElement('div');\n        timeLogHeader.className = 'task-header';\n\n        // Add checkbox\n        const timeLogCheckbox = document.createElement('input');\n        timeLogCheckbox.type = 'checkbox';\n        timeLogCheckbox.checked = element.completed || false;\n        timeLogCheckbox.onchange = (e) => {\n        e.stopPropagation();\n        this.app.toggleElement(pageId, binId, elementIndex);\n        };\n        // Prevent text click from firing when clicking checkbox\n        timeLogCheckbox.addEventListener('click', (e) => {\n        e.stopPropagation();\n        });\n        timeLogHeader.appendChild(timeLogCheckbox);\n\n        // Time display inline\n        const timeDisplay = document.createElement('span');\n        timeDisplay.className = 'time-log-display';\n        timeDisplay.style.fontSize = '14px';\n        timeDisplay.style.fontWeight = 'bold';\n        timeDisplay.style.marginLeft = '10px';\n        timeDisplay.style.whiteSpace = 'nowrap';\n\n        const updateTimeDisplay = () => {\n        const totalSeconds = element.totalTime || 0;\n        const hours = Math.floor(totalSeconds / 3600);\n        const minutes = Math.floor((totalSeconds % 3600) / 60);\n        const seconds = totalSeconds % 60;\n        timeDisplay.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\n        };\n        updateTimeDisplay();\n        timeLogHeader.appendChild(timeDisplay);\n\n        // Start/Stop button inline\n        const timeLogStartStopBtn = this.app.styleButton(element.isRunning ? '' : '', (e) => {\n        e.stopPropagation();\n        const timeLogElement = getTimeLogElement();\n        if (!timeLogElement) return;\n    \n        if (timeLogElement.isRunning) {\n        // Stop\n        timeLogElement.isRunning = false;\n        if (timeLogElement.intervalId) {\n        clearInterval(timeLogElement.intervalId);\n        timeLogElement.intervalId = null;\n        }\n        timeLogStartStopBtn.textContent = '';\n        } else {\n        // Start\n        timeLogElement.isRunning = true;\n        timeLogElement.startTime = Date.now();\n        timeLogStartStopBtn.textContent = '';\n        \n        // Update display every second\n        timeLogElement.intervalId = setInterval(() => {\n        const timeLogElement = getTimeLogElement();\n        if (!timeLogElement || !timeLogElement.isRunning) return;\n\n        timeLogElement.totalTime = Math.floor((Date.now() - timeLogElement.startTime) / 1000) +\n        (timeLogElement.pausedTotalTime || 0);\n        updateTimeDisplay();\n        }, 1000);\n        }\n        this.app.dataManager.saveData();\n        });\n\n        div.appendChild(timeLogHeader);\n    }\n}","// ImageRenderer.js - Handles image element rendering\r\n// ImageRenderer.js - Extracted from ElementRenderer.js to improve modularity\r\nimport { eventBus } from '../EventBus.js';\r\nimport { EVENTS } from '../AppEvents.js';\r\n\r\n/**\r\n * ImageRenderer - Handles rendering of image elements\r\n */\r\nexport class ImageRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    /**\r\n     * Render a image element\r\n     * @param {HTMLElement} div - The element container div (already created with classes and drag handlers)\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    render(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        if (element.imageUrl === undefined) element.imageUrl = null;\r\n        if (element.imageAlignment === undefined) element.imageAlignment = 'left';\r\n        if (element.imageWidth === undefined) element.imageWidth = 300; // Default width\r\n\r\n        const imageHeader = document.createElement('div');\r\n        imageHeader.className = 'task-header';\r\n        imageHeader.style.display = 'flex';\r\n        imageHeader.style.alignItems = 'center';\r\n        imageHeader.style.gap = '8px';\r\n        imageHeader.style.flexWrap = 'nowrap';\r\n\r\n        // Add checkbox\r\n        const imageCheckbox = document.createElement('input');\r\n        imageCheckbox.type = 'checkbox';\r\n        imageCheckbox.checked = element.completed || false;\r\n        imageCheckbox.onchange = (e) => {\r\n        e.stopPropagation();\r\n        this.app.toggleElement(pageId, binId, elementIndex);\r\n        };\r\n        // Prevent text click from firing when clicking checkbox\r\n        imageCheckbox.addEventListener('click', (e) => {\r\n        e.stopPropagation();\r\n        });\r\n        imageHeader.appendChild(imageCheckbox);\r\n\r\n        const imageText = element.text || '';\r\n        const shouldShowImageTitle = imageText.trim() && imageText.trim() !== 'Image';\r\n\r\n        if (shouldShowImageTitle) {\r\n        const imageTextSpan = document.createElement('span');\r\n        imageTextSpan.className = 'task-text';\r\n        imageTextSpan.style.flex = '0 0 auto';\r\n        const imageTextFragment = this.app.parseLinks(imageText);\r\n        imageTextSpan.appendChild(imageTextFragment);\r\n        // Clicking text enables inline editing instead of toggling checkbox\r\n        imageTextSpan.style.cursor = 'text';\r\n        imageTextSpan.addEventListener('click', (e) => {\r\n        // Don't enable editing if clicking on a link\r\n        if (e.target.tagName === 'A') {\r\n        return;\r\n        }\r\n        e.stopPropagation();\r\n        this.app.enableInlineEditing(imageTextSpan, pageId, binId, elementIndex, element);\r\n        });\r\n        imageHeader.appendChild(imageTextSpan);\r\n        }\r\n\r\n        const imageControls = document.createElement('div');\r\n        imageControls.style.display = 'flex';\r\n        imageControls.style.gap = '5px';\r\n        imageControls.style.marginLeft = shouldShowImageTitle ? '10px' : '0';\r\n        imageControls.style.flexShrink = '0';\r\n\r\n        // Alignment buttons\r\n        const alignLeftBtn = this.app.styleButton('', () => {\r\n        element.imageAlignment = 'left';\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n        const alignCenterBtn = this.app.styleButton('', () => {\r\n        element.imageAlignment = 'center';\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n        const alignRightBtn = this.app.styleButton('', () => {\r\n        element.imageAlignment = 'right';\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n        imageControls.appendChild(alignLeftBtn);\r\n        imageControls.appendChild(alignCenterBtn);\r\n        imageControls.appendChild(alignRightBtn);\r\n\r\n        // Size input\r\n        const sizeInput = document.createElement('input');\r\n        sizeInput.type = 'number';\r\n        sizeInput.value = element.imageWidth;\r\n        sizeInput.min = '50';\r\n        sizeInput.max = '1000';\r\n        sizeInput.style.width = '60px';\r\n        sizeInput.style.padding = '4px';\r\n        sizeInput.style.border = '1px solid #555';\r\n        sizeInput.style.background = 'transparent';\r\n        sizeInput.style.color = '#e0e0e0';\r\n        sizeInput.style.borderRadius = '4px';\r\n        sizeInput.onchange = (e) => {\r\n        element.imageWidth = parseInt(e.target.value) || 300;\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        };\r\n        imageControls.appendChild(sizeInput);\r\n\r\n        if (element.imageUrl) {\r\n        const removeImageBtn = this.app.styleButton('Remove Image', () => {\r\n        element.imageUrl = null;\r\n        element.text = 'Image'; // Reset text\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        });\r\n        imageControls.appendChild(removeImageBtn);\r\n        }\r\n\r\n        imageHeader.appendChild(imageControls);\r\n        div.appendChild(imageHeader);\r\n\r\n        // Image display\r\n        if (element.imageUrl) {\r\n        const imgContainer = document.createElement('div');\r\n        imgContainer.style.display = 'flex';\r\n        imgContainer.style.justifyContent = element.imageAlignment === 'left' ? 'flex-start' :\r\n        element.imageAlignment === 'center' ? 'center' : 'flex-end';\r\n        imgContainer.style.marginTop = '10px';\r\n\r\n        const img = document.createElement('img');\r\n        img.src = element.imageUrl;\r\n        img.style.maxWidth = '100%';\r\n        img.style.height = 'auto';\r\n        img.style.width = `${element.imageWidth}px`;\r\n        img.style.borderRadius = '4px';\r\n        img.style.boxShadow = '0 2px 8px rgba(0,0,0,0.3)';\r\n        img.style.cursor = 'pointer';\r\n        img.onclick = () => window.open(element.imageUrl, '_blank');\r\n\r\n        imgContainer.appendChild(img);\r\n        div.appendChild(imgContainer);\r\n        } else {\r\n        // Placeholder for image upload\r\n        const uploadArea = document.createElement('div');\r\n        uploadArea.style.border = '2px dashed #555';\r\n        uploadArea.style.borderRadius = '8px';\r\n        uploadArea.style.padding = '20px';\r\n        uploadArea.style.textAlign = 'center';\r\n        uploadArea.style.color = '#888';\r\n        uploadArea.style.cursor = 'pointer';\r\n        uploadArea.style.marginTop = '10px';\r\n        uploadArea.textContent = 'Drag & drop an image here, or click to upload';\r\n\r\n        uploadArea.onclick = () => {\r\n        const fileInput = document.getElementById('file-input-images-json');\r\n        fileInput.click();\r\n        };\r\n\r\n        // Handle file input change\r\n        const fileInput = document.getElementById('file-input-images-json');\r\n        fileInput.onchange = (e) => {\r\n        const file = e.target.files[0];\r\n        if (file && file.type.startsWith('image/')) {\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n        element.imageUrl = event.target.result;\r\n        element.text = file.name.split('.').slice(0, -1).join('.'); // Set title to filename\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        };\r\n        reader.readAsDataURL(file);\r\n        }\r\n        };\r\n\r\n        // Handle drag and drop\r\n        uploadArea.addEventListener('dragover', (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        uploadArea.style.borderColor = '#4a9eff';\r\n        });\r\n\r\n        uploadArea.addEventListener('dragleave', (e) => {\r\n        e.stopPropagation();\r\n        uploadArea.style.borderColor = '#555';\r\n        });\r\n\r\n        uploadArea.addEventListener('drop', (e) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        uploadArea.style.borderColor = '#555';\r\n        const file = e.dataTransfer.files[0];\r\n        if (file && file.type.startsWith('image/')) {\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n        element.imageUrl = event.target.result;\r\n        element.text = file.name.split('.').slice(0, -1).join('.'); // Set title to filename\r\n        this.app.dataManager.saveData();\r\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n        };\r\n        reader.readAsDataURL(file);\r\n        } else {\r\n        alert('Please drop an image file.');\r\n        }\r\n        });\r\n\r\n        div.appendChild(uploadArea);\r\n        }\r\n\r\n        // Render children if they exist\r\n        if (Array.isArray(element.childIds) && element.childIds.length > 0) {\r\n            const childrenContainer = renderChildren(pageId, binId, element, elementIndex, depth);\r\n            if (childrenContainer) {\r\n                div.appendChild(childrenContainer);\r\n            }\r\n        }\r\n    }\r\n}","// ElementTypeRegistry.js - Registry for element type renderers\r\n// Maps element types to their renderer classes\r\nimport { TaskRenderer } from './TaskRenderer.js';\r\nimport { HeaderRenderer } from './HeaderRenderer.js';\r\nimport { HeaderCheckboxRenderer } from './HeaderCheckboxRenderer.js';\r\nimport { MultiCheckboxRenderer } from './MultiCheckboxRenderer.js';\r\nimport { AudioRenderer } from './AudioRenderer.js';\r\nimport { TimerRenderer } from './TimerRenderer.js';\r\nimport { CounterRenderer } from './CounterRenderer.js';\r\nimport { TrackerRenderer } from './TrackerRenderer.js';\r\nimport { RatingRenderer } from './RatingRenderer.js';\r\nimport { TimeLogRenderer } from './TimeLogRenderer.js';\r\nimport { ImageRenderer } from './ImageRenderer.js';\r\nimport { CalendarElementRenderer } from './CalendarElementRenderer.js';\r\n\r\n/**\r\n * ElementTypeRegistry - Maps element types to their renderer classes\r\n */\r\nexport class ElementTypeRegistry {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this.renderers = new Map();\r\n        this.initializeRenderers();\r\n    }\r\n    \r\n    /**\r\n     * Initialize all element type renderers\r\n     */\r\n    initializeRenderers() {\r\n        this.renderers.set('task', new TaskRenderer(this.app));\r\n        this.renderers.set('header', new HeaderRenderer(this.app));\r\n        this.renderers.set('header-checkbox', new HeaderCheckboxRenderer(this.app));\r\n        this.renderers.set('multi-checkbox', new MultiCheckboxRenderer(this.app));\r\n        this.renderers.set('audio', new AudioRenderer(this.app));\r\n        this.renderers.set('timer', new TimerRenderer(this.app));\r\n        this.renderers.set('counter', new CounterRenderer(this.app));\r\n        this.renderers.set('tracker', new TrackerRenderer(this.app));\r\n        this.renderers.set('rating', new RatingRenderer(this.app));\r\n        this.renderers.set('time-log', new TimeLogRenderer(this.app));\r\n        this.renderers.set('image', new ImageRenderer(this.app));\r\n        // this.renderers.set('calendar', new CalendarElementRenderer(this.app)); // TEMPORARILY DISABLED\r\n    }\r\n    \r\n    /**\r\n     * Get renderer for an element type\r\n     * @param {string} elementType - The element type\r\n     * @returns {Object|null} The renderer instance or null if not found\r\n     */\r\n    getRenderer(elementType) {\r\n        return this.renderers.get(elementType) || null;\r\n    }\r\n    \r\n    /**\r\n     * Render an element using the appropriate renderer\r\n     * @param {HTMLElement} div - The element container div\r\n     * @param {string} pageId - Page ID\r\n     * @param {string} binId - Bin ID\r\n     * @param {Object} element - Element data\r\n     * @param {number|string} elementIndex - Element index\r\n     * @param {number} depth - Current nesting depth\r\n     * @param {Function} renderChildren - Function to render children elements\r\n     * @returns {void}\r\n     */\r\n    renderElement(div, pageId, binId, element, elementIndex, depth, renderChildren) {\r\n        const renderer = this.getRenderer(element.type);\r\n        if (renderer) {\r\n            // Pass renderChildren to the renderer so it can render nested children\r\n            renderer.render(div, pageId, binId, element, elementIndex, depth, renderChildren);\r\n        } else {\r\n            console.warn(`No renderer found for element type: ${element.type}`);\r\n        }\r\n    }\r\n}\r\n\r\n","// SharedDragDrop.js - Shared drag-and-drop functionality for vertical/horizontal layouts\n// Allows dragging elements over other elements to nest them\n\nexport class SharedDragDrop {\n    constructor(app) {\n        this.app = app;\n        this.dragOverTimeout = null;\n        this.nestIndicator = null;\n    }\n    \n    /**\n     * Setup drag and drop for an element in vertical/horizontal layouts\n     * Allows nesting when dragging over elements with title/text\n     * @param {HTMLElement} elementNode - The element DOM node\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     * @param {Object} element - Element data\n     */\n    setupElementDragDrop(elementNode, pageId, binId, elementIndex, element) {\n        // Only allow dragging for text/note and task/checkbox elements\n        const draggableTypes = ['task', 'note', 'header-checkbox', 'text'];\n        if (!draggableTypes.includes(element.type)) {\n            return; // Don't make non-text/checkbox elements draggable\n        }\n        \n        const elementId = `${pageId}-${binId}-${elementIndex}`;\n        elementNode.draggable = true;\n        elementNode.dataset.dragType = 'element';\n        elementNode.dataset.pageId = pageId;\n        elementNode.dataset.binId = binId;\n        elementNode.dataset.elementIndex = elementIndex;\n        elementNode.dataset.elementId = elementId;\n        elementNode.setAttribute('data-element-id', elementId);\n        \n        // Drag start\n        elementNode.addEventListener('dragstart', (e) => {\n            e.dataTransfer.effectAllowed = 'move';\n            e.dataTransfer.setData('text/plain', JSON.stringify({\n                type: 'element',\n                pageId,\n                binId,\n                elementIndex\n            }));\n            elementNode.style.opacity = '0.5';\n        });\n        \n        // Drag end\n        elementNode.addEventListener('dragend', (e) => {\n            elementNode.style.opacity = '1';\n            this.clearNestIndicator();\n            if (this.dragOverTimeout) {\n                clearTimeout(this.dragOverTimeout);\n                this.dragOverTimeout = null;\n            }\n        });\n        \n        // Drag over - allow nesting on elements with title/text\n        elementNode.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            const dragData = e.dataTransfer.getData('text/plain');\n            if (!dragData) return;\n            \n            let dragPayload;\n            try {\n                dragPayload = JSON.parse(dragData);\n            } catch (err) {\n                return;\n            }\n            \n            // Only allow nesting if source is a text/checkbox element\n            if (dragPayload.type !== 'element') return;\n            \n            // Check if target element has title or text (can be nested into)\n            const hasTitleOrText = element.title || element.text || element.content;\n            if (!hasTitleOrText) return;\n            \n            // Check if source element is a text/checkbox type\n            const sourcePage = this.app.appState?.documents?.find(p => p.id === dragPayload.pageId) || \n                             this.app.documents?.find(p => p.id === dragPayload.pageId);\n            if (!sourcePage) return;\n            \n            const sourceBin = sourcePage.groups?.find(b => b.id === dragPayload.binId);\n            const items = sourceBin?.items || [];\n            if (sourceBin) {\n                sourceBin.items = items;\n            }\n            if (!sourceBin) return;\n            \n            const sourceElement = items[dragPayload.elementIndex];\n            if (!sourceElement) return;\n            \n            const sourceTypes = ['task', 'note', 'header-checkbox', 'text'];\n            if (!sourceTypes.includes(sourceElement.type)) return;\n            \n            // Prevent nesting into self or descendants\n            if (dragPayload.pageId === pageId && dragPayload.binId === binId && dragPayload.elementIndex === elementIndex) {\n                return;\n            }\n            \n            // Show nest indicator\n            this.showNestIndicator(elementNode);\n            e.dataTransfer.dropEffect = 'move';\n        });\n        \n        // Drag leave\n        elementNode.addEventListener('dragleave', (e) => {\n            // Only clear if we're leaving the element (not entering a child)\n            if (!elementNode.contains(e.relatedTarget)) {\n                this.clearNestIndicator();\n            }\n        });\n        \n        // Drop - nest the element\n        elementNode.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            const dragData = e.dataTransfer.getData('text/plain');\n            if (!dragData) return;\n            \n            let dragPayload;\n            try {\n                dragPayload = JSON.parse(dragData);\n            } catch (err) {\n                return;\n            }\n            \n            if (dragPayload.type !== 'element') return;\n            \n            // Check if target element has title or text\n            const hasTitleOrText = element.title || element.text || element.content;\n            if (!hasTitleOrText) return;\n            \n            // Prevent nesting into self\n            if (dragPayload.pageId === pageId && dragPayload.binId === binId && dragPayload.elementIndex === elementIndex) {\n                return;\n            }\n            \n            // Use DragDropHandler to nest the element\n            if (this.app.dragDropHandler) {\n                this.app.dragDropHandler.nestElement(\n                    dragPayload.pageId, dragPayload.binId, dragPayload.elementIndex,\n                    pageId, binId, elementIndex\n                );\n            }\n            \n            this.clearNestIndicator();\n        });\n    }\n    \n    /**\n     * Show visual indicator that element can be nested\n     * @param {HTMLElement} targetElement - The target element\n     */\n    showNestIndicator(targetElement) {\n        this.clearNestIndicator();\n        \n        const indicator = document.createElement('div');\n        indicator.className = 'nest-indicator';\n        indicator.style.cssText = `\n            position: absolute;\n            left: 0;\n            right: 0;\n            top: 0;\n            bottom: 0;\n            border: 2px dashed #4a9eff;\n            background: rgba(74, 158, 255, 0.1);\n            pointer-events: none;\n            z-index: 1000;\n            border-radius: 4px;\n        `;\n        \n        // Make sure element has position relative\n        const computedStyle = window.getComputedStyle(targetElement);\n        if (computedStyle.position === 'static') {\n            targetElement.style.position = 'relative';\n        }\n        \n        targetElement.appendChild(indicator);\n        this.nestIndicator = indicator;\n    }\n    \n    /**\n     * Clear the nest indicator\n     */\n    clearNestIndicator() {\n        if (this.nestIndicator) {\n            this.nestIndicator.remove();\n            this.nestIndicator = null;\n        }\n    }\n}\n\n\n","// ElementRenderer.js - Handles element and children rendering\n// Extracted from app.js to improve modularity\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\nimport { ElementTypeRegistry } from './elements/ElementTypeRegistry.js';\nimport { SharedDragDrop } from '../utils/SharedDragDrop.js';\nimport { EventHelper } from '../utils/EventHelper.js';\nimport { ItemHierarchy } from '../utils/ItemHierarchy.js';\n\n/**\n * ElementRenderer - Handles rendering of elements and their children\n * \n * This class extracts element rendering logic from app.js to improve modularity.\n */\nexport class ElementRenderer {\n    constructor(app) {\n        this.app = app;\n        this.typeRegistry = new ElementTypeRegistry(app);\n        this.sharedDragDrop = null; // Initialize on first use\n    }\n\n    _getDocument(pageId) {\n        return this.app.appState.documents?.find(page => page.id === pageId) || null;\n    }\n\n    _getGroup(document, binId) {\n        if (!document) return null;\n        const group = document.groups?.find(bin => bin.id === binId) || null;\n        if (!group) return null;\n        const items = group.items || [];\n        group.items = items;\n        return group;\n    }\n\n    _getGroupByIds(pageId, binId) {\n        const document = this._getDocument(pageId);\n        const group = this._getGroup(document, binId);\n        return { document, group, items: group ? group.items : [] };\n    }\n\n    _getItemIndexForGroup(group) {\n        return ItemHierarchy.buildItemIndex(group?.items || []);\n    }\n\n    _getRootItemByIndex(group, elementIndex) {\n        return ItemHierarchy.getRootItemAtIndex(group?.items || [], elementIndex);\n    }\n\n    _getChildItemByIndex(group, parentElement, childIndex) {\n        const itemIndex = this._getItemIndexForGroup(group);\n        const childItems = ItemHierarchy.getChildItems(parentElement, itemIndex);\n        return childItems[childIndex] || null;\n    }\n    \n    /**\n     * Render children elements\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} parentElement - Parent element data\n     * @param {number} parentElementIndex - Parent element index\n     * @param {number} depth - Current nesting depth\n     * @returns {HTMLElement|null} The rendered children container or null\n     */\n    renderChildren(pageId, binId, parentElement, parentElementIndex, depth = 0) {\n        // Limit to one level for current implementation\n        if (depth > 1) {\n            return null;\n        }\n\n        const { group } = this._getGroupByIds(pageId, binId);\n        const itemIndex = ItemHierarchy.buildItemIndex(group?.items || []);\n        const childItems = ItemHierarchy.getChildItems(parentElement, itemIndex);\n\n        if (!childItems.length) {\n            return null;\n        }\n        \n        const container = document.createElement('div');\n        container.className = 'children-container';\n        \n        // Get or initialize children state\n        const childrenStateKey = `${binId}-${parentElementIndex}`;\n        if (!(childrenStateKey in this.app.appState.subtaskStates)) {\n            this.app.appState.subtaskStates[childrenStateKey] = this.app.appState.allSubtasksExpanded;\n        }\n        const isExpanded = this.app.appState.subtaskStates[childrenStateKey];\n        \n        const content = document.createElement('div');\n        content.className = 'dropdown-content';\n        content.style.display = isExpanded ? 'block' : 'none';\n        content.dataset.pageId = pageId;\n        content.dataset.binId = binId;\n        content.dataset.parentElementIndex = parentElementIndex;\n        \n        // Add drop indicator support for nested children (same as regular elements)\n        // Store indicator reference on the content container\n        content._dropIndicator = null;\n        content._dropTargetIndex = null;\n        \n        content.addEventListener('dragover', (e) => {\n            // Only handle if dragging a child element within the same parent\n            const dragData = this.app.appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            if (dragData.type !== 'element' || !dragData.isChild) {\n                // Remove indicator if not dragging a child element\n                if (content._dropIndicator) {\n                    content._dropIndicator.remove();\n                    content._dropIndicator = null;\n                    content._dropTargetIndex = null;\n                }\n                return;\n            }\n            \n            // Only show indicator if dragging a child of the same parent\n            if (dragData.parentElementIndex !== parentElementIndex) {\n                // Remove indicator if dragging from different parent\n                if (content._dropIndicator) {\n                    content._dropIndicator.remove();\n                    content._dropIndicator = null;\n                    content._dropTargetIndex = null;\n                }\n                return;\n            }\n            \n            e.preventDefault();\n            e.stopPropagation();\n            e.dataTransfer.dropEffect = 'move';\n            \n            // Calculate drop position based on mouse Y - always show indicator\n            const mouseY = e.clientY;\n            const contentRect = content.getBoundingClientRect();\n            const relativeY = mouseY - contentRect.top;\n            \n            // Find which position we're hovering over\n            const childElements = Array.from(content.querySelectorAll('.element.child-element'));\n            let insertIndex = childItems.length; // Default to end\n            let targetElement = null;\n            \n            for (let i = 0; i < childElements.length; i++) {\n                const elementRect = childElements[i].getBoundingClientRect();\n                const elementTop = elementRect.top - contentRect.top;\n                const elementBottom = elementRect.bottom - contentRect.top;\n                const elementMiddle = (elementTop + elementBottom) / 2;\n                \n                // If mouse is above the middle of this element, insert before it\n                if (relativeY < elementMiddle) {\n                    const childIndexStr = childElements[i].dataset.childIndex;\n                    if (childIndexStr) {\n                        const childIndex = parseInt(childIndexStr);\n                        if (!isNaN(childIndex)) {\n                            insertIndex = childIndex;\n                            targetElement = childElements[i];\n                        }\n                    }\n                    break;\n                }\n            }\n            \n            // Update drop indicator\n            let childDropIndicator = content._dropIndicator;\n            const currentTargetIndex = content._dropTargetIndex;\n            \n            if (currentTargetIndex !== insertIndex || childDropIndicator === null) {\n                // Clear ALL drop indicators before showing a new one\n                // Clear all elements list indicators\n                document.querySelectorAll('.elements-list').forEach(list => {\n                    if (list._dropIndicator) {\n                        list._dropIndicator.remove();\n                        list._dropIndicator = null;\n                        list._dropTargetIndex = null;\n                    }\n                });\n                \n                // Clear all nested children container indicators\n                document.querySelectorAll('.dropdown-content').forEach(c => {\n                    if (c._dropIndicator) {\n                        c._dropIndicator.remove();\n                        c._dropIndicator = null;\n                        c._dropTargetIndex = null;\n                    }\n                });\n                \n                // Also clear any orphaned indicators (safety check)\n                document.querySelectorAll('.drop-indicator').forEach(indicator => {\n                    indicator.remove();\n                });\n                \n                childDropIndicator = null;\n                \n                // Create new indicator\n                childDropIndicator = document.createElement('div');\n                childDropIndicator.className = 'drop-indicator';\n                childDropIndicator.style.cssText = `\n                    height: 2px;\n                    background: #4a9eff;\n                    margin: 4px 0;\n                    border-radius: 1px;\n                    pointer-events: none;\n                    position: relative;\n                    z-index: 1000;\n                `;\n                \n                // Store reference\n                content._dropIndicator = childDropIndicator;\n                content._dropTargetIndex = insertIndex;\n                \n                // Insert indicator at the correct position\n                if (targetElement && content.contains(targetElement) && targetElement.parentElement === content) {\n                    content.insertBefore(childDropIndicator, targetElement);\n                } else {\n                    // Fallback: append to end\n                    content.appendChild(childDropIndicator);\n                }\n            }\n        });\n        \n        content.addEventListener('dragleave', (e) => {\n            // Remove indicator when leaving the children container\n            if (!content.contains(e.relatedTarget)) {\n                if (content._dropIndicator) {\n                    content._dropIndicator.remove();\n                    content._dropIndicator = null;\n                    content._dropTargetIndex = null;\n                }\n            }\n        });\n        \n        content.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            // Remove indicator on drop\n            if (content._dropIndicator) {\n                content._dropIndicator.remove();\n                content._dropIndicator = null;\n            }\n            \n            // Handle drop between children (when dropping in gap, not on element)\n            const dragData = this.app.appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            if (dragData.type === 'element' && dragData.isChild && dragData.parentElementIndex === parentElementIndex) {\n                // Dropping a child element in a gap between children - reorder within same parent\n                if (content._dropTargetIndex !== null && content._dropTargetIndex !== undefined) {\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(pageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.app.reorderChildElement(pageId, binId, parentElementIndex, dragData.childIndex, content._dropTargetIndex);\n                }\n            }\n            \n            content._dropTargetIndex = null;\n        });\n        \n        childItems.forEach((child, childIndex) => {\n            // For nested children, we use a special identifier: parentIndex-childIndex\n            // But for rendering purposes, we still need to track the parent\n            const childElement = this.renderElement(pageId, binId, child, `${parentElementIndex}-${childIndex}`, childIndex, depth + 1);\n            if (childElement) {\n                // Mark as child element for styling\n                childElement.classList.add('child-element');\n                content.appendChild(childElement);\n            }\n        });\n        \n        container.appendChild(content);\n        return container;\n    }\n\n    \n    /**\n     * Render an element\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} element - Element data\n     * @param {number|string} elementIndex - Element index (may be string like \"0-1\" for nested children)\n     * @param {number|null} childIndex - Child index if nested\n     * @param {number} depth - Current nesting depth\n     * @returns {HTMLElement} The rendered element\n     */\n        renderElement(pageId, binId, element, elementIndex, childIndex = null, depth = 0) {\n        const div = document.createElement('div');\n        \n        // Determine element classification for styling\n        const classes = ['element', element.type];\n        if (element.completed) classes.push('completed');\n        \n        // Classification logic (order matters - most specific first)\n        // Persistent elements get no special styling class\n        if (!(element.persistent || element.type === 'image' || element.type === 'calendar')) {\n            // Determine primary classification (only one primary class)\n            if (element.repeats === false) {\n                // One-time task - will be deleted when completed and day resets\n                classes.push('one-time');\n            } else if (element.recurringSchedule && element.recurringSchedule !== 'daily') {\n                // Recurring schedule (non-daily) - weekly, monthly, custom\n                classes.push('recurring-schedule');\n            } else if (element.repeats === true || (element.repeats !== false && !element.recurringSchedule)) {\n                // Repeating daily - default repeating behavior\n                classes.push('repeating-daily');\n            }\n            \n            // Deadline can coexist with other classifications (add as secondary indicator)\n            if (element.deadline) {\n                classes.push('has-deadline');\n            }\n        }\n        \n        div.className = classes.join(' ');\n        \n        const elementId = `${pageId}-${binId}-${elementIndex}`;\n        \n        // Set data attributes early for ID-first lookups\n        div.dataset.pageId = pageId;\n        div.dataset.binId = binId;\n        div.setAttribute('data-element-id', elementId);\n        \n        // Apply visual settings for this element (includes tag-based settings)\n        if (this.app.visualSettingsManager) {\n            const page = this.app.appState?.documents?.find(p => p.id === pageId);\n            const viewFormat = page?.format || 'default';\n            // Tags are automatically retrieved and applied in applyVisualSettings\n            this.app.visualSettingsManager.applyVisualSettings(div, 'element', elementId, pageId, viewFormat);\n        }\n        \n        // Setup drag and drop - use shared functionality for text/checkbox elements in vertical/horizontal layouts\n        // Check if we're in a format that supports shared drag-drop (vertical/horizontal)\n        const pageFormat = this.app.formatRendererManager?.getPageFormat?.(pageId);\n        const supportsSharedDragDrop = !pageFormat || pageFormat === 'grid-layout-format' || pageFormat === 'horizontal-layout-format';\n        \n        if (supportsSharedDragDrop && (element.type === 'task' || element.type === 'note' || element.type === 'header-checkbox' || element.type === 'text')) {\n            // Use shared drag-drop for text/checkbox elements\n            // Initialize shared drag-drop if not already done\n            if (!this.sharedDragDrop) {\n                this.sharedDragDrop = new SharedDragDrop(this.app);\n            }\n            this.sharedDragDrop.setupElementDragDrop(div, pageId, binId, elementIndex, element);\n        } else {\n            // Use standard drag-drop for other elements\n            div.draggable = true;\n            div.dataset.dragType = 'element';\n            div.dataset.pageId = pageId;\n            div.dataset.binId = binId;\n            div.dataset.elementIndex = elementIndex;\n        }\n        \n        // Add progress bar plugin if enabled\n        if (element.progress !== undefined) {\n            const progressBarPlugin = document.createElement('div');\n            progressBarPlugin.className = 'element-progress-bar';\n            progressBarPlugin.style.position = 'absolute';\n            progressBarPlugin.style.top = '0';\n            progressBarPlugin.style.left = '0';\n            progressBarPlugin.style.width = `${Math.min(100, Math.max(0, element.progress))}%`;\n            progressBarPlugin.style.height = '100%';\n            progressBarPlugin.style.backgroundColor = 'rgba(74, 158, 255, 0.2)';\n            progressBarPlugin.style.transition = 'width 0.3s ease';\n            progressBarPlugin.style.pointerEvents = 'none';\n            progressBarPlugin.style.zIndex = '0';\n            div.appendChild(progressBarPlugin);\n        }\n        \n        // Add deadline countdown if enabled\n        if (element.deadline) {\n            const deadlineDiv = document.createElement('div');\n            deadlineDiv.className = 'element-deadline';\n            deadlineDiv.style.position = 'absolute';\n            deadlineDiv.style.top = '5px';\n            deadlineDiv.style.right = '5px';\n            deadlineDiv.style.fontSize = '11px';\n            deadlineDiv.style.color = '#ff6b6b';\n            deadlineDiv.style.zIndex = '10';\n            deadlineDiv.style.pointerEvents = 'none';\n            \n            const updateDeadline = () => {\n                const now = new Date();\n                const deadline = new Date(element.deadline);\n                const diff = deadline - now;\n                \n                if (diff < 0) {\n                    deadlineDiv.textContent = 'Overdue';\n                    deadlineDiv.style.color = '#ff0000';\n                } else {\n                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));\n                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n                    \n                    if (days > 0) {\n                        deadlineDiv.textContent = `${days}d left`;\n                    } else {\n                        deadlineDiv.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;\n                    }\n                    deadlineDiv.style.color = days === 0 ? '#ff6b6b' : '#ffa500';\n                }\n            };\n            updateDeadline();\n            // Update every minute\n            const deadlineInterval = setInterval(updateDeadline, 60000);\n            div._deadlineInterval = deadlineInterval;\n            \n            div.appendChild(deadlineDiv);\n        }\n        // Handle nested children - elementIndex might be a string like \"0-1\"\n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n            const parts = elementIndex.split('-');\n            div.dataset.elementIndex = parts[0]; // Parent index\n            div.dataset.childIndex = parts[1]; // Child index\n            div.dataset.isChild = 'true';\n        } else {\n        div.dataset.elementIndex = elementIndex;\n            div.dataset.isChild = 'false';\n        }\n        // Ensure elementId is set (already set above, but ensure it's in dataset too)\n        div.dataset.elementId = elementId;\n        \n        // Context menu is now handled by unified handler in EventHandler\n        \n        // Custom double-click detection with shorter delay\n        let lastClickTime = 0;\n        let isDragging = false;\n        let mouseDownTime = 0;\n        let mouseDownPos = null;\n        let dragStarted = false;\n        \n        const handleMouseDown = (e) => {\n            // Don't track if clicking on interactive elements (checkboxes, buttons, inputs)\n            if (e.target.closest('input') || e.target.closest('button') || e.target.closest('textarea')) {\n                return;\n            }\n            // Don't prevent default - let dragstart work normally\n            mouseDownTime = Date.now();\n            mouseDownPos = { x: e.clientX, y: e.clientY };\n            isDragging = false;\n            dragStarted = false;\n        };\n        \n        const handleMouseMove = (e) => {\n            // Detect if mouse moved significantly (dragging, not clicking)\n            if (mouseDownPos && mouseDownTime > 0 && !dragStarted) {\n                const dx = Math.abs(e.clientX - mouseDownPos.x);\n                const dy = Math.abs(e.clientY - mouseDownPos.y);\n                if (dx > 5 || dy > 5) {\n                    isDragging = true;\n                }\n            }\n        };\n        \n        const handleMouseUp = () => {\n            if (!dragStarted) {\n                mouseDownTime = 0;\n                mouseDownPos = null;\n                isDragging = false;\n            }\n        };\n        \n        div.addEventListener('mousedown', handleMouseDown);\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n        \n        // Store cleanup function on element\n        div._cleanupDragListeners = () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n        \n        // Use EventHelper for double-click detection\n        EventHelper.setupDoubleClick(\n            div,\n            (e) => {\n                // Double click handler\n                this.app.showContextMenu(e, pageId, binId, elementIndex);\n            },\n            this.app.appState.doubleClickDelay,\n            {\n                filter: (e) => {\n                    // Skip if we were dragging\n                    if (isDragging || dragStarted) {\n                        isDragging = false;\n                        dragStarted = false;\n                        mouseDownTime = 0;\n                        mouseDownPos = null;\n                        return false;\n                    }\n                    // Track active document\n                    this.app.appState.currentDocumentId = pageId;\n                    mouseDownTime = 0;\n                    mouseDownPos = null;\n                    return true;\n                }\n            }\n        );\n        \n        // Drag and drop handlers for elements\n        div.addEventListener('dragstart', (e) => {\n            // Don't start drag if clicking on interactive elements (checkboxes, buttons, inputs, etc.)\n            if (e.target.closest('input') || e.target.closest('button') || e.target.closest('textarea')) {\n                e.preventDefault();\n                return;\n            }\n            \n            // Stop propagation to prevent page dragstart from firing\n            e.stopPropagation();\n            \n            // Clear all drag-over classes when starting a new drag\n            document.querySelectorAll('.element.drag-over, .element.nest-target').forEach(el => {\n                el.classList.remove('drag-over');\n                el.classList.remove('nest-target');\n            });\n            this.app.appState.currentDragOverElement = null;\n            \n            dragStarted = true; // Mark that drag has started\n            isDragging = true; // Mark as dragging to prevent click handler\n            this.app.appState.isDragging = true; // Track dragging state for scroll handlers\n            \n            e.dataTransfer.effectAllowed = 'move';\n            \n            // Handle nested children - determine actual pageId and elementIndex\n            let actualPageId = pageId;\n            let actualElementIndex = elementIndex;\n            let isChild = false;\n            let parentElementIndex = null;\n            let childIndex = null;\n            \n            if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n                // This is a nested child\n                const parts = elementIndex.split('-');\n                actualElementIndex = parseInt(parts[0]);\n                childIndex = parseInt(parts[1]);\n                isChild = true;\n                parentElementIndex = actualElementIndex;\n            } else {\n                actualElementIndex = parseInt(elementIndex);\n            }\n            \n            const dragPayload = {\n                type: 'element',\n                pageId: actualPageId,\n                binId: binId,\n                elementIndex: actualElementIndex,\n                isChild: isChild,\n                parentElementIndex: parentElementIndex,\n                childIndex: childIndex\n            };\n            // Log element selected for nesting debugging\n            const { document: sourceDoc, group: sourceGroup } = this._getGroupByIds(actualPageId, binId);\n            const parentElement = parentElementIndex !== null ? this._getRootItemByIndex(sourceGroup, parentElementIndex) : null;\n            const sourceElement = isChild && parentElement && childIndex !== null\n                ? this._getChildItemByIndex(sourceGroup, parentElement, childIndex)\n                : this._getRootItemByIndex(sourceGroup, actualElementIndex);\n            const elementText = sourceElement?.text || 'N/A';\n            \n            console.log(' ELEMENT SELECTED:', {\n                page: actualPageId,\n                index: actualElementIndex,\n                isChild: isChild,\n                parentIndex: parentElementIndex,\n                childIndex: childIndex,\n                text: elementText,\n                location: `${actualPageId}-${actualElementIndex}${isChild ? ` (child of ${parentElementIndex})` : ''}`\n            });\n            \n            e.dataTransfer.setData('text/plain', JSON.stringify(dragPayload));\n            this.app.appState.dragData = dragPayload;\n            div.classList.add('dragging');\n            \n            // Show trash icon\n            const trashIcon = document.getElementById('trash-icon');\n            if (trashIcon) {\n                trashIcon.style.display = 'flex';\n            }\n        });\n        \n        \n        // Store a reference to maintain highlight state\n        // Use an object so child handlers can access it\n        const dragLeaveTimeoutRef = { value: null };\n        // Flag to track if we're actively dragging over this element\n        const isDraggingOverRef = { value: false };\n        \n        // Helper function to check if mouse coordinates are within element bounds\n        const isMouseInBounds = (x, y) => {\n            const rect = div.getBoundingClientRect();\n            return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\n        };\n        \n        div.addEventListener('dragend', (e) => {\n            div.classList.remove('dragging');\n            isDragging = false;\n            dragStarted = false;\n            mouseDownTime = 0;\n            mouseDownPos = null;\n            this.app.appState.isDragging = false; // Clear dragging state\n            \n            // Hide trash icon\n            const trashIcon = document.getElementById('trash-icon');\n            if (trashIcon) {\n                trashIcon.style.display = 'none';\n                trashIcon.classList.remove('drag-over-trash');\n                trashIcon.style.background = 'rgba(220, 53, 69, 0.9)';\n                trashIcon.style.transform = 'scale(1)';\n            }\n            \n            // Stop auto-scrolling\n            if (this.app.appState.autoScrollInterval) {\n                clearInterval(this.app.appState.autoScrollInterval);\n                this.app.appState.autoScrollInterval = null;\n            }\n            \n            // Clear nesting target\n            this.app.appState.nestTargetElement = null;\n            document.querySelectorAll('.nest-target').forEach(el => {\n                el.classList.remove('nest-target');\n            });\n            // Don't clear dragData here - let drop handler clear it after processing\n            // If drop didn't fire (drag cancelled), clear it after a delay\n            if (!e.dataTransfer.dropEffect || e.dataTransfer.dropEffect === 'none') {\n                // Drag was cancelled, clear dragData\n                setTimeout(() => {\n            this.app.appState.dragData = null;\n                }, 50);\n            }\n            // Remove all drag-over classes\n            document.querySelectorAll('.drag-over').forEach(el => {\n                el.classList.remove('drag-over');\n            });\n            // Clear the dragging flag\n            isDraggingOverRef.value = false;\n        });\n        \n        div.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.stopPropagation(); // Prevent page dragover from handling this\n\n            const dragData = this.app.appState.dragData || (() => {\n                try {\n                    return JSON.parse(e.dataTransfer.getData('text/plain') || '{}');\n                } catch {\n                    return {};\n                }\n            })();\n            \n            // Clear any pending dragleave timeout (prevents flicker)\n            if (dragLeaveTimeoutRef.value) {\n                clearTimeout(dragLeaveTimeoutRef.value);\n                dragLeaveTimeoutRef.value = null;\n            }\n            \n            // Check if we're dragging over any part of this element (including gaps)\n            // This includes child elements, task-header, or the div itself\n            const isOverElement = div.contains(e.target) || e.target === div;\n            const isOverChildElement = isOverElement && e.target !== div;\n            \n            // Also check if mouse is actually over the element using elementFromPoint\n            // This catches gaps between child elements\n            const elementUnderMouse = document.elementFromPoint(e.clientX, e.clientY);\n            const isOverElementByPosition = elementUnderMouse && (div.contains(elementUnderMouse) || elementUnderMouse === div);\n            \n            // Check if dragging over a checkbox early - need to handle this before setting dropEffect\n            const target = e.target;\n            let checkbox = null;\n            if (target && target.type === 'checkbox') {\n                checkbox = target;\n            } else if (target) {\n                checkbox = target.closest('input[type=\"checkbox\"]');\n            }\n            const isOverCheckbox = checkbox !== null && checkbox.closest('.element') === div;\n            \n            // Update drop indicator - check if we're in a nested children container first\n            const targetIsChild = div.dataset.isChild === 'true';\n            const childrenContent = div.closest('.dropdown-content');\n            \n            // If dragging a child element and hovering over a child element in the same parent, update children container indicator\n            if (dragData.type === 'element' && dragData.isChild && targetIsChild) {\n                const targetParentIndex = div.dataset.elementIndex ? parseInt(div.dataset.elementIndex.split('-')[0]) : null;\n                if (childrenContent && dragData.parentElementIndex === targetParentIndex) {\n                    // Calculate drop position in children container\n                    const mouseY = e.clientY;\n                    const contentRect = childrenContent.getBoundingClientRect();\n                    const relativeY = mouseY - contentRect.top;\n                    \n                    const childElements = Array.from(childrenContent.querySelectorAll('.element.child-element'));\n                    let insertIndex = childrenContent.dataset.parentElementIndex !== undefined ? (() => {\n                        const parentIndex = parseInt(childrenContent.dataset.parentElementIndex);\n                        if (Number.isNaN(parentIndex)) return 0;\n                        const { group } = this._getGroupByIds(pageId, binId);\n                        const parentElement = this._getRootItemByIndex(group, parentIndex);\n                        return parentElement?.childIds?.length || 0;\n                    })() : 0;\n                    let targetElement = null;\n                    \n                    for (let i = 0; i < childElements.length; i++) {\n                        const elementRect = childElements[i].getBoundingClientRect();\n                        const elementTop = elementRect.top - contentRect.top;\n                        const elementBottom = elementRect.bottom - contentRect.top;\n                        const elementMiddle = (elementTop + elementBottom) / 2;\n                        \n                        if (relativeY < elementMiddle) {\n                            const childIndexStr = childElements[i].dataset.childIndex;\n                            if (childIndexStr) {\n                                const childIndex = parseInt(childIndexStr);\n                                if (!isNaN(childIndex)) {\n                                    insertIndex = childIndex;\n                                    targetElement = childElements[i];\n                                }\n                            }\n                            break;\n                        }\n                    }\n                    \n                    // Update children container drop indicator\n                    let childDropIndicator = childrenContent._dropIndicator;\n                    const currentTargetIndex = childrenContent._dropTargetIndex;\n                    \n                    if (currentTargetIndex !== insertIndex || childDropIndicator === null) {\n                        // Clear ALL drop indicators before showing a new one\n                        // Clear all elements list indicators\n                        document.querySelectorAll('.elements-list').forEach(list => {\n                            if (list._dropIndicator) {\n                                list._dropIndicator.remove();\n                                list._dropIndicator = null;\n                                list._dropTargetIndex = null;\n                            }\n                        });\n                        \n                        // Clear all nested children container indicators\n                        document.querySelectorAll('.dropdown-content').forEach(c => {\n                            if (c._dropIndicator) {\n                                c._dropIndicator.remove();\n                                c._dropIndicator = null;\n                                c._dropTargetIndex = null;\n                            }\n                        });\n                        \n                        // Also clear any orphaned indicators (safety check)\n                        document.querySelectorAll('.drop-indicator').forEach(indicator => {\n                            indicator.remove();\n                        });\n                        \n                        childDropIndicator = null;\n                        \n                        childDropIndicator = document.createElement('div');\n                        childDropIndicator.className = 'drop-indicator';\n                        childDropIndicator.style.cssText = `\n                            height: 2px;\n                            background: #4a9eff;\n                            margin: 4px 0;\n                            border-radius: 1px;\n                            pointer-events: none;\n                            position: relative;\n                            z-index: 1000;\n                        `;\n                        \n                        childrenContent._dropIndicator = childDropIndicator;\n                        childrenContent._dropTargetIndex = insertIndex;\n                        \n                        if (targetElement && childrenContent.contains(targetElement) && targetElement.parentElement === childrenContent) {\n                            childrenContent.insertBefore(childDropIndicator, targetElement);\n                        } else {\n                            childrenContent.appendChild(childDropIndicator);\n                        }\n                    }\n                }\n            } else {\n                // Update main elements list drop indicator for regular elements\n                const elementsList = div.closest('.elements-list');\n                if (elementsList && dragData.type === 'element') {\n                    // Calculate drop position based on mouse Y\n                    const mouseY = e.clientY;\n                    const elementsListRect = elementsList.getBoundingClientRect();\n                    const relativeY = mouseY - elementsListRect.top;\n                    \n                    // Get all regular elements (not nested children) in the list\n                    const allElements = Array.from(elementsList.querySelectorAll('.element:not(.child-element)'));\n                    let insertIndex = allElements.length; // Default to end\n                    let targetElement = null;\n                    \n                    // Find which position we're hovering over\n                    for (let i = 0; i < allElements.length; i++) {\n                        const elementRect = allElements[i].getBoundingClientRect();\n                        const elementTop = elementRect.top - elementsListRect.top;\n                        const elementBottom = elementRect.bottom - elementsListRect.top;\n                        const elementMiddle = (elementTop + elementBottom) / 2;\n                        \n                        // If mouse is above the middle of this element, insert before it\n                        if (relativeY < elementMiddle) {\n                            const elementIndexStr = allElements[i].dataset.elementIndex;\n                            if (elementIndexStr) {\n                                if (typeof elementIndexStr === 'string' && elementIndexStr.includes('-')) {\n                                    const parentIndex = parseInt(elementIndexStr.split('-')[0]);\n                                    if (!isNaN(parentIndex)) {\n                                        insertIndex = parentIndex;\n                                        targetElement = allElements[i];\n                                    }\n                                } else {\n                                    const elementIndex = parseInt(elementIndexStr);\n                                    if (!isNaN(elementIndex)) {\n                                        insertIndex = elementIndex;\n                                        targetElement = allElements[i];\n                                    }\n                                }\n                            }\n                            break;\n                        }\n                    }\n                    \n                    // If we didn't find a target element, check if we should append at the end\n                    if (targetElement === null) {\n                        const { group } = this._getGroupByIds(pageId, binId);\n                        if (group && insertIndex >= (group.items?.length || 0)) {\n                            const addButton = elementsList.querySelector('.add-element-btn');\n                            if (addButton) {\n                                targetElement = addButton;\n                            }\n                        }\n                    }\n                    \n                    // Update drop indicator\n                    let dropIndicator = elementsList._dropIndicator;\n                    const currentTargetIndex = elementsList._dropTargetIndex;\n                    \n                    if (currentTargetIndex !== insertIndex || dropIndicator === null) {\n                        // Clear ALL drop indicators before showing a new one\n                        // Clear all elements list indicators\n                        document.querySelectorAll('.elements-list').forEach(list => {\n                            if (list._dropIndicator) {\n                                list._dropIndicator.remove();\n                                list._dropIndicator = null;\n                                list._dropTargetIndex = null;\n                            }\n                        });\n                        \n                        // Clear all nested children container indicators\n                        document.querySelectorAll('.dropdown-content').forEach(c => {\n                            if (c._dropIndicator) {\n                                c._dropIndicator.remove();\n                                c._dropIndicator = null;\n                                c._dropTargetIndex = null;\n                            }\n                        });\n                        \n                        // Also clear any orphaned indicators (safety check)\n                        document.querySelectorAll('.drop-indicator').forEach(indicator => {\n                            indicator.remove();\n                        });\n                        \n                        dropIndicator = null;\n                        \n                        // Create new indicator\n                        dropIndicator = document.createElement('div');\n                        dropIndicator.className = 'drop-indicator';\n                        dropIndicator.style.cssText = `\n                            height: 2px;\n                            background: #4a9eff;\n                            margin: 4px 0;\n                            border-radius: 1px;\n                            pointer-events: none;\n                            position: relative;\n                            z-index: 1000;\n                        `;\n                        \n                        // Store reference\n                        elementsList._dropIndicator = dropIndicator;\n                        elementsList._dropTargetIndex = insertIndex;\n                        \n                        // Insert indicator at the correct position\n                        if (targetElement && elementsList.contains(targetElement) && targetElement.parentElement === elementsList) {\n                            elementsList.insertBefore(dropIndicator, targetElement);\n                        } else {\n                            // Fallback: append to end\n                            elementsList.appendChild(dropIndicator);\n                        }\n                    }\n                }\n            }\n            \n            // If over any part of the element (by target or by position), always allow drop to prevent \"no\" cursor\n            // BUT don't set dropEffect yet if we're over a checkbox - let the checkbox handling code set it\n            if ((isOverElement || isOverElementByPosition) && dragData.type === 'element') {\n                // Clear drag-over from other elements first\n                if (this.app.appState.currentDragOverElement && this.app.appState.currentDragOverElement !== div) {\n                    this.app.appState.currentDragOverElement.classList.remove('drag-over');\n                    this.app.appState.currentDragOverElement.classList.remove('nest-target');\n                }\n                \n                // Only set dropEffect to 'move' if we're NOT over a checkbox\n                // Checkbox handling will set it to 'copy' or 'move' as appropriate\n                if (!isOverCheckbox) {\n                e.dataTransfer.dropEffect = 'move';\n                }\n                div.classList.add('drag-over');\n                this.app.appState.currentDragOverElement = div; // Track this as the current drag-over element\n                // Set flag to indicate we're actively dragging over this element\n                isDraggingOverRef.value = true;\n                // Clear any pending dragleave timeout\n                if (dragLeaveTimeoutRef.value) {\n                    clearTimeout(dragLeaveTimeoutRef.value);\n                    dragLeaveTimeoutRef.value = null;\n                }\n            } else {\n                // Not over this element - clear flag and remove classes immediately\n                isDraggingOverRef.value = false;\n                div.classList.remove('drag-over');\n                div.classList.remove('nest-target');\n                if (this.app.appState.currentDragOverElement === div) {\n                    this.app.appState.currentDragOverElement = null;\n                }\n            }\n            \n\n            // Only allow dropping elements on elements within the same page or different page\n            // For child elements, compare parent indices; for regular elements, compare element indices\n            const sourceIsChild = dragData.isChild || false;\n            const sourceElementIndex = sourceIsChild ? dragData.parentElementIndex : dragData.elementIndex;\n            // targetIsChild already declared above at line 2420\n            let targetElementIndex = elementIndex;\n            if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n                targetElementIndex = parseInt(elementIndex.split('-')[0]);\n            } else {\n                targetElementIndex = parseInt(elementIndex);\n            }\n            \n            // If dragging over any part of the element (by target or position), always allow drop and maintain highlight\n            // This prevents flickering when moving between child elements or gaps\n            const isOverAnyPart = isOverElement || isOverElementByPosition;\n            const canDrop = isOverAnyPart && dragData.type === 'element' ? true :\n                (dragData.type === 'element' &&\n                (dragData.pageId !== pageId || sourceElementIndex !== targetElementIndex || \n                 (sourceIsChild && dragData.parentElementIndex !== targetElementIndex)));\n\n            // Handle checkbox case FIRST - checkboxes always allow drop for nesting, even if canDrop is false\n            if (isOverCheckbox && checkbox && dragData.type === 'element') {\n                // Debug logging disabled\n                // console.log(' CHECKBOX DRAGOVER DETECTED - handling checkbox case');\n                    // Find the element that contains this checkbox\n                    const checkboxContainer = checkbox.closest('.element');\n                    let actualElementIndex = targetElementIndex;\n                    if (checkboxContainer) {\n                        const containerPageId = checkboxContainer.dataset.pageId;\n                        const containerBinId = checkboxContainer.dataset.binId;\n                        const containerElementIndexStr = checkboxContainer.dataset.elementIndex;\n                        if (containerPageId === pageId && containerBinId === binId && containerElementIndexStr) {\n                            // If it's a child element, get the parent index\n                            if (typeof containerElementIndexStr === 'string' && containerElementIndexStr.includes('-')) {\n                                actualElementIndex = parseInt(containerElementIndexStr.split('-')[0]);\n                            } else {\n                                actualElementIndex = parseInt(containerElementIndexStr);\n                            }\n                        }\n                    }\n                    \n                    // Check if this is a valid nesting target\n                    const { group: targetGroup } = this._getGroupByIds(pageId, binId);\n                    const targetElement = targetGroup ? this._getRootItemByIndex(targetGroup, actualElementIndex) : null;\n                    // Check if any existing children have their own children (enforce one-level limit)\n                    const itemIndex = this._getItemIndexForGroup(targetGroup);\n                    const childItems = targetElement ? ItemHierarchy.getChildItems(targetElement, itemIndex) : [];\n                    const hasNestedChildren = childItems.some(child => (child.childIds || []).length > 0);\n                    const canNest = targetElement && !hasNestedChildren;\n\n                    // Debug logging disabled\n                    // console.log(' CHECKBOX NESTING CHECK:', {\n                    //     pageId,\n                    //     binId,\n                    //     actualElementIndex,\n                    //     targetElementFound: !!targetElement,\n                    //     targetElementText: targetElement?.text,\n                    //     hasNestedChildren,\n                    //     canNest,\n                    //     dropEffectBefore: e.dataTransfer.dropEffect\n                    // });\n\n                    if (canNest) {\n                        e.dataTransfer.dropEffect = 'copy'; // Visual indicator for nesting\n                        const wasNestTarget = div.classList.contains('nest-target');\n                        div.classList.add('nest-target');\n                        this.app.appState.nestTargetElement = { pageId, binId, elementIndex: actualElementIndex };\n                        // Debug logging disabled\n                        // console.log(' CHECKBOX: canNest=true, set dropEffect=copy, nestTargetElement:', this.app.appState.nestTargetElement, 'dropEffectAfter:', e.dataTransfer.dropEffect);\n                    } else {\n                        // Even if can't nest, still allow drop to prevent \"no\" cursor\n                        // The drop handler will prevent actual nesting if invalid\n                        e.dataTransfer.dropEffect = 'move';\n                        const wasNestTarget = div.classList.contains('nest-target');\n                        div.classList.remove('nest-target');\n                        this.app.appState.nestTargetElement = null;\n                        // Debug logging disabled\n                        // console.log(' CHECKBOX: canNest=false, set dropEffect=move (nesting not allowed but drop allowed), dropEffectAfter:', e.dataTransfer.dropEffect);\n                    }\n            } else if (canDrop) {\n                // Debug logging disabled\n                // console.log(' CAN_DROP=true (not checkbox), handling normal drop case');\n                // Handle other drop cases (not checkbox)\n                if (targetIsChild && !dragData.isChild) {\n                    // Dropping a regular element over a child element - will nest as child of same parent\n                    // Extract parent index from child element index (format: \"parentIndex-childIndex\")\n                    const targetParentIndex = div.dataset.elementIndex ? parseInt(div.dataset.elementIndex.split('-')[0]) : null;\n                    e.dataTransfer.dropEffect = 'copy'; // Visual indicator for nesting\n                    const wasNestTarget = div.classList.contains('nest-target');\n                    div.classList.add('nest-target');\n                    // if (!wasNestTarget) {\n                    //     console.log(' HIGHLIGHT ON (nest-target, child parent):', `${pageId}-${targetParentIndex}`, 'at', e.clientX, e.clientY);\n                    // }\n                    // Set nest target to the parent element\n                    if (targetParentIndex !== null) {\n                        this.app.appState.nestTargetElement = { pageId, binId, elementIndex: targetParentIndex };\n                    }\n                } else {\n                    // Check if this is rearranging nested children within the same parent\n                    const targetParentIndex = div.dataset.elementIndex ? parseInt(div.dataset.elementIndex.split('-')[0]) : null;\n\n                    if (dragData.isChild && targetIsChild && dragData.parentElementIndex === targetParentIndex) {\n                        // Both source and target are children of the same parent - allow reordering\n                        e.dataTransfer.dropEffect = 'move';\n                        const wasDragOver = div.classList.contains('drag-over');\n                        div.classList.add('drag-over');\n                        // if (!wasDragOver) {\n                        //     console.log(' HIGHLIGHT ON (drag-over, reorder children):', `${pageId}-${elementIndex}`, 'at', e.clientX, e.clientY);\n                        // }\n                        const wasNestTarget = div.classList.contains('nest-target');\n                        div.classList.remove('nest-target');\n                        // if (wasNestTarget) {\n                        //     console.log(' HIGHLIGHT OFF (nest-target):', `${pageId}-${elementIndex}`, 'at', e.clientX, e.clientY);\n                        // }\n                        this.app.appState.nestTargetElement = null;\n                    } else {\n                        // Regular element move or un-nesting child element\n                        e.dataTransfer.dropEffect = 'move';\n                        const wasDragOver = div.classList.contains('drag-over');\n                        div.classList.add('drag-over');\n                        // if (!wasDragOver) {\n                        //     console.log(' HIGHLIGHT ON (drag-over, regular move):', `${pageId}-${elementIndex}`, 'at', e.clientX, e.clientY);\n                        // }\n                        const wasNestTarget = div.classList.contains('nest-target');\n                        div.classList.remove('nest-target');\n                        // if (wasNestTarget) {\n                        //     console.log(' HIGHLIGHT OFF (nest-target):', `${pageId}-${elementIndex}`, 'at', e.clientX, e.clientY);\n                        // }\n                        this.app.appState.nestTargetElement = null;\n                    }\n                }\n            } else {\n                // Debug logging disabled\n                // console.log(' CAN_DROP=false, isOverAnyPart:', isOverAnyPart, 'dragData.type:', dragData.type);\n                // If we're over any part of the element (including gaps), maintain highlight\n                // This prevents \"no\" cursor when moving between text, arrow, and checkbox\n                if (isOverAnyPart && dragData.type === 'element') {\n                    // Over element area but canDrop is false - still allow drop to prevent \"no\" cursor\n                    e.dataTransfer.dropEffect = 'move';\n                    div.classList.add('drag-over');\n                    // Debug logging disabled\n                    // console.log(' CAN_DROP=false but isOverAnyPart=true, set dropEffect=move to prevent no cursor');\n                } else {\n                    // Not over element - remove highlight\n                    e.dataTransfer.dropEffect = 'none';\n                    const wasDragOver = div.classList.contains('drag-over');\n                    const wasNestTarget = div.classList.contains('nest-target');\n                    div.classList.remove('drag-over');\n                    div.classList.remove('nest-target');\n                    if (wasDragOver || wasNestTarget) {\n                    }\n                    this.app.appState.nestTargetElement = null;\n                    // Debug logging disabled\n                    // console.log(' Not over element, set dropEffect=none');\n                }\n            }\n            \n            // Defensive check: ensure highlight is present when over child element or by position\n            if ((isOverChildElement || isOverElementByPosition) && dragData.type === 'element' && !div.classList.contains('drag-over')) {\n                div.classList.add('drag-over');\n                e.dataTransfer.dropEffect = 'move';\n            }\n            \n        });\n        \n        div.addEventListener('dragleave', (e) => {\n            const relatedTarget = e.relatedTarget;\n            \n            // First, check the actual mouse position to see if we're still over the element\n            // This is the most reliable check, especially when moving between child elements\n            const elementUnderMouse = document.elementFromPoint(e.clientX, e.clientY);\n            const stillOverElementByPosition = elementUnderMouse && (div.contains(elementUnderMouse) || elementUnderMouse === div);\n            const stillOverElementByBounds = isMouseInBounds(e.clientX, e.clientY);\n            \n            // If mouse is still over the element by position or bounds, ignore this dragleave\n            // This handles the case when moving between child elements within the same parent\n            if (stillOverElementByPosition || stillOverElementByBounds) {\n                // Clear any pending timeout since we're still over the element\n                if (dragLeaveTimeoutRef.value) {\n                    clearTimeout(dragLeaveTimeoutRef.value);\n                    dragLeaveTimeoutRef.value = null;\n                }\n                return; // Don't process leave at all\n            }\n            \n            // Check if relatedTarget is still within this div (even if it's a different child)\n            // This handles the architectural case: when moving from child A to child B,\n            // relatedTarget will be child B or a descendant of child B\n            let isRelatedTargetStillInDiv = false;\n            \n            if (relatedTarget) {\n                // Handle text nodes: walk up to find the containing element\n                let nodeToCheck = relatedTarget;\n                if (relatedTarget.nodeType === Node.TEXT_NODE) {\n                    nodeToCheck = relatedTarget.parentElement;\n                }\n                \n                // Walk up the DOM tree to see if any ancestor is contained in this div\n                // This catches cases where relatedTarget is deeply nested\n                while (nodeToCheck && nodeToCheck !== div) {\n                    if (div.contains(nodeToCheck)) {\n                        isRelatedTargetStillInDiv = true;\n                        break;\n                    }\n                    nodeToCheck = nodeToCheck.parentElement;\n                }\n                \n                // Also check if relatedTarget is the div itself\n                if (nodeToCheck === div) {\n                    isRelatedTargetStillInDiv = true;\n                }\n            }\n            \n            // If relatedTarget (or any of its ancestors) is still within this div, ignore dragleave\n            // This is the key architectural fix: we're moving between children, not leaving the parent\n            if (isRelatedTargetStillInDiv) {\n            // Clear any pending timeout\n            if (dragLeaveTimeoutRef.value) {\n                clearTimeout(dragLeaveTimeoutRef.value);\n                dragLeaveTimeoutRef.value = null;\n            }\n                return; // Don't process leave - we're still within the element\n            }\n            \n            // Clear any pending timeout\n            if (dragLeaveTimeoutRef.value) {\n                clearTimeout(dragLeaveTimeoutRef.value);\n                dragLeaveTimeoutRef.value = null;\n            }\n            \n            // We're actually leaving the element - process the leave\n                // Clear the flag immediately when leaving\n                isDraggingOverRef.value = false;\n                \n            // Use a timeout to verify we're really leaving (defensive check)\n                dragLeaveTimeoutRef.value = setTimeout(() => {\n                    // Check if flag is still set (meaning a dragover fired since dragleave)\n                    if (isDraggingOverRef.value) {\n                        dragLeaveTimeoutRef.value = null;\n                        return;\n                    }\n                    \n                    // Verify we're really leaving by checking:\n                    // 1. Mouse position is outside element bounds\n                    // 2. Element under mouse is not this element or a child\n                const elementUnderMouseDelayed = document.elementFromPoint(e.clientX, e.clientY);\n                const stillOverElementByTarget = elementUnderMouseDelayed && (div.contains(elementUnderMouseDelayed) || elementUnderMouseDelayed === div);\n                const stillOverElementByBoundsDelayed = isMouseInBounds(e.clientX, e.clientY);\n                const stillOverElement = stillOverElementByTarget || stillOverElementByBoundsDelayed;\n                    \n                    // Only remove if we're definitely not over the element\n                    if (!stillOverElement) {\n                        div.classList.remove('drag-over');\n                        div.classList.remove('nest-target');\n                        if (this.app.appState.currentDragOverElement === div) {\n                            this.app.appState.currentDragOverElement = null;\n                        }\n                        if (this.app.appState.nestTargetElement && this.app.appState.nestTargetElement.pageId === pageId && \n                            this.app.appState.nestTargetElement.elementIndex === elementIndex) {\n                            this.app.appState.nestTargetElement = null;\n                        }\n                    }\n                    dragLeaveTimeoutRef.value = null;\n                }, 30); // Reduced timeout for faster response\n        });\n        \n        \n        div.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation(); // Prevent page drop from handling this\n            \n            // Clear the dragging flag on drop\n            isDraggingOverRef.value = false;\n            \n            // Clear all drag-over classes on drop (defensive cleanup)\n            document.querySelectorAll('.element.drag-over, .element.nest-target').forEach(el => {\n                el.classList.remove('drag-over');\n                el.classList.remove('nest-target');\n            });\n            this.app.appState.currentDragOverElement = null;\n            \n            // Find the actual element div that was dropped on (might be different if dropped on checkbox)\n            let actualElementDiv = div;\n            if (e.target && e.target.type === 'checkbox') {\n                actualElementDiv = e.target.closest('.element') || div;\n            } else if (e.target && e.target.closest('input[type=\"checkbox\"]')) {\n                actualElementDiv = e.target.closest('.element') || div;\n            }\n            \n            // Get the correct pageId and elementIndex from the actual element div\n            const actualPageId = actualElementDiv.dataset.pageId || pageId;\n            const actualBinId = actualElementDiv.dataset.binId || binId;\n            const actualElementIndexStr = actualElementDiv.dataset.elementIndex;\n            let actualElementIndex = elementIndex;\n            if (actualElementIndexStr) {\n                if (typeof actualElementIndexStr === 'string' && actualElementIndexStr.includes('-')) {\n                    actualElementIndex = actualElementIndexStr; // Keep as string for child elements\n                } else {\n                    actualElementIndex = parseInt(actualElementIndexStr);\n                }\n            }\n            \n            div.classList.remove('drag-over');\n            div.classList.remove('nest-target');\n            \n            let dragData = this.app.appState.dragData;\n            if (!dragData) {\n                try {\n                    const dataStr = e.dataTransfer.getData('text/plain');\n                    if (dataStr) {\n                        dragData = JSON.parse(dataStr);\n                    } else {\n                        console.error('No drag data available in element drop');\n                        return;\n                    }\n                } catch (err) {\n                    console.error('Failed to parse drag data:', err);\n                    return;\n                }\n            }\n            \n            // PRIORITY: Check for drop indicator position first (this is where the user intended to drop)\n            // Check nested children container indicator first (if dragging child elements)\n            const childrenContent = div.closest('.dropdown-content');\n            let indicatorTargetIndex = null;\n            let indicatorIsChild = false;\n            \n            if (dragData.isChild && childrenContent && childrenContent._dropTargetIndex !== null && childrenContent._dropTargetIndex !== undefined) {\n                // Using nested children container indicator\n                indicatorTargetIndex = childrenContent._dropTargetIndex;\n                indicatorIsChild = true;\n                // Clear the indicator\n                if (childrenContent._dropIndicator) {\n                    childrenContent._dropIndicator.remove();\n                    childrenContent._dropIndicator = null;\n                }\n                childrenContent._dropTargetIndex = null;\n            } else {\n                // Check elements list indicator\n                const elementsList = div.closest('.elements-list');\n                if (elementsList && elementsList._dropTargetIndex !== null && elementsList._dropTargetIndex !== undefined) {\n                    indicatorTargetIndex = elementsList._dropTargetIndex;\n                    indicatorIsChild = false;\n                    // Clear the indicator\n                    if (elementsList._dropIndicator) {\n                        elementsList._dropIndicator.remove();\n                        elementsList._dropIndicator = null;\n                    }\n                    elementsList._dropTargetIndex = null;\n                }\n            }\n            \n            // console.log('Element drop event:', dragData, 'onto element:', actualPageId, actualElementIndex, 'target:', e.target.tagName, e.target.type);\n            \n            // Parse target element index properly (handle both regular and child elements)\n            const targetIsChild = actualElementDiv.dataset.isChild === 'true';\n            const targetParentIndex = actualElementDiv.dataset.elementIndex ? parseInt(actualElementDiv.dataset.elementIndex.split('-')[0]) : null;\n            let targetElementIndex = actualElementIndex;\n            if (typeof actualElementIndex === 'string' && actualElementIndex.includes('-')) {\n                // If dropping on a child element, use the parent's index\n                // This will be adjusted later based on whether we're nesting or un-nesting\n                targetElementIndex = parseInt(actualElementIndex.split('-')[0]);\n            } else {\n                targetElementIndex = parseInt(actualElementIndex);\n            }\n            \n            // If we have an indicator position, use it instead of the element position\n            if (indicatorTargetIndex !== null) {\n                if (indicatorIsChild) {\n                    // Indicator is for nested children - use the parent's index and child index\n                    targetElementIndex = targetParentIndex !== null ? targetParentIndex : targetElementIndex;\n                } else {\n                    // Indicator is for regular elements - use the indicator index\n                    targetElementIndex = indicatorTargetIndex;\n                }\n            }\n            \n            // Check if nesting should occur (dropped over checkbox or child element) - MUST check before clearing nestTargetElement\n            const target = e.target;\n            // Check if we're over a checkbox - need to find the element that contains this checkbox\n            let checkbox = null;\n            if (target && target.type === 'checkbox') {\n                checkbox = target;\n            } else if (target) {\n                checkbox = target.closest('input[type=\"checkbox\"]');\n            }\n            const isOverCheckbox = checkbox !== null;\n            \n            // If we found a checkbox, find the element that contains it\n            let checkboxElement = null;\n            let checkboxElementIndex = targetElementIndex;\n            if (isOverCheckbox && checkbox) {\n                checkboxElement = checkbox.closest('.element');\n                if (checkboxElement) {\n                    const checkboxPageId = checkboxElement.dataset.pageId;\n                    const checkboxBinId = checkboxElement.dataset.binId;\n                    const checkboxElementIndexStr = checkboxElement.dataset.elementIndex;\n                    // Use actualPageId and actualBinId from the drop event, not the renderElement scope\n                    if (checkboxPageId === actualPageId && checkboxBinId === actualBinId && checkboxElementIndexStr) {\n                        if (typeof checkboxElementIndexStr === 'string' && checkboxElementIndexStr.includes('-')) {\n                            checkboxElementIndex = parseInt(checkboxElementIndexStr.split('-')[0]);\n                        } else {\n                            checkboxElementIndex = parseInt(checkboxElementIndexStr);\n                        }\n                    }\n                }\n            }\n            \n            const savedNestTarget = this.app.appState.nestTargetElement; // Save before clearing\n            // Nesting occurs if:\n            // 1. Dropped over checkbox AND nestTargetElement matches, OR\n            // 2. Dropped over a child element (targetIsChild) AND we're not dragging a child (will nest under parent)\n            let shouldNest = (isOverCheckbox && savedNestTarget && \n                savedNestTarget.pageId === actualPageId && \n                savedNestTarget.binId === actualBinId &&\n                savedNestTarget.elementIndex === checkboxElementIndex) ||\n                (targetIsChild && !dragData.isChild && savedNestTarget &&\n                savedNestTarget.pageId === actualPageId &&\n                savedNestTarget.binId === actualBinId &&\n                savedNestTarget.elementIndex === targetParentIndex);\n            \n            // console.log('Nesting check:', {\n            //     isOverCheckbox,\n            //     checkboxFound: !!checkbox,\n            //     checkboxElement: !!checkboxElement,\n            //     checkboxElementIndex,\n            //     savedNestTarget,\n            //     actualPageId,\n            //     pageId,\n            //     targetElementIndex,\n            //     actualElementIndex,\n            //     shouldNest,\n            //     targetType: target ? target.type : 'none',\n            //     targetTag: target ? target.tagName : 'none',\n            //     actualElementDiv: actualElementDiv === div ? 'same' : 'different'\n            // });\n            \n            // Clear nesting state (after checking)\n            this.app.appState.nestTargetElement = null;\n            \n            if (dragData && dragData.type === 'element') {\n                // Log element mouse is released over\n                const { group: targetGroup } = this._getGroupByIds(actualPageId, actualBinId);\n                let targetElement = null;\n                let targetElementText = 'N/A';\n                \n                if (targetIsChild && targetParentIndex !== null) {\n                    const parentElement = targetGroup ? this._getRootItemByIndex(targetGroup, targetParentIndex) : null;\n                    const childIdx = typeof actualElementIndex === 'string' ? parseInt(actualElementIndex.split('-')[1]) : 0;\n                    targetElement = parentElement ? this._getChildItemByIndex(targetGroup, parentElement, childIdx) : null;\n                    targetElementText = targetElement?.text || 'N/A';\n                } else {\n                    targetElement = targetGroup ? this._getRootItemByIndex(targetGroup, targetElementIndex) : null;\n                    targetElementText = targetElement?.text || 'N/A';\n                }\n                \n                // Check if we're dropping a child on its own parent (should un-nest, not nest)\n                const isDroppingChildOnOwnParent = dragData.isChild && \n                    !targetIsChild && \n                    dragData.parentElementIndex !== null &&\n                    targetElementIndex === dragData.parentElementIndex;\n                \n                // IMPORTANT: If dropping a child on its own parent (not checkbox), we should un-nest, not nest\n                // Override shouldNest to false in this case\n                const originalShouldNest = shouldNest;\n                if (isDroppingChildOnOwnParent && !isOverCheckbox) {\n                    shouldNest = false;\n                    // Debug logging disabled\n                    // console.log(' OVERRIDING shouldNest: was', originalShouldNest, 'now', shouldNest, 'because dropping child on own parent (not checkbox)');\n                }\n                \n                // Debug logging disabled\n                // console.log(' ELEMENT RELEASED OVER:', {\n                //     page: actualPageId,\n                //     index: targetElementIndex,\n                //     isChild: targetIsChild,\n                //     parentIndex: targetParentIndex,\n                //     text: targetElementText,\n                //     location: `${actualPageId}-${targetElementIndex}${targetIsChild ? ` (child of ${targetParentIndex})` : ''}`,\n                //     dragDataParentIndex: dragData.parentElementIndex,\n                //     isDroppingChildOnOwnParent: isDroppingChildOnOwnParent,\n                //     isOverCheckbox: isOverCheckbox,\n                //     shouldNest: shouldNest,\n                //     originalShouldNest: originalShouldNest,\n                //     operation: shouldNest ? 'NEST' : (targetIsChild && !dragData.isChild) ? 'NEST_AS_CHILD' : \n                //               (dragData.isChild && targetIsChild && dragData.parentElementIndex === targetParentIndex) ? 'REORDER_CHILDREN' :\n                //               (dragData.isChild && targetIsChild) ? 'MOVE_CHILD_TO_PARENT' :\n                //               (dragData.isChild) ? 'UNNEST' : 'MOVE'\n                // });\n                \n                if (shouldNest) {\n                    // Nesting: drop on checkbox or child element - un-nest if child, then nest under new parent\n                    // Use checkboxElementIndex if we dropped on a checkbox, otherwise use targetParentIndex for child elements\n                    const nestTargetIndex = isOverCheckbox ? checkboxElementIndex : (targetIsChild ? targetParentIndex : targetElementIndex);\n                    \n                    // If dropping on a checkbox, always treat as regular element nesting (not child nesting)\n                    // This ensures it becomes a direct child, not a grandchild\n                    if (isOverCheckbox) {\n                        // Check if source is currently a child - if so, we need to un-nest it first\n                        if (dragData.isChild && dragData.parentElementIndex !== null && dragData.childIndex !== null) {\n                            // First un-nest: move the child to become a regular element\n                            // We'll place it temporarily, then nest it\n                            const { group: sourceGroup } = this._getGroupByIds(dragData.pageId, dragData.binId);\n                            const parentElement = sourceGroup ? this._getRootItemByIndex(sourceGroup, dragData.parentElementIndex) : null;\n                            const childElement = parentElement ? this._getChildItemByIndex(sourceGroup, parentElement, dragData.childIndex) : null;\n                            if (parentElement && childElement) {\n                                if (!Array.isArray(parentElement.childIds)) {\n                                    parentElement.childIds = [];\n                                }\n                                parentElement.childIds.splice(dragData.childIndex, 1);\n                                childElement.parentId = null;\n                                // Now nest it as a regular element (not a child)\n                                this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.parentElementIndex, actualPageId, actualBinId, nestTargetIndex,\n                                    false, null, null, childElement);\n                            } else {\n                                // Fallback: use original logic\n                                const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                                if (pageFormat) {\n                                    this.app.renderService.getRenderer()._preservingFormat = true;\n                                }\n                                this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, nestTargetIndex,\n                                    dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                            }\n                        } else {\n                            // Source is already a regular element, nest normally\n                            const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                            if (pageFormat) {\n                                this.app.renderService.getRenderer()._preservingFormat = true;\n                            }\n                            this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, nestTargetIndex,\n                                false, null, null);\n                        }\n                    } else {\n                        // Not dropping on checkbox - but check if we're dropping a child on its own parent\n                        // If so, we should un-nest instead of nest\n                        if (isDroppingChildOnOwnParent) {\n                            // Don't nest - fall through to un-nest logic below\n                            // This will be handled by the else if (dragData.isChild) block\n                        } else {\n                            // Not dropping on checkbox and not dropping on own parent - use original nesting logic\n                            const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                            if (pageFormat) {\n                                this.app.renderService.getRenderer()._preservingFormat = true;\n                            }\n                            this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, nestTargetIndex,\n                                dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                        }\n                    }\n                } else if (targetIsChild && !dragData.isChild) {\n                    // Dropping a regular element over a child element - nest it as a child of the same parent\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, targetParentIndex,\n                        false, null, null);\n                } else if (dragData.isChild && targetIsChild && dragData.parentElementIndex === targetParentIndex) {\n                    // Rearranging nested children within the same parent\n                    // Use indicator position if available (from nested children container), otherwise use element position\n                    let targetChildIndex = null;\n                    if (indicatorIsChild && indicatorTargetIndex !== null) {\n                        targetChildIndex = indicatorTargetIndex;\n                    } else {\n                        targetChildIndex = typeof actualElementIndex === 'string' ? parseInt(actualElementIndex.split('-')[1]) : 0;\n                    }\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.app.reorderChildElement(actualPageId, actualBinId, dragData.parentElementIndex, dragData.childIndex, targetChildIndex);\n                } else if (dragData.isChild && targetIsChild) {\n                    // Child element being moved to different parent - nest under target's parent\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.this.app.nestElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, targetParentIndex,\n                        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                } else if (dragData.isChild) {\n                    // Child element being un-nested and moved to a new position\n                    // When dropped on a regular (non-nested) element (including its own parent), \n                    // always un-nest and place above the target element\n                    \n                    // IMPORTANT: When dropping a child on its parent (not checkbox), un-nest and place above parent\n                    const isDroppingOnOwnParent = !targetIsChild && \n                        dragData.parentElementIndex !== null &&\n                        targetElementIndex === dragData.parentElementIndex;\n                    \n                    // Use indicator position if available (from elements list), otherwise use element position\n                    let unnestTargetIndex = indicatorTargetIndex !== null && !indicatorIsChild ? indicatorTargetIndex : targetElementIndex;\n                    \n                    // Check if we're dropping on the parent itself or a sibling\n                    const isDroppingOnParent = isDroppingOnOwnParent;\n                    const isDroppingOnSibling = !targetIsChild && \n                        dragData.parentElementIndex !== null &&\n                        targetElementIndex !== dragData.parentElementIndex;\n                    \n                    if (targetIsChild && targetParentIndex !== null) {\n                        // Dropped on a child element - place above its parent\n                        unnestTargetIndex = targetParentIndex;\n                    } else if (!targetIsChild && dragData.parentElementIndex !== null) {\n                        // Dropped on a regular element (not nested) - un-nest and place appropriately\n                        // This handles:\n                        // - Dropping before the parent (un-nest and place at target position, which is above)\n                        // - Dropping on the parent itself (un-nest and place above parent)\n                        // - Dropping on any other element (un-nest and place above target element)\n                        const { group: sourceGroup } = this._getGroupByIds(dragData.pageId, dragData.binId);\n                        if (sourceGroup && actualPageId === dragData.pageId && sourceGroup.items?.[dragData.parentElementIndex]) {\n                            // Check if dropping on the parent itself\n                            const isDroppingOnParent = targetElementIndex === dragData.parentElementIndex;\n                            \n                            if (isDroppingOnParent) {\n                                // Dropping on parent: place above parent\n                                unnestTargetIndex = dragData.parentElementIndex;\n                            } else if (targetElementIndex < dragData.parentElementIndex) {\n                                // Dropping before parent: use the target position (places above target)\n                                unnestTargetIndex = targetElementIndex;\n                            } else {\n                                // Dropping on element after parent: place above target element\n                                unnestTargetIndex = targetElementIndex;\n                            }\n                            \n                            // splice can insert at array.length to append, so we allow parentIndex + 1\n                            // even if it equals or exceeds the array length (it will be handled in moveElement)\n                            // No clamping needed here - moveElement will handle it correctly\n                        }\n                    }\n                    \n                    console.log(' UNNESTING CHILD:', {\n                        sourcePage: dragData.pageId,\n                        parentIndex: dragData.parentElementIndex,\n                        childIndex: dragData.childIndex,\n                        targetPage: actualPageId,\n                        targetElementIndex: targetElementIndex,\n                        targetIsChild: targetIsChild,\n                        isDroppingOnParent: isDroppingOnParent,\n                        isDroppingOnSibling: isDroppingOnSibling,\n                        calculatedTargetIndex: unnestTargetIndex,\n                        sourceBinElementsLength: this._getGroupByIds(dragData.pageId, dragData.binId).group?.items?.length || 0,\n                        parentElementBefore: (() => {\n                            const { group } = this._getGroupByIds(dragData.pageId, dragData.binId);\n                            const parentElement = this._getRootItemByIndex(group, dragData.parentElementIndex);\n                            return parentElement?.childIds?.length || 0;\n                        })(),\n                        willUnnest: true\n                    });\n                    \n                    // Always un-nest when dropping a child on a regular element (including its own parent)\n                    // dragData.elementIndex is the parent's index when isChild is true\n                    // For un-nesting, we must pass isChild=true, parentElementIndex, and childIndex\n                    // Ensure we have the correct values for un-nesting\n                    // dragData.elementIndex is the parent's index when isChild is true\n                    const unnestIsChild = dragData.isChild === true; // Explicitly check for true\n                    const unnestParentIndex = dragData.parentElementIndex;\n                    const unnestChildIndex = dragData.childIndex;\n                    \n                    console.log(' CALLING moveElement FOR UNNEST:', {\n                        sourcePageId: dragData.pageId,\n                        sourceElementIndex: dragData.elementIndex,\n                        targetPageId: actualPageId,\n                        targetElementIndex: unnestTargetIndex,\n                        isChild: dragData.isChild,\n                        isChildType: typeof dragData.isChild,\n                        isChildValue: unnestIsChild,\n                        parentElementIndex: unnestParentIndex,\n                        childIndex: unnestChildIndex,\n                        dragDataKeys: Object.keys(dragData)\n                    });\n                    \n                    if (!unnestIsChild || unnestParentIndex === null || unnestParentIndex === undefined || unnestChildIndex === null || unnestChildIndex === undefined) {\n                        console.error(' INVALID UNNEST PARAMETERS:', {\n                            isChild: unnestIsChild,\n                            parentElementIndex: unnestParentIndex,\n                            childIndex: unnestChildIndex,\n                            dragData: dragData\n                        });\n                        return;\n                    }\n                    \n                    // Preserve format if using a format renderer\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, unnestTargetIndex,\n                        unnestIsChild, unnestParentIndex, unnestChildIndex);\n                } else if (dragData.pageId !== actualPageId) {\n                    // Moving to different page\n                    // Preserve format if using a format renderer\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, targetElementIndex,\n                        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                } else {\n                    // Moving within same page\n                    // Preserve format if using a format renderer\n                    const pageFormat = this.app.formatRendererManager?.getPageFormat(actualPageId);\n                    if (pageFormat) {\n                        this.app.renderService.getRenderer()._preservingFormat = true;\n                    }\n                    this.app.moveElement(dragData.pageId, dragData.binId, dragData.elementIndex, actualPageId, actualBinId, targetElementIndex,\n                        dragData.isChild || false, dragData.parentElementIndex || null, dragData.childIndex || null);\n                }\n            }\n\n            // Clear drag data\n            this.app.appState.dragData = null;\n        });\n        \n        let tooltipText = '';\n        if (element.timeAllocated) {\n            tooltipText += `Time: ${element.timeAllocated}`;\n        }\n        if (element.funModifier) {\n            tooltipText += tooltipText ? ` | Fun: ${element.funModifier}` : `Fun: ${element.funModifier}`;\n        }\n        \n        // Delegate to element type renderer (pass renderChildren so type renderers can render nested children)\n        this.typeRegistry.renderElement(div, pageId, binId, element, elementIndex, depth, (pageId, binId, parentElement, parentElementIndex, depth) => {\n            return this.renderChildren(pageId, binId, parentElement, parentElementIndex, depth);\n        });\n        \n        // Add relationship indicators if element has relationships\n        if (element.relationships) {\n            const hasRelationships = \n                (element.relationships.blocks?.length > 0) ||\n                (element.relationships.dependsOn?.length > 0) ||\n                (element.relationships.relatedTo?.length > 0);\n            \n            if (hasRelationships) {\n                const relationshipIndicator = document.createElement('span');\n                relationshipIndicator.className = 'relationship-indicator';\n                relationshipIndicator.textContent = '';\n                relationshipIndicator.title = 'Has relationships - click to manage';\n                relationshipIndicator.style.cssText = 'margin-left: 8px; cursor: pointer; font-size: 14px; opacity: 0.7;';\n                relationshipIndicator.addEventListener('click', (e) => {\n                    e.stopPropagation();\n                    const elementId = this.app.relationshipManager.getElementId(pageId, binId, elementIndex);\n                    const relationships = this.app.relationshipManager.getRelationships(elementId);\n                    const inverseRelationships = this.app.relationshipManager.getInverseRelationships(elementId);\n                    \n                    // Show relationships modal\n                    const modal = document.getElementById('modal');\n                    const modalBody = document.getElementById('modal-body');\n                    \n                    let html = `\n                        <h3>Element Relationships</h3>\n                        <div class=\"relationships-section\">\n                            <h4>Outgoing Relationships</h4>\n                            <div id=\"outgoing-relationships\">\n                    `;\n                    \n                    if (relationships.length === 0) {\n                        html += '<p>No outgoing relationships</p>';\n                    } else {\n                        relationships.forEach(rel => {\n                            const target = this.app.relationshipManager.getElement(rel.to);\n                            if (target) {\n                                html += `\n                                    <div class=\"relationship-item\">\n                                        <span class=\"relationship-type\">${rel.type}</span>\n                                        <span class=\"relationship-target\">${this.app.escapeHtml(target.element.text || 'Untitled')}</span>\n                                        <button class=\"remove-relationship\" data-to=\"${rel.to}\" data-type=\"${rel.type}\">Remove</button>\n                                    </div>\n                                `;\n                            }\n                        });\n                    }\n                    \n                    html += `\n                            </div>\n                            <h4>Incoming Relationships</h4>\n                            <div id=\"incoming-relationships\">\n                    `;\n                    \n                    if (inverseRelationships.length === 0) {\n                        html += '<p>No incoming relationships</p>';\n                    } else {\n                        inverseRelationships.forEach(rel => {\n                            const source = this.app.relationshipManager.getElement(rel.from);\n                            if (source) {\n                                html += `\n                                    <div class=\"relationship-item\">\n                                        <span class=\"relationship-source\">${this.app.escapeHtml(source.element.text || 'Untitled')}</span>\n                                        <span class=\"relationship-type\">${rel.type}</span>\n                                        <span>this element</span>\n                                    </div>\n                                `;\n                            }\n                        });\n                    }\n                    \n                    html += `\n                            </div>\n                            <div class=\"add-relationship-section\">\n                                <h4>Add Relationship</h4>\n                                <select id=\"relationship-type\">\n                                    ${this.app.relationshipManager.getRelationshipTypes().map(relType => \n                                        `<option value=\"${relType.type}\">${relType.label}${relType.description ? ` - ${relType.description}` : ''}</option>`\n                                    ).join('')}\n                                </select>\n                                <select id=\"relationship-target\">\n                                    <option value=\"\">Select item...</option>\n                    `;\n                    \n                    // Add all items as options\n                    this.app.appState.documents.forEach((doc) => {\n                        if (doc.groups) {\n                            doc.groups.forEach((group) => {\n                                const items = group.items || [];\n                                group.items = items;\n                                items.forEach((el, idx) => {\n                                    const targetId = this.app.relationshipManager.getElementId(doc.id, group.id, idx);\n                                    if (targetId !== elementId) {\n                                        html += `<option value=\"${targetId}\">${this.app.escapeHtml(el.text || 'Untitled')}</option>`;\n                                    }\n                                });\n                            });\n                        }\n                    });\n                    \n                    html += `\n                                </select>\n                                <button id=\"add-relationship-btn\">Add Relationship</button>\n                            </div>\n                            <div style=\"margin-top: 20px;\">\n                                <button class=\"cancel\" onclick=\"app.modalHandler.closeModal()\">Close</button>\n                            </div>\n                        </div>\n                    `;\n                    \n                    modalBody.innerHTML = html;\n                    modal.classList.add('active');\n                    \n                    // Add event listeners\n                    document.getElementById('add-relationship-btn').addEventListener('click', () => {\n                        const type = document.getElementById('relationship-type').value;\n                        const targetId = document.getElementById('relationship-target').value;\n                        \n                        if (!targetId) {\n                            alert('Please select a target element');\n                            return;\n                        }\n                        \n                        const success = this.app.relationshipManager.addRelationship(elementId, targetId, type);\n                        if (success) {\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            this.app.modalHandler.closeModal();\n                        } else {\n                            alert('Failed to add relationship. Check console for details.');\n                        }\n                    });\n                    \n                    // Remove relationship buttons\n                    document.querySelectorAll('.remove-relationship').forEach(btn => {\n                        btn.addEventListener('click', () => {\n                            const toId = btn.dataset.to;\n                            const type = btn.dataset.type;\n                            this.app.relationshipManager.removeRelationship(elementId, toId, type);\n                            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                            this.app.modalHandler.closeModal();\n                        });\n                    });\n                });\n                \n                // Add to task header if it exists, otherwise add to div\n                const taskHeader = div.querySelector('.task-header');\n                if (taskHeader) {\n                    taskHeader.appendChild(relationshipIndicator);\n                } else {\n                    div.appendChild(relationshipIndicator);\n                }\n            }\n        }\n        \n        // Add tags display if element has tags\n        if (element.tags && element.tags.length > 0) {\n            const tagsContainer = document.createElement('div');\n            tagsContainer.className = 'element-tags';\n            tagsContainer.style.cssText = 'display: flex; flex-wrap: wrap; gap: 3px; margin-top: 5px; font-size: 10px;';\n            \n            element.tags.forEach(tag => {\n                const tagSpan = document.createElement('span');\n                tagSpan.className = 'element-tag';\n                tagSpan.textContent = tag;\n                tagSpan.style.cssText = 'background: #4a9eff; color: white; padding: 2px 6px; border-radius: 10px;';\n                tagsContainer.appendChild(tagSpan);\n            });\n            \n            div.appendChild(tagsContainer);\n        }\n        \n        return div;\n    }\n\n}\n","// AnimationRenderer.js - Handles animation of element movements\r\n// Extracted from app.js to improve modularity\r\nimport { eventBus } from './EventBus.js';\r\nimport { EVENTS } from './AppEvents.js';\r\n\r\n/**\r\n * AnimationRenderer - Handles animation of element movements\r\n * \r\n * This class extracts animation logic from app.js to improve modularity.\r\n */\r\nexport class AnimationRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n    }\r\n    \r\n    animateMovements(oldPositions) {\r\n        console.log('');\r\n        console.log(' ANIMATION SEQUENCE STARTING');\r\n        console.log('');\r\n        console.log(' Old positions captured:', {\r\n            documents: Object.keys(oldPositions.documents || {}).length,\r\n            items: Object.keys(oldPositions.items || {}).length\r\n        });\r\n        const binCount = document.querySelectorAll('.bin').length;\r\n        const elementCount = document.querySelectorAll('.element').length;\r\n        console.log(` Current DOM: ${binCount} groups, ${elementCount} items`);\r\n        \r\n        if (this.app.appState.lastMovedElement) {\r\n            console.log(' Item being moved:', {\r\n                pageId: this.app.appState.lastMovedElement.pageId,\r\n                elementIndex: this.app.appState.lastMovedElement.elementIndex,\r\n                elementText: this.app.appState.lastMovedElement.element?.text?.substring(0, 30) || 'N/A'\r\n            });\r\n        } else {\r\n            console.log('  No lastMovedElement tracked - this might be initial render');\r\n        }\r\n        \r\n        // Animate documents\r\n        let pageAnimations = 0;\r\n        document.querySelectorAll('.page').forEach(pageElement => {\r\n            const pageId = pageElement.dataset.pageId;\r\n            if (!pageId) return;\r\n            \r\n            const oldPos = oldPositions.documents[pageId];\r\n            if (!oldPos) {\r\n                console.log(` Document ${pageId}: New document, skipping animation`);\r\n                return; // New document, no animation needed\r\n            }\r\n            \r\n            const newRect = pageElement.getBoundingClientRect();\r\n            const deltaY = oldPos.top - newRect.top;\r\n            const deltaX = oldPos.left - newRect.left;\r\n            \r\n            if (Math.abs(deltaY) > 1 || Math.abs(deltaX) > 1) {\r\n                pageAnimations++;\r\n                console.log(` Document ${pageId}: Animating (deltaY: ${deltaY.toFixed(2)}px, deltaX: ${deltaX.toFixed(2)}px)`);\r\n                // Documents just slide smoothly - no pop effects\r\n                pageElement.style.transition = 'transform 2.5s ease-out';\r\n                pageElement.style.transform = `translate(${deltaX}px, ${deltaY}px)`;\r\n                \r\n                // Force reflow to ensure the transform is applied\r\n                void pageElement.offsetHeight;\r\n                \r\n                // Wait for next frame, then remove transform to trigger CSS transition\r\n                requestAnimationFrame(() => {\r\n                    requestAnimationFrame(() => {\r\n                        // Now remove transform - this should trigger the transition\r\n                        pageElement.style.transform = '';\r\n                        \r\n                        // Clean up inline styles after animation completes\r\n                        setTimeout(() => {\r\n                            pageElement.style.transition = '';\r\n                            pageElement.style.transform = '';\r\n                        }, 2500);\r\n                    });\r\n                });\r\n            }\r\n        });\r\n        \r\n        // Animate items - match by content/text since indices change\r\n        let elementAnimations = 0;\r\n        let movingElementFound = false;\r\n        document.querySelectorAll('.element').forEach(elementNode => {\r\n            const pageId = elementNode.dataset.pageId;\r\n            const elementIndex = elementNode.dataset.elementIndex;\r\n            if (!pageId || elementIndex === undefined) return;\r\n            \r\n            // Try to find matching old position by text content\r\n            const textElement = elementNode.querySelector('.task-text, .header-text, .audio-status');\r\n            let oldPos = null;\r\n            let matchMethod = 'none';\r\n            \r\n            if (textElement) {\r\n                const text = (textElement.textContent || textElement.innerText || '').substring(0, 20);\r\n                // Search for matching element in old positions\r\n                for (const [key, pos] of Object.entries(oldPositions.items)) {\r\n                    if (pos.pageId === pageId && key.includes(text)) {\r\n                        oldPos = pos;\r\n                        matchMethod = 'text-content';\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // Fallback: try exact index match\r\n            if (!oldPos) {\r\n                const key = `${pageId}-${elementIndex}`;\r\n                oldPos = oldPositions.items[key];\r\n                if (oldPos) matchMethod = 'index';\r\n            }\r\n            \r\n            if (!oldPos) {\r\n                console.log(` Item ${pageId}-${elementIndex}: New item, skipping animation`);\r\n                return; // New item, no animation needed\r\n            }\r\n            \r\n            const newRect = elementNode.getBoundingClientRect();\r\n            let deltaY = oldPos.top - newRect.top;\r\n            let deltaX = oldPos.left - newRect.left;\r\n            \r\n            // Debug logging for position calculations\r\n            if (Math.abs(deltaX) > 10) {\r\n                console.log(`    Position debug for ${pageId}-${elementIndex}:`);\r\n                console.log(`      Old: left=${oldPos.left.toFixed(2)}, top=${oldPos.top.toFixed(2)}`);\r\n                console.log(`      New: left=${newRect.left.toFixed(2)}, top=${newRect.top.toFixed(2)}`);\r\n                console.log(`      Delta: deltaX=${deltaX.toFixed(2)}, deltaY=${deltaY.toFixed(2)}`);\r\n            }\r\n            \r\n            if (Math.abs(deltaY) > 1 || Math.abs(deltaX) > 1) {\r\n                elementAnimations++;\r\n                \r\n                // Check if this is the element that was just moved\r\n                // Use more precise matching: check both new position AND old position\r\n                let isMovingElement = false;\r\n                if (this.app.appState.lastMovedElement) {\r\n                    const currentIsChild = elementNode.dataset.isChild === 'true';\r\n                    const currentChildIndex = elementNode.dataset.childIndex;\r\n                    const trackedWasChild = this.app.appState.lastMovedElement.oldElementIndex !== null && \r\n                        typeof this.app.appState.lastMovedElement.oldElementIndex === 'string' && \r\n                        this.app.appState.lastMovedElement.oldElementIndex.includes('-');\r\n                    \r\n                    // Check if new position matches\r\n                    const newIndexMatch = this.app.appState.lastMovedElement.pageId === pageId && \r\n                        this.app.appState.lastMovedElement.elementIndex === parseInt(elementIndex);\r\n                    \r\n                    // Check if this is a child element - if so, it can't be the moving element unless the moved element was also a child\r\n                    if (currentIsChild && !trackedWasChild) {\r\n                        // This is a nested child, but the moved element was not a child - skip\r\n                        if (newIndexMatch) {\r\n                            console.log(`     Index match but element is nested child (not the moved element)`);\r\n                        }\r\n                    } else {\r\n                        // Get element text for verification\r\n                        const currentText = textElement ? (textElement.textContent || textElement.innerText || '').trim().substring(0, 50) : '';\r\n                        const trackedText = (this.app.appState.lastMovedElement.element?.text || '').trim().substring(0, 50);\r\n                        const textMatch = currentText === trackedText && currentText.length > 0;\r\n                        \r\n                        // If we have a directly captured old position, use it instead of the matched one\r\n                        if (this.app.appState.lastMovedElement.oldPosition && newIndexMatch && textMatch) {\r\n                            // Use the directly captured position - this is more accurate\r\n                            deltaY = this.app.appState.lastMovedElement.oldPosition.top - newRect.top;\r\n                            deltaX = this.app.appState.lastMovedElement.oldPosition.left - newRect.left;\r\n                            \r\n                            // Match if: new position matches AND text matches AND has significant movement\r\n                            isMovingElement = newIndexMatch && textMatch && Math.abs(deltaY) > 10;\r\n                            \r\n                            if (isMovingElement) {\r\n                                console.log(`    Using directly captured old position: (${this.app.appState.lastMovedElement.oldPosition.left.toFixed(2)}, ${this.app.appState.lastMovedElement.oldPosition.top.toFixed(2)})`);\r\n                            }\r\n                        } else {\r\n                            // Match if: new position matches AND text matches AND has significant movement\r\n                            // This ensures we only match the actual moved element, not its children or other elements\r\n                            isMovingElement = newIndexMatch && textMatch && Math.abs(deltaY) > 10;\r\n                        }\r\n                        \r\n                        if (newIndexMatch && !isMovingElement) {\r\n                            console.log(`     Index match but not moving element: textMatch=${textMatch} (current=\"${currentText}\", tracked=\"${trackedText}\"), deltaY=${deltaY.toFixed(2)}`);\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                if (isMovingElement) {\r\n                    movingElementFound = true;\r\n                    console.log(` MOVING ELEMENT ${pageId}-${elementIndex}:`);\r\n                    console.log(`    Position change: deltaY=${deltaY.toFixed(2)}px, deltaX=${deltaX.toFixed(2)}px`);\r\n                    console.log(`    Matched by: ${matchMethod}`);\r\n                    console.log(`    Text: ${textElement ? (textElement.textContent || textElement.innerText || '').substring(0, 40) : 'N/A'}`);\r\n                } else {\r\n                    console.log(`  DISPLACED ELEMENT ${pageId}-${elementIndex}:`);\r\n                    console.log(`    Position change: deltaY=${deltaY.toFixed(2)}px, deltaX=${deltaX.toFixed(2)}px`);\r\n                    console.log(`    Matched by: ${matchMethod}`);\r\n                }\r\n                \r\n                if (isMovingElement) {\r\n                    // This is the element being moved - sequence: pop-out -> slide -> pop-in\r\n                    // Step 1: Start at old position (invert the delta) and pop out (scale up on z-axis only)\r\n                    // deltaY = oldPos.top - newRect.top, so positive means moved UP\r\n                    // To invert: translate DOWN by deltaY to appear at old position\r\n                    console.log(`    Step 1: Starting at old position, POP-OUT (scale 1.15, z-index 1000)`);\r\n                    console.log(`    Transform: translate(${deltaX.toFixed(2)}px, ${deltaY.toFixed(2)}px) scale(1.15)`);\r\n                    console.log(`    Old pos: (${oldPos.left.toFixed(2)}, ${oldPos.top.toFixed(2)}), New pos: (${newRect.left.toFixed(2)}, ${newRect.top.toFixed(2)})`);\r\n                    elementNode.style.transition = 'transform 0s, scale 0.3s ease-out, z-index 0s';\r\n                    elementNode.style.zIndex = '1000';\r\n                    // Invert the delta to start at old position, scale up for pop-out\r\n                    elementNode.style.transform = `translate(${deltaX}px, ${deltaY}px) scale(1.15)`;\r\n                    void elementNode.offsetHeight;\r\n                    \r\n                    // Step 2: After pop-out, slide to new position (remove translate, keep scale)\r\n                    setTimeout(() => {\r\n                        console.log(`    Step 2: POP-OUT complete, SLIDE to new position (scale 1.0)`);\r\n                        elementNode.style.transition = 'transform 2.5s ease-out, scale 0.3s ease-out';\r\n                        // Remove translate (goes to natural new position), scale back to 1.0\r\n                        elementNode.style.transform = 'scale(1.0)';\r\n                        void elementNode.offsetHeight;\r\n                        \r\n                        // Step 3: After slide completes, pop in (slight scale down)\r\n                        setTimeout(() => {\r\n                            console.log(`    Step 3: SLIDE complete, POP-IN (scale 1.05 -> 1.0)`);\r\n                            elementNode.style.transition = 'scale 0.2s ease-out, z-index 0s 0.2s';\r\n                            elementNode.style.transform = 'scale(1.05)';\r\n                            void elementNode.offsetHeight;\r\n                            \r\n                            requestAnimationFrame(() => {\r\n                                elementNode.style.transform = 'scale(1.0)';\r\n                                setTimeout(() => {\r\n                                    console.log(`    Step 4: POP-IN complete, animation finished`);\r\n                                    elementNode.style.zIndex = '';\r\n                                    elementNode.style.transition = '';\r\n                                    elementNode.style.transform = '';\r\n                                    this.app.appState.lastMovedElement = null; // Clear after animation\r\n                                }, 200);\r\n                            });\r\n                        }, 2500);\r\n                    }, 300);\r\n                } else {\r\n                    // This is a displaced element - slide to make space\r\n                    // Use FLIP: invert the delta, then remove transform to animate\r\n                    // deltaY = oldPos.top - newRect.top, so positive means moved UP\r\n                    // To invert: translate DOWN by deltaY to appear at old position\r\n                    console.log(`    Starting DISPLACE animation (2.5s slide)`);\r\n                    elementNode.style.transition = 'transform 2.5s ease-out';\r\n                    // Invert the delta to start at old position\r\n                    elementNode.style.transform = `translate(${deltaX}px, ${deltaY}px)`;\r\n                    void elementNode.offsetHeight;\r\n                    \r\n                    // Remove transform to trigger slide to new position\r\n                    requestAnimationFrame(() => {\r\n                        requestAnimationFrame(() => {\r\n                            console.log(`    DISPLACE animation triggered (removing transform)`);\r\n                            elementNode.style.transform = '';\r\n                            \r\n                            // Clean up after animation\r\n                            setTimeout(() => {\r\n                                console.log(`    DISPLACE animation complete`);\r\n                                elementNode.style.transition = '';\r\n                                elementNode.style.transform = '';\r\n                            }, 2500);\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        });\r\n        \r\n        console.log('');\r\n        console.log(` Animation Summary:`);\r\n        console.log(`    Pages animating: ${pageAnimations}`);\r\n        console.log(`    Elements animating: ${elementAnimations}`);\r\n        console.log(`    Moving element found: ${movingElementFound ? 'YES ' : 'NO '}`);\r\n        if (this.app.appState.lastMovedElement && !movingElementFound) {\r\n            console.log(`     WARNING: lastMovedElement was set but not found in DOM!`);\r\n            console.log(`      Expected: ${this.app.appState.lastMovedElement.pageId}-${this.app.appState.lastMovedElement.elementIndex}`);\r\n        }\r\n        console.log('');\r\n    }\r\n\r\n}\r\n","// PaneManager.js - Manages multiple panes/windows for viewing pages\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\nimport { DOMBuilder } from '../utils/DOMBuilder.js?v=103';\n\n/**\n * PaneManager - Manages multiple panes for viewing pages simultaneously\n * Supports split panes (horizontal/vertical), grid layouts, and multiple instances of the same page\n */\nexport class PaneManager {\n    constructor(app, appRenderer = null) {\n        this.app = app;\n        this.appRenderer = appRenderer; // Store reference to AppRenderer for accessing binRenderer\n        this.panes = new Map(); // Map of paneId -> pane data\n        this.nextPaneId = 1;\n        this.rootLayout = null; // Root layout container\n        \n        // Listen for page switching events\n        if (this.app.eventBus) {\n            this.app.eventBus.on(EVENTS.PAGE.SWITCHED, (data) => {\n                this.handlePageSwitch(data.pageId);\n            });\n            \n            // Listen for theme updates to refresh all panes\n            this.app.eventBus.on('theme:updated', () => {\n                this.updateThemesForAllPanes();\n            });\n        }\n    }\n    \n    /**\n     * Handle page switch - update active pane's tab or create new tab\n     */\n    handlePageSwitch(pageId) {\n        const allPanes = this.getAllPanes();\n        \n        // If only one pane, update its active tab\n        if (allPanes.length === 1) {\n            const pane = allPanes[0];\n            const activeTab = pane.tabs[pane.activeTabIndex];\n            \n            // Check if page is already open in a tab\n            const existingTabIndex = pane.tabs.findIndex(t => t.pageId === pageId);\n            \n            if (existingTabIndex !== -1) {\n                // Switch to existing tab\n                this.setActiveTab(pane.id, pane.tabs[existingTabIndex].id);\n            } else {\n                // Update active tab to show new page\n                const format = this.app.formatRendererManager?.getPageFormat(pageId) || null;\n                activeTab.pageId = pageId;\n                activeTab.format = format;\n                this.renderPane(pane);\n            }\n        } else if (allPanes.length > 1) {\n            // Multiple panes - find the first pane or create tab in first pane\n            const firstPane = allPanes[0];\n            const existingTabIndex = firstPane.tabs.findIndex(t => t.pageId === pageId);\n            \n            if (existingTabIndex !== -1) {\n                // Switch to existing tab\n                this.setActiveTab(firstPane.id, firstPane.tabs[existingTabIndex].id);\n            } else {\n                // Add new tab to first pane\n                this.addTabToPane(firstPane.id, pageId);\n            }\n        } else {\n            // No panes - create one\n            this.openPane(pageId);\n        }\n    }\n    \n    /**\n     * Initialize the pane system\n     */\n    initialize() {\n        // Create root layout container\n        const binsContainer = document.getElementById('bins-container');\n        if (!binsContainer) return;\n        \n        // Clear existing content\n        binsContainer.innerHTML = '';\n        \n        // Calculate header height dynamically\n        const header = document.querySelector('header');\n        const headerHeight = header ? header.offsetHeight : 60;\n        \n        binsContainer.style.cssText = `\n            width: 100vw !important;\n            height: calc(100vh - ${headerHeight}px) !important;\n            position: fixed !important;\n            top: ${headerHeight}px !important;\n            left: 0 !important;\n            right: 0 !important;\n            bottom: 0 !important;\n            overflow: hidden !important;\n            padding: 0 !important;\n            margin: 0 !important;\n            display: block !important;\n            max-width: none !important;\n            z-index: 1;\n            box-sizing: border-box !important;\n        `;\n        \n        // Also remove constraints from #app container when in multi-pane mode\n        const appContainer = document.getElementById('app');\n        if (appContainer) {\n            appContainer.style.cssText = `\n                max-width: none !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                width: 100vw !important;\n                height: 100vh !important;\n                position: relative !important;\n                overflow: hidden !important;\n            `;\n        }\n        \n        // Prevent body/html scrolling - only panes should scroll\n        document.body.style.cssText = `\n            margin: 0 !important;\n            padding: 0 !important;\n            overflow: hidden !important;\n            width: 100vw !important;\n            height: 100vh !important;\n        `;\n        \n        document.documentElement.style.cssText = `\n            margin: 0 !important;\n            padding: 0 !important;\n            overflow: hidden !important;\n            width: 100vw !important;\n            height: 100vh !important;\n        `;\n        \n        this.rootLayout = binsContainer;\n        \n        // Create initial single pane if no panes exist\n        if (this.panes.size === 0) {\n            const currentDocumentId = this.app.appState.currentDocumentId;\n            if (currentDocumentId) {\n                this.openPane(currentDocumentId);\n            }\n        }\n    }\n    \n    /**\n     * Open a new pane with a page\n     * @param {string} pageId - Page ID to open\n     * @param {string} format - Optional format to use\n     * @param {string} parentPaneId - Optional parent pane to split\n     * @param {string} direction - 'horizontal' or 'vertical' for splitting\n     * @returns {string} Pane ID\n     */\n    openPane(pageId, format = null, parentPaneId = null, direction = 'vertical') {\n        const paneId = `pane-${this.nextPaneId++}`;\n        \n        // Get page format if not specified\n        if (!format) {\n            format = this.app.formatRendererManager?.getPageFormat(pageId) || null;\n        }\n        \n        const pane = {\n            id: paneId,\n            tabs: [{ // Start with one tab\n                pageId: pageId,\n                format: format,\n                id: `tab-${Date.now()}-${Math.random()}`\n            }],\n            activeTabIndex: 0, // Index of active tab\n            element: null,\n            container: null,\n            size: parentPaneId ? 50 : 100, // Percentage size\n            parent: null,\n            children: [],\n            locked: false // Whether pane is locked (cannot be closed)\n        };\n        \n        this.panes.set(paneId, pane);\n        \n        // If splitting an existing pane\n        if (parentPaneId) {\n            this.splitPane(parentPaneId, paneId, direction);\n        } else {\n            // Create new root pane\n            this.renderPane(pane);\n        }\n        \n        // Emit event\n        eventBus.emit('pane:opened', { paneId, pageId, format });\n        \n        return paneId;\n    }\n    \n    /**\n     * Add a new tab to a pane\n     * @param {string} paneId - Pane ID\n     * @param {string} pageId - Page ID to open\n     * @param {string} format - Optional format to use\n     * @returns {string} Tab ID\n     */\n    addTabToPane(paneId, pageId, format = null) {\n        const pane = this.panes.get(paneId);\n        if (!pane) return null;\n        \n        // Get page format if not specified\n        if (!format) {\n            format = this.app.formatRendererManager?.getPageFormat(pageId) || null;\n        }\n        \n        const tab = {\n            pageId: pageId,\n            format: format,\n            id: `tab-${Date.now()}-${Math.random()}`\n        };\n        \n        pane.tabs.push(tab);\n        pane.activeTabIndex = pane.tabs.length - 1; // Activate new tab\n        \n        // Re-render pane to show new tab\n        this.renderPane(pane);\n        \n        // Emit event\n        eventBus.emit('tab:opened', { paneId, tabId: tab.id, pageId, format });\n        \n        return tab.id;\n    }\n    \n    /**\n     * Close a tab\n     * @param {string} paneId - Pane ID\n     * @param {string} tabId - Tab ID to close\n     */\n    closeTab(paneId, tabId) {\n        const pane = this.panes.get(paneId);\n        if (!pane || pane.tabs.length <= 1) return; // Don't close last tab\n        \n        const tabIndex = pane.tabs.findIndex(t => t.id === tabId);\n        if (tabIndex === -1) return;\n        \n        pane.tabs.splice(tabIndex, 1);\n        \n        // Adjust active tab index\n        if (pane.activeTabIndex >= pane.tabs.length) {\n            pane.activeTabIndex = pane.tabs.length - 1;\n        } else if (pane.activeTabIndex > tabIndex) {\n            pane.activeTabIndex--;\n        }\n        \n        // Re-render pane\n        this.renderPane(pane);\n        \n        // Emit event\n        eventBus.emit('tab:closed', { paneId, tabId });\n    }\n    \n    /**\n     * Set active tab in a pane\n     * @param {string} paneId - Pane ID\n     * @param {string} tabId - Tab ID to activate\n     */\n    setActiveTab(paneId, tabId) {\n        const pane = this.panes.get(paneId);\n        if (!pane) return;\n        \n        const tabIndex = pane.tabs.findIndex(t => t.id === tabId);\n        if (tabIndex === -1) return;\n        \n        pane.activeTabIndex = tabIndex;\n        this.renderPane(pane);\n    }\n    \n    /**\n     * Split an existing pane\n     * @param {string} existingPaneId - Pane to split\n     * @param {string} newPaneId - New pane ID (or null to create one)\n     * @param {string} direction - 'horizontal' or 'vertical'\n     * @param {string} newPageId - Page ID for new pane (or null to use same page)\n     * @param {string} newFormat - Format for new pane (or null to use same format)\n     */\n    splitPane(existingPaneId, newPaneId = null, direction = 'vertical', newPageId = null, newFormat = null) {\n        const existingPane = this.panes.get(existingPaneId);\n        if (!existingPane) return;\n        \n        // Create new pane if needed\n        if (!newPaneId) {\n            // Use active tab from existing pane or current page\n            const activeTab = existingPane.tabs[existingPane.activeTabIndex];\n            newPageId = newPageId || (activeTab ? activeTab.pageId : this.app.appState.currentDocumentId);\n            newFormat = newFormat || (activeTab ? activeTab.format : null);\n            newPaneId = this.openPane(newPageId, newFormat);\n        }\n        \n        const newPane = this.panes.get(newPaneId);\n        if (!newPane) return;\n        \n        // Create split container\n        const splitContainer = document.createElement('div');\n        splitContainer.className = 'pane-split-container';\n        splitContainer.dataset.direction = direction;\n        splitContainer.style.cssText = `\n            display: flex;\n            flex-direction: ${direction === 'horizontal' ? 'row' : 'column'};\n            width: 100%;\n            height: 100%;\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n        `;\n        \n        // Get existing pane's parent or use root\n        const parent = existingPane.parent || this.rootLayout;\n        const existingElement = existingPane.element;\n        \n        // Replace existing element with split container\n        if (existingElement && existingElement.parentNode) {\n            existingElement.parentNode.replaceChild(splitContainer, existingElement);\n        } else {\n            parent.appendChild(splitContainer);\n        }\n        \n        // Create panes in split\n        const pane1 = document.createElement('div');\n        pane1.className = 'pane-container';\n        pane1.dataset.paneId = existingPaneId;\n        pane1.style.cssText = `\n            flex: ${existingPane.size};\n            min-width: 0;\n            min-height: 0;\n            position: relative;\n            overflow: hidden;\n            width: 100%;\n            height: 100%;\n            border-right: ${direction === 'horizontal' ? '1px solid #3a3a3a' : 'none'};\n            border-bottom: ${direction === 'vertical' ? '1px solid #3a3a3a' : 'none'};\n        `;\n        \n        const pane2 = document.createElement('div');\n        pane2.className = 'pane-container';\n        pane2.dataset.paneId = newPaneId;\n        pane2.style.cssText = `\n            flex: ${newPane.size};\n            min-width: 0;\n            min-height: 0;\n            position: relative;\n            overflow: hidden;\n            width: 100%;\n            height: 100%;\n        `;\n        \n        splitContainer.appendChild(pane1);\n        splitContainer.appendChild(pane2);\n        \n        // Update pane references\n        existingPane.element = pane1;\n        existingPane.container = pane1;\n        existingPane.size = 50;\n        existingPane.parent = splitContainer;\n        \n        newPane.element = pane2;\n        newPane.container = pane2;\n        newPane.size = 50;\n        newPane.parent = splitContainer;\n        \n        // Render both panes\n        this.renderPane(existingPane);\n        this.renderPane(newPane);\n        \n        // Add resize handle (only if one doesn't already exist)\n        const existingHandle = splitContainer.querySelector('.pane-resize-handle');\n        if (!existingHandle) {\n            this.addResizeHandle(splitContainer, direction, existingPane, newPane);\n        }\n    }\n    \n    /**\n     * Add resize handle to split container\n     */\n    addResizeHandle(splitContainer, direction, pane1, pane2) {\n        // Remove any existing resize handles from this container\n        const existingHandles = splitContainer.querySelectorAll('.pane-resize-handle');\n        existingHandles.forEach(h => h.remove());\n        \n        const handle = document.createElement('div');\n        handle.className = 'pane-resize-handle';\n        handle.dataset.direction = direction;\n        handle.dataset.pane1Id = pane1.id;\n        handle.dataset.pane2Id = pane2.id;\n        \n        // Function to update handle position based on current pane sizes\n        const updateHandlePosition = () => {\n            const size1 = parseFloat(pane1.element.style.flex) || pane1.size || 50;\n            const size2 = parseFloat(pane2.element.style.flex) || pane2.size || 50;\n            const totalSize = size1 + size2;\n            const percentage = (size1 / totalSize) * 100;\n            \n            if (direction === 'horizontal') {\n                handle.style.cssText = `\n                    position: absolute;\n                    left: ${percentage}%;\n                    top: 0;\n                    bottom: 0;\n                    width: 4px;\n                    cursor: col-resize;\n                    background: #3a3a3a;\n                    z-index: 10;\n                    transition: background 0.2s;\n                    transform: translateX(-50%);\n                `;\n            } else {\n                handle.style.cssText = `\n                    position: absolute;\n                    top: ${percentage}%;\n                    left: 0;\n                    right: 0;\n                    height: 4px;\n                    cursor: row-resize;\n                    background: #3a3a3a;\n                    z-index: 10;\n                    transition: background 0.2s;\n                    transform: translateY(-50%);\n                `;\n            }\n        };\n        \n        // Initial position\n        updateHandlePosition();\n        \n        handle.addEventListener('mouseenter', () => {\n            handle.style.background = '#4a9eff';\n        });\n        \n        handle.addEventListener('mouseleave', () => {\n            handle.style.background = '#3a3a3a';\n        });\n        \n        let isResizing = false;\n        handle.addEventListener('mousedown', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            isResizing = true;\n            document.body.style.cursor = direction === 'horizontal' ? 'col-resize' : 'row-resize';\n            document.body.style.userSelect = 'none';\n            \n            const startPos = direction === 'horizontal' ? e.clientX : e.clientY;\n            const startSize1 = parseFloat(pane1.element.style.flex) || pane1.size || 50;\n            const startSize2 = parseFloat(pane2.element.style.flex) || pane2.size || 50;\n            const totalSize = startSize1 + startSize2;\n            \n            const onMouseMove = (e) => {\n                if (!isResizing) return;\n                \n                const currentPos = direction === 'horizontal' ? e.clientX : e.clientY;\n                const containerRect = splitContainer.getBoundingClientRect();\n                const containerSize = direction === 'horizontal' ? containerRect.width : containerRect.height;\n                const startRect = direction === 'horizontal' ? containerRect.left : containerRect.top;\n                const delta = ((currentPos - startPos) / containerSize) * 100;\n                \n                const newSize1 = Math.max(10, Math.min(90, startSize1 + delta));\n                const newSize2 = totalSize - newSize1;\n                \n                pane1.size = newSize1;\n                pane2.size = newSize2;\n                \n                pane1.element.style.flex = newSize1;\n                pane2.element.style.flex = newSize2;\n                \n                // Update handle position in real-time\n                updateHandlePosition();\n            };\n            \n            const onMouseUp = () => {\n                isResizing = false;\n                document.body.style.cursor = '';\n                document.body.style.userSelect = '';\n                document.removeEventListener('mousemove', onMouseMove);\n                document.removeEventListener('mouseup', onMouseUp);\n                // Final position update\n                updateHandlePosition();\n            };\n            \n            document.addEventListener('mousemove', onMouseMove);\n            document.addEventListener('mouseup', onMouseUp);\n        });\n        \n        splitContainer.appendChild(handle);\n        \n        // Store update function for later use\n        handle._updatePosition = updateHandlePosition;\n    }\n    \n    /**\n     * Render a pane\n     */\n    renderPane(pane) {\n        if (!pane.container) {\n            // Create container if it doesn't exist\n            const container = document.createElement('div');\n            container.className = 'pane-container';\n            container.dataset.paneId = pane.id;\n            container.style.cssText = `\n                width: 100% !important;\n                height: 100% !important;\n                position: absolute !important;\n                top: 0 !important;\n                left: 0 !important;\n                right: 0 !important;\n                bottom: 0 !important;\n                overflow: hidden !important;\n                margin: 0 !important;\n                padding: 0 !important;\n                box-sizing: border-box !important;\n            `;\n            \n            if (!pane.element) {\n                // Add to root if no parent\n                if (this.rootLayout) {\n                    this.rootLayout.appendChild(container);\n                }\n            }\n            \n            pane.container = container;\n            pane.element = container;\n        }\n        \n        // Get active tab first (needed for content container setup)\n        const activeTab = pane.tabs[pane.activeTabIndex];\n        if (!activeTab) {\n            console.warn('No active tab in pane:', pane.id);\n            return;\n        }\n        \n        // Preserve scroll positions before rendering\n        const scrollPositions = this.preserveScrollPositions(pane);\n        \n        // Create pane header\n        const header = this.createPaneHeader(pane);\n        pane.container.innerHTML = '';\n        pane.container.appendChild(header);\n        \n        // Create content container\n        const content = document.createElement('div');\n        content.className = 'pane-content';\n        content.dataset.pageId = activeTab.pageId; // Add pageId for event handlers\n        content.style.cssText = `\n            width: 100%;\n            height: calc(100% - 40px);\n            overflow: auto;\n        `;\n        pane.container.appendChild(content);\n        \n        // Render active tab's page in pane\n        \n        const page = this.app.appState.documents.find(page => page.id === activeTab.pageId);\n        if (page) {\n            // Check if format renderer exists\n            const format = activeTab.format \n                ? this.app.formatRendererManager?.getFormat(activeTab.format)\n                : null;\n            \n            if (format && format.renderPage) {\n                // Apply theme for this page/view combination\n                if (this.app.themeManager) {\n                    const viewFormat = activeTab.format || 'default';\n                    this.app.themeManager.applyPageTheme(page.id, viewFormat, content);\n                }\n                format.renderPage(content, page, { app: this.app });\n            } else {\n                // Apply theme for default view\n                if (this.app.themeManager) {\n                    this.app.themeManager.applyPageTheme(page.id, 'default', content);\n                }\n                // Default rendering\n                if (page.groups && page.groups.length > 0) {\n                    // Access binRenderer through appRenderer or renderService\n                    const binRenderer = this.appRenderer?.binRenderer || \n                                       this.app.renderService?.getRenderer()?.binRenderer;\n                    if (binRenderer) {\n                        page.groups.forEach((bin) => {\n                            const binElement = binRenderer.renderBin(page.id, bin);\n                            content.appendChild(binElement);\n                        });\n                    } else {\n                        console.warn('binRenderer not available');\n                    }\n                }\n            }\n        } else {\n            console.warn('Page not found:', activeTab.pageId);\n        }\n        \n        // Restore scroll positions after rendering\n        // Use requestAnimationFrame to ensure DOM is fully updated\n        requestAnimationFrame(() => {\n            this.restoreScrollPositions(pane, scrollPositions);\n        });\n        \n        // Emit page:render event for plugins (after a short delay to ensure DOM is ready)\n        if (page) {\n            setTimeout(() => {\n                if (this.app.eventBus) {\n                    // Find the page element within this pane's content\n                    const pageElement = content.querySelector(`[data-page-id=\"${activeTab.pageId}\"], .page`) || content;\n                    if (pageElement) {\n                        this.app.eventBus.emit('page:render', {\n                            pageElement: pageElement,\n                            pageData: page\n                        });\n                    }\n                }\n                \n                // Restore scroll positions after DOM is ready\n                this.restoreScrollPositions(pane, scrollPositions);\n            }, 0);\n        }\n        \n        // Emit render event\n        eventBus.emit('pane:rendered', { paneId: pane.id, pageId: activeTab.pageId });\n    }\n    \n    /**\n     * Update themes for all panes when theme changes\n     */\n    updateThemesForAllPanes() {\n        if (!this.app.themeManager) return;\n        \n        // Apply global theme to root first (only once)\n        this.app.themeManager.applyTheme(this.app.themeManager.themes.global, 'root');\n        \n        const allPanes = this.getAllPanes();\n        allPanes.forEach(pane => {\n            if (!pane.container) return;\n            \n            // Find the content container for this pane\n            const content = pane.container.querySelector('.pane-content');\n            if (!content) return;\n            \n            // Get active tab\n            const activeTab = pane.tabs[pane.activeTabIndex];\n            if (!activeTab) return;\n            \n            // Get the page\n            const page = this.app.appState.documents.find(page => page.id === activeTab.pageId);\n            if (!page) return;\n            \n            // Determine view format\n            const viewFormat = activeTab.format || 'default';\n            \n            // Get effective theme for this page/view combination\n            const effectiveTheme = this.app.themeManager.getEffectiveTheme(page.id, viewFormat);\n            \n            // Apply effective theme to this pane's content container\n            this.app.themeManager.applyTheme(effectiveTheme, content);\n        });\n    }\n    \n    /**\n     * Create pane header with tabs and controls\n     */\n    createPaneHeader(pane) {\n        const header = document.createElement('div');\n        header.className = 'pane-header';\n        header.style.cssText = `\n            display: flex;\n            align-items: center;\n            background: #2a2a2a;\n            border-bottom: 1px solid #3a3a3a;\n            height: 40px;\n            box-sizing: border-box;\n            overflow-x: auto;\n            overflow-y: hidden;\n        `;\n        \n        // Tabs container\n        const tabsContainer = document.createElement('div');\n        tabsContainer.className = 'pane-tabs-container';\n        tabsContainer.style.cssText = `\n            display: flex;\n            flex: 1;\n            min-width: 0;\n            height: 100%;\n            overflow-x: auto;\n            overflow-y: hidden;\n        `;\n        \n        // Render tabs\n        pane.tabs.forEach((tab, index) => {\n            const tabElement = this.createTabElement(pane, tab, index);\n            tabsContainer.appendChild(tabElement);\n        });\n        \n        header.appendChild(tabsContainer);\n        \n        // Controls container\n        const controls = document.createElement('div');\n        controls.className = 'pane-controls';\n        controls.style.cssText = `\n            display: flex;\n            gap: 4px;\n            align-items: center;\n            padding: 0 8px;\n            background: #2a2a2a;\n            flex-shrink: 0;\n        `;\n        \n        // Add tab button\n        const addTabBtn = document.createElement('button');\n        addTabBtn.innerHTML = '+';\n        addTabBtn.title = 'Add Tab';\n        addTabBtn.style.cssText = `\n            padding: 4px 8px;\n            background: #3a3a3a;\n            color: #dcddde;\n            border: none;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 14px;\n            line-height: 1;\n        `;\n        addTabBtn.addEventListener('click', () => {\n            // Show dialog to select page and format\n            this.showAddTabDialog(pane.id);\n        });\n        \n        // Split buttons\n        const splitVerticalBtn = document.createElement('button');\n        splitVerticalBtn.innerHTML = '';\n        splitVerticalBtn.title = 'Split Vertically';\n        splitVerticalBtn.style.cssText = `\n            padding: 4px 8px;\n            background: #3a3a3a;\n            color: #dcddde;\n            border: none;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 12px;\n        `;\n        splitVerticalBtn.addEventListener('click', () => {\n            this.splitPane(pane.id, null, 'vertical');\n        });\n        \n        const splitHorizontalBtn = document.createElement('button');\n        splitHorizontalBtn.innerHTML = '';\n        splitHorizontalBtn.title = 'Split Horizontally';\n        splitHorizontalBtn.style.cssText = `\n            padding: 4px 8px;\n            background: #3a3a3a;\n            color: #dcddde;\n            border: none;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 12px;\n        `;\n        splitHorizontalBtn.addEventListener('click', () => {\n            this.splitPane(pane.id, null, 'horizontal');\n        });\n        \n        // Close button\n        const closeBtn = document.createElement('button');\n        closeBtn.innerHTML = '';\n        closeBtn.title = 'Close Pane';\n        closeBtn.style.cssText = `\n            padding: 4px 8px;\n            background: #3a3a3a;\n            color: #dcddde;\n            border: none;\n            border-radius: 3px;\n            cursor: pointer;\n            font-size: 16px;\n            line-height: 1;\n        `;\n        closeBtn.addEventListener('click', () => {\n            this.closePane(pane.id);\n        });\n        \n        controls.appendChild(addTabBtn);\n        controls.appendChild(splitVerticalBtn);\n        controls.appendChild(splitHorizontalBtn);\n        controls.appendChild(closeBtn);\n        header.appendChild(controls);\n        \n        return header;\n    }\n    \n    /**\n     * Create a tab element with drag-and-drop support\n     */\n    createTabElement(pane, tab, index) {\n        const isActive = index === pane.activeTabIndex;\n        const page = this.app.appState.documents.find(page => page.id === tab.pageId);\n        const pageTitle = page ? (page.title || page.id) : tab.pageId;\n        const formatName = tab.format \n            ? (this.app.formatRendererManager?.getFormat(tab.format)?.name || tab.format)\n            : 'Default';\n        \n        // Use DOMBuilder for tab creation\n        const title = DOMBuilder.create('span')\n            .style({ flex: '1', overflow: 'hidden', textOverflow: 'ellipsis' })\n            .text(pageTitle)\n            .build();\n        \n        const closeBtn = DOMBuilder.create('button')\n            .attr('title', 'Close Tab')\n            .html('')\n            .style({\n                padding: '0',\n                background: 'transparent',\n                color: '#888',\n                border: 'none',\n                cursor: 'pointer',\n                fontSize: '16px',\n                lineHeight: '1',\n                width: '16px',\n                height: '16px',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center'\n            })\n            .on('click', (e) => {\n                e.stopPropagation();\n                this.closeTab(pane.id, tab.id);\n            })\n            .build();\n        \n        const tabElement = DOMBuilder.create('div')\n            .class('pane-tab')\n            .dataset({ tabId: tab.id, paneId: pane.id })\n            .attr('draggable', 'true')\n            .style({\n                display: 'flex',\n                alignItems: 'center',\n                gap: '6px',\n                padding: '6px 12px',\n                background: isActive ? '#1e1e1e' : '#2a2a2a',\n                color: '#dcddde',\n                borderRight: '1px solid #3a3a3a',\n                cursor: 'pointer',\n                userSelect: 'none',\n                whiteSpace: 'nowrap',\n                fontSize: '12px',\n                position: 'relative'\n            })\n            .child(title)\n            .build();\n        \n        // Format badge\n        if (tab.format) {\n            const formatBadge = DOMBuilder.create('span')\n                .text(formatName)\n                .style({\n                    padding: '2px 6px',\n                    background: '#3a3a3a',\n                    borderRadius: '3px',\n                    fontSize: '10px',\n                    opacity: '0.7'\n                })\n                .build();\n            tabElement.appendChild(formatBadge);\n        }\n        \n        tabElement.appendChild(closeBtn);\n        \n        // Click to activate tab\n        tabElement.addEventListener('click', (e) => {\n            if (e.target !== closeBtn && !closeBtn.contains(e.target)) {\n                this.setActiveTab(pane.id, tab.id);\n            }\n        });\n        \n        // Right-click to show context menu for page\n        tabElement.addEventListener('contextmenu', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            // Set context menu state for page editing (binId must be undefined, not null, for page edit)\n            // Also store tab info so modal can update the tab's format\n            if (this.app.appState && this.app.contextMenuHandler) {\n                // Store tab info for modal to use\n                this.app.appState._editingTabInfo = {\n                    paneId: pane.id,\n                    tabId: tab.id\n                };\n                \n                // Use setContextMenuState if available, otherwise set directly\n                if (this.app.appState.setContextMenuState) {\n                    this.app.appState.setContextMenuState({\n                        visible: true,\n                        documentId: tab.pageId,\n                        groupId: null, // null indicates page edit\n                        elementIndex: null,\n                        subtaskIndex: null,\n                        x: e.clientX,\n                        y: e.clientY\n                    });\n                } else {\n                    this.app.appState.contextMenuState = {\n                        visible: true,\n                        documentId: tab.pageId,\n                        groupId: null, // null indicates page edit\n                        elementIndex: null,\n                        subtaskIndex: null,\n                        x: e.clientX,\n                        y: e.clientY\n                    };\n                }\n                \n                // Show page context menu\n                this.app.contextMenuHandler.showPageContextMenu(e, tab.pageId);\n            }\n        });\n        \n        // Drag and drop for tabs\n        this.setupTabDragDrop(tabElement, pane, tab, index);\n        \n        return tabElement;\n    }\n    \n    /**\n     * Setup drag and drop for tab\n     */\n    setupTabDragDrop(tabElement, pane, tab, index) {\n        let dragData = null;\n        let edgeIndicator = null;\n        \n        tabElement.addEventListener('dragstart', (e) => {\n            e.dataTransfer.effectAllowed = 'move';\n            dragData = {\n                type: 'tab',\n                paneId: pane.id,\n                tabId: tab.id,\n                tabIndex: index\n            };\n            e.dataTransfer.setData('text/plain', JSON.stringify(dragData));\n            tabElement.style.opacity = '0.5';\n        });\n        \n        tabElement.addEventListener('dragend', (e) => {\n            tabElement.style.opacity = '1';\n            // Remove all drop indicators\n            document.querySelectorAll('.tab-drop-indicator').forEach(el => el.remove());\n            if (edgeIndicator) {\n                edgeIndicator.remove();\n                edgeIndicator = null;\n            }\n            dragData = null;\n        });\n        \n        // Track drag over panes to detect edge splits\n        document.addEventListener('dragover', (e) => {\n            if (!dragData || dragData.type !== 'tab') return;\n            \n            // Find pane container under cursor\n            const paneContainers = document.querySelectorAll('.pane-container');\n            let targetPane = null;\n            let targetPaneId = null;\n            \n            for (const container of paneContainers) {\n                const rect = container.getBoundingClientRect();\n                if (e.clientX >= rect.left && e.clientX <= rect.right &&\n                    e.clientY >= rect.top && e.clientY <= rect.bottom) {\n                    targetPaneId = container.dataset.paneId;\n                    targetPane = this.panes.get(targetPaneId);\n                    break;\n                }\n            }\n            \n            if (!targetPane || targetPaneId === dragData.paneId) {\n                if (edgeIndicator) {\n                    edgeIndicator.remove();\n                    edgeIndicator = null;\n                }\n                return;\n            }\n            \n            // Check if near edges\n            const container = targetPane.container || targetPane.element;\n            if (!container) return;\n            \n            const rect = container.getBoundingClientRect();\n            const edgeThreshold = 50; // pixels from edge\n            \n            const nearLeft = e.clientX - rect.left < edgeThreshold;\n            const nearRight = rect.right - e.clientX < edgeThreshold;\n            const nearTop = e.clientY - rect.top < edgeThreshold;\n            const nearBottom = rect.bottom - e.clientY < edgeThreshold;\n            \n            // Remove old indicator\n            if (edgeIndicator) {\n                edgeIndicator.remove();\n                edgeIndicator = null;\n            }\n            \n            // Show edge indicator and prepare for split\n            if (nearLeft || nearRight || nearTop || nearBottom) {\n                edgeIndicator = document.createElement('div');\n                edgeIndicator.className = 'pane-split-indicator';\n                edgeIndicator.style.cssText = `\n                    position: fixed;\n                    background: rgba(74, 158, 255, 0.3);\n                    border: 2px solid #4a9eff;\n                    z-index: 10000;\n                    pointer-events: none;\n                `;\n                \n                let direction = null;\n                if (nearLeft) {\n                    direction = 'left';\n                    edgeIndicator.style.left = `${rect.left}px`;\n                    edgeIndicator.style.top = `${rect.top}px`;\n                    edgeIndicator.style.width = `${rect.width / 2}px`;\n                    edgeIndicator.style.height = `${rect.height}px`;\n                } else if (nearRight) {\n                    direction = 'right';\n                    edgeIndicator.style.left = `${rect.left + rect.width / 2}px`;\n                    edgeIndicator.style.top = `${rect.top}px`;\n                    edgeIndicator.style.width = `${rect.width / 2}px`;\n                    edgeIndicator.style.height = `${rect.height}px`;\n                } else if (nearTop) {\n                    direction = 'up';\n                    edgeIndicator.style.left = `${rect.left}px`;\n                    edgeIndicator.style.top = `${rect.top}px`;\n                    edgeIndicator.style.width = `${rect.width}px`;\n                    edgeIndicator.style.height = `${rect.height / 2}px`;\n                } else if (nearBottom) {\n                    direction = 'down';\n                    edgeIndicator.style.left = `${rect.left}px`;\n                    edgeIndicator.style.top = `${rect.top + rect.height / 2}px`;\n                    edgeIndicator.style.width = `${rect.width}px`;\n                    edgeIndicator.style.height = `${rect.height / 2}px`;\n                }\n                \n                if (direction) {\n                    edgeIndicator.dataset.direction = direction;\n                    edgeIndicator.dataset.targetPaneId = targetPaneId;\n                    document.body.appendChild(edgeIndicator);\n                }\n            }\n        });\n        \n        // Handle drop on edge to split\n        document.addEventListener('drop', (e) => {\n            if (!dragData || dragData.type !== 'tab') return;\n            if (!edgeIndicator) return;\n            \n            const direction = edgeIndicator.dataset.direction;\n            const targetPaneId = edgeIndicator.dataset.targetPaneId;\n            \n            if (direction && targetPaneId) {\n                e.preventDefault();\n                e.stopPropagation();\n                \n                // Determine split direction\n                let splitDirection = 'vertical';\n                if (direction === 'left' || direction === 'right') {\n                    splitDirection = 'horizontal';\n                }\n                \n                // Split the target pane\n                const targetPane = this.panes.get(targetPaneId);\n                if (targetPane) {\n                    // Create new pane with the dragged tab's page\n                    const sourcePane = this.panes.get(dragData.paneId);\n                    const sourceTab = sourcePane?.tabs.find(t => t.id === dragData.tabId);\n                    \n                    if (sourceTab) {\n                        // Split target pane\n                        const newPaneId = this.splitPane(targetPaneId, null, splitDirection, sourceTab.pageId, sourceTab.format);\n                        \n                        // Move tab to new pane\n                        if (newPaneId) {\n                            const newPane = this.panes.get(newPaneId);\n                            if (newPane && newPane.tabs.length > 0) {\n                                // Replace the default tab with our moved tab\n                                newPane.tabs[0] = sourceTab;\n                                this.renderPane(newPane);\n                                \n                                // Remove tab from source pane\n                                const sourceTabIndex = sourcePane.tabs.findIndex(t => t.id === dragData.tabId);\n                                if (sourceTabIndex !== -1) {\n                                    sourcePane.tabs.splice(sourceTabIndex, 1);\n                                    \n                                    // Close source pane if it's the last tab (unless locked)\n                                    if (sourcePane.tabs.length === 0 && !sourcePane.locked) {\n                                        this.closePane(dragData.paneId);\n                                    } else {\n                                        if (sourcePane.activeTabIndex >= sourcePane.tabs.length) {\n                                            sourcePane.activeTabIndex = Math.max(0, sourcePane.tabs.length - 1);\n                                        }\n                                        this.renderPane(sourcePane);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n                \n                if (edgeIndicator) {\n                    edgeIndicator.remove();\n                    edgeIndicator = null;\n                }\n            }\n        }, true); // Use capture phase\n        \n        // Allow dropping tabs on other tabs\n        tabElement.addEventListener('dragover', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            const dragData = e.dataTransfer.getData('text/plain');\n            if (!dragData) return;\n            \n            let dragPayload;\n            try {\n                dragPayload = JSON.parse(dragData);\n            } catch (err) {\n                return;\n            }\n            \n            if (dragPayload.type !== 'tab') return;\n            \n            // Show drop indicator\n            this.showTabDropIndicator(tabElement, e);\n            e.dataTransfer.dropEffect = 'move';\n        });\n        \n        tabElement.addEventListener('drop', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            const dragData = e.dataTransfer.getData('text/plain');\n            if (!dragData) return;\n            \n            let dragPayload;\n            try {\n                dragPayload = JSON.parse(dragData);\n            } catch (err) {\n                return;\n            }\n            \n            if (dragPayload.type !== 'tab') return;\n            \n            this.moveTab(dragPayload.paneId, dragPayload.tabId, pane.id, tab.id, index);\n            \n            // Remove drop indicators\n            document.querySelectorAll('.tab-drop-indicator').forEach(el => el.remove());\n        });\n        \n        // Allow dropping tabs on pane headers (to move to different pane)\n        const header = tabElement.closest('.pane-header');\n        if (header) {\n            header.addEventListener('dragover', (e) => {\n                if (e.target.closest('.pane-tab')) return; // Handled by tab\n                \n                e.preventDefault();\n                e.stopPropagation();\n                \n                const dragData = e.dataTransfer.getData('text/plain');\n                if (!dragData) return;\n                \n                let dragPayload;\n                try {\n                    dragPayload = JSON.parse(dragData);\n                } catch (err) {\n                    return;\n                }\n                \n                if (dragPayload.type !== 'tab') return;\n                \n                e.dataTransfer.dropEffect = 'move';\n            });\n            \n            header.addEventListener('drop', (e) => {\n                if (e.target.closest('.pane-tab')) return; // Handled by tab\n                \n                e.preventDefault();\n                e.stopPropagation();\n                \n                const dragData = e.dataTransfer.getData('text/plain');\n                if (!dragData) return;\n                \n                let dragPayload;\n                try {\n                    dragPayload = JSON.parse(dragData);\n                } catch (err) {\n                    return;\n                }\n                \n                if (dragPayload.type !== 'tab') return;\n                \n                // Move tab to this pane\n                this.moveTabToPane(dragPayload.paneId, dragPayload.tabId, pane.id);\n                \n                // Remove drop indicators\n                document.querySelectorAll('.tab-drop-indicator').forEach(el => el.remove());\n            });\n        }\n    }\n    \n    /**\n     * Show drop indicator for tab\n     */\n    showTabDropIndicator(tabElement, e) {\n        // Remove existing indicators\n        document.querySelectorAll('.tab-drop-indicator').forEach(el => el.remove());\n        \n        const indicator = document.createElement('div');\n        indicator.className = 'tab-drop-indicator';\n        indicator.style.cssText = `\n            position: absolute;\n            top: 0;\n            bottom: 0;\n            width: 2px;\n            background: #4a9eff;\n            z-index: 1000;\n            pointer-events: none;\n        `;\n        \n        const rect = tabElement.getBoundingClientRect();\n        const x = e.clientX - rect.left;\n        \n        if (x < rect.width / 2) {\n            // Insert before\n            indicator.style.left = '0';\n            tabElement.style.position = 'relative';\n            tabElement.appendChild(indicator);\n        } else {\n            // Insert after\n            indicator.style.right = '0';\n            tabElement.style.position = 'relative';\n            tabElement.appendChild(indicator);\n        }\n    }\n    \n    /**\n     * Move a tab within or between panes\n     */\n    moveTab(sourcePaneId, tabId, targetPaneId, targetTabId, targetIndex) {\n        const sourcePane = this.panes.get(sourcePaneId);\n        const targetPane = this.panes.get(targetPaneId);\n        if (!sourcePane || !targetPane) return;\n        \n        const tabIndex = sourcePane.tabs.findIndex(t => t.id === tabId);\n        if (tabIndex === -1) return;\n        \n        const tab = sourcePane.tabs[tabIndex];\n        \n        // If moving to same pane, just reorder\n        if (sourcePaneId === targetPaneId) {\n            sourcePane.tabs.splice(tabIndex, 1);\n            const newIndex = targetIndex < tabIndex ? targetIndex : targetIndex + 1;\n            sourcePane.tabs.splice(newIndex, 0, tab);\n            sourcePane.activeTabIndex = newIndex;\n            this.renderPane(sourcePane);\n        } else {\n            // Move to different pane\n            sourcePane.tabs.splice(tabIndex, 1);\n            \n            // Close source pane if it's the last tab (unless locked)\n            if (sourcePane.tabs.length === 0 && !sourcePane.locked) {\n                this.closePane(sourcePaneId);\n            } else {\n                if (sourcePane.activeTabIndex >= sourcePane.tabs.length) {\n                    sourcePane.activeTabIndex = Math.max(0, sourcePane.tabs.length - 1);\n                }\n                this.renderPane(sourcePane);\n            }\n            \n            const targetTabIndex = targetPane.tabs.findIndex(t => t.id === targetTabId);\n            const insertIndex = targetTabIndex !== -1 ? targetTabIndex : targetIndex;\n            targetPane.tabs.splice(insertIndex, 0, tab);\n            targetPane.activeTabIndex = insertIndex;\n            this.renderPane(targetPane);\n        }\n    }\n    \n    /**\n     * Move a tab to a different pane (append to end)\n     */\n    moveTabToPane(sourcePaneId, tabId, targetPaneId) {\n        const sourcePane = this.panes.get(sourcePaneId);\n        const targetPane = this.panes.get(targetPaneId);\n        if (!sourcePane || !targetPane) return;\n        \n        const tabIndex = sourcePane.tabs.findIndex(t => t.id === tabId);\n        if (tabIndex === -1) return;\n        \n        const tab = sourcePane.tabs[tabIndex];\n        sourcePane.tabs.splice(tabIndex, 1);\n        \n        // Close source pane if it's the last tab (unless locked)\n        if (sourcePane.tabs.length === 0 && !sourcePane.locked) {\n            this.closePane(sourcePaneId);\n        } else {\n            if (sourcePane.activeTabIndex >= sourcePane.tabs.length) {\n                sourcePane.activeTabIndex = Math.max(0, sourcePane.tabs.length - 1);\n            }\n            // Re-render source pane\n            this.renderPane(sourcePane);\n        }\n        \n        targetPane.tabs.push(tab);\n        targetPane.activeTabIndex = targetPane.tabs.length - 1;\n        \n        // Re-render target pane\n        this.renderPane(targetPane);\n    }\n    \n    /**\n     * Close a pane\n     */\n    closePane(paneId) {\n        const pane = this.panes.get(paneId);\n        if (!pane) return;\n        \n        // If this is the last pane, don't close it\n        if (this.panes.size === 1) {\n            return;\n        }\n        \n        // Remove from DOM\n        if (pane.element && pane.element.parentNode) {\n            const parent = pane.element.parentNode;\n            \n            // If parent is a split container, remove it and keep the other pane\n            if (parent.classList.contains('pane-split-container')) {\n                const siblingPane = Array.from(parent.children).find(\n                    child => child.dataset.paneId !== paneId\n                );\n                \n                if (siblingPane) {\n                    const siblingPaneId = siblingPane.dataset.paneId;\n                    const siblingPaneData = this.panes.get(siblingPaneId);\n                    \n                    // Replace split container with sibling pane\n                    if (parent.parentNode) {\n                        parent.parentNode.replaceChild(siblingPane, parent);\n                        siblingPaneData.element = siblingPane;\n                        siblingPaneData.parent = parent.parentNode === this.rootLayout ? null : parent.parentNode;\n                        siblingPaneData.size = 100;\n                        siblingPane.style.flex = '1';\n                        siblingPane.style.border = 'none';\n                    }\n                }\n            } else {\n                pane.element.remove();\n            }\n        }\n        \n        // Remove from map\n        this.panes.delete(paneId);\n        \n        // Emit event\n        eventBus.emit('pane:closed', { paneId });\n        \n        // Re-render if needed\n        if (this.panes.size > 0) {\n            this.app.render();\n        }\n    }\n    \n    /**\n     * Get all panes\n     */\n    getAllPanes() {\n        return Array.from(this.panes.values());\n    }\n    \n    /**\n     * Get pane by ID\n     */\n    getPane(paneId) {\n        return this.panes.get(paneId);\n    }\n    \n    /**\n     * Show dialog to add a new tab (page and format selector)\n     */\n    showAddTabDialog(paneId) {\n        const pane = this.panes.get(paneId);\n        if (!pane) return;\n        \n        // Get all available formats that support pages\n        const allFormats = [];\n        if (this.app.formatRendererManager) {\n            const formats = this.app.formatRendererManager.getAllFormats();\n            formats.forEach(format => {\n                // Only include formats that support pages\n                if (format.supportsPages !== false) {\n                    const formatName = format.formatName || format.id;\n                    allFormats.push({ \n                        id: formatName, \n                        name: format.name || format.formatLabel || formatName \n                    });\n                }\n            });\n        }\n        \n        // Create modal for selecting page and format\n        const modal = document.createElement('div');\n        modal.style.cssText = `\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0, 0, 0, 0.7);\n            z-index: 10000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        `;\n        \n        const dialog = document.createElement('div');\n        dialog.style.cssText = `\n            background: #2a2a2a;\n            border: 1px solid #3a3a3a;\n            border-radius: 8px;\n            padding: 20px;\n            min-width: 400px;\n            max-width: 600px;\n        `;\n        \n        dialog.innerHTML = `\n            <h3 style=\"margin: 0 0 20px 0; color: #ffffff;\">Add Tab</h3>\n            <div style=\"margin-bottom: 15px;\">\n                <label style=\"display: block; margin-bottom: 8px; color: #dcddde;\">Page:</label>\n                <select id=\"add-tab-page-select\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #dcddde; border: 1px solid #3a3a3a; border-radius: 4px;\">\n                    ${this.app.appState.documents.map(page => \n                        `<option value=\"${page.id}\">${page.title || page.id}</option>`\n                    ).join('')}\n                </select>\n            </div>\n            <div style=\"margin-bottom: 20px;\">\n                <label style=\"display: block; margin-bottom: 8px; color: #dcddde;\">Format:</label>\n                <select id=\"add-tab-format-select\" style=\"width: 100%; padding: 8px; background: #1a1a1a; color: #dcddde; border: 1px solid #3a3a3a; border-radius: 4px;\">\n                    <option value=\"\">Default</option>\n                    ${allFormats.map(format => \n                        `<option value=\"${format.id}\">${format.name}</option>`\n                    ).join('')}\n                </select>\n            </div>\n            <div style=\"display: flex; gap: 10px; justify-content: flex-end;\">\n                <button id=\"add-tab-cancel\" style=\"padding: 8px 16px; background: #3a3a3a; color: #dcddde; border: none; border-radius: 4px; cursor: pointer;\">Cancel</button>\n                <button id=\"add-tab-ok\" style=\"padding: 8px 16px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">Add Tab</button>\n            </div>\n        `;\n        \n        modal.appendChild(dialog);\n        document.body.appendChild(modal);\n        \n        // Set default to current page\n        const pageSelect = dialog.querySelector('#add-tab-page-select');\n        const formatSelect = dialog.querySelector('#add-tab-format-select');\n        if (pageSelect && this.app.appState.currentDocumentId) {\n            pageSelect.value = this.app.appState.currentDocumentId;\n        }\n        \n        // Set default format to active tab's format or page format\n        if (formatSelect && pane.tabs.length > 0) {\n            const activeTab = pane.tabs[pane.activeTabIndex];\n            if (activeTab && activeTab.format) {\n                formatSelect.value = activeTab.format;\n            } else {\n                // Try to get page format\n                const selectedPageId = pageSelect.value;\n                const pageFormat = this.app.formatRendererManager?.getPageFormat(selectedPageId);\n                if (pageFormat) {\n                    formatSelect.value = pageFormat;\n                }\n            }\n        }\n        \n        // Update format options when page changes\n        if (pageSelect && formatSelect) {\n            pageSelect.addEventListener('change', () => {\n                const selectedPageId = pageSelect.value;\n                const pageFormat = this.app.formatRendererManager?.getPageFormat(selectedPageId);\n                if (pageFormat) {\n                    formatSelect.value = pageFormat;\n                }\n            });\n        }\n        \n        // Cancel button\n        dialog.querySelector('#add-tab-cancel').addEventListener('click', () => {\n            document.body.removeChild(modal);\n        });\n        \n        // OK button\n        dialog.querySelector('#add-tab-ok').addEventListener('click', () => {\n            const pageId = pageSelect.value;\n            const format = formatSelect.value || null;\n            \n            // Check if this page+format combination already exists in this pane\n            const existingTab = pane.tabs.find(t => t.pageId === pageId && t.format === format);\n            if (existingTab) {\n                // Switch to existing tab instead\n                this.setActiveTab(pane.id, existingTab.id);\n            } else {\n                // Add new tab\n                this.addTabToPane(pane.id, pageId, format);\n            }\n            \n            document.body.removeChild(modal);\n        });\n        \n        // Close on background click\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) {\n                document.body.removeChild(modal);\n            }\n        });\n        \n        // Close on Escape key\n        const handleEscape = (e) => {\n            if (e.key === 'Escape') {\n                document.body.removeChild(modal);\n                document.removeEventListener('keydown', handleEscape);\n            }\n        };\n        document.addEventListener('keydown', handleEscape);\n    }\n    \n    /**\n     * Preserve scroll positions for a pane and all its scrollable children\n     */\n    preserveScrollPositions(pane) {\n        const positions = {\n            container: {},\n            content: {},\n            groups: {},\n            items: {}\n        };\n        \n        // Preserve pane container scroll\n        if (pane.container) {\n            positions.container = {\n                scrollTop: pane.container.scrollTop,\n                scrollLeft: pane.container.scrollLeft\n            };\n        }\n        \n        // Preserve content container scroll\n        const content = pane.container?.querySelector('.pane-content');\n        if (content) {\n            positions.content = {\n                scrollTop: content.scrollTop,\n                scrollLeft: content.scrollLeft\n            };\n        }\n        \n        // Preserve group scroll positions (for groups with max-height)\n        const bins = pane.container?.querySelectorAll('.bin-content');\n        if (bins) {\n            bins.forEach(binContent => {\n                const binId = binContent.closest('.bin')?.dataset.binId;\n                if (binId) {\n                    positions.groups[binId] = {\n                        scrollTop: binContent.scrollTop,\n                        scrollLeft: binContent.scrollLeft\n                    };\n                }\n            });\n        }\n        \n        // Preserve any other scrollable elements (like nested containers)\n        const scrollables = pane.container?.querySelectorAll('[style*=\"overflow\"], [style*=\"overflow-y\"], [style*=\"overflow-x\"]');\n        if (scrollables) {\n            scrollables.forEach((el, index) => {\n                const key = el.dataset.binId || el.dataset.elementIndex || `scrollable-${index}`;\n                if (el.scrollTop > 0 || el.scrollLeft > 0) {\n                    positions.items[key] = {\n                        scrollTop: el.scrollTop,\n                        scrollLeft: el.scrollLeft\n                    };\n                }\n            });\n        }\n        \n        return positions;\n    }\n    \n    /**\n     * Restore scroll positions for a pane and all its scrollable children\n     */\n    restoreScrollPositions(pane, positions) {\n        if (!positions) return;\n        \n        // Restore pane container scroll\n        if (pane.container && positions.container) {\n            pane.container.scrollTop = positions.container.scrollTop || 0;\n            pane.container.scrollLeft = positions.container.scrollLeft || 0;\n        }\n        \n        // Restore content container scroll\n        const content = pane.container?.querySelector('.pane-content');\n        if (content && positions.content) {\n            content.scrollTop = positions.content.scrollTop || 0;\n            content.scrollLeft = positions.content.scrollLeft || 0;\n        }\n        \n        // Restore group scroll positions\n        if (positions.groups) {\n            Object.keys(positions.groups).forEach(binId => {\n                const binContent = pane.container?.querySelector(`.bin[data-bin-id=\"${binId}\"] .bin-content`);\n                if (binContent && positions.groups[binId]) {\n                    binContent.scrollTop = positions.groups[binId].scrollTop || 0;\n                    binContent.scrollLeft = positions.groups[binId].scrollLeft || 0;\n                }\n            });\n        }\n        \n        // Restore other scrollable items\n        if (positions.items) {\n            Object.keys(positions.items).forEach(key => {\n                let element = null;\n                if (key.startsWith('scrollable-')) {\n                    const index = parseInt(key.replace('scrollable-', ''));\n                    const scrollables = pane.container?.querySelectorAll('[style*=\"overflow\"], [style*=\"overflow-y\"], [style*=\"overflow-x\"]');\n                    if (scrollables && scrollables[index]) {\n                        element = scrollables[index];\n                    }\n                } else {\n                    element = pane.container?.querySelector(`[data-bin-id=\"${key}\"], [data-element-index=\"${key}\"]`);\n                }\n                \n                if (element && positions.items[key]) {\n                    element.scrollTop = positions.items[key].scrollTop || 0;\n                    element.scrollLeft = positions.items[key].scrollLeft || 0;\n                }\n            });\n        }\n    }\n}\n\n","// AppRenderer.js - Handles application rendering\r\n// Extracted from app.js to reduce coupling and improve modularity\r\nimport { eventBus } from './EventBus.js';\r\nimport { EVENTS } from './AppEvents.js';\r\nimport { SERVICES, getService } from './AppServices.js';\r\nimport { BinRenderer } from './BinRenderer.js';\r\nimport { ElementRenderer } from './ElementRenderer.js';\r\n// import { CalendarRenderer } from './CalendarRenderer.js'; // TEMPORARILY DISABLED\r\nimport { AnimationRenderer } from './AnimationRenderer.js';\r\nimport { PaneManager } from './PaneManager.js';\r\n\r\n/**\r\n * AppRenderer - Manages all rendering operations\r\n * \r\n * Handles DOM rendering, element rendering, and UI updates.\r\n * This class extracts rendering logic from app.js to improve modularity.\r\n */\r\nexport class AppRenderer {\r\n    constructor(app) {\r\n        this.app = app;\r\n        this._preservingFormat = false;\r\n        this.binRenderer = new BinRenderer(app);\r\n        this.elementRenderer = new ElementRenderer(app);\r\n        // this.calendarRenderer = new CalendarRenderer(app); // TEMPORARILY DISABLED\r\n        this.animationRenderer = new AnimationRenderer(app);\r\n        this.paneManager = new PaneManager(app, this);\r\n        this._lastScrollTop = null;\r\n        this._lastScrollLeft = null;\r\n        this._setupScrollTracking();\r\n        this._setupThemeListener();\r\n    }\r\n    \r\n    /**\r\n     * Setup listener for theme updates to apply immediately\r\n     */\r\n    _setupThemeListener() {\r\n        if (this.app.eventBus) {\r\n            this.app.eventBus.on('theme:updated', () => {\r\n                this._applyCurrentThemes();\r\n            });\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Apply current themes to all UI components immediately\r\n     */\r\n    _applyCurrentThemes() {\r\n        if (!this.app.themeManager) return;\r\n        \r\n        const appState = this.app.appState;\r\n        if (!appState || !appState.documents) return;\r\n        \r\n        // Apply global theme to root\r\n        this.app.themeManager.applyTheme(this.app.themeManager.themes.global, 'root');\r\n        \r\n        // Update bins-container for current page\r\n        const binsContainer = document.getElementById('bins-container');\r\n        if (binsContainer && appState.currentDocumentId) {\r\n            const currentPage = appState.documents.find(p => p.id === appState.currentDocumentId);\r\n            if (currentPage) {\r\n                const viewFormat = currentPage.format || 'default';\r\n                const effectiveTheme = this.app.themeManager.getEffectiveTheme(currentPage.id, viewFormat);\r\n                this.app.themeManager.applyTheme(effectiveTheme, binsContainer);\r\n            }\r\n        }\r\n        \r\n        // Update all page containers\r\n        appState.documents.forEach(page => {\r\n            const viewFormat = page.format || 'default';\r\n            const effectiveTheme = this.app.themeManager.getEffectiveTheme(page.id, viewFormat);\r\n            \r\n            // Update page containers\r\n            const pageContainers = document.querySelectorAll(`[data-page-id=\"${page.id}\"]`);\r\n            pageContainers.forEach(container => {\r\n                this.app.themeManager.applyTheme(effectiveTheme, container);\r\n            });\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Setup scroll tracking for debugging\r\n     */\r\n    _setupScrollTracking() {\r\n        // Only set up once\r\n        if (this._scrollTrackingSetup) return;\r\n        this._scrollTrackingSetup = true;\r\n        \r\n        // Wait for DOM to be ready\r\n        if (document.readyState === 'loading') {\r\n            document.addEventListener('DOMContentLoaded', () => this._setupScrollTracking());\r\n            return;\r\n        }\r\n        \r\n        const setupTracking = () => {\r\n            const container = document.getElementById('bins-container');\r\n            if (!container) {\r\n                // Retry after a short delay if container doesn't exist yet\r\n                setTimeout(setupTracking, 100);\r\n                return;\r\n            }\r\n            \r\n            // Remove existing listener if any\r\n            if (this._scrollTrackingHandler) {\r\n                container.removeEventListener('scroll', this._scrollTrackingHandler);\r\n            }\r\n            \r\n            // Track programmatic scroll changes by monitoring scrollTop/scrollLeft\r\n            let lastKnownScrollTop = container.scrollTop;\r\n            let lastKnownScrollLeft = container.scrollLeft;\r\n            \r\n            // Function to check and log scroll changes\r\n            const checkScrollChange = (source = 'unknown') => {\r\n                const currentScrollTop = container.scrollTop;\r\n                const currentScrollLeft = container.scrollLeft;\r\n                \r\n                if (currentScrollTop !== lastKnownScrollTop || currentScrollLeft !== lastKnownScrollLeft) {\r\n                    const scrollHeight = container.scrollHeight;\r\n                    const clientHeight = container.clientHeight;\r\n                    const scrollPercentage = scrollHeight > clientHeight ? ((currentScrollTop / (scrollHeight - clientHeight)) * 100).toFixed(1) : 0;\r\n                    \r\n                    console.log('[SCROLL TRACK] Scroll position changed:', {\r\n                        source,\r\n                        scrollTop: currentScrollTop.toFixed(0),\r\n                        scrollLeft: currentScrollLeft.toFixed(0),\r\n                        scrollHeight,\r\n                        clientHeight,\r\n                        scrollPercentage: scrollPercentage + '%',\r\n                        maxScrollTop: scrollHeight - clientHeight,\r\n                        deltaTop: lastKnownScrollTop !== null ? (currentScrollTop - lastKnownScrollTop).toFixed(0) : 'N/A',\r\n                        deltaLeft: lastKnownScrollLeft !== null ? (currentScrollLeft - lastKnownScrollLeft).toFixed(0) : 'N/A'\r\n                    });\r\n                    \r\n                    lastKnownScrollTop = currentScrollTop;\r\n                    lastKnownScrollLeft = currentScrollLeft;\r\n                    this._lastScrollTop = currentScrollTop;\r\n                    this._lastScrollLeft = currentScrollLeft;\r\n                }\r\n            };\r\n            \r\n            // Add scroll event listener (for user scrolling)\r\n            this._scrollTrackingHandler = (e) => {\r\n                checkScrollChange('user-scroll');\r\n            };\r\n            container.addEventListener('scroll', this._scrollTrackingHandler, { passive: true });\r\n            \r\n            // Monitor for programmatic changes using periodic checks\r\n            this._scrollCheckInterval = setInterval(() => {\r\n                checkScrollChange('programmatic');\r\n            }, 50);\r\n            \r\n            console.log('[SCROLL TRACK] Scroll tracking enabled on bins-container');\r\n        };\r\n        \r\n        setupTracking();\r\n    }\r\n    \r\n    /**\r\n     * Main render method\r\n     * Renders the entire application UI\r\n     */\r\n    render() {\r\n        // Preserve active modals (like visual customization modal) during render\r\n        const activeModals = [];\r\n        const modals = document.querySelectorAll('.modal');\r\n        modals.forEach(modal => {\r\n            if (modal.classList.contains('active')) {\r\n                // Check if this is a modal we want to preserve (settings or visual customization)\r\n                const modalBody = modal.querySelector('#modal-body, #settings-body');\r\n                if (modalBody) {\r\n                    const isVisualCustomization = modalBody.querySelector('#visual-instance-specific') !== null;\r\n                    const isSettings = modalBody.querySelector('#settings-reset') !== null;\r\n                    if (isVisualCustomization || isSettings) {\r\n                        activeModals.push(modal);\r\n                        return; // Skip closing this modal\r\n                    }\r\n                }\r\n            }\r\n            // Close other modals\r\n            modal.classList.remove('active');\r\n            modal.style.display = 'none';\r\n        });\r\n        \r\n        // Render page tabs\r\n        this.renderPageTabs();\r\n        \r\n        // Get current page (ensure default exists via PageManager)\r\n        const pageManager = getService(SERVICES.PAGE_MANAGER);\r\n        const currentPage = pageManager.ensureDefaultPage();\r\n        \r\n        // Check if multi-pane mode is enabled (for now, we'll add a flag later)\r\n        const appState = getService(SERVICES.APP_STATE);\r\n        const useMultiPane = appState.multiPaneEnabled !== false; // Default to true for now\r\n        \r\n        if (useMultiPane) {\r\n            // Initialize pane manager if not already done\r\n            if (!this.paneManager.rootLayout) {\r\n                this.paneManager.initialize();\r\n            }\r\n            \r\n            // Render all panes\r\n            const allPanes = this.paneManager.getAllPanes();\r\n            allPanes.forEach(pane => {\r\n                this.paneManager.renderPane(pane);\r\n            });\r\n            \r\n            // If no panes, create one with current page\r\n            if (allPanes.length === 0) {\r\n                this.paneManager.openPane(appState.currentDocumentId);\r\n            }\r\n            \r\n            return;\r\n        }\r\n        \r\n        // Legacy single-pane rendering\r\n        const container = document.getElementById('bins-container');\r\n        if (!container) return;\r\n        \r\n        // Get active page (reuse appState from line 63)\r\n        const activePage = appState.documents.find(page => page.id === appState.currentDocumentId);\r\n        \r\n        // Store old positions before re-rendering (only if container has content)\r\n        const hasContent = container.children.length > 0;\r\n        const oldPositions = hasContent ? this.getCurrentPositions() : { bins: {}, elements: {} };\r\n        \r\n        // Preserve scroll position BEFORE any rendering or clearing\r\n        const scrollTop = container.scrollTop;\r\n        const scrollLeft = container.scrollLeft;\r\n        console.log('[SCROLL DEBUG] Preserving scroll position:', { scrollTop, scrollLeft, containerHeight: container.scrollHeight, clientHeight: container.clientHeight });\r\n        \r\n        // Check if page has a format renderer BEFORE clearing\r\n        const formatRendererManager = getService(SERVICES.FORMAT_RENDERER_MANAGER);\r\n        const pageFormat = formatRendererManager?.getPageFormat(appState.currentDocumentId);\r\n        const format = pageFormat ? formatRendererManager?.getFormat(pageFormat) : null;\r\n        const shouldUseFormat = format && format.renderPage && activePage;\r\n        \r\n        // Only clear if we're not preserving format view (prevents flicker)\r\n        if (!shouldUseFormat || !this._preservingFormat) {\r\n            container.innerHTML = '';\r\n        }\r\n        \r\n        // If we have a format renderer, use it\r\n        if (shouldUseFormat) {\r\n            // Apply theme for this page/view combination\r\n            if (this.app.themeManager) {\r\n                const viewFormat = pageFormat || 'default';\r\n                this.app.themeManager.applyPageTheme(activePage.id, viewFormat, container);\r\n            }\r\n            \r\n            // If format view is already rendered, update it instead of clearing\r\n            if (this._preservingFormat && container.children.length > 0) {\r\n                // Update existing format view\r\n                console.log('[SCROLL DEBUG] Format render - updating existing (preserving format)', { scrollBeforeUpdate: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft } });\r\n                format.renderPage(container, activePage, { app: this.app });\r\n                console.log('[SCROLL DEBUG] Format render - after update', { scrollAfterUpdate: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight } });\r\n            } else {\r\n                // First render or format changed - clear and render\r\n                console.log('[SCROLL DEBUG] Format render - clearing container', { scrollBeforeClear: { scrollTop, scrollLeft } });\r\n                container.innerHTML = '';\r\n                console.log('[SCROLL DEBUG] Format render - after clear', { scrollAfterClear: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft } });\r\n                format.renderPage(container, activePage, { app: this.app });\r\n                console.log('[SCROLL DEBUG] Format render - after renderPage', { scrollAfterRender: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight } });\r\n            }\r\n            \r\n            // Reset format preservation flag after render\r\n            this._preservingFormat = false;\r\n            \r\n            // Restore scroll position after format rendering\r\n            // Use requestAnimationFrame to ensure DOM is fully updated\r\n            requestAnimationFrame(() => {\r\n                const beforeRestore = { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight, clientHeight: container.clientHeight };\r\n                console.log('[SCROLL DEBUG] Format render - About to restore scroll:', { \r\n                    preserved: { scrollTop, scrollLeft }, \r\n                    beforeRestore\r\n                });\r\n                container.scrollTop = scrollTop;\r\n                container.scrollLeft = scrollLeft;\r\n                const afterRestore = { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight, clientHeight: container.clientHeight };\r\n                console.log('[SCROLL DEBUG] Format render - After restore:', { \r\n                    afterRestore,\r\n                    restored: afterRestore.scrollTop === scrollTop && afterRestore.scrollLeft === scrollLeft,\r\n                    difference: { top: (afterRestore.scrollTop - scrollTop).toFixed(0), left: (afterRestore.scrollLeft - scrollLeft).toFixed(0) }\r\n                });\r\n                \r\n                // Emit page:render event for plugins\r\n                if (this.app.eventBus && activePage) {\r\n                    this.app.eventBus.emit('page:render', {\r\n                        pageElement: container,\r\n                        pageData: activePage\r\n                    });\r\n                }\r\n            });\r\n            return;\r\n        }\r\n        \r\n        // Apply theme for default view\r\n        if (this.app.themeManager) {\r\n            this.app.themeManager.applyPageTheme(activePage.id, 'default', container);\r\n        }\r\n        \r\n        // Default rendering - reset container CSS to default vertical layout\r\n        // Clear any format-specific CSS that was applied\r\n        container.style.cssText = '';\r\n        \r\n        if (activePage && activePage.groups && activePage.groups.length > 0) {\r\n            console.log('[SCROLL DEBUG] Default render - before appending bins', { scrollBeforeAppend: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight } });\r\n            activePage.groups.forEach((bin, binIndex) => {\r\n                const binElement = this.binRenderer.renderBin(activePage.id, bin);\r\n                container.appendChild(binElement);\r\n            });\r\n            console.log('[SCROLL DEBUG] Default render - after appending bins', { scrollAfterAppend: { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight } });\r\n            \r\n            // Restore scroll position and emit events after rendering\r\n            // Use requestAnimationFrame to ensure DOM is fully updated\r\n            requestAnimationFrame(() => {\r\n                // Restore scroll position after rendering\r\n                const beforeRestore = { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight, clientHeight: container.clientHeight };\r\n                console.log('[SCROLL DEBUG] Default render - About to restore scroll:', { \r\n                    preserved: { scrollTop, scrollLeft }, \r\n                    beforeRestore\r\n                });\r\n                container.scrollTop = scrollTop;\r\n                container.scrollLeft = scrollLeft;\r\n                const afterRestore = { scrollTop: container.scrollTop, scrollLeft: container.scrollLeft, scrollHeight: container.scrollHeight, clientHeight: container.clientHeight };\r\n                console.log('[SCROLL DEBUG] Default render - After restore:', { \r\n                    afterRestore,\r\n                    restored: afterRestore.scrollTop === scrollTop && afterRestore.scrollLeft === scrollLeft,\r\n                    difference: { top: (afterRestore.scrollTop - scrollTop).toFixed(0), left: (afterRestore.scrollLeft - scrollLeft).toFixed(0) }\r\n                });\r\n                \r\n                // Emit page:render event for plugins\r\n                if (this.app.eventBus && activePage) {\r\n                    const pageElement = document.querySelector(`[data-page-id=\"${activePage.id}\"], .page, #bins-container`);\r\n                    if (pageElement) {\r\n                        this.app.eventBus.emit('page:render', {\r\n                            pageElement: pageElement,\r\n                            pageData: activePage\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        \r\n        // If no bins, show empty state\r\n        if (!activePage || !activePage.groups || activePage.groups.length === 0) {\r\n            container.innerHTML = '<p>No bins yet. Add a bin to get started!</p>';\r\n            return;\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Render page tabs\r\n     */\r\n    renderPageTabs() {\r\n        const tabsContainer = document.getElementById('page-tabs');\r\n        if (!tabsContainer) return;\r\n        \r\n        tabsContainer.innerHTML = '';\r\n        \r\n        const appState = getService(SERVICES.APP_STATE);\r\n        appState.documents.forEach((page, index) => {\r\n            const tab = document.createElement('div');\r\n            tab.className = 'page-tab';\r\n            if (page.id === appState.currentDocumentId) {\r\n                tab.classList.add('active');\r\n            }\r\n            tab.dataset.pageId = page.id;\r\n            tab.textContent = index + 1; // Show page number (1, 2, 3, etc.)\r\n            tab.title = `Page ${index + 1}`;\r\n            \r\n            // Click to switch page\r\n            tab.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n                appState.currentDocumentId = page.id;\r\n                eventBus.emit(EVENTS.DATA.SAVE_REQUESTED);\r\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\r\n            });\r\n            \r\n            // Context menu is now handled by unified handler in EventHandler\r\n            \r\n            tabsContainer.appendChild(tab);\r\n        });\r\n\r\n        // Context menu is now handled by unified handler in EventHandler\r\n    }\r\n    \r\n    /**\r\n     * Get current positions of bins and elements for animation\r\n     */\r\n    getCurrentPositions() {\r\n        const positions = {\r\n            groups: {},\r\n            items: {}\r\n        };\r\n        \r\n        // Get group positions\r\n        document.querySelectorAll('.bin').forEach(binElement => {\r\n            const binId = binElement.dataset.binId;\r\n            if (binId) {\r\n                const rect = binElement.getBoundingClientRect();\r\n                positions.groups[binId] = {\r\n                    top: rect.top,\r\n                    left: rect.left\r\n                };\r\n            }\r\n        });\r\n        \r\n        // Get item positions - use ElementFinder for consistency\r\n        document.querySelectorAll('.element').forEach(elementNode => {\r\n            const elementData = ElementFinder.getElementData(elementNode);\r\n            if (elementData.pageId && elementData.binId && elementData.elementIndex !== null) {\r\n                // Create a stable key using element's text/content\r\n                let elementKey = `${elementData.pageId}-${elementData.binId}-${elementData.elementIndex}`;\r\n                \r\n                // Try to get element text for more stable matching\r\n                const textElement = elementNode.querySelector('.task-text, .header-text, .audio-status');\r\n                if (textElement) {\r\n                    const text = textElement.textContent || textElement.innerText || '';\r\n                    // Use first 20 chars of text as part of key for stability\r\n                    elementKey = `${elementData.pageId}-${elementData.binId}-${text.substring(0, 20)}-${elementData.elementIndex}`;\r\n                }\r\n                \r\n                const rect = elementNode.getBoundingClientRect();\r\n                positions.items[elementKey] = {\r\n                    top: rect.top,\r\n                    left: rect.left,\r\n                    pageId: elementData.pageId,\r\n                    binId: elementData.binId,\r\n                    elementIndex: elementData.elementIndex\r\n                };\r\n            }\r\n        });\r\n        \r\n        return positions;\r\n    }\r\n    \r\n    /**\r\n     * Set format preservation flag\r\n     * Used to prevent flicker when updating format views\r\n     */\r\n    setPreservingFormat(value) {\r\n        this._preservingFormat = value;\r\n    }\r\n    \r\n    /**\r\n     * Render a bin - delegates to BinRenderer\r\n     */\r\n    renderBin(pageId, bin) {\r\n        return this.binRenderer.renderBin(pageId, bin);\r\n    }\r\n    \r\n    renderElement(pageId, binId, element, elementIndex, childIndex = null, depth = 0) {\r\n        return this.elementRenderer.renderElement(pageId, binId, element, elementIndex, childIndex, depth);\r\n    }\r\n    \r\n    renderChildren(pageId, binId, parentElement, parentElementIndex, depth = 0) {\r\n        return this.elementRenderer.renderChildren(pageId, binId, parentElement, parentElementIndex, depth);\r\n    }\r\n    \r\n    renderCalendar(container, pageId, binId, element, elementIndex) {\r\n        // TEMPORARILY DISABLED - Calendar feature has syntax errors\r\n        const disabledMsg = document.createElement('div');\r\n        disabledMsg.style.padding = '20px';\r\n        disabledMsg.style.textAlign = 'center';\r\n        disabledMsg.style.color = '#888';\r\n        disabledMsg.textContent = 'Calendar feature temporarily disabled';\r\n        container.appendChild(disabledMsg);\r\n        return;\r\n        // return this.calendarRenderer.renderCalendar(container, pageId, binId, element, elementIndex);\r\n    }\r\n    \r\n    renderCurrentDateView(container, element) {\r\n        // TEMPORARILY DISABLED - Calendar feature has syntax errors\r\n        return;\r\n        // return this.calendarRenderer.renderCurrentDateView(container, element);\r\n    }\r\n    \r\n    renderOneDayView(container, element) {\r\n        // TEMPORARILY DISABLED - Calendar feature has syntax errors\r\n        return;\r\n        // return this.calendarRenderer.renderOneDayView(container, element);\r\n    }\r\n    \r\n    renderWeekView(container, element) {\r\n        // TEMPORARILY DISABLED - Calendar feature has syntax errors\r\n        return;\r\n        // return this.calendarRenderer.renderWeekView(container, element);\r\n    }\r\n    \r\n    renderMonthView(container, element) {\r\n        // TEMPORARILY DISABLED - Calendar feature has syntax errors\r\n        return;\r\n        // return this.calendarRenderer.renderMonthView(container, element);\r\n    }\r\n    \r\n    animateMovements(oldPositions) {\r\n        return this.animationRenderer.animateMovements(oldPositions);\r\n    }\r\n    \r\n    styleButton(text, onClick) {\r\n        const btn = document.createElement('button');\r\n        btn.textContent = text;\r\n        btn.style.padding = '4px 8px';\r\n        btn.style.border = '1px solid #555';\r\n        btn.style.background = '#333';\r\n        btn.style.color = '#e0e0e0';\r\n        btn.style.borderRadius = '4px';\r\n        btn.style.cursor = 'pointer';\r\n        btn.style.fontSize = '12px';\r\n        btn.style.width = '32px'; // Consistent width for all buttons\r\n        btn.style.minWidth = '32px'; // Ensure minimum width\r\n        btn.onclick = (e) => {\r\n            e.stopPropagation();\r\n            onClick(e);\r\n        };\r\n        btn.onmouseenter = () => btn.style.background = '#444';\r\n        btn.onmouseleave = () => btn.style.background = '#333';\r\n        return btn;\r\n    }\r\n    \r\n    toggleAllSubtasks() {\r\n        const appState = getService(SERVICES.APP_STATE);\r\n        appState.allSubtasksExpanded = !appState.allSubtasksExpanded;\r\n        \r\n        // Update all individual subtask states to match global state\r\n        Object.keys(appState.subtaskStates || {}).forEach(key => {\r\n            appState.subtaskStates[key] = appState.allSubtasksExpanded;\r\n        });\r\n        \r\n        // Find all subtask content and arrow elements\r\n        const subtaskContents = document.querySelectorAll('[id^=\"subtask-content-\"]');\r\n        const subtaskArrows = document.querySelectorAll('[id^=\"subtask-toggle-\"]');\r\n        \r\n        subtaskContents.forEach(content => {\r\n            content.style.display = appState.allSubtasksExpanded ? 'block' : 'none';\r\n        });\r\n        \r\n        subtaskArrows.forEach(arrow => {\r\n            arrow.textContent = appState.allSubtasksExpanded ? '' : '';\r\n        });\r\n    }\r\n}\r\n\r\n","// RenderService.js - Service that handles application rendering\n// Listens to render requests via EventBus and delegates to AppRenderer\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\nimport { SERVICES, registerService } from './AppServices.js';\nimport { AppRenderer } from './AppRenderer.js';\n\n/**\n * RenderService - Handles application rendering via EventBus\n * \n * This service listens for render requests and delegates to AppRenderer.\n */\nexport class RenderService {\n    constructor(app) {\n        this.app = app;\n        this.appRenderer = new AppRenderer(app);\n        this.isRendering = false;\n        this.renderQueue = [];\n        this.setupEventListeners();\n        \n        // Register as service\n        registerService(SERVICES.RENDERER, this);\n    }\n    \n    /**\n     * Setup EventBus listeners for render requests\n     */\n    setupEventListeners() {\n        eventBus.on(EVENTS.APP.RENDER_REQUESTED, () => {\n            this.render();\n        });\n    }\n    \n    /**\n     * Render the application\n     * Delegates to AppRenderer\n     */\n    render() {\n        // Prevent multiple simultaneous renders\n        if (this.isRendering) {\n            return;\n        }\n        \n        this.isRendering = true;\n        performance.mark('render-start');\n        const renderStart = performance.now();\n        \n        try {\n            // Delegate to AppRenderer\n            this.appRenderer.render();\n            \n            performance.mark('render-end');\n            const renderTime = performance.now() - renderStart;\n            if (renderTime > 100) {\n                console.log(`[PERF] Render took ${renderTime.toFixed(1)}ms`);\n            }\n            // console.log(`[DIAG] Render complete: ${renderTime.toFixed(1)}ms`);\n            \n            // Emit render complete event\n            eventBus.emit(EVENTS.APP.RENDERED);\n        } catch (error) {\n            console.error('[RenderService] Render error:', error);\n        } finally {\n            this.isRendering = false;\n        }\n    }\n    \n    /**\n     * Request a render (public API)\n     */\n    requestRender() {\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n    }\n    \n    /**\n     * Get the AppRenderer instance\n     */\n    getRenderer() {\n        return this.appRenderer;\n    }\n}\n\n","// AppState.js - Manages application state\n// Provides getters/setters with validation and emits state change events\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\n\n/**\n * AppState - Centralized state management for TodoApp\n * \n * Manages all application state including documents, current document, UI state, etc.\n * Emits events when state changes to allow other modules to react.\n */\nexport class AppState {\n    constructor() {\n        // Core data\n        this._documents = [];\n        this._currentDocumentId = 'document-1';\n        \n        // UI state\n        this._currentEditModal = null;\n        this._contextMenuState = {\n            visible: false,\n            documentId: null,\n            groupId: null,\n            elementIndex: null,\n            subtaskIndex: null,\n            x: 0,\n            y: 0\n        };\n        this._allSubtasksExpanded = true;\n        this._lastRightClickTime = 0;\n        this._doubleClickThreshold = 300;\n        this._doubleClickDelay = 150;\n        this._clickTimeout = null;\n        this._groupStates = {}; // Track collapsed/expanded state of groups\n        this._subtaskStates = {}; // Track individual subtask visibility\n        this._activeGroupId = null;\n        this._currentEnterKeyHandler = null;\n        this._multiEditState = null;\n        this._documentStates = {}; // Track collapsed/expanded state of documents\n        \n        // Drag and drop state\n        this._dragData = null;\n        this._nestTargetElement = null;\n        this._lastMovedElement = null;\n        this._isDragging = false;\n        this._autoScrollInterval = null;\n        this._edgeScrollSpeed = 10;\n        this._currentDragOverElement = null;\n        \n        // Touch gesture state\n        this._touchPoints = {};\n        this._firstTouchData = null;\n        \n        // Mouse state\n        this._middleMouseDown = false;\n        \n        // Audio recording state (legacy)\n        this._mediaRecorder = null;\n        this._audioChunks = [];\n        this._recordingStartTime = null;\n        this._recordingTimer = null;\n        this._inlineAudioRecorders = {};\n        this._inlineAudioPlayers = {};\n        \n        // Multi-pane state\n        this._multiPaneEnabled = true; // Enable multi-pane by default\n    }\n    \n    // Multi-pane enabled getter/setter\n    get multiPaneEnabled() {\n        return this._multiPaneEnabled;\n    }\n    \n    set multiPaneEnabled(value) {\n        this._multiPaneEnabled = value;\n        eventBus.emit(EVENTS.UI.CHANGED, { type: 'multiPaneEnabled', value });\n    }\n    \n    // Documents getter/setter (canonical)\n    get documents() {\n        return this._documents;\n    }\n    \n    set documents(value) {\n        if (!Array.isArray(value)) {\n            console.warn('[AppState] documents must be an array');\n            return;\n        }\n        this._documents = value;\n        eventBus.emit(EVENTS.DATA.CHANGED, { type: 'documents', value });\n    }\n    \n    // Current document ID getter/setter (canonical)\n    get currentDocumentId() {\n        return this._currentDocumentId;\n    }\n    \n    set currentDocumentId(value) {\n        if (typeof value !== 'string') {\n            console.warn('[AppState] currentDocumentId must be a string');\n            return;\n        }\n        const oldValue = this._currentDocumentId;\n        this._currentDocumentId = value;\n        if (oldValue !== value) {\n            eventBus.emit(EVENTS.PAGE.SWITCHED, { pageId: value });\n        }\n    }\n    \n    // Current edit modal getter/setter\n    get currentEditModal() {\n        return this._currentEditModal;\n    }\n    \n    set currentEditModal(value) {\n        this._currentEditModal = value;\n    }\n    \n    // Context menu state getter/setter\n    get contextMenuState() {\n        return this._contextMenuState;\n    }\n    \n    setContextMenuState(state) {\n        const merged = { ...this._contextMenuState, ...state };\n        this._contextMenuState = merged;\n    }\n    \n    // Subtasks expanded state\n    get allSubtasksExpanded() {\n        return this._allSubtasksExpanded;\n    }\n    \n    set allSubtasksExpanded(value) {\n        this._allSubtasksExpanded = Boolean(value);\n    }\n    \n    // Group states\n    get groupStates() {\n        return this._groupStates;\n    }\n    \n    set groupStates(value) {\n        if (typeof value !== 'object' || value === null || Array.isArray(value)) {\n            console.warn('[AppState] groupStates must be an object');\n            return;\n        }\n        this._groupStates = value || {};\n    }\n    \n    setGroupState(groupId, state) {\n        this._groupStates[groupId] = state;\n    }\n    \n    getGroupState(groupId) {\n        return this._groupStates[groupId];\n    }\n    \n    // Subtask states\n    get subtaskStates() {\n        return this._subtaskStates;\n    }\n    \n    set subtaskStates(value) {\n        if (typeof value !== 'object' || value === null || Array.isArray(value)) {\n            console.warn('[AppState] subtaskStates must be an object');\n            return;\n        }\n        this._subtaskStates = value || {};\n    }\n    \n    setSubtaskState(key, state) {\n        this._subtaskStates[key] = state;\n    }\n    \n    getSubtaskState(key) {\n        return this._subtaskStates[key];\n    }\n    \n    // Document states\n    get documentStates() {\n        return this._documentStates;\n    }\n    \n    set documentStates(value) {\n        if (typeof value !== 'object' || value === null || Array.isArray(value)) {\n            console.warn('[AppState] documentStates must be an object');\n            return;\n        }\n        this._documentStates = value || {};\n    }\n    \n    setDocumentState(documentId, state) {\n        this._documentStates[documentId] = state;\n    }\n    \n    getDocumentState(documentId) {\n        return this._documentStates[documentId];\n    }\n    \n    // Active group ID\n    get activeGroupId() {\n        return this._activeGroupId;\n    }\n    \n    set activeGroupId(value) {\n        this._activeGroupId = value;\n    }\n    \n    // Drag data\n    get dragData() {\n        return this._dragData;\n    }\n    \n    set dragData(value) {\n        this._dragData = value;\n    }\n    \n    // Is dragging\n    get isDragging() {\n        return this._isDragging;\n    }\n    \n    set isDragging(value) {\n        this._isDragging = Boolean(value);\n    }\n    \n    // Inline audio recorders\n    get inlineAudioRecorders() {\n        return this._inlineAudioRecorders;\n    }\n    \n    // Inline audio players\n    get inlineAudioPlayers() {\n        return this._inlineAudioPlayers;\n    }\n    \n    // Last right click time\n    get lastRightClickTime() {\n        return this._lastRightClickTime;\n    }\n    \n    set lastRightClickTime(value) {\n        this._lastRightClickTime = Number(value) || 0;\n    }\n    \n    // Double click threshold\n    get doubleClickThreshold() {\n        return this._doubleClickThreshold;\n    }\n    \n    set doubleClickThreshold(value) {\n        this._doubleClickThreshold = Number(value) || 300;\n    }\n    \n    // Double click delay\n    get doubleClickDelay() {\n        return this._doubleClickDelay;\n    }\n    \n    set doubleClickDelay(value) {\n        this._doubleClickDelay = Number(value) || 150;\n    }\n    \n    // Click timeout\n    get clickTimeout() {\n        return this._clickTimeout;\n    }\n    \n    set clickTimeout(value) {\n        this._clickTimeout = value;\n    }\n    \n    // Current enter key handler\n    get currentEnterKeyHandler() {\n        return this._currentEnterKeyHandler;\n    }\n    \n    set currentEnterKeyHandler(value) {\n        this._currentEnterKeyHandler = value;\n    }\n    \n    // Nest target element\n    get nestTargetElement() {\n        return this._nestTargetElement;\n    }\n    \n    set nestTargetElement(value) {\n        this._nestTargetElement = value;\n    }\n    \n    // Last moved element\n    get lastMovedElement() {\n        return this._lastMovedElement;\n    }\n    \n    set lastMovedElement(value) {\n        this._lastMovedElement = value;\n    }\n    \n    // Auto scroll interval\n    get autoScrollInterval() {\n        return this._autoScrollInterval;\n    }\n    \n    set autoScrollInterval(value) {\n        this._autoScrollInterval = value;\n    }\n    \n    // Middle mouse button state\n    get middleMouseDown() {\n        return this._middleMouseDown;\n    }\n    \n    set middleMouseDown(value) {\n        this._middleMouseDown = value;\n    }\n    \n    // Edge scroll speed\n    get edgeScrollSpeed() {\n        return this._edgeScrollSpeed;\n    }\n    \n    set edgeScrollSpeed(value) {\n        this._edgeScrollSpeed = Number(value) || 10;\n    }\n    \n    // Current drag over element\n    get currentDragOverElement() {\n        return this._currentDragOverElement;\n    }\n    \n    set currentDragOverElement(value) {\n        this._currentDragOverElement = value;\n    }\n    \n    // Touch points\n    get touchPoints() {\n        return this._touchPoints;\n    }\n    \n    set touchPoints(value) {\n        this._touchPoints = value || {};\n    }\n    \n    // First touch data\n    get firstTouchData() {\n        return this._firstTouchData;\n    }\n    \n    set firstTouchData(value) {\n        this._firstTouchData = value;\n    }\n    \n    // Media recorder\n    get mediaRecorder() {\n        return this._mediaRecorder;\n    }\n    \n    set mediaRecorder(value) {\n        this._mediaRecorder = value;\n    }\n    \n    // Audio chunks\n    get audioChunks() {\n        return this._audioChunks;\n    }\n    \n    set audioChunks(value) {\n        this._audioChunks = Array.isArray(value) ? value : [];\n    }\n    \n    // Recording start time\n    get recordingStartTime() {\n        return this._recordingStartTime;\n    }\n    \n    set recordingStartTime(value) {\n        this._recordingStartTime = value;\n    }\n    \n    // Recording timer\n    get recordingTimer() {\n        return this._recordingTimer;\n    }\n    \n    set recordingTimer(value) {\n        this._recordingTimer = value;\n    }\n    \n    // Direct property access for backward compatibility\n    // These allow app.js to access properties directly during transition\n    getProperty(name) {\n        return this[`_${name}`];\n    }\n    \n    setProperty(name, value) {\n        this[`_${name}`] = value;\n    }\n    \n    /**\n     * Initialize state from app instance (for migration)\n     * @param {Object} app - TodoApp instance\n     */\n    initializeFromApp(app) {\n        this._documents = app.documents || [];\n        this._currentDocumentId = app.currentDocumentId || 'document-1';\n        this._currentEditModal = app.currentEditModal || null;\n        this._contextMenuState = app.contextMenuState || this._contextMenuState;\n        this._allSubtasksExpanded = app.allSubtasksExpanded !== undefined ? app.allSubtasksExpanded : true;\n        this._lastRightClickTime = app.lastRightClickTime || 0;\n        this._doubleClickThreshold = app.doubleClickThreshold || 300;\n        this._doubleClickDelay = app.doubleClickDelay || 150;\n        this._clickTimeout = app.clickTimeout || null;\n        this._groupStates = app.groupStates || {};\n        this._subtaskStates = app.subtaskStates || {};\n        this._activeGroupId = app.activeGroupId || null;\n        this._currentEnterKeyHandler = app.currentEnterKeyHandler || null;\n        this._dragData = app.dragData || null;\n        this._nestTargetElement = app.nestTargetElement || null;\n        this._lastMovedElement = app.lastMovedElement || null;\n        this._isDragging = app.isDragging || false;\n        this._autoScrollInterval = app.autoScrollInterval || null;\n        this._edgeScrollSpeed = app.edgeScrollSpeed || 10;\n        this._currentDragOverElement = app.currentDragOverElement || null;\n        this._touchPoints = app.touchPoints || {};\n        this._firstTouchData = app.firstTouchData || null;\n        this._mediaRecorder = app.mediaRecorder || null;\n        this._audioChunks = app.audioChunks || [];\n        this._recordingStartTime = app.recordingStartTime || null;\n        this._recordingTimer = app.recordingTimer || null;\n        this._inlineAudioRecorders = app.inlineAudioRecorders || {};\n        this._inlineAudioPlayers = app.inlineAudioPlayers || {};\n        this._documentStates = app.documentStates || {};\n    }\n    \n    /**\n     * Sync state back to app instance (for backward compatibility during transition)\n     * @param {Object} app - TodoApp instance\n     */\n    syncToApp(app) {\n        app.documents = this._documents;\n        app.currentDocumentId = this._currentDocumentId;\n        app.currentEditModal = this._currentEditModal;\n        app.contextMenuState = this._contextMenuState;\n        app.allSubtasksExpanded = this._allSubtasksExpanded;\n        app.lastRightClickTime = this._lastRightClickTime;\n        app.doubleClickThreshold = this._doubleClickThreshold;\n        app.doubleClickDelay = this._doubleClickDelay;\n        app.clickTimeout = this._clickTimeout;\n        app.groupStates = this._groupStates;\n        app.subtaskStates = this._subtaskStates;\n        app.activeGroupId = this._activeGroupId;\n        app.currentEnterKeyHandler = this._currentEnterKeyHandler;\n        app.multiEditState = this._multiEditState;\n        app.documentStates = this._documentStates;\n        app.dragData = this._dragData;\n        app.nestTargetElement = this._nestTargetElement;\n        app.lastMovedElement = this._lastMovedElement;\n        app.isDragging = this._isDragging;\n        app.autoScrollInterval = this._autoScrollInterval;\n        app.edgeScrollSpeed = this._edgeScrollSpeed;\n        app.currentDragOverElement = this._currentDragOverElement;\n        app.touchPoints = this._touchPoints;\n        app.firstTouchData = this._firstTouchData;\n        app.mediaRecorder = this._mediaRecorder;\n        app.audioChunks = this._audioChunks;\n        app.recordingStartTime = this._recordingStartTime;\n        app.recordingTimer = this._recordingTimer;\n        app.inlineAudioRecorders = this._inlineAudioRecorders;\n        app.inlineAudioPlayers = this._inlineAudioPlayers;\n    }\n}\n\n","// PluginDiscovery.js - Discovers and loads plugins from manifest files\r\n// Replaces hardcoded plugin lists with configuration-based discovery\r\n\r\n/**\r\n * PluginDiscoveryManager - Discovers plugins from manifest files\r\n * \r\n * Supports:\r\n * - Loading plugins from manifest.json\r\n * - Scanning plugin directories\r\n * - Configuration-based plugin loading\r\n * - Optional plugins (graceful failure)\r\n */\r\nexport class PluginDiscoveryManager {\r\n    constructor() {\r\n        this.manifestPath = '/js/plugins/plugin-manifest.json';\r\n        this.manifest = null;\r\n    }\r\n    \r\n    /**\r\n     * Load plugin manifest\r\n     * @returns {Promise<Object>} Manifest object\r\n     */\r\n    async loadManifest() {\r\n        if (this.manifest) {\r\n            return this.manifest;\r\n        }\r\n        \r\n        try {\r\n            const response = await fetch(this.manifestPath);\r\n            if (!response.ok) {\r\n                console.warn('[PluginDiscovery] Manifest not found, using defaults');\r\n                return this.getDefaultManifest();\r\n            }\r\n            this.manifest = await response.json();\r\n            return this.manifest;\r\n        } catch (error) {\r\n            console.warn('[PluginDiscovery] Failed to load manifest:', error);\r\n            return this.getDefaultManifest();\r\n        }\r\n    }\r\n    \r\n    /**\r\n     * Get default manifest (fallback if manifest file doesn't exist)\r\n     * @returns {Object} Default manifest\r\n     */\r\n    getDefaultManifest() {\r\n        return {\r\n            elementTypes: [\r\n                { name: 'LinkBookmarkElement', path: '/js/plugins/element/LinkBookmarkElement.js' },\r\n                { name: 'CodeSnippetElement', path: '/js/plugins/element/CodeSnippetElement.js' },\r\n                { name: 'TableElement', path: '/js/plugins/element/TableElement.js' },\r\n                { name: 'ContactElement', path: '/js/plugins/element/ContactElement.js' },\r\n                { name: 'ExpenseTrackerElement', path: '/js/plugins/element/ExpenseTrackerElement.js' },\r\n                { name: 'ReadingListElement', path: '/js/plugins/element/ReadingListElement.js' },\r\n                { name: 'RecipeElement', path: '/js/plugins/element/RecipeElement.js' },\r\n                { name: 'WorkoutElement', path: '/js/plugins/element/WorkoutElement.js' },\r\n                { name: 'MoodTrackerElement', path: '/js/plugins/element/MoodTrackerElement.js' },\r\n                { name: 'NoteElement', path: '/js/plugins/element/NoteElement.js' },\r\n                { name: 'HabitTracker', path: '/js/plugins/element/HabitTracker.js' },\r\n                { name: 'TimeTracking', path: '/js/plugins/element/TimeTracking.js' },\r\n                { name: 'ElementRelationships', path: '/js/plugins/element/ElementRelationships.js' },\r\n                { name: 'CustomProperties', path: '/js/plugins/element/CustomProperties.js' }\r\n            ],\r\n            pagePlugins: [\r\n                { name: 'SearchFilter', path: '/js/plugins/page/SearchFilter.js' },\r\n                { name: 'ExportImport', path: '/js/plugins/page/ExportImport.js' },\r\n                { name: 'PageTemplates', path: '/js/plugins/page/PageTemplates.js' },\r\n                { name: 'CustomScripts', path: '/js/plugins/page/CustomScripts.js' },\r\n                { name: 'PageThemes', path: '/js/plugins/page/PageThemes.js' },\r\n                { name: 'CustomViews', path: '/js/plugins/page/CustomViews.js' },\r\n                { name: 'AnalyticsDashboard', path: '/js/plugins/page/AnalyticsDashboard.js' },\r\n                { name: 'PageGoalSetting', path: '/js/plugins/page/PageGoalSetting.js' },\r\n                { name: 'PageReminderSystem', path: '/js/plugins/page/PageReminderSystem.js' }\r\n            ],\r\n            binPlugins: [\r\n                { name: 'KanbanBoard', path: '/js/plugins/bin/KanbanBoard.js' },\r\n                { name: 'WorkflowAutomation', path: '/js/plugins/bin/WorkflowAutomation.js' },\r\n                { name: 'BatchOperations', path: '/js/plugins/bin/BatchOperations.js' },\r\n                { name: 'CustomSorting', path: '/js/plugins/bin/CustomSorting.js' },\r\n                { name: 'FilterPresets', path: '/js/plugins/bin/FilterPresets.js' },\r\n                { name: 'ProgressTracker', path: '/js/plugins/bin/ProgressTracker.js' },\r\n                { name: 'TimeEstimates', path: '/js/plugins/bin/TimeEstimates.js' },\r\n                { name: 'ColorCoding', path: '/js/plugins/bin/ColorCoding.js' },\r\n                { name: 'BinArchive', path: '/js/plugins/bin/BinArchive.js' },\r\n                { name: 'BinStatistics', path: '/js/plugins/bin/BinStatistics.js' },\r\n                { name: 'BinNotificationRules', path: '/js/plugins/bin/BinNotificationRules.js' },\r\n                { name: 'GanttChartView', path: '/js/plugins/bin/GanttChartView.js' }\r\n            ],\r\n            formatRenderers: [\r\n                { name: 'TrelloBoardFormat', path: '/js/plugins/format/TrelloBoardFormat.js' },\r\n                { name: 'GridLayoutFormat', path: '/js/plugins/format/GridLayoutFormat.js' },\r\n                { name: 'HorizontalLayoutFormat', path: '/js/plugins/format/HorizontalLayoutFormat.js' },\r\n                { name: 'PageKanbanFormat', path: '/js/plugins/format/PageKanbanFormat.js' },\r\n                { name: 'DocumentViewFormat', path: '/js/plugins/format/DocumentViewFormat.js' },\r\n                { name: 'LaTeXEditorFormat', path: '/js/plugins/format/LaTeXEditorFormat.js' },\r\n                { name: 'MindMapFormat', path: '/js/plugins/format/MindMapFormat.js' },\r\n                { name: 'LogicGraphFormat', path: '/js/plugins/format/LogicGraphFormat.js' },\r\n                { name: 'FlowchartFormat', path: '/js/plugins/format/FlowchartFormat.js' }\r\n            ]\r\n        };\r\n    }\r\n    \r\n    /**\r\n     * Get element type plugins\r\n     * @returns {Promise<Array>} Array of plugin definitions\r\n     */\r\n    async getElementTypes() {\r\n        const manifest = await this.loadManifest();\r\n        return manifest.elementTypes || [];\r\n    }\r\n    \r\n    /**\r\n     * Get page plugins\r\n     * @returns {Promise<Array>} Array of plugin definitions\r\n     */\r\n    async getPagePlugins() {\r\n        const manifest = await this.loadManifest();\r\n        return manifest.pagePlugins || [];\r\n    }\r\n    \r\n    /**\r\n     * Get bin plugins\r\n     * @returns {Promise<Array>} Array of plugin definitions\r\n     */\r\n    async getBinPlugins() {\r\n        const manifest = await this.loadManifest();\r\n        return manifest.binPlugins || [];\r\n    }\r\n    \r\n    /**\r\n     * Get format renderers\r\n     * @returns {Promise<Array>} Array of plugin definitions\r\n     */\r\n    async getFormatRenderers() {\r\n        const manifest = await this.loadManifest();\r\n        return manifest.formatRenderers || [];\r\n    }\r\n    \r\n    /**\r\n     * Get all plugins\r\n     * @returns {Promise<Object>} Object with all plugin types\r\n     */\r\n    async getAllPlugins() {\r\n        const manifest = await this.loadManifest();\r\n        return {\r\n            elementTypes: manifest.elementTypes || [],\r\n            pagePlugins: manifest.pagePlugins || [],\r\n            binPlugins: manifest.binPlugins || [],\r\n            formatRenderers: manifest.formatRenderers || []\r\n        };\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const pluginDiscovery = new PluginDiscoveryManager();\r\n","// AppInitializationManager.js - Handles application initialization\n// Extracted from app.js to reduce coupling and improve modularity\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\nimport { pluginDiscovery } from './PluginDiscoveryManager.js';\n\n/**\n * AppInitializationManager - Manages application initialization sequence\n * \n * Handles plugin loading, async initialization, and startup sequence.\n */\nexport class AppInitializationManager {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Initialize the application\n     * This is the main initialization method called from app.js\n     */\n    async init() {\n        // Load settings first\n        const settings = this.app.settingsManager.loadSettings();\n        this.app.settingsManager.applySettings(settings);\n        \n        // Check for file parameter in URL (before loading other data)\n        const urlParams = new URLSearchParams(window.location.search);\n        const fileParam = urlParams.get('file');\n        if (fileParam) {\n            try {\n                // Load the file specified in URL\n                const fileData = await this.app.fileManager.loadFile(fileParam);\n                const documents = fileData.documents || [];\n                if (Array.isArray(documents)) {\n                    this.app.documents = documents;\n                    if (this.app.appState) {\n                        this.app.appState.documents = documents;\n                        const currentId = fileData.currentDocumentId;\n                        if (currentId) {\n                            this.app.appState.currentDocumentId = currentId;\n                        }\n                    }\n                    // Store as last opened file\n                    localStorage.setItem('twodo-last-opened-file', fileParam);\n                    console.log(`Loaded file from URL: ${fileParam}`);\n                }\n            } catch (error) {\n                console.warn('Failed to load file from URL:', error);\n                // Fall through to load last opened file or default\n            }\n        } else {\n            // Check daily reset before loading data (only if no URL file param)\n            this.app.dataManager.checkDailyReset();\n            \n            // Load data (only once, only if no URL file param)\n            this.app.dataManager.loadData();\n        }\n        \n        // Initialize format renderer manager from loaded data\n        if (this.app.formatRendererManager) {\n            this.app.formatRendererManager.initializeFromSavedData();\n        }\n        \n        // Initialize relationships from loaded data (fast, synchronous)\n        this.app.relationshipManager.initializeFromData();\n        \n        // Set up event listeners\n        this.app.eventHandler.setupEventListeners();\n        this.app.setupTrashIcon();\n        \n        // Load last opened file BEFORE rendering to ensure we have the correct data\n        // This prevents rendering with empty/default data and then re-rendering\n        const initLoadStart = performance.now();\n        await this.app.loadLastOpenedFile();\n        const initLoadTime = performance.now() - initLoadStart;\n        // console.log(`[DIAG] AppInitializer.init() - loadLastOpenedFile took: ${initLoadTime.toFixed(1)}ms`);\n        \n        // Now render with the loaded data\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        // Now do async operations in the background (non-blocking)\n        // Connect to sync if needed\n        (async () => {\n            // After loading file, connect to sync if needed\n            if (this.app.fileManager && this.app.fileManager.currentFilename && this.app.syncManager) {\n                // Store filename to join once connected\n                this.app.syncManager.pendingFileJoin = this.app.fileManager.currentFilename;\n                \n                // Connect to WebSocket (non-blocking, will retry automatically)\n                // Don't await - let it connect in the background\n                this.app.syncManager.connect().catch(error => {\n                    console.warn('WebSocket connection failed, will retry:', error);\n                    // Connection will retry automatically, and joinFile will be called on connect\n                });\n            }\n        })();\n        \n        // Initialize plugin system in background (loads in parallel for faster startup)\n        // This happens after initial render so the UI appears quickly\n        this.app.initializePlugins().catch(err => console.error('Plugin initialization error:', err));\n        \n        // Initialize global search in background\n        this.app.initializeGlobalSearch().catch(err => console.error('Global search initialization error:', err));\n        \n        // Rebuild search index in background (non-blocking)\n        if (this.app.searchIndex) {\n            // Use requestIdleCallback if available, otherwise setTimeout\n            if (window.requestIdleCallback) {\n                requestIdleCallback(() => this.app.searchIndex.rebuildIndex());\n            } else {\n                setTimeout(() => this.app.searchIndex.rebuildIndex(), 0);\n            }\n        }\n    }\n    \n    /**\n     * Load all available plugins\n     * Uses PluginDiscovery to load plugins from manifest\n     */\n    async loadAllPlugins() {\n        // Get plugin definitions from PluginDiscovery\n        const plugins = await pluginDiscovery.getAllPlugins();\n        \n        // Load all plugins\n        const loadPromises = [];\n        \n        // Load element types\n        for (const pluginDef of plugins.elementTypes) {\n            loadPromises.push(\n                this.app.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this.app)\n                    .catch(err => {\n                        // Silently ignore connection/fetch errors (file doesn't exist or server issue)\n                        // These are expected for optional plugins that may not be implemented yet\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        // Log other unexpected errors\n                        console.warn(`Failed to load element type ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load page plugins\n        for (const pluginDef of plugins.pagePlugins) {\n            loadPromises.push(\n                this.app.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this.app)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load page plugin ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load bin plugins\n        for (const pluginDef of plugins.binPlugins) {\n            loadPromises.push(\n                this.app.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this.app)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load bin plugin ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load format renderers\n        for (const pluginDef of plugins.formatRenderers) {\n            loadPromises.push(\n                this.app.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this.app)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load format renderer ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Wait for all plugins to load\n        await Promise.allSettled(loadPromises);\n        console.log('All plugins loaded');\n        \n        // Rescan for formats after all plugins are loaded\n        if (this.app.formatRendererManager) {\n            console.log('[AppInitializer] Rescanning for formats after plugin load...');\n            this.app.formatRendererManager.scanForFormats();\n        }\n    }\n    \n    /**\n     * Initialize plugin system\n     */\n    async initializePlugins() {\n        // Load all available plugins first (already parallel)\n        await this.loadAllPlugins();\n        \n        // Initialize plugins for existing documents and groups in parallel\n        const initPromises = [];\n        for (const page of this.app.documents) {\n            initPromises.push(\n                this.app.pagePluginManager.initializePagePlugins(page.id)\n                    .catch(err => console.warn(`Failed to initialize page plugins for ${page.id}:`, err))\n            );\n            if (page.groups) {\n                for (const bin of page.groups) {\n                    initPromises.push(\n                        this.app.binPluginManager.initializeBinPlugins(page.id, bin.id)\n                            .catch(err => console.warn(`Failed to initialize bin plugins for ${page.id}/${bin.id}:`, err))\n                    );\n                }\n            }\n        }\n        // Wait for all plugin initializations in parallel\n        await Promise.allSettled(initPromises);\n    }\n    \n    /**\n     * Initialize global search feature\n     */\n    async initializeGlobalSearch() {\n        try {\n            const SearchFilter = (await import('/js/plugins/page/SearchFilter.js')).default;\n            this.app.globalSearchFilter = new SearchFilter(this.app);\n            await this.app.globalSearchFilter.onInit();\n        } catch (error) {\n            console.error('Failed to initialize global search:', error);\n        }\n        \n        // Setup search index update listeners\n        this.app.eventBus.on('element:created', () => {\n            if (this.app.searchIndex) {\n                this.app.searchIndex.rebuildIndex();\n            }\n        });\n        this.app.eventBus.on('element:updated', ({ pageId, binId, elementIndex }) => {\n            if (this.app.searchIndex) {\n                this.app.searchIndex.updateElement(pageId, binId, elementIndex);\n            }\n        });\n        this.app.eventBus.on('element:deleted', ({ pageId, binId, elementIndex }) => {\n            if (this.app.searchIndex) {\n                this.app.searchIndex.removeElement(pageId, binId, elementIndex);\n            }\n        });\n    }\n}\n\n","// DailyResetManager.js - Handles daily task reset logic\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class DailyResetManager {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    /**\n     * Reset tasks for the new day\n     * Removes completed one-time tasks and resets repeating tasks\n     */\n    resetToday() {\n        const today = new Date();\n        const todayDateString = today.toDateString();\n        \n        const appState = this._getAppState();\n        if (!appState || !appState.documents) return;\n        appState.documents.forEach(page => {\n            page.groups?.forEach(bin => {\n                const items = bin.items || [];\n                bin.items = items;\n                // Filter out completed one-time tasks first (but not persistent elements)\n                bin.items = bin.items.filter(element => {\n                // Skip persistent elements entirely\n                if (element.persistent || element.type === 'image' || element.type === 'calendar') {\n                    return true;\n                }\n                // Delete one-time tasks that are completed\n                if (element.repeats === false && element.completed) {\n                    return false;\n                }\n                return true;\n                });\n                \n                // Reset repeating tasks\n                bin.items.forEach(element => {\n                // Skip persistent elements - they never reset\n                if (element.persistent || element.type === 'image' || element.type === 'calendar') {\n                    return;\n                }\n                \n                // Handle recurring schedules (non-daily)\n                if (element.recurringSchedule && element.recurringSchedule !== 'daily') {\n                    // Check if it's time to reset based on schedule\n                    const lastReset = element.lastResetDate ? new Date(element.lastResetDate) : null;\n                    let shouldReset = false;\n                    \n                    if (!lastReset) {\n                        // Never reset before - reset now\n                        shouldReset = true;\n                    } else {\n                        const daysSinceReset = Math.floor((today - lastReset) / (1000 * 60 * 60 * 24));\n                        \n                        switch (element.recurringSchedule) {\n                            case 'weekly':\n                                shouldReset = daysSinceReset >= 7;\n                                break;\n                            case 'monthly':\n                                shouldReset = daysSinceReset >= 30;\n                                break;\n                            case 'custom':\n                                // For custom patterns, we'd need to parse the pattern\n                                // For now, treat as weekly\n                                shouldReset = daysSinceReset >= 7;\n                                break;\n                            default:\n                                shouldReset = false;\n                        }\n                    }\n                    \n                    if (shouldReset) {\n                        element.completed = false;\n                        element.lastResetDate = todayDateString;\n                        // Reset subtasks and items\n                        if (element.subtasks) {\n                            element.subtasks.forEach(st => {\n                                if (st.repeats !== false && !st.persistent) {\n                                    st.completed = false;\n                                }\n                            });\n                        }\n                        if (element.items) {\n                            element.items.forEach(item => {\n                                if (item.repeats !== false && !item.persistent) {\n                                    item.completed = false;\n                                }\n                            });\n                        }\n                    }\n                } else if (element.repeats !== false) {\n                    // Daily repeating tasks - always reset\n                    element.completed = false;\n                    if (element.subtasks) {\n                        element.subtasks.forEach(st => {\n                            if (st.repeats !== false && !st.persistent) {\n                                st.completed = false;\n                            }\n                        });\n                    }\n                    if (element.items) {\n                        element.items.forEach(item => {\n                            if (item.repeats !== false && !item.persistent) {\n                                item.completed = false;\n                            }\n                        });\n                    }\n                }\n                });\n            });\n        });\n        \n        const dataManager = this._getDataManager();\n        if (dataManager) {\n            localStorage.setItem(dataManager.lastResetKey, todayDateString);\n            dataManager.saveData();\n        }\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n    }\n}\n\n","// InlineEditor.js - Handles inline text editing functionality\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { getService, SERVICES, hasService } from '../core/AppServices.js';\n\nexport class InlineEditor {\n    constructor() {\n    }\n    \n    /**\n     * Get services\n     */\n    _getAppState() {\n        return getService(SERVICES.APP_STATE);\n    }\n    \n    _getUndoRedoManager() {\n        return getService(SERVICES.UNDO_REDO_MANAGER);\n    }\n    \n    _getDataManager() {\n        return getService(SERVICES.DATA_MANAGER);\n    }\n    \n    /**\n     * Enable inline editing for element text\n     * @param {HTMLElement} textElement - The DOM element to make editable\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     * @param {Object} element - Element data object\n     */\n    enableInlineEditing(textElement, pageId, binId, elementIndex, element) {\n        // Don't enable if already editing\n        if (textElement.contentEditable === 'true') {\n            return;\n        }\n        \n        // Store original text\n        const originalText = element.text || '';\n        \n        // Get plain text from element (remove HTML from links)\n        let plainText = '';\n        if (textElement.textContent) {\n            plainText = textElement.textContent.trim();\n        } else {\n            plainText = originalText;\n        }\n        \n        // Make element editable\n        textElement.contentEditable = 'true';\n        textElement.textContent = plainText;\n        textElement.style.outline = '2px solid #4a9eff';\n        textElement.style.outlineOffset = '2px';\n        textElement.style.borderRadius = '2px';\n        \n        // Focus and select all\n        textElement.focus();\n        const range = document.createRange();\n        range.selectNodeContents(textElement);\n        const selection = window.getSelection();\n        selection.removeAllRanges();\n        selection.addRange(range);\n        \n        // Handle blur (save on focus loss)\n        const handleBlur = () => {\n            const newText = textElement.textContent.trim();\n            textElement.contentEditable = 'false';\n            textElement.style.outline = '';\n            textElement.style.outlineOffset = '';\n            textElement.style.borderRadius = '';\n            \n            // Update element text if changed\n            // Store as plain text (inline editing extracts plain text, which is correct)\n            // Users can use markdown/HTML syntax which will be rendered by parseLinks\n            if (newText !== originalText) {\n                const appState = this._getAppState();\n                const page = appState.documents.find(p => p.id === pageId);\n                const bin = page?.groups?.find(b => b.id === binId);\n                const items = bin?.items || [];\n                if (bin) {\n                    bin.items = items;\n                }\n                const el = items[elementIndex];\n                if (el) {\n                    // Record undo/redo change\n                    const undoRedoManager = this._getUndoRedoManager();\n                    if (undoRedoManager) {\n                        undoRedoManager.recordElementPropertyChange(pageId, binId, elementIndex, 'text', newText, originalText);\n                    }\n                    el.text = newText;\n                    const dataManager = this._getDataManager();\n                    if (dataManager) {\n                        dataManager.saveData();\n                    }\n                    // Re-render to update links and formatting\n                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                }\n            } else {\n                // Restore original formatting even if text didn't change\n                eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            }\n            \n            textElement.removeEventListener('blur', handleBlur);\n            textElement.removeEventListener('keydown', handleKeyDown);\n        };\n        \n        // Handle Enter key (save and exit)\n        const handleKeyDown = (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                textElement.blur();\n            } else if (e.key === 'Escape') {\n                // Cancel editing - restore original text\n                textElement.textContent = originalText;\n                textElement.blur();\n            }\n        };\n        \n        textElement.addEventListener('blur', handleBlur);\n        textElement.addEventListener('keydown', handleKeyDown);\n    }\n}\n\n","// NavigationHelper.js - Centralized navigation and scrolling utilities\n// Provides unified navigation, scrolling, and element highlighting\n\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { ElementFinder } from './ElementFinder.js';\n\nexport class NavigationHelper {\n    /**\n     * Navigate to a specific element\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     * @param {Object} options - Navigation options\n     * @param {Object} app - App instance\n     * @param {boolean} options.highlight - Whether to highlight the element (default: true)\n     * @param {string} options.highlightColor - Highlight color (default: 'rgba(74, 158, 255, 0.3)')\n     * @param {number} options.highlightDuration - Highlight duration in ms (default: 2000)\n     * @param {Object} options.scrollOptions - Options for scrollIntoView (default: { behavior: 'smooth', block: 'center' })\n     * @param {number} options.delay - Delay before scrolling in ms (default: 100)\n     */\n    static navigateToElement(pageId, binId, elementIndex, app, options = {}) {\n        const {\n            highlight = true,\n            highlightColor = 'rgba(74, 158, 255, 0.3)',\n            highlightDuration = 2000,\n            scrollOptions = { behavior: 'smooth', block: 'center' },\n            delay = 100\n        } = options;\n        \n        // Switch to page\n        if (app && app.appState) {\n            app.appState.currentDocumentId = pageId;\n        }\n        \n        // Emit events\n        eventBus.emit(EVENTS.PAGE.SWITCHED, { pageId });\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        // Scroll to element after render\n        setTimeout(() => {\n            const element = ElementFinder.findElement(pageId, binId, elementIndex);\n            if (element) {\n                this.scrollToElement(element, scrollOptions);\n                if (highlight) {\n                    this.highlightElement(element, highlightDuration, highlightColor);\n                }\n            }\n        }, delay);\n    }\n    \n    /**\n     * Navigate to a specific page\n     * @param {string} pageId - Page ID\n     * @param {Object} app - App instance\n     * @param {Object} options - Navigation options\n     * @param {boolean} options.render - Whether to trigger render (default: true)\n     */\n    static navigateToPage(pageId, app, options = {}) {\n        const { render = true } = options;\n        \n        if (app && app.appState) {\n            app.appState.currentDocumentId = pageId;\n        }\n        \n        if (render) {\n            eventBus.emit(EVENTS.PAGE.SWITCHED, { pageId });\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        }\n    }\n    \n    /**\n     * Navigate to a specific bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {Object} app - App instance\n     * @param {Object} options - Navigation options\n     * @param {boolean} options.scroll - Whether to scroll to bin (default: true)\n     */\n    static navigateToBin(pageId, binId, app, options = {}) {\n        const { scroll = true } = options;\n        \n        // Navigate to page first\n        this.navigateToPage(pageId, app, options);\n        \n        if (scroll) {\n            setTimeout(() => {\n                const bin = this.findBin(pageId, binId);\n                if (bin) {\n                    this.scrollToElement(bin, { behavior: 'smooth', block: 'start' });\n                }\n            }, 100);\n        }\n    }\n    \n    /**\n     * Highlight an element with a fade effect\n     * @param {HTMLElement} element - Element to highlight\n     * @param {number} duration - Duration in milliseconds (default: 2000)\n     * @param {string} color - Highlight color (default: 'rgba(74, 158, 255, 0.3)')\n     */\n    static highlightElement(element, duration = 2000, color = 'rgba(74, 158, 255, 0.3)') {\n        if (!element) return;\n        \n        const originalBackground = element.style.background;\n        const originalTransition = element.style.transition;\n        \n        element.style.background = color;\n        element.style.transition = 'background 0.3s';\n        \n        setTimeout(() => {\n            element.style.background = originalBackground;\n            setTimeout(() => {\n                element.style.transition = originalTransition;\n            }, 300);\n        }, duration);\n    }\n    \n    /**\n     * Scroll to an element\n     * @param {HTMLElement} element - Element to scroll to\n     * @param {Object} options - Scroll options (passed to scrollIntoView)\n     */\n    static scrollToElement(element, options = {}) {\n        if (!element) return;\n        \n        const defaultOptions = {\n            behavior: 'smooth',\n            block: 'center',\n            inline: 'nearest'\n        };\n        \n        element.scrollIntoView({ ...defaultOptions, ...options });\n    }\n    \n    /**\n     * Find element by data attributes\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     * @param {HTMLElement} context - Optional context element (default: document)\n     * @param {number} childIndex - Optional child index for nested elements\n     * @returns {HTMLElement|null} Found element or null\n     */\n    static findElementByData(pageId, binId, elementIndex, context = document, childIndex = null) {\n        let selector = `[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"][data-element-index=\"${elementIndex}\"]`;\n        \n        if (childIndex !== null && childIndex !== undefined) {\n            selector += `[data-child-index=\"${childIndex}\"]`;\n        }\n        \n        return context.querySelector(selector);\n    }\n    \n    /**\n     * Find bin element by data attributes\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {HTMLElement} context - Optional context element (default: document)\n     * @returns {HTMLElement|null} Found bin element or null\n     */\n    static findBin(pageId, binId, context = document) {\n        return context.querySelector(`[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"].bin`);\n    }\n    \n    /**\n     * Find page element by data attributes\n     * @param {string} pageId - Page ID\n     * @param {HTMLElement} context - Optional context element (default: document)\n     * @returns {HTMLElement|null} Found page element or null\n     */\n    static findPage(pageId, context = document) {\n        return context.querySelector(`[data-page-id=\"${pageId}\"].page`);\n    }\n    \n    /**\n     * Find all elements in a bin\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {HTMLElement} context - Optional context element (default: document)\n     * @returns {NodeList} List of element nodes\n     */\n    static findAllElements(pageId, binId, context = document) {\n        return context.querySelectorAll(`[data-page-id=\"${pageId}\"][data-bin-id=\"${binId}\"][data-element-index]`);\n    }\n}\n\n","// LinkHandler.js - Unified link handling system for external URLs and internal references\nimport { eventBus } from '../core/EventBus.js';\nimport { EVENTS } from '../core/AppEvents.js';\nimport { NavigationHelper } from './NavigationHelper.js';\n\nexport class LinkHandler {\n    constructor(app) {\n        this.app = app;\n    }\n    \n    /**\n     * Parse text and create links (external URLs and internal references)\n     * @param {string} text - Text to parse\n     * @param {Object} context - Context (pageId, binId, elementIndex)\n     * @returns {DocumentFragment} Fragment containing text nodes and link elements\n     */\n    parseLinks(text, context = {}) {\n        if (!text || typeof text !== 'string') {\n            return document.createDocumentFragment();\n        }\n        \n        const fragment = document.createDocumentFragment();\n        \n        // Pattern for internal references: [[page-name]], [[element-id]], [[bin-name]]\n        // Also supports: [[page-name|display text]], [[element-id|display text]]\n        const internalRefPattern = /\\[\\[([^\\]]+)\\]\\]/g;\n        \n        // Pattern for markdown links: [text](url)\n        const markdownLinkPattern = /\\[([^\\]]+)\\]\\(([^)]+)\\)/g;\n        \n        // Pattern for URLs: http://, https://, www., or domain.com\n        const urlPattern = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}[^\\s]*)/g;\n        \n        // First, handle markdown links and internal references (they have priority)\n        let processedText = text;\n        const linkMatches = [];\n        \n        // Collect all link matches with their positions\n        let match;\n        \n        // Markdown links\n        while ((match = markdownLinkPattern.exec(text)) !== null) {\n            linkMatches.push({\n                type: 'markdown',\n                start: match.index,\n                end: match.index + match[0].length,\n                text: match[1],\n                url: match[2],\n                fullMatch: match[0]\n            });\n        }\n        \n        // Internal references\n        while ((match = internalRefPattern.exec(text)) !== null) {\n            const refText = match[1];\n            const parts = refText.split('|');\n            const ref = parts[0].trim();\n            const displayText = parts[1] ? parts[1].trim() : ref;\n            \n            linkMatches.push({\n                type: 'internal',\n                start: match.index,\n                end: match.index + match[0].length,\n                ref: ref,\n                displayText: displayText,\n                fullMatch: match[0]\n            });\n        }\n        \n        // Sort matches by position\n        linkMatches.sort((a, b) => a.start - b.start);\n        \n        // Build fragment by processing text segments\n        let lastIndex = 0;\n        \n        linkMatches.forEach(linkMatch => {\n            // Add text before link\n            if (linkMatch.start > lastIndex) {\n                const beforeText = text.substring(lastIndex, linkMatch.start);\n                this._addTextWithUrls(fragment, beforeText);\n            }\n            \n            // Add link\n            if (linkMatch.type === 'markdown') {\n                const link = this._createExternalLink(linkMatch.url, linkMatch.text);\n                fragment.appendChild(link);\n            } else if (linkMatch.type === 'internal') {\n                const link = this._createInternalLink(linkMatch.ref, linkMatch.displayText, context);\n                fragment.appendChild(link);\n            }\n            \n            lastIndex = linkMatch.end;\n        });\n        \n        // Add remaining text\n        if (lastIndex < text.length) {\n            const remainingText = text.substring(lastIndex);\n            this._addTextWithUrls(fragment, remainingText);\n        }\n        \n        // Process markdown formatting (bold, italic, code, strikethrough)\n        this._processMarkdownFormatting(fragment);\n        \n        return fragment;\n    }\n    \n    /**\n     * Add text with URL detection (for text outside of markdown/internal links)\n     * @param {DocumentFragment} fragment - Fragment to add to\n     * @param {string} text - Text to process\n     */\n    _addTextWithUrls(fragment, text) {\n        if (!text) return;\n        \n        const urlPattern = /(https?:\\/\\/[^\\s]+|www\\.[^\\s]+|[a-zA-Z0-9-]+\\.[a-zA-Z]{2,}[^\\s]*)/g;\n        const parts = text.split(urlPattern);\n        \n        parts.forEach(part => {\n            if (urlPattern.test(part)) {\n                // This is a URL\n                let href = part;\n                if (!href.startsWith('http://') && !href.startsWith('https://')) {\n                    href = 'https://' + href;\n                }\n                const link = this._createExternalLink(href, part);\n                fragment.appendChild(link);\n            } else if (part) {\n                // Regular text\n                const textNode = document.createTextNode(part);\n                fragment.appendChild(textNode);\n            }\n        });\n    }\n    \n    /**\n     * Process markdown formatting in fragment (bold, italic, code, strikethrough)\n     * @param {DocumentFragment} fragment - Fragment to process\n     */\n    _processMarkdownFormatting(fragment) {\n        // Convert fragment to string, process, then rebuild\n        const tempDiv = document.createElement('div');\n        tempDiv.appendChild(fragment.cloneNode(true));\n        \n        let html = tempDiv.innerHTML;\n        \n        // Process markdown (order matters)\n        // Code (before bold/italic to avoid conflicts)\n        html = html.replace(/`([^`]+)`/g, '<code>$1</code>');\n        // Bold\n        html = html.replace(/\\*\\*([^*]+)\\*\\*/g, '<strong>$1</strong>');\n        // Italic (but not if it's part of bold)\n        html = html.replace(/(?<!\\*)\\*([^*]+?)\\*(?!\\*)/g, '<em>$1</em>');\n        // Strikethrough\n        html = html.replace(/~~([^~]+)~~/g, '<del>$1</del>');\n        \n        // Rebuild fragment\n        tempDiv.innerHTML = html;\n        // Clear fragment properly (DocumentFragments don't have innerHTML)\n        while (fragment.firstChild) {\n            fragment.removeChild(fragment.firstChild);\n        }\n        while (tempDiv.firstChild) {\n            fragment.appendChild(tempDiv.firstChild);\n        }\n    }\n    \n    /**\n     * Create external link element\n     * @param {string} href - URL\n     * @param {string} text - Link text\n     * @returns {HTMLElement} Link element\n     */\n    _createExternalLink(href, text) {\n        const link = document.createElement('a');\n        link.href = href;\n        link.textContent = text;\n        link.target = '_blank';\n        link.rel = 'noopener noreferrer';\n        link.style.color = '#4a9eff';\n        link.style.textDecoration = 'underline';\n        link.className = 'external-link';\n        link.onclick = (e) => {\n            e.stopPropagation();\n            // Allow default navigation to external URLs\n        };\n        return link;\n    }\n    \n    /**\n     * Create internal link element (to page, element, or bin)\n     * @param {string} ref - Reference (page name, element ID, bin name)\n     * @param {string} displayText - Display text\n     * @param {Object} context - Context (pageId, binId, elementIndex)\n     * @returns {HTMLElement} Link element\n     */\n    _createInternalLink(ref, displayText, context) {\n        const link = document.createElement('a');\n        link.textContent = displayText;\n        link.href = '#';\n        link.className = 'internal-link';\n        link.style.color = '#4a9eff';\n        link.style.textDecoration = 'underline';\n        link.style.cursor = 'pointer';\n        link.dataset.internalRef = ref;\n        \n        link.onclick = (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            this.navigateToReference(ref, context);\n        };\n        \n        return link;\n    }\n    \n    /**\n     * Navigate to an internal reference (page, element, or bin)\n     * @param {string} ref - Reference string\n     * @param {Object} context - Current context\n     */\n    navigateToReference(ref, context = {}) {\n        if (!this.app) return;\n        \n        const pages = this.app.appState?.documents || this.app.documents || [];\n        \n        // Try to find by page title/ID\n        let targetPage = pages.find(p => \n            p.id === ref || \n            p.title?.toLowerCase() === ref.toLowerCase() ||\n            p.title?.toLowerCase().replace(/\\s+/g, '-') === ref.toLowerCase()\n        );\n        \n        if (targetPage) {\n            // Navigate to page\n            this.app.appState.currentDocumentId = targetPage.id;\n            eventBus.emit(EVENTS.PAGE.SWITCHED, { pageId: targetPage.id });\n            eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n            \n            // Scroll to top\n            setTimeout(() => {\n                const container = document.getElementById('bins-container');\n                if (container) {\n                    container.scrollTop = 0;\n                }\n            }, 100);\n            return;\n        }\n        \n        // Try to find by element ID or text\n        for (const page of pages) {\n            if (!page.groups) continue;\n            \n            for (const bin of page.groups) {\n                const items = bin.items || [];\n                bin.items = items;\n                \n                for (let i = 0; i < items.length; i++) {\n                    const element = items[i];\n                    \n                    // Check element ID (if it exists)\n                    if (element.id === ref) {\n                        this._navigateToElement(page.id, bin.id, i);\n                        return;\n                    }\n                    \n                    // Check element text\n                    if (element.text && element.text.toLowerCase().includes(ref.toLowerCase())) {\n                        this._navigateToElement(page.id, bin.id, i);\n                        return;\n                    }\n                }\n                \n                // Check bin title\n                if (bin.title && bin.title.toLowerCase() === ref.toLowerCase()) {\n                    this.app.appState.currentDocumentId = page.id;\n                    eventBus.emit(EVENTS.PAGE.SWITCHED, { pageId: page.id });\n                    eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n                    \n                    // Scroll to bin\n                    setTimeout(() => {\n                        const binElement = document.querySelector(`[data-bin-id=\"${bin.id}\"]`);\n                        if (binElement) {\n                            binElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                            binElement.style.background = 'rgba(74, 158, 255, 0.2)';\n                            setTimeout(() => {\n                                binElement.style.background = '';\n                            }, 2000);\n                        }\n                    }, 100);\n                    return;\n                }\n            }\n        }\n        \n        // Not found - show message or create new page?\n        console.warn(`[LinkHandler] Reference not found: ${ref}`);\n    }\n    \n    /**\n     * Navigate to a specific element\n     * @param {string} pageId - Page ID\n     * @param {string} binId - Bin ID\n     * @param {number} elementIndex - Element index\n     */\n    _navigateToElement(pageId, binId, elementIndex) {\n        NavigationHelper.navigateToElement(pageId, binId, elementIndex, this.app);\n    }\n}\n\n","// ModalEventBridge.js - Bridges UI events to modal methods\n// Listens to UI events and calls appropriate modal methods\nimport { eventBus } from './EventBus.js';\nimport { EVENTS } from './AppEvents.js';\nimport { getService, SERVICES } from './AppServices.js';\n\n/**\n * ModalEventBridge - Bridges UI modal events to ModalHandler methods\n * \n * This module bridges UI events to modal handler methods, keeping\n * modules decoupled from direct modal calls.\n */\nexport class ModalEventBridge {\n    constructor() {\n        this.setupEventListeners();\n    }\n    \n    /**\n     * Setup event listeners for UI modal events\n     */\n    setupEventListeners() {\n        // Show edit modal\n        eventBus.on(EVENTS.UI.SHOW_EDIT_MODAL, ({ pageId, binId, elementIndex, element }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showEditModal(pageId, binId, elementIndex, element);\n        });\n        \n        // Show add element modal\n        eventBus.on(EVENTS.UI.SHOW_ADD_ELEMENT_MODAL, ({ pageId, binId, elementIndex }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showAddElementModal(pageId, binId, elementIndex);\n        });\n        \n        // Show add child element modal\n        eventBus.on(EVENTS.UI.SHOW_ADD_CHILD_ELEMENT_MODAL, ({ pageId, binId, elementIndex }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showAddChildElementModal(pageId, binId, elementIndex);\n        });\n        \n        // Show add subtasks modal\n        eventBus.on(EVENTS.UI.SHOW_ADD_SUBTASKS_MODAL, ({ pageId, binId, elementIndex, element }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showAddSubtasksModal(pageId, binId, elementIndex, element);\n        });\n        \n        // Show view data modal\n        eventBus.on(EVENTS.UI.SHOW_VIEW_DATA_MODAL, ({ element, isSubtask = false }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showViewDataModal(element, isSubtask);\n        });\n        \n        // Show edit page modal\n        eventBus.on(EVENTS.UI.SHOW_EDIT_PAGE_MODAL, ({ pageId }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showEditPageModal(pageId);\n        });\n        \n        // Show edit bin modal\n        eventBus.on(EVENTS.UI.SHOW_EDIT_BIN_MODAL, ({ pageId, binId }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showEditBinModal(pageId, binId);\n        });\n        \n        // Show visual customization modal\n        eventBus.on(EVENTS.UI.SHOW_VISUAL_CUSTOMIZATION_MODAL, ({ targetType, targetId, context }) => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.showVisualCustomizationModal(targetType, targetId, context);\n        });\n        \n        // Close modal\n        eventBus.on(EVENTS.UI.CLOSE_MODAL, () => {\n            const modalHandler = getService(SERVICES.MODAL_HANDLER);\n            modalHandler.closeModal();\n        });\n        \n        // Focus input\n        eventBus.on(EVENTS.UI.FOCUS_INPUT, ({ inputId, select = false }) => {\n            const input = document.getElementById(inputId);\n            if (input) {\n                input.focus();\n                if (select) {\n                    input.select();\n                }\n            }\n        });\n    }\n}\n\n// Create and export singleton instance\nexport const modalEventBridge = new ModalEventBridge();\n","// Daily Todo Tracker App\nimport { DataManager } from './js/modules/DataManager.js';\nimport { SettingsManager } from './js/modules/SettingsManager.js';\nimport { ThemeManager } from './js/modules/ThemeManager.js';\nimport { VisualSettingsManager } from './js/modules/VisualSettingsManager.js';\nimport { PageManager } from './js/modules/PageManager.js';\nimport { BinManager } from './js/modules/BinManager.js';\nimport { ElementManager } from './js/modules/ElementManager.js';\nimport { DragDropHandler } from './js/modules/DragDropHandler.js';\nimport { AudioHandler } from './js/modules/AudioHandler.js';\nimport { EventHandler } from './js/modules/EventHandler.js';\nimport { ContextMenuHandler } from './js/modules/ContextMenuHandler.js';\nimport { TouchGestureHandler } from './js/modules/TouchGestureHandler.js';\nimport { ModalHandler } from './js/modules/ModalHandler.js';\nimport { FileManager } from './js/modules/FileManager.js';\n// Plugin system imports\nimport { PagePluginManager } from './js/modules/PagePluginManager.js';\nimport { BinPluginManager } from './js/modules/BinPluginManager.js';\nimport { ElementTypeManager } from './js/modules/ElementTypeManager.js';\nimport { FormatRendererManager } from './js/modules/FormatRendererManager.js';\nimport { pluginRegistry } from './js/core/PluginManager.js';\nimport { eventBus } from './js/core/EventBus.js';\nimport { pluginLoader } from './js/core/PluginLoaderService.js';\nimport { RelationshipManager } from './js/modules/RelationshipManager.js';\nimport { TemplateManager } from './js/modules/TemplateManager.js';\nimport { AutomationManager } from './js/core/AutomationManager.js';\nimport { TagManager } from './js/modules/TagManager.js';\nimport { SearchIndex } from './js/modules/SearchIndex.js';\nimport { ExportService } from './js/modules/ExportService.js';\nimport { ImportService } from './js/modules/ImportService.js';\nimport { OAuthManager } from './js/core/OAuthManager.js';\nimport { SyncManager } from './js/modules/SyncManager.js';\nimport { UndoRedoManager } from './js/modules/UndoRedoManager.js';\nimport { TimeTracker } from './js/modules/TimeTracker.js';\nimport { registerAllServices, registerService, SERVICES } from './js/core/AppServices.js';\nimport { RenderService } from './js/core/RenderService.js';\nimport { EVENTS } from './js/core/AppEvents.js';\nimport { AppState } from './js/core/AppState.js';\nimport { AppInitializationManager } from './js/core/AppInitializationManager.js';\nimport { StringUtils } from './js/utils/string.js';\nimport { DailyResetManager } from './js/modules/DailyResetManager.js';\nimport { InlineEditor } from './js/modules/InlineEditor.js';\nimport { LinkHandler } from './js/utils/LinkHandler.js';\nimport { modalEventBridge } from './js/core/ModalEventBridge.js';\nimport { pluginDiscovery } from './js/core/PluginDiscoveryManager.js';\n\nclass TodoApp {\n    constructor() {\n        performance.mark('app-constructor-start');\n        const constructorStart = performance.now();\n        \n        // Initialize app state first (needed by services)\n        this.appState = new AppState();\n        \n        // Initialize managers\n        this.dataManager = new DataManager();\n        this.settingsManager = new SettingsManager();\n        this.themeManager = new ThemeManager();\n        this.visualSettingsManager = new VisualSettingsManager();\n        this.pageManager = new PageManager();\n        this.binManager = new BinManager();\n        \n        // Initialize undoRedoManager early (needed by ElementManager)\n        this.undoRedoManager = new UndoRedoManager();\n        \n        // Register core services first (before creating modules that need them)\n        // Register services that don't depend on modules created later\n        // Use imported eventBus singleton (this.eventBus is assigned later)\n        registerService(SERVICES.EVENT_BUS, eventBus);\n        registerService(SERVICES.APP_STATE, this.appState);\n        registerService(SERVICES.DATA_MANAGER, this.dataManager);\n        registerService(SERVICES.UNDO_REDO_MANAGER, this.undoRedoManager);\n        registerService(SERVICES.SETTINGS_MANAGER, this.settingsManager);\n        registerService(SERVICES.PAGE_MANAGER, this.pageManager);\n        registerService(SERVICES.BIN_MANAGER, this.binManager);\n        \n        // Initialize modules that use ServiceLocator (no app parameter)\n        // These can now access the services registered above\n        this.elementManager = new ElementManager();\n        \n        // Create handlers and managers that need to be registered\n        this.dragDropHandler = new DragDropHandler();\n        this.audioHandler = new AudioHandler();\n        this.eventHandler = new EventHandler(this);\n        this.contextMenuHandler = new ContextMenuHandler();\n        this.touchGestureHandler = new TouchGestureHandler();\n        this.modalHandler = new ModalHandler();\n        this.fileManager = new FileManager();\n        \n        // Register remaining services (including ElementManager and others)\n        // Must be called AFTER all services are created\n        registerAllServices(this);\n        \n        // Initialize relationship manager\n        this.relationshipManager = new RelationshipManager();\n        \n        // Initialize template manager\n        this.templateManager = new TemplateManager();\n        \n        // Initialize automation manager\n        this.automationEngine = new AutomationManager();\n        \n        // Initialize tag manager\n        this.tagManager = new TagManager();\n        \n        // Initialize search index\n        this.searchIndex = new SearchIndex();\n        \n        // Initialize export/import services\n        this.exportService = new ExportService();\n        this.importService = new ImportService();\n        \n        // Initialize OAuth and sync managers\n        this.oauthManager = new OAuthManager();\n        this.syncManager = new SyncManager();\n        \n        // Start loading file early (in parallel with other initialization)\n        // This prevents the file request from being queued behind other operations\n        this._fileLoadPromise = null;\n        const lastOpenedFile = localStorage.getItem('twodo-last-opened-file');\n        if (lastOpenedFile) {\n            performance.mark('preload-start');\n            const preloadInitStart = performance.now();\n            const requestsBeforePreload = performance.getEntriesByType('resource').length;\n            // console.log('[DIAG] Starting preload:', lastOpenedFile);\n            // console.log(`[DIAG] Preload init: ${requestsBeforePreload} resource requests already loaded`);\n            // Start the fetch immediately, but don't await it yet\n            this._fileLoadPromise = this._preloadFile(lastOpenedFile);\n            const preloadInitTime = performance.now() - preloadInitStart;\n            // console.log(`[DIAG] Preload promise created in: ${preloadInitTime.toFixed(1)}ms`);\n        }\n        \n        // Initialize time tracker\n        this.timeTracker = new TimeTracker();\n        \n        // Initialize daily reset manager\n        this.dailyResetManager = new DailyResetManager();\n        \n        // Initialize inline editor\n        this.inlineEditor = new InlineEditor();\n        \n        // Initialize link handler\n        this.linkHandler = new LinkHandler();\n        \n        // Initialize plugin system managers\n        this.pagePluginManager = new PagePluginManager();\n        this.binPluginManager = new BinPluginManager();\n        this.elementTypeManager = new ElementTypeManager();\n        this.formatRendererManager = new FormatRendererManager();\n        \n        // Expose plugin system to window for debugging\n        this.pluginRegistry = pluginRegistry;\n        this.eventBus = eventBus;\n        this.pluginLoader = pluginLoader;\n        \n        // Initialize render service (registers itself in ServiceLocator)\n        this.renderService = new RenderService(this);\n        \n        // Initialize modal event bridge (bridges UI events to modal methods)\n        // This is initialized after services are registered\n        this.modalEventBridge = modalEventBridge;\n        \n        // Initialize app initialization manager\n        this.appInitializer = new AppInitializationManager(this);\n        \n        // Listen for render requests from EventBus (handled by RenderService now)\n        \n        performance.mark('app-constructor-end');\n        const constructorTime = performance.now() - constructorStart;\n        // console.log(`[DIAG] Constructor took: ${constructorTime.toFixed(1)}ms`);\n        // console.log(`[DIAG] Preload started: ${this._fileLoadPromise ? 'YES' : 'NO'}`);\n        \n        this.init();\n    }\n    \n    /**\n     * Preload file data early (non-blocking)\n     * This starts the fetch immediately so it can happen in parallel with other initialization\n     */\n    async _preloadFile(filename) {\n        performance.mark('preload-fetch-start');\n        const preloadStart = performance.now();\n        // console.log(`[DIAG] _preloadFile() called for: ${filename}`);\n        \n        try {\n            const encodedFilename = encodeURIComponent(filename);\n            const controller = new AbortController();\n            const timeoutId = setTimeout(() => controller.abort(), 5000);\n            \n            try {\n                const fetchStart = performance.now();\n                const fetchUrl = `/files/${encodedFilename}`;\n                \n                // Check how many requests are in flight before our fetch\n                const requestsBefore = performance.getEntriesByType('resource').length;\n                // console.log(`[DIAG] Preload: ${requestsBefore} resource requests before fetch`);\n                \n                const response = await fetch(fetchUrl, {\n                    signal: controller.signal,\n                    cache: 'no-cache'\n                });\n                const fetchEnd = performance.now();\n                const fetchTime = fetchEnd - fetchStart;\n                clearTimeout(timeoutId);\n                \n                // Extract network timing - wait a bit for timing to be available\n                setTimeout(() => {\n                    const resourceTimings = performance.getEntriesByType('resource');\n                    const resourceTiming = resourceTimings.find(entry => entry.name.includes(encodedFilename));\n                    if (resourceTiming) {\n                        // console.log('[DIAG] Preload network timing:', {\n                        //     stalled: (resourceTiming.requestStart - resourceTiming.fetchStart).toFixed(1) + 'ms',\n                        //     dns: (resourceTiming.domainLookupEnd - resourceTiming.domainLookupStart).toFixed(1) + 'ms',\n                        //     tcp: (resourceTiming.connectEnd - resourceTiming.connectStart).toFixed(1) + 'ms',\n                        //     ttfb: (resourceTiming.responseStart - resourceTiming.requestStart).toFixed(1) + 'ms',\n                        //     download: (resourceTiming.responseEnd - resourceTiming.responseStart).toFixed(1) + 'ms',\n                        //     total: resourceTiming.duration.toFixed(1) + 'ms'\n                        // });\n                    } else {\n                        // console.log('[DIAG] Preload: Could not find resource timing entry');\n                    }\n                }, 100);\n                \n                if (!response.ok) {\n                    if (response.status === 404) {\n                        // console.log('[DIAG] Preload: File not found (404)');\n                        return null; // File doesn't exist\n                    }\n                    throw new Error(`HTTP error! status: ${response.status}`);\n                }\n                \n                const parseStart = performance.now();\n                const result = await response.json();\n                const parseTime = performance.now() - parseStart;\n                \n                if (result.success) {\n                    performance.mark('preload-fetch-end');\n                    const preloadTime = performance.now() - preloadStart;\n                    // console.log(`[DIAG] Preload fetch: ${fetchTime.toFixed(1)}ms, parse: ${parseTime.toFixed(1)}ms, total: ${preloadTime.toFixed(1)}ms`);\n                    return result.data; // Return the data for later use\n                } else {\n                    throw new Error(result.error || 'Failed to load file');\n                }\n            } catch (fetchError) {\n                clearTimeout(timeoutId);\n                if (fetchError.name === 'AbortError') {\n                    // console.log('[DIAG] Preload: Timeout');\n                    throw new Error('File load timeout');\n                }\n                throw fetchError;\n            }\n        } catch (error) {\n            // console.log(`[DIAG] Preload failed: ${error.message}`);\n            // Silently fail - will be handled in loadLastOpenedFile\n            return null;\n        }\n    }\n    \n    /**\n     * Load the last opened file from server (device-specific)\n     */\n    async loadLastOpenedFile() {\n        performance.mark('load-file-start');\n        const loadStart = performance.now();\n        // console.log('[DIAG] loadLastOpenedFile() called');\n        \n        try {\n            const lastOpenedFile = localStorage.getItem('twodo-last-opened-file');\n            if (!lastOpenedFile) {\n                // console.log('[DIAG] No last opened file in localStorage');\n                return; // No last opened file, use default data\n            }\n            \n            // Use preloaded data if available (started in constructor)\n            let fileData;\n            if (this._fileLoadPromise) {\n                // console.log('[DIAG] Preload promise exists, awaiting...');\n                const preloadAwaitStart = performance.now();\n                const preloadedData = await this._fileLoadPromise;\n                const preloadAwaitTime = performance.now() - preloadAwaitStart;\n                // console.log(`[DIAG] Preload await took: ${preloadAwaitTime.toFixed(1)}ms`);\n                \n                if (preloadedData) {\n                    // Use preloaded data - fetch already completed!\n                    // console.log('[DIAG] Using preloaded data');\n                    fileData = preloadedData;\n                    this.fileManager.currentFilename = lastOpenedFile;\n                } else {\n                    // Preload failed or file doesn't exist, try normal load\n                    // console.log('[DIAG] Preload returned null, doing normal load');\n                    const loadPromise = this.fileManager.loadFile(lastOpenedFile, false);\n                    const timeoutPromise = new Promise((_, reject) => \n                        setTimeout(() => reject(new Error('File load timeout')), 5000)\n                    );\n                    fileData = await Promise.race([loadPromise, timeoutPromise]);\n                }\n            } else {\n                // No preload started, do normal load\n                // console.log('[DIAG] No preload promise, doing normal load');\n                const loadPromise = this.fileManager.loadFile(lastOpenedFile, false);\n                const timeoutPromise = new Promise((_, reject) => \n                    setTimeout(() => reject(new Error('File load timeout')), 5000)\n                );\n                fileData = await Promise.race([loadPromise, timeoutPromise]);\n            }\n            \n            const documents = fileData.documents || [];\n            if (!documents || !Array.isArray(documents)) {\n                console.warn('Last opened file has invalid format, using default data');\n                localStorage.removeItem('twodo-last-opened-file');\n                return;\n            }\n            \n            // Update app with loaded file data\n            this.appState.documents = documents;\n            // Set timestamp to prevent stale sync data from overwriting freshly loaded data\n            if (this.dataManager) {\n                this.dataManager._lastSyncTimestamp = Date.now();\n            }\n            console.log(`Loaded last opened file: ${lastOpenedFile}`);\n            // Don't render here - let init() handle rendering after load completes\n            \n            performance.mark('load-file-end');\n            const loadTime = performance.now() - loadStart;\n            // console.log(`[DIAG] Total loadLastOpenedFile: ${loadTime.toFixed(1)}ms`);\n            \n            // Load buffer in background (non-blocking)\n            if (this.undoRedoManager) {\n                this.undoRedoManager.loadBuffer(lastOpenedFile).catch(err => {\n                    console.warn('Failed to load buffer in background:', err);\n                });\n            }\n        } catch (error) {\n            // If file not found (404) or timeout, clear the stored preference\n            if (error.status === 404 || error.message.includes('not found') || error.message.includes('timeout')) {\n                localStorage.removeItem('twodo-last-opened-file');\n                console.log('Last opened file not found or timeout, cleared preference');\n            } else {\n                // For other errors, log but don't block initialization\n                console.warn('Failed to load last opened file:', error);\n            }\n        }\n    }\n    \n    async init() {\n        // Load and apply settings on initialization\n        const settings = this.settingsManager.loadSettings();\n        this.settingsManager.applySettings(settings);\n        \n        // Check for file parameter in URL (before loading other data)\n        const urlParams = new URLSearchParams(window.location.search);\n        const fileParam = urlParams.get('file');\n        if (fileParam) {\n            try {\n                // Load the file specified in URL\n                const fileData = await this.fileManager.loadFile(fileParam);\n                const documents = fileData.documents || [];\n                if (documents && Array.isArray(documents)) {\n                    this.appState.documents = documents;\n                    // Store as last opened file\n                    localStorage.setItem('twodo-last-opened-file', fileParam);\n                    console.log(`Loaded file from URL: ${fileParam}`);\n                }\n            } catch (error) {\n                console.warn('Failed to load file from URL:', error);\n                // Fall through to load last opened file or default\n            }\n        } else {\n            // Check daily reset before loading data (only if no URL file param)\n            this.dataManager.checkDailyReset();\n            \n            // Load data (only once, only if no URL file param)\n            this.dataManager.loadData();\n        }\n        \n        // Initialize format renderer manager from loaded data\n        if (this.formatRendererManager) {\n            this.formatRendererManager.initializeFromSavedData();\n        }\n        \n        // Initialize relationships from loaded data (fast, synchronous)\n        this.relationshipManager.initializeFromData();\n        \n        // Set up event listeners\n        this.eventHandler.setupEventListeners();\n        this.setupTrashIcon();\n        \n        // Load last opened file BEFORE rendering to ensure we have the correct data\n        // This prevents rendering with empty/default data and then re-rendering\n        await this.loadLastOpenedFile();\n        \n        // Now render with the loaded data\n        eventBus.emit(EVENTS.APP.RENDER_REQUESTED);\n        \n        // Now do async operations in the background (non-blocking)\n        // Connect to sync if needed\n        (async () => {\n            // After loading file, connect to sync if needed\n            if (this.fileManager && this.fileManager.currentFilename && this.syncManager) {\n                // Store filename to join once connected\n                this.syncManager.pendingFileJoin = this.fileManager.currentFilename;\n                \n                // Connect to WebSocket (non-blocking, will retry automatically)\n                // Don't await - let it connect in the background\n                this.syncManager.connect().catch(error => {\n                    console.warn('WebSocket connection failed, will retry:', error);\n                    // Connection will retry automatically, and joinFile will be called on connect\n                });\n            }\n        })();\n        \n        // Initialize plugin system in background (loads in parallel for faster startup)\n        // This happens after initial render so the UI appears quickly\n        this.initializePlugins().catch(err => console.error('Plugin initialization error:', err));\n        \n        // Initialize global search in background\n        this.initializeGlobalSearch().catch(err => console.error('Global search initialization error:', err));\n        \n        // Rebuild search index in background (non-blocking)\n        if (this.searchIndex) {\n            // Use requestIdleCallback if available, otherwise setTimeout\n            if (window.requestIdleCallback) {\n                requestIdleCallback(() => this.searchIndex.rebuildIndex());\n            } else {\n                setTimeout(() => this.searchIndex.rebuildIndex(), 0);\n            }\n        }\n    }\n    \n    /**\n     * Load all available plugins\n     * Uses PluginDiscovery to load plugins from manifest\n     */\n    async loadAllPlugins() {\n        // Get plugin definitions from PluginDiscovery\n        const plugins = await pluginDiscovery.getAllPlugins();\n        \n        // Load all plugins\n        const loadPromises = [];\n        \n        // Load element types\n        for (const pluginDef of plugins.elementTypes) {\n            loadPromises.push(\n                this.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this)\n                    .catch(err => {\n                        // Silently ignore connection/fetch errors (file doesn't exist or server issue)\n                        // These are expected for optional plugins that may not be implemented yet\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        // Log other unexpected errors\n                        console.warn(`Failed to load element type ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load page plugins\n        for (const pluginDef of plugins.pagePlugins) {\n            loadPromises.push(\n                this.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load page plugin ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load bin plugins\n        for (const pluginDef of plugins.binPlugins) {\n            loadPromises.push(\n                this.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load bin plugin ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Load format renderers\n        for (const pluginDef of plugins.formatRenderers) {\n            loadPromises.push(\n                this.pluginLoader.loadPlugin(pluginDef.path, pluginDef.name, this)\n                    .catch(err => {\n                        const isFetchError = err instanceof TypeError && \n                            (err.message.includes('Failed to fetch') || \n                             err.message.includes('ERR_CONNECTION_REFUSED') ||\n                             err.message.includes('dynamically imported module'));\n                        if (isFetchError) {\n                            return null;\n                        }\n                        console.warn(`Failed to load format renderer ${pluginDef.name}:`, err);\n                        return null;\n                    })\n            );\n        }\n        \n        // Wait for all plugins to load\n        await Promise.allSettled(loadPromises);\n        console.log('All plugins loaded');\n        \n        // Rescan for formats after all plugins are loaded\n        if (this.formatRendererManager) {\n            console.log('[app.js] Rescanning for formats after plugin load...');\n            this.formatRendererManager.scanForFormats();\n        }\n    }\n    \n    /**\n     * Initialize plugin system\n     */\n    async initializePlugins() {\n        // Load all available plugins first (already parallel)\n        await this.loadAllPlugins();\n        \n        // Initialize plugins for existing pages and bins in parallel\n        const initPromises = [];\n        for (const page of this.appState.documents) {\n            initPromises.push(\n                this.pagePluginManager.initializePagePlugins(page.id)\n                    .catch(err => console.warn(`Failed to initialize page plugins for ${page.id}:`, err))\n            );\n            const groups = page.groups || page.bins || [];\n            for (const bin of groups) {\n                    initPromises.push(\n                        this.binPluginManager.initializeBinPlugins(page.id, bin.id)\n                            .catch(err => console.warn(`Failed to initialize bin plugins for ${page.id}/${bin.id}:`, err))\n                    );\n            }\n        }\n        // Wait for all plugin initializations in parallel\n        await Promise.allSettled(initPromises);\n    }\n    \n    /**\n     * Initialize global search feature\n     */\n    async initializeGlobalSearch() {\n        try {\n            const SearchFilter = (await import('./js/plugins/page/SearchFilter.js')).default;\n            this.globalSearchFilter = new SearchFilter(this);\n            await this.globalSearchFilter.onInit();\n        } catch (error) {\n            console.error('Failed to initialize global search:', error);\n        }\n        \n        // Setup search index update listeners\n        this.eventBus.on('element:created', () => {\n            if (this.searchIndex) {\n                this.searchIndex.rebuildIndex();\n            }\n        });\n        this.eventBus.on('element:updated', ({ pageId, binId, elementIndex }) => {\n            if (this.searchIndex) {\n                this.searchIndex.updateElement(pageId, binId, elementIndex);\n            }\n        });\n        this.eventBus.on('element:deleted', ({ pageId, binId, elementIndex }) => {\n            if (this.searchIndex) {\n                this.searchIndex.removeElement(pageId, binId, elementIndex);\n            }\n        });\n    }\n    \n    setupTrashIcon() {\n        return this.dragDropHandler.setupTrashIcon();\n    }\n    \n    // setupEventListeners is now in EventHandler.js\n\n    // Helper method to create and style buttons - delegated to AppRenderer\n    styleButton(text, onClick) {\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().styleButton(text, onClick);\n        }\n        // Fallback if renderer not available\n        const btn = document.createElement('button');\n        btn.textContent = text;\n        btn.onclick = (e) => {\n            e.stopPropagation();\n            onClick(e);\n        };\n        return btn;\n    }\n    \n    resetToday() {\n        return this.dailyResetManager.resetToday();\n    }\n    \n    // Page and element management methods are now in PageManager, ElementManager, and DragDropHandler\n    // Delegating to managers for backward compatibility\n    addPage() {\n        return this.pageManager.addPage();\n    }\n    \n    deletePage(pageId) {\n        return this.pageManager.deletePage(pageId);\n    }\n    \n    movePage(sourcePageId, targetPageId) {\n        return this.pageManager.movePage(sourcePageId, targetPageId);\n    }\n    \n    addBin(pageId) {\n        return this.binManager.addBin(pageId);\n    }\n    \n    deleteBin(pageId, binId) {\n        return this.binManager.deleteBin(pageId, binId);\n    }\n    \n    moveBin(sourcePageId, sourceBinId, targetPageId, targetBinId) {\n        return this.binManager.moveBin(sourcePageId, sourceBinId, targetPageId, targetBinId);\n    }\n    \n    moveElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild = false, parentElementIndex = null, childIndex = null) {\n        return this.dragDropHandler.moveElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild, parentElementIndex, childIndex);\n    }\n    \n    reorderChildElement(pageId, binId, parentElementIndex, sourceChildIndex, targetChildIndex) {\n        return this.dragDropHandler.reorderChildElement(pageId, binId, parentElementIndex, sourceChildIndex, targetChildIndex);\n    }\n\n    nestElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild = false, parentElementIndex = null, childIndex = null, elementToNest = null) {\n        return this.dragDropHandler.nestElement(sourcePageId, sourceBinId, sourceElementIndex, targetPageId, targetBinId, targetElementIndex, isChild, parentElementIndex, childIndex, elementToNest);\n    }\n    \n    addElement(pageId, binId, elementType) {\n        return this.elementManager.addElement(pageId, binId, elementType);\n    }\n    \n    createElementTemplate(type) {\n        return this.elementManager.createElementTemplate(type);\n    }\n    \n    enableInlineEditing(textElement, pageId, binId, elementIndex, element) {\n        return this.inlineEditor.enableInlineEditing(textElement, pageId, binId, elementIndex, element);\n    }\n    \n    toggleElement(pageId, binId, elementIndex, subtaskIndex = null, itemIndex = null) {\n        return this.elementManager.toggleElement(pageId, binId, elementIndex, subtaskIndex, itemIndex);\n    }\n    \n    addMultiCheckboxItem(pageId, binId, elementIndex) {\n        return this.elementManager.addMultiCheckboxItem(pageId, binId, elementIndex);\n    }\n    \n    removeMultiCheckboxItem(pageId, binId, elementIndex, itemIndex) {\n        return this.elementManager.removeMultiCheckboxItem(pageId, binId, elementIndex, itemIndex);\n    }\n    \n    toggleAllSubtasks() {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            this.renderService.getRenderer().toggleAllSubtasks();\n        }\n    }\n    \n    render() {\n        // Delegate to AppRenderer via RenderService\n        if (this.renderService && this.renderService.getRenderer) {\n            this.renderService.getRenderer().render();\n        }\n    }\n    \n    renderPageTabs() {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            this.renderService.getRenderer().renderPageTabs();\n        }\n    }\n    \n    getCurrentPositions() {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().getCurrentPositions();\n        }\n        return { bins: {}, elements: {} };\n    }\n\n    _getDocument(pageId) {\n        return this.appState.documents?.find(page => page.id === pageId) || null;\n    }\n\n    _getGroup(pageId, binId) {\n        const document = this._getDocument(pageId);\n        const group = document?.groups?.find(bin => bin.id === binId) || null;\n        if (!group) return null;\n        const items = group.items || group.elements || [];\n        group.items = items;\n        group.elements = items;\n        return group;\n    }\n    \n    // Animation method moved to AnimationRenderer.js\n    animateMovements(oldPositions) {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().animateMovements(oldPositions);\n        }\n    }\n    \n    renderBin(pageId, bin) {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().renderBin(pageId, bin);\n        }\n        // Fallback - should not happen\n        console.error('RenderService not available');\n        return document.createElement('div');\n    }\n    \n    // renderBin implementation moved to BinRenderer.js\n    \n    // renderBin implementation moved to BinRenderer.js\n    // renderChildren and renderElement implementations moved to ElementRenderer.js\n    \n    renderElement(pageId, binId, element, elementIndex, childIndex = null, depth = 0) {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().renderElement(pageId, binId, element, elementIndex, childIndex, depth);\n        }\n        return null;\n    }\n    \n    renderChildren(pageId, binId, parentElement, parentElementIndex, depth = 0) {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().renderChildren(pageId, binId, parentElement, parentElementIndex, depth);\n        }\n        return null;\n    }\n    \n    // Calendar rendering methods moved to CalendarRenderer.js\n    renderCalendar(container, pageId, binId, element, elementIndex) {\n        // Delegate to AppRenderer\n        if (this.renderService && this.renderService.getRenderer) {\n            return this.renderService.getRenderer().renderCalendar(container, pageId, binId, element, elementIndex);\n        }\n    }\n    \n    \n    showAddElementModal(pageId, elementIndex = null) {\n        return this.modalHandler.showAddElementModal(pageId, elementIndex);\n    }\n    \n    \n    // Utility methods moved to StringUtils\n    escapeHtml(text) {\n        return StringUtils.escapeHtml(text);\n    }\n    \n    parseLinks(text, context = {}) {\n        // Use LinkHandler for unified link parsing (supports internal and external links)\n        if (this.linkHandler) {\n            return this.linkHandler.parseLinks(text, context);\n        }\n        // Fallback to StringUtils for backward compatibility\n        return StringUtils.parseLinks(text);\n    }\n    \n    showContextMenu(e, pageId, binId, elementIndex, subtaskIndex = null) {\n        // If binId not provided, try to find it\n        if (!binId) {\n            binId = this.appState.activeGroupId;\n            if (!binId) {\n                const page = this._getDocument(pageId);\n                const groups = page?.groups || page?.bins || [];\n                if (groups.length > 0) {\n                    binId = groups[0].id;\n                }\n            }\n        }\n        return this.contextMenuHandler.showContextMenu(e, pageId, binId, elementIndex, subtaskIndex);\n    }\n    \n    hideContextMenu() {\n        return this.contextMenuHandler.hideContextMenu();\n    }\n    \n    setupTouchGestures() {\n        return this.touchGestureHandler.setupTouchGestures();\n    }\n    \n    triggerContextMenuFromTouch(e, target) {\n        return this.touchGestureHandler.triggerContextMenuFromTouch(e, target);\n    }\n    \n    showPageContextMenu(e, pageId = null) {\n        return this.contextMenuHandler.showPageContextMenu(e, pageId);\n    }\n    \n    /**\n     * Helper to validate elementIndex\n     * @param {*} elementIndex - Element index to validate\n     * @returns {boolean} True if elementIndex is a valid number\n     */\n    _isValidElementIndex(elementIndex) {\n        return elementIndex !== null && \n               elementIndex !== undefined && \n               !isNaN(elementIndex) && \n               (typeof elementIndex === 'number' || (typeof elementIndex === 'string' && !isNaN(parseInt(elementIndex, 10))));\n    }\n    \n    handleContextEdit() {\n        const { documentId: pageId, groupId: binId, elementIndex } = this.appState.contextMenuState;\n        console.log('[handleContextEdit] Called with:', { pageId, binId, elementIndex, contextMenuState: this.appState.contextMenuState });\n        \n        if (pageId === null) {\n            console.warn('[handleContextEdit] pageId is null');\n            return;\n        }\n        \n        const page = this._getDocument(pageId);\n        if (!page) {\n            console.warn('[handleContextEdit] Page not found:', pageId);\n            return;\n        }\n        \n        this.hideContextMenu();\n        \n        // Determine what we're editing:\n        // - If elementIndex is a valid number  element edit\n        // - If elementIndex is null and binId is explicitly set (not undefined)  bin edit\n        // - If elementIndex is null and binId is undefined  page edit\n        \n        // Check if elementIndex is a valid number (not null, not undefined, not NaN)\n        const isValidElementIndex = this._isValidElementIndex(elementIndex);\n        console.log('[handleContextEdit] isValidElementIndex:', isValidElementIndex);\n        \n        if (isValidElementIndex) {\n            // Edit element - find binId from contextMenuState or use active bin\n            let targetBinId = binId || this.appState.activeGroupId;\n            if (!targetBinId) {\n                // Try to find bin containing this element\n                const groups = page.groups || page.bins || [];\n                for (const bin of groups) {\n                    const items = bin.items || bin.elements || [];\n                    bin.items = items;\n                    bin.elements = items;\n                    if (items[elementIndex]) {\n                        targetBinId = bin.id;\n                        break;\n                    }\n                }\n                if (!targetBinId && groups.length > 0) {\n                    targetBinId = groups[0].id;\n                }\n            }\n            const bin = this._getGroup(pageId, targetBinId);\n            if (!bin) {\n                console.warn('[handleContextEdit] Bin not found:', { pageId, targetBinId, elementIndex });\n                return;\n            }\n            const element = bin.items[elementIndex];\n            if (!element) {\n                console.warn('[handleContextEdit] Element not found:', { pageId, targetBinId, elementIndex, elementsLength: bin.items?.length });\n                return;\n            }\n            this.showEditModal(pageId, targetBinId, elementIndex, element);\n        } else if (binId !== null && binId !== undefined) {\n            // Edit bin - show bin edit modal\n            this.modalHandler.showEditBinModal(pageId, binId);\n        } else {\n            // Edit page - show page edit modal\n            this.modalHandler.showEditPageModal(pageId);\n        }\n    }\n    \n    handleContextCustomizeVisuals() {\n        const { documentId: pageId, groupId: binId, elementIndex } = this.appState.contextMenuState;\n        this.hideContextMenu();\n        \n        // Determine what we're customizing:\n        // - If elementIndex is a valid number  element visual customization\n        // - If elementIndex is null and binId is explicitly set (not undefined)  bin visual customization\n        // - If elementIndex is null and binId is undefined  page visual customization\n        // - Check for pane customization (from pane context menu)\n        \n        if (this._isValidElementIndex(elementIndex) && pageId) {\n            // Customize element visuals\n            const page = this._getDocument(pageId);\n            if (!page) return;\n            \n            let targetBinId = binId || this.appState.activeGroupId;\n            if (!targetBinId) {\n                const groups = page.groups || page.bins || [];\n                for (const bin of groups) {\n                    const items = bin.items || bin.elements || [];\n                    bin.items = items;\n                    bin.elements = items;\n                    if (items[elementIndex]) {\n                        targetBinId = bin.id;\n                        break;\n                    }\n                }\n            }\n            \n            if (targetBinId) {\n                // Create unique element ID (pageId-binId-elementIndex)\n                const elementId = `${pageId}-${targetBinId}-${elementIndex}`;\n                const pageFormat = page.format || 'default';\n                this.modalHandler.showVisualCustomizationModal('element', elementId, {\n                    pageId: pageId,\n                    viewFormat: pageFormat\n                });\n            }\n        } else if (binId !== null && binId !== undefined && pageId) {\n            // Customize bin visuals\n            const pageFormat = this._getDocument(pageId)?.format || 'default';\n            this.modalHandler.showVisualCustomizationModal('bin', binId, {\n                pageId: pageId,\n                viewFormat: pageFormat\n            });\n        } else if (pageId) {\n            // Customize page visuals\n            const page = this._getDocument(pageId);\n            const pageFormat = page?.format || 'default';\n            this.modalHandler.showVisualCustomizationModal('page', pageId, {\n                viewFormat: pageFormat\n            });\n        } else {\n            // Could be pane customization - check if we have pane context\n            // For now, if no pageId, we can't customize\n            console.warn('Cannot customize visuals: no pageId provided');\n        }\n    }\n    \n    async saveBinEdit(pageId, binId) {\n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const bin = this._getGroup(pageId, binId);\n        if (!bin) return;\n        \n        const titleInput = document.getElementById('edit-bin-title');\n        if (titleInput) {\n            bin.title = titleInput.value.trim() || bin.id;\n        }\n        \n        const maxHeightInput = document.getElementById('edit-bin-max-height');\n        if (maxHeightInput) {\n            const maxHeightValue = maxHeightInput.value.trim();\n            if (maxHeightValue === '') {\n                delete bin.maxHeight;\n            } else {\n                const height = parseInt(maxHeightValue, 10);\n                if (!isNaN(height) && height > 0) {\n                    bin.maxHeight = height;\n                } else {\n                    delete bin.maxHeight;\n                }\n            }\n        }\n        \n        this.dataManager.saveData();\n        this.render();\n        this.closeModal();\n    }\n    \n    async savePageEdit(pageId) {\n        const page = this._getDocument(pageId);\n        if (!page) return;\n        \n        const titleInput = document.getElementById('edit-page-title');\n        \n        // Save grid layout configuration if grid layout is selected\n        const formatSelect = document.getElementById('page-format-select');\n        const selectedFormat = formatSelect ? formatSelect.value : this.formatRendererManager?.getPageFormat(pageId);\n        if (selectedFormat === 'grid-layout-format') {\n            const minColumnWidthInput = document.getElementById('grid-min-column-width');\n            const gapInput = document.getElementById('grid-gap');\n            const paddingInput = document.getElementById('grid-padding');\n            const maxHeightInput = document.getElementById('grid-max-height');\n            \n            if (!page.formatConfig) {\n                page.formatConfig = {};\n            }\n            \n            page.formatConfig.grid = {\n                minColumnWidth: minColumnWidthInput ? parseInt(minColumnWidthInput.value, 10) || 350 : 350,\n                gap: gapInput ? parseInt(gapInput.value, 10) || 20 : 20,\n                padding: paddingInput ? parseInt(paddingInput.value, 10) || 20 : 20,\n                maxHeight: maxHeightInput && maxHeightInput.value.trim() ? parseInt(maxHeightInput.value, 10) : null\n            };\n        } else if (page.formatConfig?.grid) {\n            // Remove grid config if not using grid layout\n            delete page.formatConfig.grid;\n            if (Object.keys(page.formatConfig).length === 0) {\n                delete page.formatConfig;\n            }\n        }\n        if (titleInput) {\n            page.title = titleInput.value.trim() || page.id;\n            this.dataManager.saveData();\n            this.render();\n        }\n        \n        this.closeModal();\n    }\n    \n    handleContextAddBin() {\n        const { documentId: pageId, groupId: binId } = this.appState.contextMenuState;\n        if (pageId === null) return;\n        \n        this.hideContextMenu();\n        // Add bin below the selected bin (afterBinId will be binId if provided, null otherwise)\n        this.binManager.addBin(pageId, binId || null);\n    }\n    \n    handleContextDeleteBin() {\n        const { documentId: pageId, groupId: binId } = this.appState.contextMenuState;\n        if (pageId === null || binId === null) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const bin = this._getGroup(pageId, binId);\n        if (!bin) return;\n        \n        if (!confirm(`Delete bin \"${bin.title || binId}\"?`)) return;\n        \n        this.hideContextMenu();\n        this.deleteBin(pageId, binId);\n        this.render();\n    }\n    \n    handleContextAddSubtasks() {\n        const { documentId: pageId, groupId: binId, elementIndex } = this.appState.contextMenuState;\n        if (pageId === null || !this._isValidElementIndex(elementIndex)) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const groups = page.groups || page.bins || [];\n        const targetBinId = binId || this.appState.activeGroupId || (groups[0]?.id);\n        const bin = this._getGroup(pageId, targetBinId);\n        if (!bin) return;\n        const items = bin.items || bin.elements || [];\n        bin.items = items;\n        bin.elements = items;\n        \n        const element = items[elementIndex];\n        if (!element) return;\n        \n        // Only tasks and header-checkbox can have subtasks\n        if (element.type !== 'task' && element.type !== 'header-checkbox') {\n            alert('This element type cannot have subtasks');\n            this.hideContextMenu();\n            return;\n        }\n        \n        this.hideContextMenu();\n        this.showAddSubtasksModal(pageId, elementIndex, element);\n    }\n    \n    handleContextViewData() {\n        const { documentId: pageId, groupId: binId, elementIndex, subtaskIndex } = this.appState.contextMenuState;\n        if (pageId === null || !this._isValidElementIndex(elementIndex)) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const targetBinId = binId || this.appState.activeGroupId;\n        const bin = this._getGroup(pageId, targetBinId);\n        if (!bin) return;\n        const items = bin.items || bin.elements || [];\n        bin.items = items;\n        bin.elements = items;\n        \n        const element = items[elementIndex];\n        if (!element) return;\n        \n        // If it's a subtask, show subtask data\n        if (subtaskIndex !== null && element.subtasks && element.subtasks[subtaskIndex]) {\n            const subtask = element.subtasks[subtaskIndex];\n            this.hideContextMenu();\n            this.showViewDataModal(subtask, true);\n            return;\n        }\n        \n        this.hideContextMenu();\n        this.showViewDataModal(element);\n    }\n    \n    handleContextDeleteElement() {\n        const { documentId: pageId, groupId: binId, elementIndex, subtaskIndex } = this.appState.contextMenuState;\n        if (pageId === null || !this._isValidElementIndex(elementIndex)) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const targetBinId = binId || this.appState.activeGroupId;\n        if (!targetBinId) return;\n        const bin = this._getGroup(pageId, targetBinId);\n        if (!bin) return;\n        const items = bin.items || bin.elements || [];\n        bin.items = items;\n        bin.elements = items;\n        \n        this.hideContextMenu();\n        \n        // Handle nested children - elementIndex might be a string like \"0-1\"\n        let actualElementIndex = elementIndex;\n        let childIndex = null;\n        let isChild = false;\n        \n        if (typeof elementIndex === 'string' && elementIndex.includes('-')) {\n            const parts = elementIndex.split('-');\n            actualElementIndex = parseInt(parts[0]);\n            childIndex = parseInt(parts[1]);\n            isChild = true;\n        } else {\n            actualElementIndex = parseInt(elementIndex);\n        }\n        \n        // If it's a child or subtask, delete from parent's children/subtasks\n        if (isChild && childIndex !== null) {\n            const parentElement = items[actualElementIndex];\n            if (parentElement && parentElement.children && parentElement.children[childIndex]) {\n                parentElement.children.splice(childIndex, 1);\n                // If no children remain, set children to empty array\n                if (parentElement.children.length === 0) {\n                    parentElement.children = [];\n                }\n                // Update parent completion status\n                parentElement.completed = parentElement.children.length > 0 && parentElement.children.every(ch => ch.completed);\n                this.dataManager.saveData();\n                this.render();\n            }\n        } else if (subtaskIndex !== null) {\n            // Legacy subtask support\n            const element = items[actualElementIndex];\n            if (element && element.subtasks && element.subtasks[subtaskIndex]) {\n                element.subtasks.splice(subtaskIndex, 1);\n                if (element.subtasks.length === 0) {\n                    element.subtasks = [];\n                }\n                element.completed = element.subtasks.length > 0 && element.subtasks.every(st => st.completed);\n                this.dataManager.saveData();\n                this.render();\n            } else if (element && element.children && element.children[subtaskIndex]) {\n                // Use children if subtasks don't exist\n                element.children.splice(subtaskIndex, 1);\n                if (element.children.length === 0) {\n                    element.children = [];\n                }\n                element.completed = element.children.length > 0 && element.children.every(ch => ch.completed);\n                this.dataManager.saveData();\n                this.render();\n            }\n        } else {\n            // Delete main element\n            if (items[actualElementIndex]) {\n                items.splice(actualElementIndex, 1);\n                this.dataManager.saveData();\n                this.render();\n            }\n        }\n    }\n    \n    handleContextAddElement() {\n        const { documentId: pageId, groupId: binId, elementIndex } = this.appState.contextMenuState;\n        if (pageId === null || !this._isValidElementIndex(elementIndex)) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const groups = page.groups || page.bins || [];\n        const targetBinId = binId || this.appState.activeGroupId || (groups[0]?.id);\n        if (!targetBinId) return;\n        \n        this.hideContextMenu();\n        // Use the same modal as bin-level add element\n        this.modalHandler.showAddElementModal(pageId, targetBinId, elementIndex);\n    }\n    \n    handleContextAddChildElement() {\n        const { documentId: pageId, groupId: binId, elementIndex } = this.appState.contextMenuState;\n        if (pageId === null || !this._isValidElementIndex(elementIndex)) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        const targetBinId = binId || this.appState.activeGroupId;\n        const bin = this._getGroup(pageId, targetBinId);\n        if (!bin) return;\n        const items = bin.items || bin.elements || [];\n        bin.items = items;\n        bin.elements = items;\n        \n        const element = items[elementIndex];\n        if (!element) return;\n        \n        // Check if element's children have their own children (one-level limit)\n        const hasNestedChildren = element.children && element.children.some(child => \n            child.children && child.children.length > 0\n        );\n        if (hasNestedChildren) {\n            alert('This element has children with their own children. One-level nesting limit enforced.');\n            this.hideContextMenu();\n            return;\n        }\n        \n        this.hideContextMenu();\n        // Show modal to select child element type, then add to element's children\n        // Use binId from contextMenuState or find it\n        if (targetBinId) {\n            this.showAddChildElementModal(pageId, targetBinId, elementIndex);\n        }\n    }\n    \n    showAddChildElementModal(pageId, binId, elementIndex) {\n        return this.modalHandler.showAddChildElementModal(pageId, binId, elementIndex);\n    }\n    \n    addElementAfter(pageId, binId, elementIndex, elementType) {\n        const page = this._getDocument(pageId);\n        if (!page) return;\n        \n        const targetBinId = binId || this.appState.activeGroupId;\n        const bin = this._getGroup(pageId, targetBinId);\n        if (!bin) return;\n        const items = bin.items || bin.elements || [];\n        bin.items = items;\n        bin.elements = items;\n        \n        const newElement = this.elementManager.createElementTemplate(elementType);\n        // Insert after the clicked element (at elementIndex + 1)\n        const insertIndex = elementIndex + 1;\n        items.splice(insertIndex, 0, newElement);\n        this.dataManager.saveData();\n        this.render();\n    }\n    \n    handleContextAddPage() {\n        this.hideContextMenu();\n        this.addPage();\n    }\n    \n    handleContextAddElementPage() {\n        const { documentId: pageId, groupId: binId } = this.appState.contextMenuState;\n        const targetPageId = pageId || this.appState.currentDocumentId;\n        const targetBinId = binId || this.appState.activeGroupId;\n        \n        if (!targetPageId || !targetBinId) {\n            this.hideContextMenu();\n            return;\n        }\n        \n        this.hideContextMenu();\n        this.modalHandler.showAddElementModal(targetPageId, targetBinId);\n    }\n    \n    handleContextDeletePage() {\n        const { documentId: pageId } = this.appState.contextMenuState;\n        const targetPageId = pageId || this.appState.currentDocumentId;\n        \n        if (!targetPageId) {\n            this.hideContextMenu();\n            return;\n        }\n        \n        const page = this._getDocument(targetPageId);\n        if (!page) {\n            this.hideContextMenu();\n            return;\n        }\n        \n        this.hideContextMenu();\n        this.deletePage(targetPageId);\n    }\n    \n    handleContextToggleSubtasks() {\n        this.hideContextMenu();\n        this.toggleAllSubtasks();\n    }\n    \n    handleContextResetDay() {\n        this.hideContextMenu();\n        this.resetToday();\n    }\n    \n    handleContextCollapseAllPages() {\n        this.hideContextMenu();\n        \n        // Collapse all pages\n        this.appState.documents.forEach(page => {\n            // Set page state to collapsed\n            this.appState.documentStates[page.id] = false;\n        });\n        \n        // Update UI for all pages using querySelector to ensure we get all\n        const allPageArrows = document.querySelectorAll('[id^=\"page-toggle-\"]');\n        const allPageContents = document.querySelectorAll('[id^=\"page-content-\"]');\n        \n        allPageArrows.forEach(arrow => {\n            arrow.textContent = '';\n        });\n        \n        allPageContents.forEach(content => {\n            content.style.display = 'none';\n        });\n    }\n    \n    handleContextCollapsePage() {\n        const { documentId: pageId } = this.appState.contextMenuState;\n        if (pageId === null) return;\n        \n        const page = this._getDocument(pageId);\n        if (!page) return;\n        \n        // Toggle page collapse state\n        const pageStates = this.appState.documentStates || {};\n        if (!(pageId in pageStates)) {\n            this.appState.setDocumentState(pageId, true);\n        } else {\n            const currentState = this.appState.getDocumentState(pageId);\n            this.appState.setDocumentState(pageId, !currentState);\n        }\n        \n        this.hideContextMenu();\n        \n        // Update the page UI\n        const pageToggleId = `page-toggle-${pageId}`;\n        const pageContentId = `page-content-${pageId}`;\n        \n        const arrow = document.getElementById(pageToggleId);\n        const content = document.getElementById(pageContentId);\n        \n        if (arrow && content) {\n            const isExpanded = this.appState.documentStates?.[pageId];\n            arrow.textContent = isExpanded ? '' : '';\n            content.style.display = isExpanded ? 'block' : 'none';\n        }\n    }\n    \n    showEditModal(pageId, binId, elementIndex, element) {\n        // If binId not provided, try to find it from active bin or element location\n        if (!binId) {\n            binId = this.appState.activeGroupId;\n            if (!binId) {\n                const page = this._getDocument(pageId);\n                const groups = page?.groups || page?.bins || [];\n                if (groups.length > 0) {\n                    binId = groups[0].id;\n                }\n            }\n        }\n        return this.modalHandler.showEditModal(pageId, binId, elementIndex, element);\n    }\n    \n    addEditItem() {\n        return this.modalHandler.addEditItem();\n    }\n    \n    removeEditItem(idx) {\n        return this.modalHandler.removeEditItem(idx);\n    }\n    \n    saveEdit(pageId, elementIndex, skipClose = false) {\n        return this.modalHandler.saveEdit(pageId, elementIndex, skipClose);\n    }\n    \n    addEditSubtaskModal() {\n        const container = document.getElementById('edit-subtasks-in-modal');\n        if (!container) return;\n        const idx = container.children.length;\n        const newSubtask = document.createElement('div');\n        newSubtask.className = 'subtask-item';\n        newSubtask.innerHTML = `\n            <input type=\"text\" class=\"edit-subtask-text-modal\" data-index=\"${idx}\" value=\"New subtask\" placeholder=\"Subtask text\" />\n            <input type=\"text\" class=\"edit-subtask-time-modal\" data-index=\"${idx}\" value=\"\" placeholder=\"Time\" />\n            <label class=\"edit-subtask-repeat-label\">\n                <input type=\"checkbox\" class=\"edit-subtask-repeats-modal\" data-index=\"${idx}\" checked />\n                Repeats\n            </label>\n            <button onclick=\"app.removeEditSubtaskModal(${idx})\" class=\"remove-subtask-btn\"></button>\n        `;\n        container.appendChild(newSubtask);\n        // Scroll to bottom to show new item\n        container.scrollTop = container.scrollHeight;\n    }\n    \n    removeEditSubtaskModal(idx) {\n        return this.modalHandler.removeEditSubtaskModal(idx);\n    }\n    \n    removeAllSubtasksModal() {\n        return this.modalHandler.removeAllSubtasksModal();\n    }\n    \n    addEditChildModal() {\n        return this.modalHandler.addEditChildModal();\n    }\n    \n    removeEditChildModal(idx) {\n        return this.modalHandler.removeEditChildModal(idx);\n    }\n    \n    removeAllChildrenModal() {\n        return this.modalHandler.removeAllChildrenModal();\n    }\n    \n    toggleArchiveViewInEdit(pageId, elementIndex) {\n        return this.modalHandler.toggleArchiveViewInEdit(pageId, elementIndex);\n    }\n    \n    showAddSubtasksModal(pageId, elementIndex, element) {\n        return this.modalHandler.showAddSubtasksModal(pageId, elementIndex, element);\n    }\n    \n    addEditSubtask() {\n        const container = document.getElementById('edit-subtasks');\n        const idx = container.children.length;\n        const newSubtask = document.createElement('div');\n        newSubtask.className = 'subtask-item';\n        newSubtask.innerHTML = `\n            <input type=\"text\" class=\"edit-subtask-text\" data-index=\"${idx}\" value=\"New subtask\" />\n            <input type=\"text\" class=\"edit-subtask-time\" data-index=\"${idx}\" value=\"\" placeholder=\"Time\" />\n            <label>\n                <input type=\"checkbox\" class=\"edit-subtask-repeats\" data-index=\"${idx}\" checked />\n                Repeats\n            </label>\n            <button onclick=\"app.removeEditSubtask(${idx})\"></button>\n        `;\n        container.appendChild(newSubtask);\n    }\n    \n    removeEditSubtask(idx) {\n        const container = document.getElementById('edit-subtasks');\n        const item = container.querySelector(`.edit-subtask-text[data-index=\"${idx}\"]`)?.closest('.subtask-item');\n        if (item) {\n            item.remove();\n        }\n    }\n    \n    saveChildren(pageId, elementIndex) {\n        return this.modalHandler.saveChildren(pageId, elementIndex);\n    }\n    \n    // Legacy method name for backward compatibility\n    saveSubtasks(pageId, elementIndex) {\n        return this.modalHandler.saveSubtasks(pageId, elementIndex);\n    }\n    \n    showViewDataModal(element, isSubtask = false) {\n        return this.modalHandler.showViewDataModal(element, isSubtask);\n    }\n    \n    closeModal() {\n        return this.modalHandler.closeModal();\n    }\n    \n    showTooltip(text) {\n        const tooltip = document.getElementById('global-tooltip');\n        if (tooltip) {\n            tooltip.textContent = text;\n            tooltip.classList.add('visible');\n        }\n    }\n    \n    hideTooltip() {\n        const tooltip = document.getElementById('global-tooltip');\n        if (tooltip) {\n            tooltip.classList.remove('visible');\n        }\n    }\n    \n    showAudioRecordingModal() {\n        return this.audioHandler.showAudioRecordingModal();\n    }\n    \n    async startAudioRecording() {\n        return this.audioHandler.startAudioRecording();\n    }\n    \n    stopAudioRecording() {\n        return this.audioHandler.stopAudioRecording();\n    }\n    \n    async saveAudioRecording() {\n        return this.audioHandler.saveAudioRecording();\n    }\n    \n    closeAudioRecordingModal() {\n        return this.audioHandler.closeAudioRecordingModal();\n    }\n    \n    // Inline audio recording methods - delegate to AudioHandler\n    async startInlineRecording(pageId, binId, elementIndex, originalElementIndex = null, shouldOverwrite = false) {\n        return this.audioHandler.startInlineRecording(pageId, binId, elementIndex, originalElementIndex, shouldOverwrite);\n    }\n    \n    async stopInlineRecording(pageId, binId, elementIndex, originalElementIndex = null) {\n        return this.audioHandler.stopInlineRecording(pageId, binId, elementIndex, originalElementIndex);\n    }\n    \n    async saveInlineRecording(pageId, binId, elementIndex, chunks, domElementIndex = null) {\n        return this.audioHandler.saveInlineRecording(pageId, binId, elementIndex, chunks, domElementIndex);\n    }\n    \n    async appendInlineRecording(pageId, binId, elementIndex, originalElementIndex = null) {\n        return this.audioHandler.appendInlineRecording(pageId, binId, elementIndex, originalElementIndex);\n    }\n    \n    async playInlineAudio(pageId, binId, elementIndex) {\n        return this.audioHandler.playInlineAudio(pageId, binId, elementIndex);\n    }\n    \n    stopInlineAudio(pageId, binId, elementIndex) {\n        return this.audioHandler.stopInlineAudio(pageId, binId, elementIndex);\n    }\n    \n    showAudioProgressBar(pageId, binId, elementIndex) {\n        return this.audioHandler.showAudioProgressBar(pageId, binId, elementIndex);\n    }\n    \n    hideAudioProgressBar(pageId, binId, elementIndex) {\n        return this.audioHandler.hideAudioProgressBar(pageId, binId, elementIndex);\n    }\n    \n    updateAudioStatus(pageId, binId, elementIndex, text, color) {\n        return this.audioHandler.updateAudioStatus(pageId, binId, elementIndex, text, color);\n    }\n    \n    toggleArchiveView(pageId, binId, elementIndex) {\n        return this.audioHandler.toggleArchiveView(pageId, binId, elementIndex);\n    }\n    \n}\n\n// Initialize app\nlet app;\ndocument.addEventListener('DOMContentLoaded', () => {\n    app = new TodoApp();\n    // Make app globally accessible for onclick handlers in modals\n    window.app = app;\n});\n\n\n\n","// BasePlugin - Base class for page and bin plugins\r\nimport { eventBus } from './EventBus.js';\r\nimport { DataUtils } from '../utils/data.js';\r\nimport { StorageUtils } from '../utils/storage.js';\r\n\r\nexport class BasePlugin {\r\n    constructor(config = {}) {\r\n        this.id = config.id || this.constructor.name.toLowerCase();\r\n        this.name = config.name || this.id;\r\n        this.type = config.type || 'plugin'; // 'page' or 'bin'\r\n        this.version = config.version || '1.0.0';\r\n        this.description = config.description || '';\r\n        this.dependencies = config.dependencies || [];\r\n        this.config = DataUtils.deepMerge({}, config.defaultConfig || {});\r\n        this.enabled = false;\r\n        this.app = null;\r\n    }\r\n    \r\n    /**\r\n     * Initialize plugin\r\n     * @param {Object} app - App instance\r\n     * @returns {Promise<void>}\r\n     */\r\n    async init(app) {\r\n        this.app = app;\r\n        \r\n        // Load saved configuration\r\n        const savedConfig = StorageUtils.get(`plugin:${this.id}:config`, null);\r\n        if (savedConfig) {\r\n            this.config = DataUtils.deepMerge(this.config, savedConfig);\r\n        }\r\n        \r\n        // Subscribe to events\r\n        this.setupEventListeners();\r\n        \r\n        // Call custom initialization\r\n        await this.onInit();\r\n    }\r\n    \r\n    /**\r\n     * Custom initialization hook (override in subclasses)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onInit() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Enable plugin\r\n     * @returns {Promise<void>}\r\n     */\r\n    async enable() {\r\n        if (this.enabled) return;\r\n        \r\n        await this.onEnable();\r\n        this.enabled = true;\r\n        eventBus.emit('plugin:enabled', { pluginId: this.id });\r\n    }\r\n    \r\n    /**\r\n     * Custom enable hook (override in subclasses)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onEnable() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Disable plugin\r\n     * @returns {Promise<void>}\r\n     */\r\n    async disable() {\r\n        if (!this.enabled) return;\r\n        \r\n        await this.onDisable();\r\n        this.enabled = false;\r\n        eventBus.emit('plugin:disabled', { pluginId: this.id });\r\n    }\r\n    \r\n    /**\r\n     * Custom disable hook (override in subclasses)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onDisable() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Destroy plugin\r\n     * @returns {Promise<void>}\r\n     */\r\n    async destroy() {\r\n        await this.disable();\r\n        this.removeEventListeners();\r\n        await this.onDestroy();\r\n        this.app = null;\r\n    }\r\n    \r\n    /**\r\n     * Custom destroy hook (override in subclasses)\r\n     * @returns {Promise<void>}\r\n     */\r\n    async onDestroy() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Setup event listeners (override in subclasses)\r\n     */\r\n    setupEventListeners() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Remove event listeners (override in subclasses)\r\n     */\r\n    removeEventListeners() {\r\n        // Override in subclasses\r\n    }\r\n    \r\n    /**\r\n     * Get plugin configuration\r\n     * @returns {Object}\r\n     */\r\n    getConfig() {\r\n        return DataUtils.deepClone(this.config);\r\n    }\r\n    \r\n    /**\r\n     * Update plugin configuration\r\n     * @param {Object} newConfig - New configuration\r\n     * @param {boolean} save - Save to storage\r\n     */\r\n    updateConfig(newConfig, save = true) {\r\n        this.config = DataUtils.deepMerge(this.config, newConfig);\r\n        \r\n        if (save) {\r\n            StorageUtils.set(`plugin:${this.id}:config`, this.config);\r\n        }\r\n        \r\n        eventBus.emit('plugin:config:updated', {\r\n            pluginId: this.id,\r\n            config: this.config\r\n        });\r\n    }\r\n    \r\n    /**\r\n     * Reset configuration to defaults\r\n     */\r\n    resetConfig() {\r\n        // This should be overridden to provide default config\r\n        this.config = {};\r\n        StorageUtils.remove(`plugin:${this.id}:config`);\r\n    }\r\n    \r\n    /**\r\n     * Render plugin UI (override in subclasses)\r\n     * @param {HTMLElement} container - Container element\r\n     * @param {Object} context - Context data (page/bin)\r\n     * @returns {HTMLElement}\r\n     */\r\n    render(container, context) {\r\n        // Override in subclasses\r\n        return container;\r\n    }\r\n    \r\n    /**\r\n     * Render plugin configuration UI (override in subclasses)\r\n     * @param {HTMLElement} container - Container element\r\n     * @returns {HTMLElement}\r\n     */\r\n    renderConfigUI(container) {\r\n        // Override in subclasses\r\n        return container;\r\n    }\r\n    \r\n    /**\r\n     * Get plugin metadata\r\n     * @returns {Object}\r\n     */\r\n    getMetadata() {\r\n        return {\r\n            id: this.id,\r\n            name: this.name,\r\n            type: this.type,\r\n            version: this.version,\r\n            description: this.description,\r\n            dependencies: this.dependencies,\r\n            enabled: this.enabled\r\n        };\r\n    }\r\n}\r\n\r\n"],"file":"assets/index-XsTijtuR.js"}