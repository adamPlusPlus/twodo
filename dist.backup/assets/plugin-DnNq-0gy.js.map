{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["../../js/plugins/page/SearchFilter.js"],"sourcesContent":["// SearchFilter.js - Page plugin for search and filter functionality\r\nimport { BasePlugin } from '../../core/BasePlugin.js';\r\nimport { DOMUtils } from '../../utils/dom.js';\r\nimport { StringUtils } from '../../utils/string.js';\r\nimport { getService, SERVICES } from '../../core/AppServices.js';\r\n\r\nexport default class SearchFilter extends BasePlugin {\r\n    constructor(app = null, config = {}) {\r\n        super({\r\n            id: 'search-filter',\r\n            name: 'Search & Filter',\r\n            description: 'Global search and filter across all documents and items.',\r\n            type: 'page',\r\n            defaultConfig: {\r\n                enabled: true,\r\n                searchHistory: [],\r\n                savedSearches: []\r\n            },\r\n            ...config\r\n        });\r\n        if (app) {\r\n            this.app = app;\r\n        }\r\n        this.searchResults = [];\r\n        this.currentFilters = {};\r\n    }\r\n\r\n    async onInit() {\r\n        if (this.config.enabled && this.app && this.app.eventBus) {\r\n            this.injectSearchUI();\r\n            this.app.eventBus.on('element:created', this.handleElementChange.bind(this));\r\n            this.app.eventBus.on('element:updated', this.handleElementChange.bind(this));\r\n            this.app.eventBus.on('element:deleted', this.handleElementChange.bind(this));\r\n        }\r\n    }\r\n\r\n    async onDestroy() {\r\n        if (this.app && this.app.eventBus) {\r\n            this.app.eventBus.off('element:created', this.handleElementChange.bind(this));\r\n            this.app.eventBus.off('element:updated', this.handleElementChange.bind(this));\r\n            this.app.eventBus.off('element:deleted', this.handleElementChange.bind(this));\r\n        }\r\n    }\r\n\r\n    handleElementChange() {\r\n        // Rebuild search index when items change\r\n        if (this.app.searchIndex) {\r\n            this.app.searchIndex.rebuildIndex();\r\n        }\r\n    }\r\n\r\n    injectSearchUI() {\r\n        // Find or create search container as a modal/dropdown\r\n        let searchContainer = document.getElementById('global-search-container');\r\n        if (!searchContainer) {\r\n            // Create as a modal-style overlay\r\n            searchContainer = DOMUtils.createElement('div', {\r\n                id: 'global-search-container',\r\n                style: 'display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10000; background: #2a2a2a; padding: 20px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.5); min-width: 400px; max-width: 600px;'\r\n            });\r\n            document.body.appendChild(searchContainer);\r\n        }\r\n        \r\n        // Setup search button click handler\r\n        const searchBtn = document.getElementById('search-btn');\r\n        if (searchBtn && !searchBtn.dataset.searchHandlerAttached) {\r\n            searchBtn.dataset.searchHandlerAttached = 'true';\r\n            searchBtn.addEventListener('click', () => {\r\n                const isVisible = searchContainer.style.display !== 'none';\r\n                if (isVisible) {\r\n                    searchContainer.style.display = 'none';\r\n                } else {\r\n                    searchContainer.style.display = 'block';\r\n                    // Focus search input when opened\r\n                    const searchInput = searchContainer.querySelector('#global-search-input');\r\n                    if (searchInput) {\r\n                        setTimeout(() => searchInput.focus(), 100);\r\n                    }\r\n                }\r\n            });\r\n            \r\n            // Close on escape key\r\n            document.addEventListener('keydown', (e) => {\r\n                if (e.key === 'Escape' && searchContainer.style.display !== 'none') {\r\n                    searchContainer.style.display = 'none';\r\n                }\r\n            });\r\n            \r\n            // Close when clicking outside\r\n            document.addEventListener('click', (e) => {\r\n                if (searchContainer.style.display !== 'none' && \r\n                    !searchContainer.contains(e.target) && \r\n                    e.target !== searchBtn) {\r\n                    searchContainer.style.display = 'none';\r\n                }\r\n            });\r\n        }\r\n\r\n        searchContainer.innerHTML = `\r\n            <div style=\"display: flex; gap: 5px; margin-bottom: 10px;\">\r\n                <input type=\"text\" id=\"global-search-input\" placeholder=\"Search all items...\" \r\n                       style=\"flex: 1; padding: 8px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px;\" />\r\n                <button id=\"global-search-btn\" style=\"padding: 8px 15px; background: #4a9eff; color: white; border: none; border-radius: 4px; cursor: pointer;\">Search</button>\r\n                <button id=\"global-filter-toggle\" style=\"padding: 8px; background: #3a3a3a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; cursor: pointer;\" title=\"Toggle Filters\">⚙</button>\r\n            </div>\r\n            <div id=\"global-filter-panel\" style=\"display: none; margin-top: 10px; padding: 10px; background: #1a1a1a; border-radius: 4px;\">\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <label style=\"display: block; margin-bottom: 5px; font-size: 12px;\">Tags:</label>\r\n                    <select id=\"filter-tags\" multiple style=\"width: 100%; padding: 5px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; font-size: 12px;\">\r\n                    </select>\r\n                </div>\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <label style=\"display: block; margin-bottom: 5px; font-size: 12px;\">Type:</label>\r\n                    <select id=\"filter-type\" multiple style=\"width: 100%; padding: 5px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; font-size: 12px;\">\r\n                    </select>\r\n                </div>\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <label style=\"display: flex; align-items: center; gap: 8px; font-size: 12px;\">\r\n                        <input type=\"checkbox\" id=\"filter-completed\" />\r\n                        <span>Completed</span>\r\n                    </label>\r\n                    <label style=\"display: flex; align-items: center; gap: 8px; font-size: 12px; margin-top: 5px;\">\r\n                        <input type=\"checkbox\" id=\"filter-has-deadline\" />\r\n                        <span>Has Deadline</span>\r\n                    </label>\r\n                </div>\r\n                <div style=\"margin-bottom: 10px;\">\r\n                    <label style=\"display: block; margin-bottom: 5px; font-size: 12px;\">Page:</label>\r\n                    <select id=\"filter-page\" multiple style=\"width: 100%; padding: 5px; background: #2a2a2a; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; font-size: 12px;\">\r\n                    </select>\r\n                </div>\r\n                <button id=\"clear-filters-btn\" style=\"width: 100%; padding: 5px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;\">Clear Filters</button>\r\n            </div>\r\n            <div id=\"search-results-container\" style=\"display: none; margin-top: 10px; max-height: 400px; overflow-y: auto; background: #1a1a1a; border-radius: 4px; padding: 10px;\">\r\n                <div id=\"search-results-list\"></div>\r\n            </div>\r\n        `;\r\n\r\n        this.setupEventListeners();\r\n        this.populateFilterOptions();\r\n        \r\n        // Setup close button\r\n        const closeBtn = searchContainer.querySelector('#search-close-btn');\r\n        if (closeBtn) {\r\n            closeBtn.addEventListener('click', () => {\r\n                searchContainer.style.display = 'none';\r\n            });\r\n        }\r\n    }\r\n\r\n    setupEventListeners() {\r\n        const searchInput = document.getElementById('global-search-input');\r\n        const searchBtn = document.getElementById('global-search-btn');\r\n        const filterToggle = document.getElementById('global-filter-toggle');\r\n        const filterPanel = document.getElementById('global-filter-panel');\r\n        const clearFiltersBtn = document.getElementById('clear-filters-btn');\r\n\r\n        // Search on button click\r\n        if (searchBtn) {\r\n            searchBtn.addEventListener('click', () => this.performSearch());\r\n        }\r\n\r\n        // Search on Enter key\r\n        if (searchInput) {\r\n            searchInput.addEventListener('keypress', (e) => {\r\n                if (e.key === 'Enter') {\r\n                    this.performSearch();\r\n                }\r\n            });\r\n        }\r\n\r\n        // Toggle filter panel\r\n        if (filterToggle && filterPanel) {\r\n            filterToggle.addEventListener('click', () => {\r\n                filterPanel.style.display = filterPanel.style.display === 'none' ? 'block' : 'none';\r\n            });\r\n        }\r\n\r\n        // Clear filters\r\n        if (clearFiltersBtn) {\r\n            clearFiltersBtn.addEventListener('click', () => this.clearFilters());\r\n        }\r\n\r\n        // Filter change handlers\r\n        const filterTags = document.getElementById('filter-tags');\r\n        const filterType = document.getElementById('filter-type');\r\n        const filterCompleted = document.getElementById('filter-completed');\r\n        const filterHasDeadline = document.getElementById('filter-has-deadline');\r\n        const filterPage = document.getElementById('filter-page');\r\n\r\n        if (filterTags) {\r\n            filterTags.addEventListener('change', () => this.applyFilters());\r\n        }\r\n        if (filterType) {\r\n            filterType.addEventListener('change', () => this.applyFilters());\r\n        }\r\n        if (filterCompleted) {\r\n            filterCompleted.addEventListener('change', () => this.applyFilters());\r\n        }\r\n        if (filterHasDeadline) {\r\n            filterHasDeadline.addEventListener('change', () => this.applyFilters());\r\n        }\r\n        if (filterPage) {\r\n            filterPage.addEventListener('change', () => this.applyFilters());\r\n        }\r\n    }\r\n\r\n    populateFilterOptions() {\r\n        if (!this.app.searchIndex) return;\r\n\r\n        const filterTags = document.getElementById('filter-tags');\r\n        const filterType = document.getElementById('filter-type');\r\n        const filterPage = document.getElementById('filter-page');\r\n\r\n        // Populate tags\r\n        if (filterTags) {\r\n            const tags = this.app.searchIndex.getAllTags();\r\n            filterTags.innerHTML = tags.map(tag => \r\n                `<option value=\"${StringUtils.escapeHtml(tag)}\">${StringUtils.escapeHtml(tag)}</option>`\r\n            ).join('');\r\n        }\r\n\r\n        // Populate types\r\n        if (filterType) {\r\n            const types = this.app.searchIndex.getAllTypes();\r\n            filterType.innerHTML = types.map(type => \r\n                `<option value=\"${StringUtils.escapeHtml(type)}\">${StringUtils.escapeHtml(type)}</option>`\r\n            ).join('');\r\n        }\r\n\r\n        // Populate documents\r\n        if (filterPage) {\r\n            const appState = getService(SERVICES.APP_STATE);\r\n            const documents = appState?.documents || [];\r\n            filterPage.innerHTML = documents.map(page => \r\n                `<option value=\"${StringUtils.escapeHtml(page.id)}\">${StringUtils.escapeHtml(page.title || page.id)}</option>`\r\n            ).join('');\r\n        }\r\n    }\r\n\r\n    applyFilters() {\r\n        const filterTags = document.getElementById('filter-tags');\r\n        const filterType = document.getElementById('filter-type');\r\n        const filterCompleted = document.getElementById('filter-completed');\r\n        const filterHasDeadline = document.getElementById('filter-has-deadline');\r\n        const filterPage = document.getElementById('filter-page');\r\n\r\n        this.currentFilters = {};\r\n\r\n        if (filterTags && filterTags.selectedOptions.length > 0) {\r\n            this.currentFilters.tags = Array.from(filterTags.selectedOptions).map(opt => opt.value);\r\n        }\r\n\r\n        if (filterType && filterType.selectedOptions.length > 0) {\r\n            this.currentFilters.type = Array.from(filterType.selectedOptions).map(opt => opt.value);\r\n        }\r\n\r\n        if (filterCompleted && filterCompleted.checked) {\r\n            this.currentFilters.completed = true;\r\n        }\r\n\r\n        if (filterHasDeadline && filterHasDeadline.checked) {\r\n            this.currentFilters.hasDeadline = true;\r\n        }\r\n\r\n        if (filterPage && filterPage.selectedOptions.length > 0) {\r\n            this.currentFilters.pageId = Array.from(filterPage.selectedOptions).map(opt => opt.value);\r\n        }\r\n\r\n        this.performSearch();\r\n    }\r\n\r\n    clearFilters() {\r\n        const filterTags = document.getElementById('filter-tags');\r\n        const filterType = document.getElementById('filter-type');\r\n        const filterCompleted = document.getElementById('filter-completed');\r\n        const filterHasDeadline = document.getElementById('filter-has-deadline');\r\n        const filterPage = document.getElementById('filter-page');\r\n\r\n        if (filterTags) filterTags.selectedIndex = -1;\r\n        if (filterType) filterType.selectedIndex = -1;\r\n        if (filterCompleted) filterCompleted.checked = false;\r\n        if (filterHasDeadline) filterHasDeadline.checked = false;\r\n        if (filterPage) filterPage.selectedIndex = -1;\r\n\r\n        this.currentFilters = {};\r\n        this.performSearch();\r\n    }\r\n\r\n    performSearch() {\r\n        const searchInput = document.getElementById('global-search-input');\r\n        const query = searchInput ? searchInput.value.trim() : '';\r\n        const resultsContainer = document.getElementById('search-results-container');\r\n        const resultsList = document.getElementById('search-results-list');\r\n\r\n        if (!this.app.searchIndex) {\r\n            console.warn('SearchIndex not available');\r\n            return;\r\n        }\r\n\r\n        this.searchResults = this.app.searchIndex.search(query, this.currentFilters);\r\n\r\n        if (resultsContainer && resultsList) {\r\n            if (this.searchResults.length === 0) {\r\n                resultsList.innerHTML = '<div style=\"padding: 10px; color: #888; text-align: center;\">No results found</div>';\r\n            } else {\r\n                resultsList.innerHTML = this.searchResults.map(result => {\r\n                    const pageTitle = StringUtils.escapeHtml(result.pageTitle || result.pageId);\r\n                    const binTitle = StringUtils.escapeHtml(result.binTitle || result.binId);\r\n                    const elementText = StringUtils.escapeHtml(result.text || 'Untitled');\r\n                    const tags = result.tags.map(tag => \r\n                        `<span style=\"background: #4a9eff; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-right: 3px;\">${StringUtils.escapeHtml(tag)}</span>`\r\n                    ).join('');\r\n\r\n                    return `\r\n                        <div class=\"search-result-item\" \r\n                             data-page-id=\"${StringUtils.escapeHtml(result.pageId)}\"\r\n                             data-bin-id=\"${StringUtils.escapeHtml(result.binId)}\"\r\n                             data-element-index=\"${result.elementIndex}\"\r\n                             style=\"padding: 8px; margin-bottom: 5px; background: #2a2a2a; border-radius: 4px; cursor: pointer; border-left: 3px solid #4a9eff;\"\r\n                             onmouseover=\"this.style.background='#3a3a3a'\"\r\n                             onmouseout=\"this.style.background='#2a2a2a'\">\r\n                            <div style=\"font-weight: bold; margin-bottom: 3px;\">${elementText}</div>\r\n                            <div style=\"font-size: 11px; color: #888; margin-bottom: 3px;\">\r\n                                ${pageTitle} → ${binTitle}\r\n                            </div>\r\n                            ${tags ? `<div style=\"margin-top: 3px;\">${tags}</div>` : ''}\r\n                        </div>\r\n                    `;\r\n                }).join('');\r\n\r\n                // Add click handlers\r\n                resultsList.querySelectorAll('.search-result-item').forEach(item => {\r\n                    item.addEventListener('click', () => {\r\n                        const pageId = item.dataset.pageId;\r\n                        const binId = item.dataset.binId;\r\n                        const elementIndex = parseInt(item.dataset.elementIndex);\r\n                        \r\n                        // Navigate to element using NavigationHelper\r\n                        import('../../utils/NavigationHelper.js').then(({ NavigationHelper }) => {\r\n                            NavigationHelper.navigateToElement(pageId, binId, elementIndex, this.app, {\r\n                                highlightColor: '#4a9eff'\r\n                            });\r\n                        });\r\n                        \r\n                        // Close results\r\n                        if (resultsContainer) {\r\n                            resultsContainer.style.display = 'none';\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n\r\n            resultsContainer.style.display = 'block';\r\n        }\r\n\r\n        // Save to search history\r\n        if (query && !this.config.searchHistory.includes(query)) {\r\n            this.config.searchHistory.unshift(query);\r\n            this.config.searchHistory = this.config.searchHistory.slice(0, 10); // Keep last 10\r\n            this.updateConfig({ searchHistory: this.config.searchHistory }, true);\r\n        }\r\n    }\r\n}\r\n\r\n"],"file":"assets/plugin-DnNq-0gy.js"}